/*! V1.3.3, Â© INA 2023 */
/**
 * Copyright (c) 2015-2023 Institut National de l'Audiovisuel, INA
 *
 * This file is part of amalia.js
 *
 * Amalia.js is free software: you can redistribute it and/or modify it under
 * the terms of the MIT License
 *
 * Redistributions of source code, javascript and css minified versions must
 * retain the above copyright notice, this list of conditions and the following
 * disclaimer
 *
 * Neither the name of the copyright holder nor the names of its contributors
 * may be used to endorse or promote products derived from this software without
 * specific prior written permission
 *
 * You should have received a copy of the MIT License along with
 * amalia.js. If not, see <https://opensource.org/license/mit/>
 *
 * Amalia.js is distributed in the hope that it will be useful, but WITHOUT ANY
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
 * A PARTICULAR PURPOSE.
 */
fr.ina.amalia.player.plugins.PluginBase.extend("fr.ina.amalia.player.plugins.ProgressBarPlugin",{classCss:"ajs-plugin plugin-progress-bar",eventTypes:{}},{container:null,progressBar:null,sliding:!1,sliderStart:0,sliderEnd:1e3,defaultValue:0,initialize:function(){this._super(),this.sliding=!1,this.settings=$.extend({framerate:"25",timeFormat:"f"},this.settings.parameters||{}),this.container=$("<div>",{class:this.Class.classCss}),this.pluginContainer.append(this.container),this.createProgressBarElement(),this.defineListeners()},defineListeners:function(){this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.TIME_CHANGE,{self:this},this.onTimechange),null!==this.logger&&this.logger.trace(this.Class.fullName,"definePlayerListeners")},createProgressBarElement:function(){this.timeIndicatorContainer=$("<div>",{class:"ajs-time-indicator"});var a=$("<span>",{class:"ajs-tooltip-text"});this.timeIndicatorContainer.append(a),this.container.append(this.timeIndicatorContainer),this.progressBar=$("<div>",{class:"ajs-progress-bar"}),this.progressBar.slider({range:"min",min:this.sliderStart,max:this.sliderEnd,value:this.defaultValue,height:20}),this.progressBar.prepend($("<div>",{class:"buffer-bar"})),this.progressBar.on("slidestart",{self:this,component:this.component},this.onSlideStart),this.progressBar.on("slide",{self:this,component:this.component},this.onSlide),this.progressBar.on("slidestop",{self:this,component:this.component},this.onSlideStop),this.container.append(this.progressBar),this.container.find(".ajs-progress-bar").on("mouseover",$.proxy(this.onProgressBarMouseover,this)),this.container.find(".ajs-progress-bar").on("mouseout",$.proxy(this.onProgressBarMouseoout,this)),this.container.find(".ajs-progress-bar").on("mousemove",$.proxy(this.onProgressBarMousemove,this))},setValue:function(a){!1===this.sliding&&this.progressBar.slider("value",10*a)},setTitle:function(a){this.progressBar.attr("title",a)},onTimechange:function(a,b){var c=fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(b.currentTime,a.data.self.settings.framerate,a.data.self.settings.timeFormat);a.data.self.setValue(b.percentage),a.data.self.setTitle(c)},onSlideStart:function(a,b){a.data.self.sliding=!0,a.data.self.mediaPlayer.pause(),a.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.START_SEEKING,{percentage:b.value/10}),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onSlideStart Value : "+b.value)},onSlide:function(a,b){a.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.SEEKING,{percentage:b.value/10})},onSlideStop:function(a,b){a.data.self.sliding=!1;var c=a.data.self.mediaPlayer.getDuration(),d=b.value/10,e=c*d/100;a.data.self.mediaPlayer.setCurrentTime(e+a.data.self.mediaPlayer.getTcOffset()),a.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.STOP_SEEKING,{percentage:b.value/10}),a.data.self.mediaPlayer.play(),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onSlideStop value : "+b.value)},onProgressBarMouseover:function(){this.timeIndicatorContainer.show()},onProgressBarMouseoout:function(){this.timeIndicatorContainer.hide()},onProgressBarMousemove:function(a){var b=$(a.currentTarget),c=this.timeIndicatorContainer.width()/2,d=a.clientX-b.offset().left,e=Math.max(c,Math.min(d,b.width()-c)),f=d*this.mediaPlayer.getDuration()/b.width()+this.mediaPlayer.getTcOffset();this.timeIndicatorContainer.css("left",e),this.timeIndicatorContainer.find(".ajs-tooltip-text").html(fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(f,this.settings.framerate,this.settings.timeFormat))}});