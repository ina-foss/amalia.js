/*! V1.3.3, Â© INA 2023 */
/**
 * Copyright (c) 2015-2023 Institut National de l'Audiovisuel, INA
 *
 * This file is part of amalia.js
 *
 * Amalia.js is free software: you can redistribute it and/or modify it under
 * the terms of the MIT License
 *
 * Redistributions of source code, javascript and css minified versions must
 * retain the above copyright notice, this list of conditions and the following
 * disclaimer
 *
 * Neither the name of the copyright holder nor the names of its contributors
 * may be used to endorse or promote products derived from this software without
 * specific prior written permission
 *
 * You should have received a copy of the MIT License along with
 * amalia.js. If not, see <https://opensource.org/license/mit/>
 *
 * Amalia.js is distributed in the hope that it will be useful, but WITHOUT ANY
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
 * A PARTICULAR PURPOSE.
 */
function X2JS(a,b,c){function d(a){var b=a.localName;return null==b&&(b=a.baseName),(null==b||""==b)&&(b=a.nodeName),b}function e(a){return a.prefix}function f(a){return"string"==typeof a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):a}function g(a){return a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")}function h(f){if(f.nodeType==t.DOCUMENT_NODE){var i,j,k,l=f.firstChild;for(j=0,k=f.childNodes.length;k>j;j+=1)if(f.childNodes[j].nodeType!==t.COMMENT_NODE){l=f.childNodes[j];break}if(c)i=h(l);else{i={};var m=d(l);i[m]=h(l)}return i}if(f.nodeType==t.ELEMENT_NODE){var i=new Object;i.__cnt=0;for(var n=[],o=f.childNodes,p=0;p<o.length;p++){var l=o.item(p),m=d(l);if(i.__cnt++,null==i[m]){var q=h(l);if("#text"!=m||/[^\s]/.test(q)){var r={};r[m]=q,n.push(r)}i[m]=q,i[m+"_asArray"]=new Array(1),i[m+"_asArray"][0]=i[m]}else{if(null!=i[m]&&!(i[m]instanceof Array)){var u=i[m];i[m]=new Array,i[m][0]=u,i[m+"_asArray"]=i[m]}for(var v=0;null!=i[m][v];)v++;var q=h(l);if("#text"!=m||/[^\s]/.test(q)){var r={};r[m]=q,n.push(r)}i[m][v]=q}}i.__children=n;for(var w=0;w<f.attributes.length;w++){var x=f.attributes.item(w);i.__cnt++;for(var y=x.value,z=0,A=a.length;A>z;z++){var B=a[z];B.test.call(this,x)&&(y=B.converter.call(this,x.value))}i[b+x.name]=y}var C=e(f);return null!=C&&""!=C&&(i.__cnt++,i.__prefix=C),1==i.__cnt&&null!=i["#text"]&&(i=i["#text"]),null!=i["#text"]&&(i.__text=i["#text"],s&&(i.__text=g(i.__text)),delete i["#text"],delete i["#text_asArray"]),null!=i["#cdata-section"]&&(i.__cdata=i["#cdata-section"],delete i["#cdata-section"],delete i["#cdata-section_asArray"]),(null!=i.__text||null!=i.__cdata)&&(i.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),i}return f.nodeType==t.TEXT_NODE||f.nodeType==t.CDATA_SECTION_NODE?f.nodeValue:f.nodeType==t.COMMENT_NODE?null:void 0}function i(a,b,c,d){var e="<"+(null!=a&&null!=a.__prefix?a.__prefix+":":"")+b;if(null!=c)for(var f=0;f<c.length;f++){var g=c[f],h=a[g];e+=" "+g.substr(1)+"='"+h+"'"}return e+=d?"/>":">"}function j(a,b){return"</"+(null!=a.__prefix?a.__prefix+":":"")+b+">"}function k(a,b){return-1!==a.indexOf(b,a.length-b.length)}function l(a,b){return!!(k(b.toString(),"_asArray")||0==b.toString().indexOf("_")||a[b]instanceof Function)}function m(a){var b=0;if(a instanceof Object)for(var c in a)l(a,c)||b++;return b}function n(a){var b=[];if(a instanceof Object)for(var c in a)-1==c.toString().indexOf("__")&&0==c.toString().indexOf("_")&&b.push(c);return b}function o(a){var b="";return null!=a.__cdata&&(b+="<![CDATA["+a.__cdata+"]]>"),null!=a.__text&&(b+=s?f(a.__text):a.__text),b}function p(a){var b="";return a instanceof Object?b+=o(a):null!=a&&(b+=s?f(a):a),b}function q(a,b,c){var d="";if(0==a.length)d+=i(a,b,c,!0);else for(var e=0;e<a.length;e++)d+=i(a[e],b,n(a[e]),!1),d+=r(a[e]),d+=j(a[e],b);return d}function r(a){var b="";if(m(a)>0)for(var c in a)if(!l(a,c)){var d=a[c],e=n(d);if(null==d||void 0==d)b+=i(d,c,e,!0);else if(d instanceof Object)if(d instanceof Array)b+=q(d,c,e);else{var f=m(d);f>0||null!=d.__text||null!=d.__cdata?(b+=i(d,c,e,!1),b+=r(d),b+=j(d,c)):b+=i(d,c,e,!0)}else b+=i(d,c,e,!1),b+=p(d),b+=j(d,c)}return b+=p(a)}(null===b||void 0===b)&&(b="_"),(null===c||void 0===c)&&(c=!1);var s=!1,t={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(a){var b;return window.DOMParser?b=(new window.DOMParser).parseFromString(a,"text/xml"):(0==a.indexOf("<?")&&(a=a.substr(a.indexOf("?>")+2)),b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a)),b},this.xml2json=function(a){return h(a)},this.xml_str2json=function(a){var b=this.parseXmlString(a);return this.xml2json(b)},this.json2xml_str=function(a){return r(a)},this.json2xml=function(a){var b=this.json2xml_str(a);return this.parseXmlString(b)},this.getVersion=function(){return"1.0.11"},this.escapeMode=function(a){s=a}}function ObjectIron(a){var b;for(b=[],i=0,len=a.length;i<len;i+=1)a[i].isRoot?b.push("root"):b.push(a[i].name);var c=function(a,b){var c;if(null!==a&&null!==b)for(c in a)a.hasOwnProperty(c)&&(b.hasOwnProperty(c)||(b[c]=a[c]))},d=function(a,b,d){var e,f,g,h,i;if(null!==a&&0!==a.length)for(e=0,f=a.length;f>e;e+=1)g=a[e],b.hasOwnProperty(g.name)&&(d.hasOwnProperty(g.name)?g.merge&&(h=b[g.name],i=d[g.name],"object"==typeof h&&"object"==typeof i?c(h,i):null!=g.mergeFunction?d[g.name]=g.mergeFunction(h,i):d[g.name]=h+i):d[g.name]=b[g.name])},e=function(a,b){var c,f,g,h,i,j,k,l=a;if(null!==l.children&&0!==l.children.length)for(c=0,f=l.children.length;f>c;c+=1)if(j=l.children[c],b.hasOwnProperty(j.name))if(j.isArray)for(i=b[j.name+"_asArray"],g=0,h=i.length;h>g;g+=1)k=i[g],d(l.properties,b,k),e(j,k);else k=b[j.name],d(l.properties,b,k),e(j,k)},f=function(c){var d,g,h,i,j,k,l;if(null===c)return c;if("object"!=typeof c)return c;for(d=0,g=b.length;g>d;d+=1)"root"===b[d]&&(j=a[d],k=c,e(j,k));for(i in c)if(c.hasOwnProperty(i)&&"__children"!=i){if(-1!==(h=b.indexOf(i)))if(j=a[h],j.isArray)for(l=c[i+"_asArray"],d=0,g=l.length;g>d;d+=1)k=l[d],e(j,k);else k=c[i],e(j,k);f(c[i])}return c};return{run:f}}if(function(a){var b={undHash:/_|-/,colons:/::/,words:/([A-Z]+)([A-Z][a-z])/g,lowUp:/([a-z\d])([A-Z])/g,dash:/([a-z\d])([A-Z])/g,replacer:/\{([^\}]+)\}/g,dot:/\./},c=function(a,b,c){return a[b]||c&&(a[b]={})},d=function(a){var b=typeof a;return b&&("function"==b||"object"==b)},e=function(e,f,g){var h,i,j,k=e?e.split(b.dot):[],l=k.length,m=a.isArray(f)?f:[f||window],n=0;if(0==l)return m[0];for(;h=m[n++];){for(j=0;j<l-1&&d(h);j++)h=c(h,k[j],g);if(d(h)&&void 0!==(i=c(h,k[j],g)))return!1===g&&delete h[k[j]],i}},f=a.String=a.extend(a.String||{},{getObject:e,capitalize:function(a,b){return a.charAt(0).toUpperCase()+a.substr(1)},camelize:function(a){return a=f.classize(a),a.charAt(0).toLowerCase()+a.substr(1)},classize:function(a,c){for(var d=a.split(b.undHash),e=0;e<d.length;e++)d[e]=f.capitalize(d[e]);return d.join(c||"")},niceName:function(a){f.classize(parts[i]," ")},underscore:function(a){return a.replace(b.colons,"/").replace(b.words,"$1_$2").replace(b.lowUp,"$1_$2").replace(b.dash,"_").toLowerCase()},sub:function(a,c,d){var f=[];return f.push(a.replace(b.replacer,function(a,b){var g=e(b,c,"boolean"==typeof d?!d:d),h=typeof g;return"object"!==h&&"function"!==h||null===h?""+g:(f.push(g),"")})),f.length<=1?f[0]:f}})}(jQuery),function(a){var b=!1,c=a.makeArray,d=a.isFunction,e=a.isArray,f=a.extend,g=function(a,b){return a.concat(c(b))},h=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,i=function(a,b,c){c=c||a;for(var e in a)c[e]=d(a[e])&&d(b[e])&&h.test(a[e])?function(a,c){return function(){var d,e=this._super;return this._super=b[a],d=c.apply(this,arguments),this._super=e,d}}(e,a[e]):a[e]},j=a.Class=function(){arguments.length&&j.extend.apply(j,arguments)};f(j,{callback:function(a){var b,d=c(arguments);return a=d.shift(),e(a)||(a=[a]),b=this,function(){for(var c,f,h=g(d,arguments),i=a.length,j=0;j<i;j++)(f=a[j])&&(c="string"==typeof f,c&&b._set_called&&(b.called=f),h=(c?b[f]:f).apply(b,h||[]),j<i-1&&(h=!e(h)||h._use_call?[h]:h));return h}},getObject:a.String.getObject,newInstance:function(){var a,b=this.rawInstance();return b.setup&&(a=b.setup.apply(b,arguments)),b.init&&b.init.apply(b,e(a)?a:arguments),b},setup:function(a,b){return this.defaults=f(!0,{},a.defaults,this.defaults),arguments},rawInstance:function(){b=!0;var a=new this;return b=!1,a},extend:function(a,c,d){function e(){if(!b)return this.constructor!==e&&arguments.length?arguments.callee.extend.apply(arguments.callee,arguments):this.Class.newInstance.apply(this.Class,arguments)}"string"!=typeof a&&(d=c,c=a,a=null),d||(d=c,c=null),d=d||{};var h,k,l,m,n=this,o=this.prototype;b=!0,m=new this,b=!1,i(d,o,m);for(h in this)this.hasOwnProperty(h)&&(e[h]=this[h]);if(i(c,this,e),a){var p=a.split(/\./),k=p.pop(),q=j.getObject(p.join("."),window,!0),l=q;q[k]=e}f(e,{prototype:m,namespace:l,shortName:k,constructor:e,fullName:a}),e.prototype.Class=e.prototype.constructor=e;var r=e.setup.apply(e,g([n],arguments));return e.init&&e.init.apply(e,r||[]),e}}),j.prototype.callback=j.callback}(jQuery),function(a){"object"==typeof exports?module.exports=a(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){"use strict";var b={},c=Math.max,d=Math.min;b.c={},b.c.d=a(document),b.c.t=function(a){return a.originalEvent.touches.length-1},b.o=function(){var c=this;this.o=null,this.$=null,this.i=null,this.g=null,this.v=null,this.cv=null,this.x=0,this.y=0,this.w=0,this.h=0,this.$c=null,this.c=null,this.t=0,this.isInit=!1,this.fgColor=null,this.pColor=null,this.dH=null,this.cH=null,this.eH=null,this.rH=null,this.scale=1,this.relative=!1,this.relativeWidth=!1,this.relativeHeight=!1,this.$div=null,this.run=function(){var b=function(a,b){var d;for(d in b)c.o[d]=b[d];c._carve().init(),c._configure()._draw()};if(!this.$.data("kontroled")){if(this.$.data("kontroled",!0),this.extend(),this.o=a.extend({min:void 0!==this.$.data("min")?this.$.data("min"):0,max:void 0!==this.$.data("max")?this.$.data("max"):100,stopper:!0,readOnly:this.$.data("readonly")||"readonly"===this.$.attr("readonly"),cursor:!0===this.$.data("cursor")&&30||this.$.data("cursor")||0,thickness:this.$.data("thickness")&&Math.max(Math.min(this.$.data("thickness"),1),.01)||.35,lineCap:this.$.data("linecap")||"butt",width:this.$.data("width")||200,height:this.$.data("height")||200,displayInput:null==this.$.data("displayinput")||this.$.data("displayinput"),displayPrevious:this.$.data("displayprevious"),fgColor:this.$.data("fgcolor")||"#87CEEB",inputColor:this.$.data("inputcolor"),font:this.$.data("font")||"Arial",fontWeight:this.$.data("font-weight")||"bold",inline:!1,step:this.$.data("step")||1,rotation:this.$.data("rotation"),draw:null,change:null,cancel:null,release:null,format:function(a){return a},parse:function(a){return parseFloat(a)}},this.o),this.o.flip="anticlockwise"===this.o.rotation||"acw"===this.o.rotation,this.o.inputColor||(this.o.inputColor=this.o.fgColor),this.$.is("fieldset")?(this.v={},this.i=this.$.find("input"),this.i.each(function(b){var d=a(this);c.i[b]=d,c.v[b]=c.o.parse(d.val()),d.bind("change blur",function(){var a={};a[b]=d.val(),c.val(c._validate(a))})}),this.$.find("legend").remove()):(this.i=this.$,this.v=this.o.parse(this.$.val()),""===this.v&&(this.v=this.o.min),this.$.bind("change blur",function(){c.val(c._validate(c.o.parse(c.$.val())))})),!this.o.displayInput&&this.$.hide(),this.$c=a(document.createElement("canvas")).attr({width:this.o.width,height:this.o.height}),this.$div=a('<div style="'+(this.o.inline?"display:inline;":"")+"width:"+this.o.width+"px;height:"+this.o.height+'px;"></div>'),this.$.wrap(this.$div).before(this.$c),this.$div=this.$.parent(),"undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement(this.$c[0]),this.c=this.$c[0].getContext?this.$c[0].getContext("2d"):null,!this.c)throw{name:"CanvasNotSupportedException",message:"Canvas not supported. Please use excanvas on IE8.0.",toString:function(){return this.name+": "+this.message}};return this.scale=(window.devicePixelRatio||1)/(this.c.webkitBackingStorePixelRatio||this.c.mozBackingStorePixelRatio||this.c.msBackingStorePixelRatio||this.c.oBackingStorePixelRatio||this.c.backingStorePixelRatio||1),this.relativeWidth=this.o.width%1!=0&&this.o.width.indexOf("%"),this.relativeHeight=this.o.height%1!=0&&this.o.height.indexOf("%"),this.relative=this.relativeWidth||this.relativeHeight,this._carve(),this.v instanceof Object?(this.cv={},this.copy(this.v,this.cv)):this.cv=this.v,this.$.bind("configure",b).parent().bind("configure",b),this._listen()._configure()._xy().init(),this.isInit=!0,this.$.val(this.o.format(this.v)),this._draw(),this}},this._carve=function(){if(this.relative){var a=this.relativeWidth?this.$div.parent().width()*parseInt(this.o.width)/100:this.$div.parent().width(),b=this.relativeHeight?this.$div.parent().height()*parseInt(this.o.height)/100:this.$div.parent().height();this.w=this.h=Math.min(a,b)}else this.w=this.o.width,this.h=this.o.height;return this.$div.css({width:this.w+"px",height:this.h+"px"}),this.$c.attr({width:this.w,height:this.h}),1!==this.scale&&(this.$c[0].width=this.$c[0].width*this.scale,this.$c[0].height=this.$c[0].height*this.scale,this.$c.width(this.w),this.$c.height(this.h)),this},this._draw=function(){var a=!0;c.g=c.c,c.clear(),c.dH&&(a=c.dH()),!1!==a&&c.draw()},this._touch=function(a){var d=function(a){var b=c.xy2val(a.originalEvent.touches[c.t].pageX,a.originalEvent.touches[c.t].pageY);b!=c.cv&&(c.cH&&!1===c.cH(b)||(c.change(c._validate(b)),c._draw()))};return this.t=b.c.t(a),d(a),b.c.d.bind("touchmove.k",d).bind("touchend.k",function(){b.c.d.unbind("touchmove.k touchend.k"),c.val(c.cv)}),this},this._mouse=function(a){var d=function(a){var b=c.xy2val(a.pageX,a.pageY);b!=c.cv&&(c.cH&&!1===c.cH(b)||(c.change(c._validate(b)),c._draw()))};return d(a),b.c.d.bind("mousemove.k",d).bind("keyup.k",function(a){if(27===a.keyCode){if(b.c.d.unbind("mouseup.k mousemove.k keyup.k"),c.eH&&!1===c.eH())return;c.cancel()}}).bind("mouseup.k",function(a){b.c.d.unbind("mousemove.k mouseup.k keyup.k"),c.val(c.cv)}),this},this._xy=function(){var a=this.$c.offset();return this.x=a.left,this.y=a.top,this},this._listen=function(){return this.o.readOnly?this.$.attr("readonly","readonly"):(this.$c.bind("mousedown",function(a){a.preventDefault(),c._xy()._mouse(a)}).bind("touchstart",function(a){a.preventDefault(),c._xy()._touch(a)}),this.listen()),this.relative&&a(window).resize(function(){c._carve().init(),c._draw()}),this},this._configure=function(){return this.o.draw&&(this.dH=this.o.draw),this.o.change&&(this.cH=this.o.change),this.o.cancel&&(this.eH=this.o.cancel),this.o.release&&(this.rH=this.o.release),this.o.displayPrevious?(this.pColor=this.h2rgba(this.o.fgColor,"0.4"),this.fgColor=this.h2rgba(this.o.fgColor,"0.6")):this.fgColor=this.o.fgColor,this},this._clear=function(){this.$c[0].width=this.$c[0].width},this._validate=function(a){var b=~~((a<0?-.5:.5)+a/this.o.step)*this.o.step;return Math.round(100*b)/100},this.listen=function(){},this.extend=function(){},this.init=function(){},this.change=function(a){},this.val=function(a){},this.xy2val=function(a,b){},this.draw=function(){},this.clear=function(){this._clear()},this.h2rgba=function(a,b){var c;return a=a.substring(1,7),c=[parseInt(a.substring(0,2),16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,6),16)],"rgba("+c[0]+","+c[1]+","+c[2]+","+b+")"},this.copy=function(a,b){for(var c in a)b[c]=a[c]}},b.Dial=function(){b.o.call(this),this.startAngle=null,this.xy=null,this.radius=null,this.lineWidth=null,this.cursorExt=null,this.w2=null,this.PI2=2*Math.PI,this.extend=function(){this.o=a.extend({bgColor:this.$.data("bgcolor")||"#EEEEEE",angleOffset:this.$.data("angleoffset")||0,angleArc:this.$.data("anglearc")||360,inline:!0},this.o)},this.val=function(a,b){if(null==a)return this.v;a=this.o.parse(a),!1!==b&&a!=this.v&&this.rH&&!1===this.rH(a)||(this.cv=this.o.stopper?c(d(a,this.o.max),this.o.min):a,this.v=this.cv,this.$.val(this.o.format(this.v)),this._draw())},this.xy2val=function(a,b){var e,f;return e=Math.atan2(a-(this.x+this.w2),-(b-this.y-this.w2))-this.angleOffset,this.o.flip&&(e=this.angleArc-e-this.PI2),this.angleArc!=this.PI2&&e<0&&e>-.5?e=0:e<0&&(e+=this.PI2),f=e*(this.o.max-this.o.min)/this.angleArc+this.o.min,this.o.stopper&&(f=c(d(f,this.o.max),this.o.min)),f},this.listen=function(){var b,e,f,g,h=this,i=function(a){a.preventDefault();var f=a.originalEvent,g=f.detail||f.wheelDeltaX,i=f.detail||f.wheelDeltaY,j=h._validate(h.o.parse(h.$.val()))+(g>0||i>0?h.o.step:g<0||i<0?-h.o.step:0);j=c(d(j,h.o.max),h.o.min),h.val(j,!1),h.rH&&(clearTimeout(b),b=setTimeout(function(){h.rH(j),b=null},100),e||(e=setTimeout(function(){b&&h.rH(j),e=null},200)))},j=1,k={37:-h.o.step,38:h.o.step,39:h.o.step,40:-h.o.step};this.$.bind("keydown",function(b){var e=b.keyCode;if(e>=96&&e<=105&&(e=b.keyCode=e-48),f=parseInt(String.fromCharCode(e)),isNaN(f)&&(13!==e&&8!==e&&9!==e&&189!==e&&(190!==e||h.$.val().match(/\./))&&b.preventDefault(),a.inArray(e,[37,38,39,40])>-1)){b.preventDefault();var i=h.o.parse(h.$.val())+k[e]*j;h.o.stopper&&(i=c(d(i,h.o.max),h.o.min)),h.change(h._validate(i)),h._draw(),g=window.setTimeout(function(){j*=2},30)}}).bind("keyup",function(a){isNaN(f)?g&&(window.clearTimeout(g),g=null,j=1,h.val(h.$.val())):h.$.val()>h.o.max&&h.$.val(h.o.max)||h.$.val()<h.o.min&&h.$.val(h.o.min)}),this.$c.bind("mousewheel DOMMouseScroll",i),this.$.bind("mousewheel DOMMouseScroll",i)},this.init=function(){(this.v<this.o.min||this.v>this.o.max)&&(this.v=this.o.min),this.$.val(this.v),this.w2=this.w/2,this.cursorExt=this.o.cursor/100,this.xy=this.w2*this.scale,this.lineWidth=this.xy*this.o.thickness,this.lineCap=this.o.lineCap,this.radius=this.xy-this.lineWidth/2,this.o.angleOffset&&(this.o.angleOffset=isNaN(this.o.angleOffset)?0:this.o.angleOffset),this.o.angleArc&&(this.o.angleArc=isNaN(this.o.angleArc)?this.PI2:this.o.angleArc),this.angleOffset=this.o.angleOffset*Math.PI/180,this.angleArc=this.o.angleArc*Math.PI/180,this.startAngle=1.5*Math.PI+this.angleOffset,this.endAngle=1.5*Math.PI+this.angleOffset+this.angleArc;var a=c(String(Math.abs(this.o.max)).length,String(Math.abs(this.o.min)).length,2)+2;this.o.displayInput&&this.i.css({width:(this.w/2+4>>0)+"px",height:(this.w/3>>0)+"px",position:"absolute","vertical-align":"middle","margin-top":(this.w/3>>0)+"px","margin-left":"-"+(3*this.w/4+2>>0)+"px",border:0,background:"none",font:this.o.fontWeight+" "+(this.w/a>>0)+"px "+this.o.font,"text-align":"center",color:this.o.inputColor||this.o.fgColor,padding:"0px","-webkit-appearance":"none"})||this.i.css({width:"0px",visibility:"hidden"})},this.change=function(a){this.cv=a,this.$.val(this.o.format(a))},this.angle=function(a){return(a-this.o.min)*this.angleArc/(this.o.max-this.o.min)},this.arc=function(a){var b,c;return a=this.angle(a),this.o.flip?(b=this.endAngle+1e-5,c=b-a-1e-5):(b=this.startAngle-1e-5,c=b+a+1e-5),this.o.cursor&&(b=c-this.cursorExt)&&(c+=this.cursorExt),{s:b,e:c,d:this.o.flip&&!this.o.cursor}},this.draw=function(){var a,b=this.g,c=this.arc(this.cv),d=1;b.lineWidth=this.lineWidth,b.lineCap=this.lineCap,"none"!==this.o.bgColor&&(b.beginPath(),b.strokeStyle=this.o.bgColor,b.arc(this.xy,this.xy,this.radius,this.endAngle-1e-5,this.startAngle+1e-5,!0),b.stroke()),this.o.displayPrevious&&(a=this.arc(this.v),b.beginPath(),b.strokeStyle=this.pColor,b.arc(this.xy,this.xy,this.radius,a.s,a.e,a.d),b.stroke(),d=this.cv==this.v),b.beginPath(),b.strokeStyle=d?this.o.fgColor:this.fgColor,b.arc(this.xy,this.xy,this.radius,c.s,c.e,c.d),b.stroke()},this.cancel=function(){this.val(this.v)}},a.fn.dial=a.fn.knob=function(c){return this.each(function(){var d=new b.Dial;d.o=c,d.$=a(this),d.run()}).parent()}}),function(a){function b(a,b){if(!(a.originalEvent.touches.length>1)){a.preventDefault();var c=a.originalEvent.changedTouches[0],d=document.createEvent("MouseEvents");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),a.target.dispatchEvent(d)}}if(a.support.touch="ontouchend"in document,a.support.touch){var c,d=a.ui.mouse.prototype,e=d._mouseInit,f=d._mouseDestroy;d._touchStart=function(a){var d=this;!c&&d._mouseCapture(a.originalEvent.changedTouches[0])&&(c=!0,d._touchMoved=!1,b(a,"mouseover"),b(a,"mousemove"),b(a,"mousedown"))},d._touchMove=function(a){c&&(this._touchMoved=!0,b(a,"mousemove"))},d._touchEnd=function(a){c&&(b(a,"mouseup"),b(a,"mouseout"),this._touchMoved||b(a,"click"),c=!1)},d._mouseInit=function(){var b=this;b.element.bind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),e.call(b)},d._mouseDestroy=function(){var b=this;b.element.unbind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),f.call(b)}}}(jQuery),function(a){"use strict";var b={VERSION:"0.5.3"};b.System=function(){this._mappings={},this._outlets={},this._handlers={},this.strictInjections=!0,this.autoMapOutlets=!1,this.postInjectionHook="setup"},b.System.prototype={_createAndSetupInstance:function(a,b){var c=new b;return this.injectInto(c,a),c},_retrieveFromCacheOrCreate:function(a,b){void 0===b&&(b=!1);var c;if(!this._mappings.hasOwnProperty(a))throw new Error(1e3);var d=this._mappings[a];return!b&&d.isSingleton?(null==d.object&&(d.object=this._createAndSetupInstance(a,d.clazz)),c=d.object):c=d.clazz?this._createAndSetupInstance(a,d.clazz):d.object,c},mapOutlet:function(a,b,c){if(void 0===a)throw new Error(1010);return b=b||"global",c=c||a,this._outlets.hasOwnProperty(b)||(this._outlets[b]={}),this._outlets[b][c]=a,this},getObject:function(a){if(void 0===a)throw new Error(1020);return this._retrieveFromCacheOrCreate(a)},mapValue:function(a,b){if(void 0===a)throw new Error(1030);return this._mappings[a]={clazz:null,object:b,isSingleton:!0},this.autoMapOutlets&&this.mapOutlet(a),this.hasMapping(a)&&this.injectInto(b,a),this},hasMapping:function(a){if(void 0===a)throw new Error(1040);return this._mappings.hasOwnProperty(a)},mapClass:function(a,b){if(void 0===a)throw new Error(1050);if(void 0===b)throw new Error(1051);return this._mappings[a]={clazz:b,object:null,isSingleton:!1},this.autoMapOutlets&&this.mapOutlet(a),this},mapSingleton:function(a,b){if(void 0===a)throw new Error(1060);if(void 0===b)throw new Error(1061);return this._mappings[a]={clazz:b,object:null,isSingleton:!0},this.autoMapOutlets&&this.mapOutlet(a),this},instantiate:function(a){if(void 0===a)throw new Error(1070);return this._retrieveFromCacheOrCreate(a,!0)},injectInto:function(a,b){if(void 0===a)throw new Error(1080);if("object"==typeof a){var c=[];this._outlets.hasOwnProperty("global")&&c.push(this._outlets.global),void 0!==b&&this._outlets.hasOwnProperty(b)&&c.push(this._outlets[b]);for(var d in c){var e=c[d];for(var f in e){var g=e[f];(!this.strictInjections||f in a)&&(a[f]=this.getObject(g))}}"setup"in a&&a.setup.call(a)}return this},unmap:function(a){if(void 0===a)throw new Error(1090);return delete this._mappings[a],this},unmapOutlet:function(a,b){if(void 0===a)throw new Error(1100);if(void 0===b)throw new Error(1101);return delete this._outlets[a][b],this},mapHandler:function(a,b,c,d,e){if(void 0===a)throw new Error(1110);return b=b||"global",c=c||a,void 0===d&&(d=!1),void 0===e&&(e=!1),this._handlers.hasOwnProperty(a)||(this._handlers[a]={}),this._handlers[a].hasOwnProperty(b)||(this._handlers[a][b]=[]),this._handlers[a][b].push({handler:c,oneShot:d,passEvent:e}),this},unmapHandler:function(a,b,c){if(void 0===a)throw new Error(1120);if(b=b||"global",c=c||a,this._handlers.hasOwnProperty(a)&&this._handlers[a].hasOwnProperty(b)){var d=this._handlers[a][b];for(var e in d){if(d[e].handler===c){d.splice(e,1);break}}}return this},notify:function(a){if(void 0===a)throw new Error(1130);var b=Array.prototype.slice.call(arguments),c=b.slice(1);if(this._handlers.hasOwnProperty(a)){var d=this._handlers[a];for(var e in d){var f,g=d[e];"global"!==e&&(f=this.getObject(e));var h,i,j=[];for(h=0,i=g.length;i>h;h++){var k,l=g[h];k=f&&"string"==typeof l.handler?f[l.handler]:l.handler,l.oneShot&&j.unshift(h),l.passEvent?k.apply(f,b):k.apply(f,c)}for(h=0,i=j.length;i>h;h++)g.splice(j[h],1)}}return this}},a.dijon=b}(this),void 0===utils)var utils={};void 0===utils.Math&&(utils.Math={}),utils.Math.to64BitNumber=function(a,b){var c,d,e;return c=new goog.math.Long(0,b),d=new goog.math.Long(a,0),e=c.add(d),e.toNumber()},goog={},goog.math={},goog.math.Long=function(a,b){this.low_=0|a,this.high_=0|b},goog.math.Long.IntCache_={},goog.math.Long.fromInt=function(a){if(a>=-128&&128>a){var b=goog.math.Long.IntCache_[a];if(b)return b}var c=new goog.math.Long(0|a,0>a?-1:0);return a>=-128&&128>a&&(goog.math.Long.IntCache_[a]=c),c},goog.math.Long.fromNumber=function(a){return isNaN(a)||!isFinite(a)?goog.math.Long.ZERO:a<=-goog.math.Long.TWO_PWR_63_DBL_?goog.math.Long.MIN_VALUE:a+1>=goog.math.Long.TWO_PWR_63_DBL_?goog.math.Long.MAX_VALUE:0>a?goog.math.Long.fromNumber(-a).negate():new goog.math.Long(a%goog.math.Long.TWO_PWR_32_DBL_|0,a/goog.math.Long.TWO_PWR_32_DBL_|0)},goog.math.Long.fromBits=function(a,b){return new goog.math.Long(a,b)},goog.math.Long.fromString=function(a,b){if(0==a.length)throw Error("number format error: empty string");var c=b||10;if(2>c||c>36)throw Error("radix out of range: "+c);if("-"==a.charAt(0))return goog.math.Long.fromString(a.substring(1),c).negate();if(a.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+a);for(var d=goog.math.Long.fromNumber(Math.pow(c,8)),e=goog.math.Long.ZERO,f=0;f<a.length;f+=8){var g=Math.min(8,a.length-f),h=parseInt(a.substring(f,f+g),c);if(8>g){var i=goog.math.Long.fromNumber(Math.pow(c,g));e=e.multiply(i).add(goog.math.Long.fromNumber(h))}else e=e.multiply(d),e=e.add(goog.math.Long.fromNumber(h))}return e},goog.math.Long.TWO_PWR_16_DBL_=65536,goog.math.Long.TWO_PWR_24_DBL_=1<<24,goog.math.Long.TWO_PWR_32_DBL_=goog.math.Long.TWO_PWR_16_DBL_*goog.math.Long.TWO_PWR_16_DBL_,goog.math.Long.TWO_PWR_31_DBL_=goog.math.Long.TWO_PWR_32_DBL_/2,goog.math.Long.TWO_PWR_48_DBL_=goog.math.Long.TWO_PWR_32_DBL_*goog.math.Long.TWO_PWR_16_DBL_,goog.math.Long.TWO_PWR_64_DBL_=goog.math.Long.TWO_PWR_32_DBL_*goog.math.Long.TWO_PWR_32_DBL_,goog.math.Long.TWO_PWR_63_DBL_=goog.math.Long.TWO_PWR_64_DBL_/2,goog.math.Long.ZERO=goog.math.Long.fromInt(0),goog.math.Long.ONE=goog.math.Long.fromInt(1),goog.math.Long.NEG_ONE=goog.math.Long.fromInt(-1),goog.math.Long.MAX_VALUE=goog.math.Long.fromBits(-1,2147483647),goog.math.Long.MIN_VALUE=goog.math.Long.fromBits(0,-2147483648),goog.math.Long.TWO_PWR_24_=goog.math.Long.fromInt(1<<24),goog.math.Long.prototype.toInt=function(){return this.low_},goog.math.Long.prototype.toNumber=function(){return this.high_*goog.math.Long.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},goog.math.Long.prototype.toString=function(a){var b=a||10;if(2>b||b>36)throw Error("radix out of range: "+b);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(goog.math.Long.MIN_VALUE)){var c=goog.math.Long.fromNumber(b),d=this.div(c),e=d.multiply(c).subtract(this);return d.toString(b)+e.toInt().toString(b)}return"-"+this.negate().toString(b)}for(var f=goog.math.Long.fromNumber(Math.pow(b,6)),e=this,g="";;){var h=e.div(f),i=e.subtract(h.multiply(f)).toInt(),j=i.toString(b);if(e=h,e.isZero())return j+g;for(;j.length<6;)j="0"+j;g=""+j+g}},goog.math.Long.prototype.getHighBits=function(){return this.high_},goog.math.Long.prototype.getLowBits=function(){return this.low_},goog.math.Long.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:goog.math.Long.TWO_PWR_32_DBL_+this.low_},goog.math.Long.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(goog.math.Long.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var a=0!=this.high_?this.high_:this.low_,b=31;b>0&&0==(a&1<<b);b--);return 0!=this.high_?b+33:b+1},goog.math.Long.prototype.isZero=function(){return 0==this.high_&&0==this.low_},goog.math.Long.prototype.isNegative=function(){return this.high_<0},goog.math.Long.prototype.isOdd=function(){return 1==(1&this.low_)},goog.math.Long.prototype.equals=function(a){return this.high_==a.high_&&this.low_==a.low_},goog.math.Long.prototype.notEquals=function(a){return this.high_!=a.high_||this.low_!=a.low_},goog.math.Long.prototype.lessThan=function(a){return this.compare(a)<0},goog.math.Long.prototype.lessThanOrEqual=function(a){return this.compare(a)<=0},goog.math.Long.prototype.greaterThan=function(a){return this.compare(a)>0},goog.math.Long.prototype.greaterThanOrEqual=function(a){return this.compare(a)>=0},goog.math.Long.prototype.compare=function(a){if(this.equals(a))return 0;var b=this.isNegative(),c=a.isNegative();return b&&!c?-1:!b&&c?1:this.subtract(a).isNegative()?-1:1},goog.math.Long.prototype.negate=function(){return this.equals(goog.math.Long.MIN_VALUE)?goog.math.Long.MIN_VALUE:this.not().add(goog.math.Long.ONE)},goog.math.Long.prototype.add=function(a){var b=this.high_>>>16,c=65535&this.high_,d=this.low_>>>16,e=65535&this.low_,f=a.high_>>>16,g=65535&a.high_,h=a.low_>>>16,i=65535&a.low_,j=0,k=0,l=0,m=0;return m+=e+i,l+=m>>>16,m&=65535,l+=d+h,k+=l>>>16,l&=65535,k+=c+g,j+=k>>>16,k&=65535,j+=b+f,j&=65535,goog.math.Long.fromBits(l<<16|m,j<<16|k)},goog.math.Long.prototype.subtract=function(a){return this.add(a.negate())},goog.math.Long.prototype.multiply=function(a){if(this.isZero())return goog.math.Long.ZERO;if(a.isZero())return goog.math.Long.ZERO;if(this.equals(goog.math.Long.MIN_VALUE))return a.isOdd()?goog.math.Long.MIN_VALUE:goog.math.Long.ZERO;if(a.equals(goog.math.Long.MIN_VALUE))return this.isOdd()?goog.math.Long.MIN_VALUE:goog.math.Long.ZERO;if(this.isNegative())return a.isNegative()?this.negate().multiply(a.negate()):this.negate().multiply(a).negate();if(a.isNegative())return this.multiply(a.negate()).negate();if(this.lessThan(goog.math.Long.TWO_PWR_24_)&&a.lessThan(goog.math.Long.TWO_PWR_24_))return goog.math.Long.fromNumber(this.toNumber()*a.toNumber());var b=this.high_>>>16,c=65535&this.high_,d=this.low_>>>16,e=65535&this.low_,f=a.high_>>>16,g=65535&a.high_,h=a.low_>>>16,i=65535&a.low_,j=0,k=0,l=0,m=0;return m+=e*i,l+=m>>>16,m&=65535,l+=d*i,k+=l>>>16,l&=65535,l+=e*h,k+=l>>>16,l&=65535,k+=c*i,j+=k>>>16,k&=65535,k+=d*h,j+=k>>>16,k&=65535,k+=e*g,j+=k>>>16,k&=65535,j+=b*i+c*h+d*g+e*f,j&=65535,goog.math.Long.fromBits(l<<16|m,j<<16|k)},goog.math.Long.prototype.div=function(a){if(a.isZero())throw Error("division by zero");if(this.isZero())return goog.math.Long.ZERO;if(this.equals(goog.math.Long.MIN_VALUE)){if(a.equals(goog.math.Long.ONE)||a.equals(goog.math.Long.NEG_ONE))return goog.math.Long.MIN_VALUE;if(a.equals(goog.math.Long.MIN_VALUE))return goog.math.Long.ONE;var b=this.shiftRight(1),c=b.div(a).shiftLeft(1);if(c.equals(goog.math.Long.ZERO))return a.isNegative()?goog.math.Long.ONE:goog.math.Long.NEG_ONE;var d=this.subtract(a.multiply(c));return c.add(d.div(a))}if(a.equals(goog.math.Long.MIN_VALUE))return goog.math.Long.ZERO;if(this.isNegative())return a.isNegative()?this.negate().div(a.negate()):this.negate().div(a).negate();if(a.isNegative())return this.div(a.negate()).negate();for(var e=goog.math.Long.ZERO,d=this;d.greaterThanOrEqual(a);){for(var c=Math.max(1,Math.floor(d.toNumber()/a.toNumber())),f=Math.ceil(Math.log(c)/Math.LN2),g=48>=f?1:Math.pow(2,f-48),h=goog.math.Long.fromNumber(c),i=h.multiply(a);i.isNegative()||i.greaterThan(d);)c-=g,h=goog.math.Long.fromNumber(c),i=h.multiply(a);h.isZero()&&(h=goog.math.Long.ONE),e=e.add(h),d=d.subtract(i)}return e},goog.math.Long.prototype.modulo=function(a){return this.subtract(this.div(a).multiply(a))},goog.math.Long.prototype.not=function(){return goog.math.Long.fromBits(~this.low_,~this.high_)},goog.math.Long.prototype.and=function(a){return goog.math.Long.fromBits(this.low_&a.low_,this.high_&a.high_)},goog.math.Long.prototype.or=function(a){return goog.math.Long.fromBits(this.low_|a.low_,this.high_|a.high_)},goog.math.Long.prototype.xor=function(a){return goog.math.Long.fromBits(this.low_^a.low_,this.high_^a.high_)},goog.math.Long.prototype.shiftLeft=function(a){if(0==(a&=63))return this;var b=this.low_;if(32>a){var c=this.high_;return goog.math.Long.fromBits(b<<a,c<<a|b>>>32-a)}return goog.math.Long.fromBits(0,b<<a-32)},goog.math.Long.prototype.shiftRight=function(a){if(0==(a&=63))return this;var b=this.high_;if(32>a){var c=this.low_;return goog.math.Long.fromBits(c>>>a|b<<32-a,b>>a)}return goog.math.Long.fromBits(b>>a-32,b>=0?0:-1)},goog.math.Long.prototype.shiftRightUnsigned=function(a){if(0==(a&=63))return this;var b=this.high_;if(32>a){var c=this.low_;return goog.math.Long.fromBits(c>>>a|b<<32-a,b>>>a)}return 32==a?goog.math.Long.fromBits(b,0):goog.math.Long.fromBits(b>>>a-32,0)};var UTF8={};UTF8.encode=function(a){for(var b=[],c=0;c<a.length;++c){var d=a.charCodeAt(c)
;128>d?b.push(d):2048>d?(b.push(192|d>>6),b.push(128|63&d)):65536>d?(b.push(224|d>>12),b.push(128|63&d>>6),b.push(128|63&d)):(b.push(240|d>>18),b.push(128|63&d>>12),b.push(128|63&d>>6),b.push(128|63&d))}return b},UTF8.decode=function(a){for(var b=[],c=0;c<a.length;){var d=a[c++];128>d||(224>d?(d=(31&d)<<6,d|=63&a[c++]):240>d?(d=(15&d)<<12,d|=(63&a[c++])<<6,d|=63&a[c++]):(d=(7&d)<<18,d|=(63&a[c++])<<12,d|=(63&a[c++])<<6,d|=63&a[c++])),b.push(String.fromCharCode(d))}return b.join("")};var BASE64={};if(function(b){var c=function(a){for(var c=0,d=[],e=0|a.length/3;0<e--;){var f=(a[c]<<16)+(a[c+1]<<8)+a[c+2];c+=3,d.push(b.charAt(63&f>>18)),d.push(b.charAt(63&f>>12)),d.push(b.charAt(63&f>>6)),d.push(b.charAt(63&f))}if(2==a.length-c){var f=(a[c]<<16)+(a[c+1]<<8);d.push(b.charAt(63&f>>18)),d.push(b.charAt(63&f>>12)),d.push(b.charAt(63&f>>6)),d.push("=")}else if(1==a.length-c){var f=a[c]<<16;d.push(b.charAt(63&f>>18)),d.push(b.charAt(63&f>>12)),d.push("==")}return d.join("")},d=function(){for(var a=[],c=0;c<b.length;++c)a[b.charCodeAt(c)]=c;return a["=".charCodeAt(0)]=0,a}(),e=function(a){for(var b=0,c=[],e=0|a.length/4;0<e--;){var f=(d[a.charCodeAt(b)]<<18)+(d[a.charCodeAt(b+1)]<<12)+(d[a.charCodeAt(b+2)]<<6)+d[a.charCodeAt(b+3)];c.push(255&f>>16),c.push(255&f>>8),c.push(255&f),b+=4}return c&&("="==a.charAt(b-2)?(c.pop(),c.pop()):"="==a.charAt(b-1)&&c.pop()),c},f={};f.encode=function(a){for(var b=[],c=0;c<a.length;++c)b.push(a.charCodeAt(c));return b},f.decode=function(b){for(var c=0;c<s.length;++c)a[c]=String.fromCharCode(a[c]);return a.join("")},BASE64.decodeArray=function(a){var b=e(a);return new Uint8Array(b)},BASE64.encodeASCII=function(a){var b=f.encode(a);return c(b)},BASE64.decodeASCII=function(a){var b=e(a);return f.decode(b)},BASE64.encode=function(a){var b=UTF8.encode(a);return c(b)},BASE64.decode=function(a){var b=e(a);return UTF8.decode(b)}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),void 0===btoa)var btoa=BASE64.encode;if(void 0===atob)var atob=BASE64.decode;var ISOBoxer=ISOBoxer||{};ISOBoxer.Cursor=function(a){this.offset=void 0===a?0:a};var ISOBox=function(){this._cursor=new ISOBoxer.Cursor};ISOBox.parse=function(a){var b=new ISOBox;return b._offset=a._cursor.offset,b._root=a._root?a._root:a,b._raw=a._raw,b._parent=a,b._parseBox(),a._cursor.offset=b._raw.byteOffset+b._raw.byteLength,b},ISOBox.prototype._readInt=function(a){var b=null;switch(a){case 8:b=this._raw.getInt8(this._cursor.offset-this._raw.byteOffset);break;case 16:b=this._raw.getInt16(this._cursor.offset-this._raw.byteOffset);break;case 32:b=this._raw.getInt32(this._cursor.offset-this._raw.byteOffset)}return this._cursor.offset+=a>>3,b},ISOBox.prototype._readUint=function(a){var b=null;switch(a){case 8:b=this._raw.getUint8(this._cursor.offset-this._raw.byteOffset);break;case 16:b=this._raw.getUint16(this._cursor.offset-this._raw.byteOffset);break;case 24:var c=this._raw.getUint16(this._cursor.offset-this._raw.byteOffset),d=this._raw.getUint8(this._cursor.offset-this._raw.byteOffset+2);b=(c<<8)+d;break;case 32:b=this._raw.getUint32(this._cursor.offset-this._raw.byteOffset);break;case 64:var c=this._raw.getUint32(this._cursor.offset-this._raw.byteOffset),d=this._raw.getUint32(this._cursor.offset-this._raw.byteOffset+4);b=c*Math.pow(2,32)+d}return this._cursor.offset+=a>>3,b},ISOBox.prototype._readString=function(a){for(var b="",c=0;a>c;c++){var d=this._readUint(8);b+=String.fromCharCode(d)}return b},ISOBox.prototype._readTerminatedString=function(){for(var a="";;){var b=this._readUint(8);if(0==b)break;a+=String.fromCharCode(b)}return a},ISOBox.prototype._readTemplate=function(a){return this._readUint(a/2)+this._readUint(a/2)/Math.pow(2,a/2)},ISOBox.prototype._parseBox=function(){if(this._cursor.offset=this._offset,this._offset+8>this._raw.buffer.byteLength)return void(this._root._incomplete=!0);switch(this.size=this._readUint(32),this.type=this._readString(4),1==this.size&&(this.largesize=this._readUint(64)),"uuid"==this.type&&(this.usertype=this._readString(16)),this.size){case 0:this._raw=new DataView(this._raw.buffer,this._offset,this._raw.byteLength-this._cursor.offset);break;case 1:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.largesize);break;default:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.size)}!this._incomplete&&this._boxParsers[this.type]&&this._boxParsers[this.type].call(this)},ISOBox.prototype._parseFullBox=function(){this.version=this._readUint(8),this.flags=this._readUint(24)},ISOBox.prototype._boxParsers={},["moov","trak","tref","mdia","minf","stbl","edts","dinf","mvex","moof","traf","mfra","udta","meco","strk"].forEach(function(a){ISOBox.prototype._boxParsers[a]=function(){for(this.boxes=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.boxes.push(ISOBox.parse(this))}}),ISOBox.prototype._boxParsers.emsg=function(){this._parseFullBox(),this.scheme_id_uri=this._readTerminatedString(),this.value=this._readTerminatedString(),this.timescale=this._readUint(32),this.presentation_time_delta=this._readUint(32),this.event_duration=this._readUint(32),this.id=this._readUint(32),this.message_data=new DataView(this._raw.buffer,this._cursor.offset,this._raw.byteLength-(this._cursor.offset-this._offset))},ISOBox.prototype._boxParsers.free=ISOBox.prototype._boxParsers.skip=function(){this.data=new DataView(this._raw.buffer,this._cursor.offset,this._raw.byteLength-(this._cursor.offset-this._offset))},ISOBox.prototype._boxParsers.ftyp=ISOBox.prototype._boxParsers.styp=function(){for(this.major_brand=this._readString(4),this.minor_versions=this._readUint(32),this.compatible_brands=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.compatible_brands.push(this._readString(4))},ISOBox.prototype._boxParsers.mdat=function(){this.data=new DataView(this._raw.buffer,this._cursor.offset,this._raw.byteLength-(this._cursor.offset-this._offset))},ISOBox.prototype._boxParsers.mdhd=function(){this._parseFullBox(),1==this.version?(this.creation_time=this._readUint(64),this.modification_time=this._readUint(64),this.timescale=this._readUint(32),this.duration=this._readUint(64)):(this.creation_time=this._readUint(32),this.modification_time=this._readUint(32),this.timescale=this._readUint(32),this.duration=this._readUint(32));var a=this._readUint(16);this.pad=a>>15,this.language=String.fromCharCode(96+(a>>10&31),96+(a>>5&31),96+(31&a)),this.pre_defined=this._readUint(16)},ISOBox.prototype._boxParsers.mfhd=function(){this._parseFullBox(),this.sequence_number=this._readUint(32)},ISOBox.prototype._boxParsers.mvhd=function(){this._parseFullBox(),1==this.version?(this.creation_time=this._readUint(64),this.modification_time=this._readUint(64),this.timescale=this._readUint(32),this.duration=this._readUint(64)):(this.creation_time=this._readUint(32),this.modification_time=this._readUint(32),this.timescale=this._readUint(32),this.duration=this._readUint(32)),this.rate=this._readTemplate(32),this.volume=this._readTemplate(16),this.reserved1=this._readUint(16),this.reserved2=[this._readUint(32),this._readUint(32)],this.matrix=[];for(var a=0;9>a;a++)this.matrix.push(this._readTemplate(32));this.pre_defined=[];for(var a=0;6>a;a++)this.pre_defined.push(this._readUint(32));this.next_track_ID=this._readUint(32)},ISOBox.prototype._boxParsers.sidx=function(){this._parseFullBox(),this.reference_ID=this._readUint(32),this.timescale=this._readUint(32),0==this.version?(this.earliest_presentation_time=this._readUint(32),this.first_offset=this._readUint(32)):(this.earliest_presentation_time=this._readUint(64),this.first_offset=this._readUint(64)),this.reserved=this._readUint(16),this.reference_count=this._readUint(16),this.references=[];for(var a=0;a<this.reference_count;a++){var b={},c=this._readUint(32);b.reference_type=c>>31&1,b.referenced_size=2147483647&c,b.subsegment_duration=this._readUint(32);var d=this._readUint(32);b.starts_with_SAP=d>>31&1,b.SAP_type=d>>28&7,b.SAP_delta_time=268435455&d,this.references.push(b)}},ISOBox.prototype._boxParsers.ssix=function(){this._parseFullBox(),this.subsegment_count=this._readUint(32),this.subsegments=[];for(var a=0;a<this.subsegment_count;a++){var b={};b.ranges_count=this._readUint(32),b.ranges=[];for(var c=0;c<b.ranges_count;c++){var d={};d.level=this._readUint(8),d.range_size=this._readUint(24),b.ranges.push(d)}this.subsegments.push(b)}},ISOBox.prototype._boxParsers.tkhd=function(){this._parseFullBox(),1==this.version?(this.creation_time=this._readUint(64),this.modification_time=this._readUint(64),this.track_ID=this._readUint(32),this.reserved1=this._readUint(32),this.duration=this._readUint(64)):(this.creation_time=this._readUint(32),this.modification_time=this._readUint(32),this.track_ID=this._readUint(32),this.reserved1=this._readUint(32),this.duration=this._readUint(32)),this.reserved2=[this._readUint(32),this._readUint(32)],this.layer=this._readUint(16),this.alternate_group=this._readUint(16),this.volume=this._readTemplate(16),this.reserved3=this._readUint(16),this.matrix=[];for(var a=0;9>a;a++)this.matrix.push(this._readTemplate(32));this.width=this._readUint(32),this.height=this._readUint(32)},ISOBox.prototype._boxParsers.tfdt=function(){this._parseFullBox(),this.baseMediaDecodeTime=this._readUint(1==this.version?64:32)},ISOBox.prototype._boxParsers.tfhd=function(){this._parseFullBox(),this.track_ID=this._readUint(32),1&this.flags&&(this.base_data_offset=this._readUint(64)),2&this.flags&&(this.sample_description_offset=this._readUint(32)),8&this.flags&&(this.default_sample_duration=this._readUint(32)),16&this.flags&&(this.default_sample_size=this._readUint(32)),32&this.flags&&(this.default_sample_flags=this._readUint(32))},ISOBox.prototype._boxParsers.trun=function(){this._parseFullBox(),this.sample_count=this._readUint(32),1&this.flags&&(this.data_offset=this._readInt(32)),4&this.flags&&(this.first_sample_flags=this._readUint(32)),this.samples=[];for(var a=0;a<this.sample_count;a++){var b={};256&this.flags&&(b.sample_duration=this._readUint(32)),512&this.flags&&(b.sample_size=this._readUint(32)),1024&this.flags&&(b.sample_flags=this._readUint(32)),2048&this.flags&&(b.sample_composition_time_offset=0==this.version?this._readUint(32):this._readInt(32)),this.samples.push(b)}};var ISOBoxer=ISOBoxer||{};ISOBoxer.parseBuffer=function(a){return new ISOFile(a).parse()},ISOBoxer.Utils={},ISOBoxer.Utils.dataViewToString=function(a,b){if("undefined"!=typeof TextDecoder)return new TextDecoder(b||"utf-8").decode(a);for(var c="",d=0;d<a.byteLength;d++)c+=String.fromCharCode(a.getUint8(d));return c},"undefined"!=typeof exports&&(exports.parseBuffer=ISOBoxer.parseBuffer,exports.Utils=ISOBoxer.Utils);var ISOFile=function(a){this._raw=new DataView(a),this._cursor=new ISOBoxer.Cursor,this.boxes=[]};ISOFile.prototype.fetch=function(a){var b=this.fetchAll(a,!0);return b.length?b[0]:null},ISOFile.prototype.fetchAll=function(a,b){var c=[];return ISOFile._sweep.call(this,a,c,b),c},ISOFile.prototype.parse=function(){for(this._cursor.offset=0,this.boxes=[];this._cursor.offset<this._raw.byteLength;){var a=ISOBox.parse(this);if(void 0===a.type)break;this.boxes.push(a)}return this},ISOFile._sweep=function(a,b,c){this.type&&this.type==a&&b.push(this);for(var d in this.boxes){if(b.length&&c)return;ISOFile._sweep.call(this.boxes[d],a,b,c)}},MediaPlayer=function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n,o="1.5.0",p="http://time.akamai.com/?iso",q="urn:mpeg:dash:utc:http-xsdate:2014",r=0,s=null,t=null,u=!1,v=!1,w=!1,x=!0,y=!1,z=MediaPlayer.dependencies.BufferController.BUFFER_SIZE_REQUIRED,A=!0,B=[],C=4,D=!1,E=function(){return!!e&&!!f&&!v},F=function(){if(!u)throw"MediaPlayer not initialized!";if(!this.capabilities.supportsMediaSource())return void this.errHandler.capabilityError("mediasource");if(!e||!f)throw"Missing view or source.";w=!0,this.debug.log("Playback initiated!"),g=b.getObject("streamController"),i.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,g),i.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED,g),i.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_CAN_PLAY,g),i.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ERROR,g),i.setLiveDelayAttributes(C,D),b.mapValue("liveDelayFragmentCount",C),b.mapOutlet("liveDelayFragmentCount","trackController"),g.initialize(x,s,t),n.checkInitialBitrate(),"string"==typeof f?g.load(f):g.loadWithManifest(f),g.setUTCTimingSources(B,A),b.mapValue("scheduleWhilePaused",y),b.mapOutlet("scheduleWhilePaused","stream"),b.mapOutlet("scheduleWhilePaused","scheduleController"),b.mapValue("numOfParallelRequestAllowed",r),b.mapOutlet("numOfParallelRequestAllowed","scheduleController"),b.mapValue("bufferMax",z),b.mapOutlet("bufferMax","bufferController"),h.initialize()},G=function(){E()&&F.call(this)},H=function(){var a=k.getReadOnlyMetricsFor("video")||k.getReadOnlyMetricsFor("audio");return j.getCurrentDVRInfo(a)},I=function(){return H.call(this).manifestInfo.DVRWindowSize},J=function(a){var b=H.call(this),c=b.range.start+a;return c>b.range.end&&(c=b.range.end),c},K=function(a){var b=i.getIsDynamic()?this.getDVRSeekOffset(a):a;this.getVideoModel().setCurrentTime(b)},L=function(){var a=l.getCurrentTime();if(i.getIsDynamic()){var b=H.call(this);a=null===b?0:this.duration()-(b.range.end-b.time)}return a},M=function(){var a=l.getElement().duration;if(i.getIsDynamic()){var b,c=H.call(this);if(null===c)return 0;b=c.range.end-c.range.start,a=b<c.manifestInfo.DVRWindowSize?b:c.manifestInfo.DVRWindowSize}return a},N=function(a){var b,c=H.call(this);return null===c?0:(b=c.manifestInfo.availableFrom.getTime()/1e3,a+(b+c.range.start))},O=function(){return N.call(this,this.time())},P=function(){return N.call(this,this.duration())},Q=function(a,b,c){var d=new Date(1e3*a),e=d.toLocaleDateString(b);return d.toLocaleTimeString(b,{hour12:c})+" "+e},R=function(a){a=Math.max(a,0);var b=Math.floor(a/3600),c=Math.floor(a%3600/60),d=Math.floor(a%3600%60);return(0===b?"":10>b?"0"+b.toString()+":":b.toString()+":")+(10>c?"0"+c.toString():c.toString())+":"+(10>d?"0"+d.toString():d.toString())},S=function(a,b,c){b&&void 0!==a&&null!==a&&(c?h.setRules(a,b):h.addRules(a,b))},T=function(){var a=g.getActiveStreamInfo();return a?g.getStreamById(a.id):null},U=function(){if(this.adapter.reset(),w&&g){if(!v){v=!0,i.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,g),i.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED,g),i.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_CAN_PLAY,g),i.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ERROR,g);var a={},b=this;a[MediaPlayer.dependencies.StreamController.eventList.ENAME_TEARDOWN_COMPLETE]=function(){c.reset(),h.reset(),i.reset(),d.reset(),g=null,w=!1,v=!1,E.call(b)&&G.call(b)},g.subscribe(MediaPlayer.dependencies.StreamController.eventList.ENAME_TEARDOWN_COMPLETE,a,void 0,!0),g.reset()}}else E.call(this)&&G.call(this)},V=dijon.System.prototype.getObject;dijon.System.prototype.getObject=function(a){var b=V.call(this,a);return"object"!=typeof b||b.getName||(b.getName=function(){return a},b.setMediaType=function(a){b.mediaType=a},b.getMediaType=function(){return b.mediaType}),b},b=new dijon.System,b.mapValue("system",b),b.mapOutlet("system"),b.mapValue("eventBus",new MediaPlayer.utils.EventBus),b.mapOutlet("eventBus");var W=new MediaPlayer.utils.Debug;return b.mapValue("debug",W),b.mapOutlet("debug"),b.injectInto(W),W.setup(),b.injectInto(a),{notifier:void 0,debug:void 0,eventBus:void 0,capabilities:void 0,adapter:void 0,errHandler:void 0,uriQueryFragModel:void 0,videoElementExt:void 0,setup:function(){j=b.getObject("metricsExt"),c=b.getObject("abrController"),h=b.getObject("rulesController"),k=b.getObject("metricsModel"),n=b.getObject("DOMStorage"),i=b.getObject("playbackController"),d=b.getObject("mediaController"),this.restoreDefaultUTCTimingSources()},addEventListener:function(a,b,c){a=a.toLowerCase(),this.eventBus.addEventListener(a,b,c)},removeEventListener:function(a,b,c){a=a.toLowerCase(),this.eventBus.removeEventListener(a,b,c)},getVersion:function(){return o},getObjectByContextName:function(a){return b.getObject(a)},startup:function(){u||(b.injectInto(this),u=!0)},getDebug:function(){return this.debug},getVideoModel:function(){return l},setLiveDelayFragmentCount:function(a){C=a},useSuggestedPresentationDelay:function(a){D=a},enableLastBitrateCaching:function(a,b){n.enableLastBitrateCaching(a,b)},enableLastMediaSettingsCaching:function(a,b){n.enableLastMediaSettingsCaching(a,b)},setNumOfParallelRequestAllowed:function(a){r=a},setMaxAllowedBitrateFor:function(a,b){c.setMaxAllowedBitrateFor(a,b)},getMaxAllowedBitrateFor:function(a){return c.getMaxAllowedBitrateFor(a)},setAutoPlay:function(a){x=a},getAutoPlay:function(){return x},setScheduleWhilePaused:function(a){y=a},getScheduleWhilePaused:function(){return y},setBufferMax:function(a){z=a},getBufferMax:function(){return z},getMetricsExt:function(){return j},getMetricsFor:function(a){return k.getReadOnlyMetricsFor(a)},getQualityFor:function(a){return c.getQualityFor(a,g.getActiveStreamInfo())},setQualityFor:function(a,b){c.setPlaybackQuality(a,g.getActiveStreamInfo(),b)},setTextTrack:function(a){void 0===m&&(m=b.getObject("textSourceBuffer"));for(var c=e.textTracks,d=c.length,f=0;d>f;f++){var g=c[f],h=a===f?"showing":"hidden";g.mode!==h&&(g.mode=h)}m.isFragmented&&m.setTextTrack()},getBitrateInfoListFor:function(a){var b=T.call(this);return b?b.getBitrateListFor(a):[]},setInitialBitrateFor:function(a,b){c.setInitialBitrateFor(a,b)},getInitialBitrateFor:function(a){return c.getInitialBitrateFor(a)},getStreamsFromManifest:function(a){return this.adapter.getStreamsInfo(a)},getTracksFor:function(a){var b=g?g.getActiveStreamInfo():null;return b?d.getTracksFor(a,b):[]},getTracksForTypeFromManifest:function(a,b,c){return c=c||this.adapter.getStreamsInfo(b)[0],c?this.adapter.getAllMediaInfoForType(b,c,a):[]},getCurrentTrackFor:function(a){var b=g?g.getActiveStreamInfo():null;return b?d.getCurrentTrackFor(a,b):null},setInitialMediaSettingsFor:function(a,b){d.setInitialSettings(a,b)},getInitialMediaSettingsFor:function(a){return d.getInitialSettings(a)},setCurrentTrack:function(a){d.setTrack(a)},getTrackSwitchModeFor:function(a){return d.getSwitchMode(a)},setTrackSwitchModeFor:function(a,b){d.setSwitchMode(a,b)},setSelectionModeForInitialTrack:function(a){d.setSelectionModeForInitialTrack(a)},getSelectionModeForInitialTrack:function(){return d.getSelectionModeForInitialTrack()},getAutoSwitchQuality:function(){return c.getAutoSwitchBitrate()},setAutoSwitchQuality:function(a){c.setAutoSwitchBitrate(a)},setSchedulingRules:function(a){S.call(this,h.SCHEDULING_RULE,a,!0)},addSchedulingRules:function(a){S.call(this,h.SCHEDULING_RULE,a,!1)},setABRRules:function(a){S.call(this,h.ABR_RULE,a,!0)},addABRRules:function(a){S.call(this,h.ABR_RULE,a,!1)},createProtection:function(){return b.getObject("protectionController")},retrieveManifest:function(a,c){!function(a){var d=b.getObject("manifestLoader"),e=b.getObject("uriQueryFragModel"),f={};f[MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED]=function(a){a.error?c(null,a.error):c(a.data.manifest),d.unsubscribe(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,this)},d.subscribe(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,f),d.load(e.parseURI(a))}(a)},addUTCTimingSource:function(a,b){this.removeUTCTimingSource(a,b);var c=new Dash.vo.UTCTiming;c.schemeIdUri=a,c.value=b,B.push(c)},removeUTCTimingSource:function(a,b){B.forEach(function(c,d){c.schemeIdUri===a&&c.value===b&&B.splice(d,1)})},clearDefaultUTCTimingSources:function(){B=[]},restoreDefaultUTCTimingSources:function(){this.addUTCTimingSource(q,p)},enableManifestDateHeaderTimeSource:function(a){A=a},attachView:function(a){if(!u)throw"MediaPlayer not initialized!";e=a,l=null,e&&(l=b.getObject("videoModel"),l.setElement(e)),U.call(this)},attachTTMLRenderingDiv:function(a){if(!l)throw"Must call attachView with video element before you attach TTML Rendering Div";l.setTTMLRenderingDiv(a)},attachSource:function(a,b,c){if(!u)throw"MediaPlayer not initialized!";"string"==typeof a?(this.uriQueryFragModel.reset(),f=this.uriQueryFragModel.parseURI(a)):f=a,s=b,t=c,U.call(this)},reset:function(){this.attachSource(null),this.attachView(null),s=null,t=null},play:F,isReady:E,seek:K,time:L,duration:M,timeAsUTC:O,durationAsUTC:P,getDVRWindowSize:I,getDVRSeekOffset:J,formatUTC:Q,convertToTimeCode:R}},MediaPlayer.prototype={constructor:MediaPlayer},MediaPlayer.dependencies={},MediaPlayer.dependencies.protection={},MediaPlayer.dependencies.protection.servers={},MediaPlayer.utils={},MediaPlayer.models={},MediaPlayer.vo={},MediaPlayer.vo.metrics={},MediaPlayer.vo.protection={},MediaPlayer.rules={},MediaPlayer.di={},MediaPlayer.events={RESET_COMPLETE:"resetComplete",METRICS_CHANGED:"metricschanged",METRIC_CHANGED:"metricchanged",METRIC_UPDATED:"metricupdated",METRIC_ADDED:"metricadded",MANIFEST_LOADED:"manifestloaded",PROTECTION_CREATED:"protectioncreated",PROTECTION_DESTROYED:"protectiondestroyed",STREAM_SWITCH_STARTED:"streamswitchstarted",STREAM_SWITCH_COMPLETED:"streamswitchcompleted",STREAM_INITIALIZED:"streaminitialized",TEXT_TRACK_ADDED:"texttrackadded",TEXT_TRACKS_ADDED:"alltexttracksadded",BUFFER_LOADED:"bufferloaded",BUFFER_EMPTY:"bufferstalled",ERROR:"error",LOG:"log"},MediaPlayer.di.Context=function(){"use strict";var a=function(){var a=document.createElement("video");MediaPlayer.models.ProtectionModel_21Jan2015.detect(a)?this.system.mapClass("protectionModel",MediaPlayer.models.ProtectionModel_21Jan2015):MediaPlayer.models.ProtectionModel_3Feb2014.detect(a)?this.system.mapClass("protectionModel",MediaPlayer.models.ProtectionModel_3Feb2014):MediaPlayer.models.ProtectionModel_01b.detect(a)?this.system.mapClass("protectionModel",MediaPlayer.models.ProtectionModel_01b):(this.debug.log("No supported version of EME detected on this user agent!"),this.debug.log("Attempts to play encrypted content will fail!"))};return{system:void 0,setup:function(){this.system.autoMapOutlets=!0,this.system.mapClass("eventBusCl",MediaPlayer.utils.EventBus),this.system.mapSingleton("capabilities",MediaPlayer.utils.Capabilities),this.system.mapSingleton("DOMStorage",MediaPlayer.utils.DOMStorage),this.system.mapClass("customTimeRanges",MediaPlayer.utils.CustomTimeRanges),this.system.mapSingleton("virtualBuffer",MediaPlayer.utils.VirtualBuffer),this.system.mapClass("isoFile",MediaPlayer.utils.IsoFile),this.system.mapSingleton("textTrackExtensions",MediaPlayer.utils.TextTrackExtensions),this.system.mapSingleton("vttParser",MediaPlayer.utils.VTTParser),this.system.mapSingleton("ttmlParser",MediaPlayer.utils.TTMLParser),this.system.mapSingleton("boxParser",MediaPlayer.utils.BoxParser),this.system.mapSingleton("videoModel",MediaPlayer.models.VideoModel),this.system.mapSingleton("manifestModel",MediaPlayer.models.ManifestModel),this.system.mapSingleton("metricsModel",MediaPlayer.models.MetricsModel),this.system.mapSingleton("uriQueryFragModel",MediaPlayer.models.URIQueryAndFragmentModel),this.system.mapSingleton("ksPlayReady",MediaPlayer.dependencies.protection.KeySystem_PlayReady),this.system.mapSingleton("ksWidevine",MediaPlayer.dependencies.protection.KeySystem_Widevine),this.system.mapSingleton("ksClearKey",MediaPlayer.dependencies.protection.KeySystem_ClearKey),this.system.mapSingleton("serverPlayReady",MediaPlayer.dependencies.protection.servers.PlayReady),this.system.mapSingleton("serverWidevine",MediaPlayer.dependencies.protection.servers.Widevine),this.system.mapSingleton("serverClearKey",MediaPlayer.dependencies.protection.servers.ClearKey),this.system.mapSingleton("serverDRMToday",MediaPlayer.dependencies.protection.servers.DRMToday),this.system.mapSingleton("requestModifierExt",MediaPlayer.dependencies.RequestModifierExtensions),this.system.mapSingleton("textSourceBuffer",MediaPlayer.dependencies.TextSourceBuffer),this.system.mapSingleton("mediaSourceExt",MediaPlayer.dependencies.MediaSourceExtensions),this.system.mapSingleton("sourceBufferExt",MediaPlayer.dependencies.SourceBufferExtensions),this.system.mapSingleton("abrController",MediaPlayer.dependencies.AbrController),this.system.mapSingleton("errHandler",MediaPlayer.dependencies.ErrorHandler),this.system.mapSingleton("videoExt",MediaPlayer.dependencies.VideoModelExtensions),this.system.mapSingleton("protectionExt",MediaPlayer.dependencies.ProtectionExtensions),this.system.mapClass("protectionController",MediaPlayer.dependencies.ProtectionController),this.system.mapSingleton("playbackController",MediaPlayer.dependencies.PlaybackController),a.call(this),this.system.mapSingleton("liveEdgeFinder",MediaPlayer.dependencies.LiveEdgeFinder),this.system.mapClass("metrics",MediaPlayer.models.MetricsList),this.system.mapClass("insufficientBufferRule",MediaPlayer.rules.InsufficientBufferRule),this.system.mapClass("bufferOccupancyRule",MediaPlayer.rules.BufferOccupancyRule),this.system.mapClass("throughputRule",MediaPlayer.rules.ThroughputRule),this.system.mapSingleton("abrRulesCollection",MediaPlayer.rules.ABRRulesCollection),this.system.mapSingleton("rulesController",MediaPlayer.rules.RulesController),this.system.mapClass("bufferLevelRule",MediaPlayer.rules.BufferLevelRule),this.system.mapClass("pendingRequestsRule",MediaPlayer.rules.PendingRequestsRule),this.system.mapClass("playbackTimeRule",MediaPlayer.rules.PlaybackTimeRule),this.system.mapClass("sameTimeRequestRule",MediaPlayer.rules.SameTimeRequestRule),this.system.mapClass("abandonRequestRule",MediaPlayer.rules.AbandonRequestsRule),this.system.mapSingleton("scheduleRulesCollection",MediaPlayer.rules.ScheduleRulesCollection),this.system.mapClass("liveEdgeBinarySearchRule",MediaPlayer.rules.LiveEdgeBinarySearchRule),this.system.mapClass("liveEdgeWithTimeSynchronizationRule",MediaPlayer.rules.LiveEdgeWithTimeSynchronizationRule),this.system.mapSingleton("synchronizationRulesCollection",MediaPlayer.rules.SynchronizationRulesCollection),this.system.mapClass("xlinkController",MediaPlayer.dependencies.XlinkController),this.system.mapClass("xlinkLoader",MediaPlayer.dependencies.XlinkLoader),this.system.mapClass("streamProcessor",MediaPlayer.dependencies.StreamProcessor),this.system.mapClass("eventController",MediaPlayer.dependencies.EventController),this.system.mapClass("textController",MediaPlayer.dependencies.TextController),this.system.mapClass("bufferController",MediaPlayer.dependencies.BufferController),this.system.mapClass("manifestLoader",MediaPlayer.dependencies.ManifestLoader),this.system.mapSingleton("manifestUpdater",MediaPlayer.dependencies.ManifestUpdater),this.system.mapClass("fragmentController",MediaPlayer.dependencies.FragmentController),this.system.mapClass("fragmentLoader",MediaPlayer.dependencies.FragmentLoader),this.system.mapClass("fragmentModel",MediaPlayer.dependencies.FragmentModel),this.system.mapSingleton("streamController",MediaPlayer.dependencies.StreamController),this.system.mapSingleton("mediaController",MediaPlayer.dependencies.MediaController),this.system.mapClass("stream",MediaPlayer.dependencies.Stream),this.system.mapClass("scheduleController",MediaPlayer.dependencies.ScheduleController),this.system.mapSingleton("timeSyncController",MediaPlayer.dependencies.TimeSyncController),this.system.mapSingleton("notifier",MediaPlayer.dependencies.Notifier)}}},Dash=function(){"use strict";return{modules:{},dependencies:{},vo:{},di:{}}}(),Dash.di.DashContext=function(){"use strict";return{system:void 0,debug:void 0,setup:function(){Dash.di.DashContext.prototype.setup.call(this),this.system.mapClass("parser",Dash.dependencies.DashParser),this.system.mapClass("indexHandler",Dash.dependencies.DashHandler),this.system.mapSingleton("baseURLExt",Dash.dependencies.BaseURLExtensions),this.system.mapClass("fragmentExt",Dash.dependencies.FragmentExtensions),this.system.mapClass("representationController",Dash.dependencies.RepresentationController),this.system.mapSingleton("manifestExt",Dash.dependencies.DashManifestExtensions),this.system.mapSingleton("metricsExt",Dash.dependencies.DashMetricsExtensions),this.system.mapSingleton("timelineConverter",Dash.dependencies.TimelineConverter),this.system.mapSingleton("adapter",Dash.dependencies.DashAdapter)}}},Dash.di.DashContext.prototype=new MediaPlayer.di.Context,Dash.di.DashContext.prototype.constructor=Dash.di.DashContext,Dash.dependencies.DashAdapter=function(){"use strict";var a=[],b={},c=function(a,b){return b.getRepresentationForQuality(a.quality)},d=function(a){return b[a.streamInfo.id][a.index]},e=function(b){var c,d=a.length,e=0;for(e;d>e;e+=1)if(c=a[e],b.id===c.id)return c;return null},f=function(a,b){var c=new MediaPlayer.vo.TrackInfo,d=b.adaptation.period.mpd.manifest.Period_asArray[b.adaptation.period.index].AdaptationSet_asArray[b.adaptation.index],e=this.manifestExt.getRepresentationFor(b.index,d);return c.id=b.id,c.quality=b.index,c.bandwidth=this.manifestExt.getBandwidth(e),c.DVRWindow=b.segmentAvailabilityRange,c.fragmentDuration=b.segmentDuration||(b.segments&&b.segments.length>0?b.segments[0].duration:NaN),c.MSETimeOffset=b.MSETimeOffset,c.useCalculatedLiveEdgeTime=b.useCalculatedLiveEdgeTime,c.mediaInfo=g.call(this,a,b.adaptation),c},g=function(a,b){var c,d=new MediaPlayer.vo.MediaInfo,e=this,f=b.period.mpd.manifest.Period_asArray[b.period.index].AdaptationSet_asArray[b.index];return d.id=b.id,d.index=b.index,d.type=b.type,d.streamInfo=h.call(this,a,b.period),d.representationCount=this.manifestExt.getRepresentationCount(f),d.lang=this.manifestExt.getLanguageForAdaptation(f),c=this.manifestExt.getViewpointForAdaptation(f),d.viewpoint=c?c.value:void 0,d.accessibility=this.manifestExt.getAccessibilityForAdaptation(f).map(function(a){return a.value}),d.audioChannelConfiguration=this.manifestExt.getAudioChannelConfigurationForAdaptation(f).map(function(a){return a.value}),d.roles=this.manifestExt.getRolesForAdaptation(f).map(function(a){return a.value}),d.codec=this.manifestExt.getCodec(f),d.mimeType=this.manifestExt.getMimeType(f),d.contentProtection=this.manifestExt.getContentProtectionData(f),d.bitrateList=this.manifestExt.getBitrateListForAdaptation(f),d.contentProtection&&d.contentProtection.forEach(function(a){a.KID=e.manifestExt.getKID(a)}),d.isText=this.manifestExt.getIsTextTrack(d.mimeType),d},h=function(a,b){var c=new MediaPlayer.vo.StreamInfo;return c.id=b.id,c.index=b.index,c.start=b.start,c.duration=b.duration,c.manifestInfo=i.call(this,a,b.mpd),c.isLast=1===a.Period_asArray.length||Math.abs(c.start+c.duration-c.manifestInfo.duration)<1,c},i=function(a,b){var c=new MediaPlayer.vo.ManifestInfo;return c.DVRWindowSize=b.timeShiftBufferDepth,c.loadedTime=b.manifest.loadedTime,c.availableFrom=b.availabilityStartTime,c.minBufferTime=b.manifest.minBufferTime,c.maxFragmentDuration=b.maxSegmentDuration,c.duration=this.manifestExt.getDuration(a),c.isDynamic=this.manifestExt.getIsDynamic(a),c},j=function(a,c,d){var f,h=e(c),i=h.id,j=this.manifestExt.getAdaptationForType(a,c.index,d);return j?(f=this.manifestExt.getIndexForAdaptation(j,a,c.index),b[i]=b[i]||this.manifestExt.getAdaptationsForPeriod(a,h),g.call(this,a,b[i][f])):null},k=function(a,c,d){var f,h,i,j=e(c),k=j.id,l=this.manifestExt.getAdaptationsForType(a,c.index,d),m=[];if(!l)return m;b[k]=b[k]||this.manifestExt.getAdaptationsForPeriod(a,j);for(var n=0,o=l.length;o>n;n+=1)f=l[n],i=this.manifestExt.getIndexForAdaptation(f,a,c.index),(h=g.call(this,a,b[k][i]))&&m.push(h);return m},l=function(c){var d,e,f,g=[];if(!c)return null;for(d=this.manifestExt.getMpd(c),a=this.manifestExt.getRegularPeriods(c,d),
d.checkTime=this.manifestExt.getCheckTime(c,a[0]),b={},e=a.length,f=0;e>f;f+=1)g.push(h.call(this,c,a[f]));return g},m=function(a){var b=this.manifestExt.getMpd(a);return i.call(this,a,b)},n=function(a,b){var c=a.representationController.getRepresentationForQuality(b);return a.indexHandler.getInitRequest(c)},o=function(a,b){var d=c(b,a.representationController);return a.indexHandler.getNextSegmentRequest(d)},p=function(a,b,d,e){var f=c(b,a.representationController);return a.indexHandler.getSegmentRequestForTime(f,d,e)},q=function(a,b,d){var e=c(b,a.representationController);return a.indexHandler.generateSegmentRequestForTime(e,d)},r=function(a){return a.indexHandler.getCurrentTime()},s=function(a,b){return a.indexHandler.setCurrentTime(b)},t=function(a,b){var c,f,g=e(b.getStreamInfo()),h=b.getMediaInfo(),i=d(h),j=b.getType();c=h.id,f=c?this.manifestExt.getAdaptationForId(c,a,g.index):this.manifestExt.getAdaptationForIndex(h.index,a,g.index),b.representationController.updateData(f,i,j)},u=function(a,b,c){var d=b.getRepresentationForQuality(c);return d?f.call(this,a,d):null},v=function(a,b){var c=b.getCurrentRepresentation();return c?f.call(this,a,c):null},w=function(a,b,c){var d=new Dash.vo.Event,e=a.scheme_id_uri,f=a.value,g=a.timescale,h=a.presentation_time_delta,i=a.event_duration,j=a.id,k=a.message_data,l=c*g+h;return b[e]?(d.eventStream=b[e],d.eventStream.value=f,d.eventStream.timescale=g,d.duration=i,d.id=j,d.presentationTime=l,d.messageData=k,d.presentationTimeDelta=h,d):null},x=function(a,b,f){var g=[];return b instanceof MediaPlayer.vo.StreamInfo?g=this.manifestExt.getEventsForPeriod(a,e(b)):b instanceof MediaPlayer.vo.MediaInfo?g=this.manifestExt.getEventStreamForAdaptationSet(a,d(b)):b instanceof MediaPlayer.vo.TrackInfo&&(g=this.manifestExt.getEventStreamForRepresentation(a,c(b,f.representationController))),g};return{system:void 0,manifestExt:void 0,timelineConverter:void 0,metricsList:{TCP_CONNECTION:"TcpConnection",HTTP_REQUEST:"HttpRequest",HTTP_REQUEST_TRACE:"HttpRequestTrace",TRACK_SWITCH:"RepresentationSwitch",BUFFER_LEVEL:"BufferLevel",BUFFER_STATE:"BufferState",DVR_INFO:"DVRInfo",DROPPED_FRAMES:"DroppedFrames",SCHEDULING_INFO:"SchedulingInfo",REQUESTS_QUEUE:"RequestsQueue",MANIFEST_UPDATE:"ManifestUpdate",MANIFEST_UPDATE_STREAM_INFO:"ManifestUpdatePeriodInfo",MANIFEST_UPDATE_TRACK_INFO:"ManifestUpdateRepresentationInfo",PLAY_LIST:"PlayList",PLAY_LIST_TRACE:"PlayListTrace"},convertDataToTrack:f,convertDataToMedia:g,convertDataToStream:h,getDataForTrack:c,getDataForMedia:d,getDataForStream:e,getStreamsInfo:l,getManifestInfo:m,getMediaInfoForType:j,getAllMediaInfoForType:k,getCurrentRepresentationInfo:v,getRepresentationInfoForQuality:u,updateData:t,getInitRequest:n,getNextFragmentRequest:o,getFragmentRequestForTime:p,generateFragmentRequestForTime:q,getIndexHandlerTime:r,setIndexHandlerTime:s,getEventsFor:x,getEvent:w,reset:function(){a=[],b={}}}},Dash.dependencies.DashAdapter.prototype={constructor:Dash.dependencies.DashAdapter},Dash.create=function(a,b,c){if(void 0===a||"VIDEO"!=a.nodeName)return null;var d,e=a.id||a.name||"video element";if(c=c||new Dash.di.DashContext,void 0===(b=b||[].slice.call(a.querySelectorAll("source")).filter(function(a){return a.type==Dash.supportedManifestMimeTypes.mimeType})[0])&&a.src)b=document.createElement("source"),b.src=a.src;else if(void 0===b&&!a.src)return null;return d=new MediaPlayer(c),d.startup(),d.attachView(a),d.setAutoPlay(a.autoplay),d.attachSource(b.src),d.getDebug().log("Converted "+e+" to dash.js player and added content: "+b.src),d},Dash.createAll=function(a,b,c){var d=[];a=a||".dashjs-player",b=b||document,c=c||new Dash.di.DashContext;for(var e=b.querySelectorAll(a),f=0;f<e.length;f++){var g=Dash.create(e[f],void 0,c);d.push(g)}return d},Dash.supportedManifestMimeTypes={mimeType:"application/dash+xml"},Dash.dependencies.DashHandler=function(){"use strict";var a,b,c,d=-1,e=0,f=new RegExp("^(?:(?:[a-z]+:)?/)?/","i"),g=function(a,b){for(;a.length<b;)a="0"+a;return a},h=function(a,b,c){for(var d,e,f,h,i,j,k=b.length,l="%0",m=l.length;;){if(0>(d=a.indexOf("$"+b)))return a;if(0>(e=a.indexOf("$",d+k)))return a;if((f=a.indexOf(l,d+k))>d&&e>f)switch(h=a.charAt(e-1),i=parseInt(a.substring(f+m,e-1),10),h){case"d":case"i":case"u":j=g(c.toString(),i);break;case"x":j=g(c.toString(16),i);break;case"X":j=g(c.toString(16),i).toUpperCase();break;case"o":j=g(c.toString(8),i);break;default:return this.log("Unsupported/invalid IEEE 1003.1 format identifier string in URL"),a}else j=c;a=a.substring(0,d)+j+a.substring(e+1)}},i=function(a){return a.split("$$").join("$")},j=function(a,b){if(null===b||-1===a.indexOf("$RepresentationID$"))return a;var c=b.toString();return a.split("$RepresentationID$").join(c)},k=function(a,b){return a.representation.startNumber+b},l=function(a,b){var c=b.adaptation.period.mpd.manifest.Period_asArray[b.adaptation.period.index].AdaptationSet_asArray[b.adaptation.index].Representation_asArray[b.index].BaseURL;return a===c?a:f.test(a)?a:c+a},m=function(a,c){var d,e,f=this,g=new MediaPlayer.vo.FragmentRequest;return d=a.adaptation.period,g.mediaType=c,g.type=MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE,g.url=l(a.initialization,a),g.range=a.range,e=d.start,g.availabilityStartTime=f.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(e,a.adaptation.period.mpd,b),g.availabilityEndTime=f.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(e+d.duration,d.mpd,b),g.quality=a.index,g.mediaInfo=f.streamProcessor.getMediaInfo(),g},n=function(a){var b=this;return a?m.call(b,a,c):null},o=function(a){var c,e,f,g=a.adaptation.period,h=!1;return 0>d?h=!1:b||d<a.availableSegmentsNumber?(e=B(d,a))&&(f=e.presentationStartTime-g.start,c=a.adaptation.period.duration,this.log(a.segmentInfoType+": "+f+" / "+c),h=f>=c):h=!0,h},p=function(a,c){var d,e,f,g,h=this;return e=a.segmentDuration,isNaN(e)&&(e=a.adaptation.period.duration),f=a.adaptation.period.start+c*e,g=f+e,d=new Dash.vo.Segment,d.representation=a,d.duration=e,d.presentationStartTime=f,d.mediaStartTime=h.timelineConverter.calcMediaTimeFromPresentationTime(d.presentationStartTime,a),d.availabilityStartTime=h.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(d.presentationStartTime,a.adaptation.period.mpd,b),d.availabilityEndTime=h.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(g,a.adaptation.period.mpd,b),d.wallStartTime=h.timelineConverter.calcWallTimeForSegment(d,b),d.replacementNumber=k(d,c),d.availabilityIdx=c,d},q=function(c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=this,s=c.adaptation.period.mpd.manifest.Period_asArray[c.adaptation.period.index].AdaptationSet_asArray[c.adaptation.index].Representation_asArray[c.index].SegmentTemplate,v=s.SegmentTimeline,w=c.availableSegmentsNumber>0,x=[],y=0,z=0,A=-1,B=function(a){return u.call(r,c,y,a.d,q,s.media,a.mediaRange,A)};for(q=c.timescale,d=v.S_asArray,l=t.call(r,c),l?(o=l.start,p=l.end):n=r.timelineConverter.calcMediaTimeFromPresentationTime(a||0,c),f=0,g=d.length;g>f;f+=1){if(e=d[f],i=0,e.hasOwnProperty("r")&&(i=e.r),e.hasOwnProperty("t")&&(y=e.t,z=y/q),0>i){if((k=d[f+1])&&k.hasOwnProperty("t"))j=k.t/q;else{var C=c.segmentAvailabilityRange?c.segmentAvailabilityRange.end:this.timelineConverter.calcSegmentAvailabilityRange(c,b).end;j=r.timelineConverter.calcMediaTimeFromPresentationTime(C,c),c.segmentDuration=e.d/q}i=Math.ceil((j-z)/(e.d/q))-1}if(m){if(w)break;A+=i+1}else for(h=0;i>=h;h+=1){if(A+=1,l){if(A>p){if(m=!0,w)break;continue}A>=o&&x.push(B.call(r,e))}else{if(x.length>10){if(m=!0,w)break;continue}z>=n-e.d/q*1.5&&x.push(B.call(r,e))}y+=e.d,z=y/q}}return w||(c.availableSegmentsNumber=A+1),x},r=function(a){var c,d,e,f,g,i=[],j=this,k=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].SegmentTemplate,l=a.segmentDuration,m=a.segmentAvailabilityRange,n=null,o=null;for(g=a.startNumber,c=isNaN(l)&&!b?{start:g,end:g}:s.call(j,a),e=c.start,f=c.end,d=e;f>=d;d+=1)n=p.call(j,a,d),n.replacementTime=(g+d-1)*a.segmentDuration,o=k.media,o=h(o,"Number",n.replacementNumber),o=h(o,"Time",n.replacementTime),n.media=o,i.push(n),n=null;return isNaN(l)?a.availableSegmentsNumber=1:a.availableSegmentsNumber=Math.ceil((m.end-m.start)/l),i},s=function(c){var e,f,g=this,h=c.segmentDuration,i=c.adaptation.period.mpd.manifest.minBufferTime,j=c.segmentAvailabilityRange,k={start:g.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(c,j.start),end:g.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(c,j.end)},l=NaN,m=null,n=c.segments,o=2*h,p=Math.max(2*i,10*h);return k||(k=g.timelineConverter.calcSegmentAvailabilityRange(c,b)),k.start=Math.max(k.start,0),b&&!g.timelineConverter.isTimeSyncCompleted()?(e=Math.floor(k.start/h),f=Math.floor(k.end/h),{start:e,end:f}):(n&&n.length>0?(m=B(d,c),l=m?g.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(c,m.presentationStartTime):d>0?d*h:g.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(c,a||n[0].presentationStartTime)):l=d>0?d*h:b?k.end:k.start,e=Math.floor(Math.max(l-o,k.start)/h),f=Math.floor(Math.min(e+p/h,k.end/h)),{start:e,end:f})},t=function(){var c,e,f=0,g=Number.POSITIVE_INFINITY;return b&&!this.timelineConverter.isTimeSyncCompleted()?{start:f,end:g}:!b&&a||0>d?null:(c=Math.max(d-2,f),e=Math.min(d+10,g),{start:c,end:e})},u=function(a,c,d,e,f,g,i){var j,l,m,n=this,o=c/e,p=Math.min(d/e,a.adaptation.period.mpd.maxSegmentDuration);return j=n.timelineConverter.calcPresentationTimeFromMediaTime(o,a),l=j+p,m=new Dash.vo.Segment,m.representation=a,m.duration=p,m.mediaStartTime=o,m.presentationStartTime=j,m.availabilityStartTime=a.adaptation.period.mpd.manifest.loadedTime,m.availabilityEndTime=n.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(l,a.adaptation.period.mpd,b),m.wallStartTime=n.timelineConverter.calcWallTimeForSegment(m,b),m.replacementTime=c,m.replacementNumber=k(m,i),f=h(f,"Number",m.replacementNumber),f=h(f,"Time",m.replacementTime),m.media=f,m.mediaRange=g,m.availabilityIdx=i,m},v=function(a){var b,c,d,e,f,g,h,i=this,j=[],k=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].SegmentList,l=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].BaseURL,m=k.SegmentURL_asArray.length;for(h=a.startNumber,e=s.call(i,a),f=Math.max(e.start,0),g=Math.min(e.end,k.SegmentURL_asArray.length-1),b=f;g>=b;b+=1)d=k.SegmentURL_asArray[b],c=p.call(i,a,b),c.replacementTime=(h+b-1)*a.segmentDuration,c.media=d.media?d.media:l,c.mediaRange=d.mediaRange,c.index=d.index,c.indexRange=d.indexRange,j.push(c),c=null;return a.availableSegmentsNumber=m,j},w=function(a){var b,c=this,d=a.segmentInfoType;return"SegmentBase"!==d&&"BaseURL"!==d&&C.call(c,a)?("SegmentTimeline"===d?b=q.call(c,a):"SegmentTemplate"===d?b=r.call(c,a):"SegmentList"===d&&(b=v.call(c,a)),x.call(c,a,b)):b=a.segments,b},x=function(a,c){var d,e,f,g;a.segments=c,d=c.length-1,b&&isNaN(this.timelineConverter.getExpectedLiveEdge())&&(g=c[d],e=g.presentationStartTime,f=this.metricsModel.getMetricsFor("stream"),this.timelineConverter.setExpectedLiveEdge(e),this.metricsModel.updateManifestUpdateInfo(this.metricsExt.getCurrentManifestUpdate(f),{presentationStartTime:e}))},y=function(a){var b=this;if(!a)throw new Error("no representation");return a.segments=null,w.call(b,a),a},z=function(a,e){var f,g=this,h=a.initialization,i="BaseURL"!==a.segmentInfoType&&"SegmentBase"!==a.segmentInfoType;return a.segmentDuration||a.segments||y.call(g,a),a.segmentAvailabilityRange=null,a.segmentAvailabilityRange=g.timelineConverter.calcSegmentAvailabilityRange(a,b),a.segmentAvailabilityRange.end<a.segmentAvailabilityRange.start&&!a.useCalculatedLiveEdgeTime?(f=new MediaPlayer.vo.Error(Dash.dependencies.DashHandler.SEGMENTS_UNAVAILABLE_ERROR_CODE,"no segments are available yet",{availabilityDelay:a.segmentAvailabilityRange.start-a.segmentAvailabilityRange.end}),void g.notify(Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED,{representation:a},f)):(e||(d=-1),a.segmentDuration&&y.call(g,a),h||g.baseURLExt.loadInitialization(a),i||g.baseURLExt.loadSegments(a,c,a.indexRange),void(h&&i&&g.notify(Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED,{representation:a})))},A=function(a,b,c){var d,e,f,g,h,i=b.segments,j=i?i.length:null,k=-1;if(i&&j>0)for(h=0;j>h;h+=1)if(e=i[h],f=e.presentationStartTime,g=e.duration,d=void 0===c||null===c?g/2:c,a+d>=f&&f+g>a-d){k=e.availabilityIdx;break}return k},B=function(a,b){if(!b||!b.segments)return null;var c,d,e=b.segments.length;for(d=0;e>d;d+=1)if(c=b.segments[d],c.availabilityIdx===a)return c;return null},C=function(a){var b,c,e=!1,f=a.segments;return f&&0!==f.length?(c=f[0].availabilityIdx,b=f[f.length-1].availabilityIdx,e=c>d||d>b):e=!0,e},D=function(a){if(null===a||void 0===a)return null;var b,d=new MediaPlayer.vo.FragmentRequest,e=a.representation,f=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].bandwidth;return b=l(a.media,e),b=h(b,"Number",a.replacementNumber),b=h(b,"Time",a.replacementTime),b=h(b,"Bandwidth",f),b=j(b,e.id),b=i(b),d.mediaType=c,d.type=MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE,d.url=b,d.range=a.mediaRange,d.startTime=a.presentationStartTime,d.duration=a.duration,d.timescale=e.timescale,d.availabilityStartTime=a.availabilityStartTime,d.availabilityEndTime=a.availabilityEndTime,d.wallStartTime=a.wallStartTime,d.quality=e.index,d.index=a.availabilityIdx,d.mediaInfo=this.streamProcessor.getMediaInfo(),d},E=function(b,e,f){var g,h,i,j=d,k=!!f&&f.keepIdx,l=f?f.timeThreshold:null,m=!(!f||!f.ignoreIsFinished),n=this;return b?(a=e,n.log("Getting the request for time: "+e),d=A.call(n,e,b,l),w.call(n,b),0>d&&(d=A.call(n,e,b,l)),n.log("Index for time "+e+" is "+d),i=!m&&o.call(n,b),i?(g=new MediaPlayer.vo.FragmentRequest,g.action=g.ACTION_COMPLETE,g.index=d,g.mediaType=c,g.mediaInfo=n.streamProcessor.getMediaInfo(),n.log("Signal complete."),n.log(g)):(h=B(d,b),g=D.call(n,h)),k&&(d=j),g):null},F=function(a,b){var c=(a.segmentAvailabilityRange.end-a.segmentAvailabilityRange.start)/2;return a.segments=null,a.segmentAvailabilityRange={start:b-c,end:b+c},E.call(this,a,b,{keepIdx:!1,ignoreIsFinished:!0})},G=function(b){var e,f,g,h,i=this;if(!b)return null;if(-1===d)throw"You must call getSegmentRequestForTime first.";return a=null,d+=1,h=d,g=o.call(i,b),g?(e=new MediaPlayer.vo.FragmentRequest,e.action=e.ACTION_COMPLETE,e.index=h,e.mediaType=c,e.mediaInfo=i.streamProcessor.getMediaInfo(),i.log("Signal complete.")):(w.call(i,b),f=B(h,b),e=D.call(i,f)),e},H=function(a){var b=a.data.representation;b.segments&&this.notify(Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED,{representation:b})},I=function(a){if(!a.error&&c===a.data.mediaType){var b,d,e,f,g=this,h=a.data.segments,i=a.data.representation,j=[],k=0;for(b=0,d=h.length;d>b;b+=1)e=h[b],f=u.call(g,i,e.startTime,e.duration,e.timescale,e.media,e.mediaRange,k),j.push(f),f=null,k+=1;i.segmentAvailabilityRange={start:j[0].presentationStartTime,end:j[d-1].presentationStartTime},i.availableSegmentsNumber=d,x.call(g,i,j),i.initialization&&this.notify(Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED,{representation:i})}};return{log:void 0,baseURLExt:void 0,timelineConverter:void 0,metricsModel:void 0,metricsExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this[Dash.dependencies.BaseURLExtensions.eventList.ENAME_INITIALIZATION_LOADED]=H,this[Dash.dependencies.BaseURLExtensions.eventList.ENAME_SEGMENTS_LOADED]=I},initialize:function(a){this.subscribe(Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED,a.representationController),c=a.getType(),this.setMediaType(c),b=a.isDynamic(),this.streamProcessor=a},getType:function(){return c},setType:function(a){c=a},getIsDynamic:function(){return b},setIsDynamic:function(a){b=a},setCurrentTime:function(a){e=a},getCurrentTime:function(){return e},reset:function(){e=0,a=void 0,d=-1,b=void 0,this.unsubscribe(Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED,this.streamProcessor.representationController)},getInitRequest:n,getSegmentRequestForTime:E,getNextSegmentRequest:G,generateSegmentRequestForTime:F,updateRepresentation:z}},Dash.dependencies.DashHandler.prototype={constructor:Dash.dependencies.DashHandler},Dash.dependencies.DashHandler.SEGMENTS_UNAVAILABLE_ERROR_CODE=1,Dash.dependencies.DashHandler.eventList={ENAME_REPRESENTATION_UPDATED:"representationUpdated"},Dash.dependencies.DashParser=function(){"use strict";var a=31536e3,b=2592e3,c=86400,d=3600,e=60,f=60,g=1e3,h=/^([-])?P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,i=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})([0-9]{2}))?/,j=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,k=/^https?:\/\//i,l=[{type:"duration",test:function(a){for(var b=["minBufferTime","mediaPresentationDuration","minimumUpdatePeriod","timeShiftBufferDepth","maxSegmentDuration","maxSubsegmentDuration","suggestedPresentationDelay","start","starttime","duration"],c=b.length,d=0;c>d;d++)if(a.nodeName===b[d])return h.test(a.value);return!1},converter:function(f){var g=h.exec(f),i=parseFloat(g[2]||0)*a+parseFloat(g[4]||0)*b+parseFloat(g[6]||0)*c+parseFloat(g[8]||0)*d+parseFloat(g[10]||0)*e+parseFloat(g[12]||0);return void 0!==g[1]&&(i=-i),i}},{type:"datetime",test:function(a){return i.test(a.value)},converter:function(a){var b,c=i.exec(a);if(b=Date.UTC(parseInt(c[1],10),parseInt(c[2],10)-1,parseInt(c[3],10),parseInt(c[4],10),parseInt(c[5],10),c[6]&&parseInt(c[6],10)||0,c[7]&&parseFloat(c[7])*g||0),c[9]&&c[10]){var d=parseInt(c[9],10)*f+parseInt(c[10],10);b+=("+"===c[8]?-1:1)*d*e*g}return new Date(b)}},{type:"numeric",test:function(a){return j.test(a.value)},converter:function(a){return parseFloat(a)}}],m=function(){var a,b,c,d;return d=[{name:"profiles",merge:!1},{name:"width",merge:!1},{name:"height",merge:!1},{name:"sar",merge:!1},{name:"frameRate",merge:!1},{name:"audioSamplingRate",merge:!1},{name:"mimeType",merge:!1},{name:"segmentProfiles",merge:!1},{name:"codecs",merge:!1},{name:"maximumSAPPeriod",merge:!1},{name:"startsWithSap",merge:!1},{name:"maxPlayoutRate",merge:!1},{name:"codingDependency",merge:!1},{name:"scanType",merge:!1},{name:"FramePacking",merge:!0},{name:"AudioChannelConfiguration",merge:!0},{name:"ContentProtection",merge:!0}],a={},a.name="AdaptationSet",a.isRoot=!1,a.isArray=!0,a.parent=null,a.children=[],a.properties=d,b={},b.name="Representation",b.isRoot=!1,b.isArray=!0,b.parent=a,b.children=[],b.properties=d,a.children.push(b),c={},c.name="SubRepresentation",c.isRoot=!1,c.isArray=!0,c.parent=b,c.children=[],c.properties=d,b.children.push(c),a},n=function(){var a,b,c,d;return d=[{name:"SegmentBase",merge:!0},{name:"SegmentTemplate",merge:!0},{name:"SegmentList",merge:!0}],a={},a.name="Period",a.isRoot=!1,a.isArray=!0,a.parent=null,a.children=[],a.properties=d,b={},b.name="AdaptationSet",b.isRoot=!1,b.isArray=!0,b.parent=a,b.children=[],b.properties=d,a.children.push(b),c={},c.name="Representation",c.isRoot=!1,c.isArray=!0,c.parent=b,c.children=[],c.properties=d,b.children.push(c),a},o=function(){var a,b,c,d,e;return e=[{name:"BaseURL",merge:!0,mergeFunction:function(a,b){return k.test(b)?b:a+b}}],a={},a.name="mpd",a.isRoot=!0,a.isArray=!0,a.parent=null,a.children=[],a.properties=e,b={},b.name="Period",b.isRoot=!1,b.isArray=!0,b.parent=null,b.children=[],b.properties=e,a.children.push(b),c={},c.name="AdaptationSet",c.isRoot=!1,c.isArray=!0,c.parent=b,c.children=[],c.properties=e,b.children.push(c),d={},d.name="Representation",d.isRoot=!1,d.isArray=!0,d.parent=c,d.children=[],d.properties=e,c.children.push(d),a},p=function(){var a=[];return a.push(m()),a.push(n()),a.push(o()),a};return{log:void 0,errHandler:void 0,parse:function(a,b,c){var d,e=new X2JS(l,"",!0),f=new ObjectIron(p()),g=new Date,h=null,i=null;try{d=e.xml_str2json(a),h=new Date,d.hasOwnProperty("BaseURL")?(d.BaseURL=d.BaseURL_asArray[0],0!==d.BaseURL.toString().indexOf("http")&&(d.BaseURL=b+d.BaseURL)):d.BaseURL=b,d.hasOwnProperty("Location")&&(d.Location=d.Location_asArray[0]),f.run(d),i=new Date,c.setMatchers(l),c.setIron(f),this.log("Parsing complete: ( xml2json: "+(h.getTime()-g.getTime())+"ms, objectiron: "+(i.getTime()-h.getTime())+"ms, total: "+(i.getTime()-g.getTime())/1e3+"s)")}catch(b){return this.errHandler.manifestError("parsing the manifest failed","parse",a),null}return d}}},Dash.dependencies.DashParser.prototype={constructor:Dash.dependencies.DashParser},Dash.dependencies.TimelineConverter=function(){"use strict";var a=0,b=!1,c=NaN,d=function(b,c,d,e){return e?d&&c.timeShiftBufferDepth!=Number.POSITIVE_INFINITY?new Date(c.availabilityStartTime.getTime()+1e3*(b+c.timeShiftBufferDepth)):c.availabilityEndTime:d?new Date(c.availabilityStartTime.getTime()+1e3*(b-a)):c.availabilityStartTime},e=function(a,b,c){return d.call(this,a,b,c)},f=function(a,b,c){return d.call(this,a,b,c,!0)},g=function(b,c){return(b.getTime()-c.mpd.availabilityStartTime.getTime()+1e3*a)/1e3},h=function(a,b){return a+(b.adaptation.period.start-b.presentationTimeOffset)},i=function(a,b){return a-b.adaptation.period.start+b.presentationTimeOffset},j=function(a,b){var c,d,e;return b&&(c=a.representation.adaptation.period.mpd.suggestedPresentationDelay,d=a.presentationStartTime+c,e=new Date(a.availabilityStartTime.getTime()+1e3*d)),e},k=function(a,c){var d,e,f=a.adaptation.period.start,h=f+a.adaptation.period.duration,i={start:f,end:h},j=a.segmentDuration||(a.segments&&a.segments.length?a.segments[a.segments.length-1].duration:0);if(!c)return i;if(!b&&a.segmentAvailabilityRange)return a.segmentAvailabilityRange;d=a.adaptation.period.mpd.checkTime,e=g(new Date,a.adaptation.period),f=Math.max(e-a.adaptation.period.mpd.timeShiftBufferDepth,a.adaptation.period.start);var k=isNaN(d)?e:Math.min(d,e),l=a.adaptation.period.start+a.adaptation.period.duration;return h=k>=l&&l>k-j?l:k-j,i={start:f,end:h}},l=function(a,b){return b-a.adaptation.period.start},m=function(a,b){return b+a.adaptation.period.start},n=function(d){b||d.error||(a+=d.data.liveEdge-(c+d.data.searchTime),b=!0)},o=function(c){b||c.error||(a=c.data.offset/1e3,b=!0)},p=function(a){var b=a.presentationTimeOffset;return a.adaptation.period.start-b},q=function(){a=0,b=!1,c=NaN};return{setup:function(){this[MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED]=n,this[MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED]=o},calcAvailabilityStartTimeFromPresentationTime:e,calcAvailabilityEndTimeFromPresentationTime:f,calcPresentationTimeFromWallTime:g,calcPresentationTimeFromMediaTime:h,calcPeriodRelativeTimeFromMpdRelativeTime:l,calcMpdRelativeTimeFromPeriodRelativeTime:m,calcMediaTimeFromPresentationTime:i,calcSegmentAvailabilityRange:k,calcWallTimeForSegment:j,calcMSETimeOffset:p,reset:q,isTimeSyncCompleted:function(){return b},setTimeSyncCompleted:function(a){b=a},getClientTimeOffset:function(){return a},getExpectedLiveEdge:function(){return c},setExpectedLiveEdge:function(a){c=a}}},Dash.dependencies.TimelineConverter.prototype={constructor:Dash.dependencies.TimelineConverter},Dash.dependencies.RepresentationController=function(){"use strict";var a,b=null,c=-1,d=!0,e=[],f=function(c,f,g){var h,j,k=this,m=null,n=k.streamProcessor.getStreamInfo(),o=k.abrController.getTopQualityIndexFor(g,n.id);if(d=!0,k.notify(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_STARTED),e=l.call(k,f),null===b?(j=k.abrController.getAverageThroughput(g),m=j||k.abrController.getInitialBitrateFor(g,n),h=k.abrController.getQualityForBitrate(k.streamProcessor.getMediaInfo(),m)):h=k.abrController.getQualityFor(g,n),h>o&&(h=o),a=i.call(k,h),b=c,"video"!==g&&"audio"!==g&&"fragmentedText"!==g)return d=!1,void k.notify(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,{data:b,currentRepresentation:a});for(var p=0;p<e.length;p+=1)k.indexHandler.updateRepresentation(e[p],!0)},g=function(){var a=new Date,b=this.getCurrentRepresentation(),c=this.streamProcessor.playbackController.getTime();this.metricsModel.addRepresentationSwitch(b.adaptation.type,a,c,b.id)},h=function(){var b=this.streamProcessor,c=this.timelineConverter.calcSegmentAvailabilityRange(a,b.isDynamic());this.metricsModel.addDVRInfo(b.getType(),b.playbackController.getTime(),b.getStreamInfo().manifestInfo,c)},i=function(a){return e[a]},j=function(a){return e.indexOf(a)},k=function(){for(var a=0,b=e.length;b>a;a+=1){var c=e[a].segmentInfoType;if(null===e[a].segmentAvailabilityRange||null===e[a].initialization||("SegmentBase"===c||"BaseURL"===c)&&!e[a].segments)return!1}return!0},l=function(a){var d=this,e=d.manifestModel.getValue();return c=d.manifestExt.getIndexForAdaptation(b,e,a.period.index),d.manifestExt.getRepresentationsForAdaptation(e,a)},m=function(a){for(var b,c=this,d=0,f=e.length;f>d;d+=1)b=e[d],b.segmentAvailabilityRange=c.timelineConverter.calcSegmentAvailabilityRange(b,a)},n=function(b){var c=this,f=1e3*(b+a.segmentDuration*this.liveDelayFragmentCount),g=function(){if(!this.isUpdating()){d=!0,c.notify(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_STARTED);for(var a=0;a<e.length;a+=1)c.indexHandler.updateRepresentation(e[a],!0)}};d=!1,setTimeout(g.bind(this),f)},o=function(c){if(this.isUpdating()){var e,f,i,l=this,m=c.data.representation,o=l.metricsModel.getMetricsFor("stream"),p=l.metricsModel.getMetricsFor(this.getCurrentRepresentation().adaptation.type),q=l.metricsExt.getCurrentManifestUpdate(o),r=!1;if(c.error&&c.error.code===Dash.dependencies.DashHandler.SEGMENTS_UNAVAILABLE_ERROR_CODE)return h.call(this),n.call(this,c.error.data.availabilityDelay),f=new MediaPlayer.vo.Error(Dash.dependencies.RepresentationController.SEGMENTS_UPDATE_FAILED_ERROR_CODE,"Segments update failed",null),void this.notify(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,{data:b,currentRepresentation:a},f);if(q){for(var s=0;s<q.trackInfo.length;s+=1)if(e=q.trackInfo[s],e.index===m.index&&e.mediaType===l.streamProcessor.getType()){r=!0;break}r||l.metricsModel.addManifestUpdateRepresentationInfo(q,m.id,m.index,m.adaptation.period.index,l.streamProcessor.getType(),m.presentationTimeOffset,m.startNumber,m.segmentInfoType)}k()&&(d=!1,l.abrController.setPlaybackQuality(l.streamProcessor.getType(),l.streamProcessor.getStreamInfo(),j.call(this,a)),l.metricsModel.updateManifestUpdateInfo(q,{latency:a.segmentAvailabilityRange.end-l.streamProcessor.playbackController.getTime()}),i=l.metricsExt.getCurrentRepresentationSwitch(p),i||g.call(l),this.notify(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,{data:b,currentRepresentation:a}))}},p=function(a){m.call(this,a.data.isDynamic)},q=function(b){if(!b.error){m.call(this,!0),this.indexHandler.updateRepresentation(a,!1);var c=this.manifestModel.getValue(),d=a.adaptation.period,e=this.streamController.getActiveStreamInfo();e.isLast&&(d.mpd.checkTime=this.manifestExt.getCheckTime(c,d),d.duration=this.manifestExt.getEndTimeForLastPeriod(this.manifestModel.getValue(),d)-d.start,e.duration=d.duration)}},r=function(){h.call(this)},s=function(b){var c=this;b.data.mediaType===c.streamProcessor.getType()&&c.streamProcessor.getStreamInfo().id===b.data.streamInfo.id&&(a=c.getRepresentationForQuality(b.data.newQuality),t.call(c,b.data.mediaType,a.bandwidth),g.call(c))},t=function(a,b){!this.DOMStorage.isSupported(MediaPlayer.utils.DOMStorage.STORAGE_TYPE_LOCAL)||"video"!==a&&"audio"!==a||localStorage.setItem(MediaPlayer.utils.DOMStorage["LOCAL_STORAGE_"+a.toUpperCase()+"_BITRATE_KEY"],JSON.stringify({bitrate:b/1e3,timestamp:(new Date).getTime()}))};return{system:void 0,log:void 0,manifestExt:void 0,manifestModel:void 0,metricsModel:void 0,metricsExt:void 0,abrController:void 0,streamController:void 0,timelineConverter:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,DOMStorage:void 0,liveDelayFragmentCount:void 0,setup:function(){this[MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED]=s,this[Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED]=o,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED]=p,this[MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED]=q,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED]=r},initialize:function(a){this.streamProcessor=a,this.indexHandler=a.indexHandler},getData:function(){return b},getDataIndex:function(){return c},isUpdating:function(){return d},updateData:f,getRepresentationForQuality:i,getCurrentRepresentation:function(){return a}}},Dash.dependencies.RepresentationController.prototype={constructor:Dash.dependencies.RepresentationController},Dash.dependencies.RepresentationController.SEGMENTS_UPDATE_FAILED_ERROR_CODE=1,Dash.dependencies.RepresentationController.eventList={ENAME_DATA_UPDATE_COMPLETED:"dataUpdateCompleted",ENAME_DATA_UPDATE_STARTED:"dataUpdateStarted"},Dash.dependencies.BaseURLExtensions=function(){"use strict";var a=function(a,b){for(var c,d,e,f,g=a.references,h=g.length,i=a.timescale,j=a.earliest_presentation_time,k=b.range.start+a.first_offset+a.size,l=[],m=0;h>m;m+=1)e=g[m].subsegment_duration,f=g[m].referenced_size,c=new Dash.vo.Segment,c.duration=e,c.media=b.url,c.startTime=j,c.timescale=i,d=k+f-1,c.mediaRange=k+"-"+d,l.push(c),j+=e,k+=f;return l},b=function(a){var b,c,d=a.getBox("ftyp"),e=a.getBox("moov"),f=null;return this.log("Searching for initialization."),e&&e.isComplete&&(b=d?d.offset:e.offset,c=e.offset+e.size-1,f=b+"-"+c,this.log("Found the initialization.  Range: "+f)),f},c=function(a,d){var f=new XMLHttpRequest,g=!0,h=this,i=null,j=null,k=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].BaseURL,l=d||{url:k,range:{start:0,end:1500},searching:!1,bytesLoaded:0,bytesToLoad:1500,request:f};h.log("Start searching for initialization."),f.onload=function(){f.status<200||f.status>299||(g=!1,l.bytesLoaded=l.range.end,j=h.boxParser.parse(f.response),i=b.call(h,j),i?(a.range=i,a.initialization=k,h.notify(Dash.dependencies.BaseURLExtensions.eventList.ENAME_INITIALIZATION_LOADED,{representation:a})):(l.range.end=l.bytesLoaded+l.bytesToLoad,c.call(h,a,l)))},f.onloadend=f.onerror=function(){g&&(g=!1,h.errHandler.downloadError("initialization",l.url,f),h.notify(Dash.dependencies.BaseURLExtensions.eventList.ENAME_INITIALIZATION_LOADED,{representation:a}))},e.call(h,f,l),h.log("Perform init search: "+l.url)},d=function(b,c,f,g,h){var i=this,j=null!==f,k=new XMLHttpRequest,l=b.adaptation.period.mpd.manifest.Period_asArray[b.adaptation.period.index].AdaptationSet_asArray[b.adaptation.index].Representation_asArray[b.index].BaseURL,m=!0,n=null,o=null,p={url:l,range:j?f:{start:0,end:1500},searching:!j,bytesLoaded:g?g.bytesLoaded:0,bytesToLoad:1500,request:k};k.onload=function(){if(!(k.status<200||k.status>299)){var e=p.bytesToLoad,f=k.response.byteLength;if(m=!1,p.bytesLoaded=p.range.end-p.range.start,n=i.boxParser.parse(k.response),(o=n.getBox("sidx"))&&o.isComplete){var g,j,l=o.references;if(null!==l&&void 0!==l&&l.length>0&&(g=1===l[0].reference_type),g){i.log("Initiate multiple SIDX load."),p.range.end=p.range.start+o.size;var q,r,s,t,u,v=[],w=0,x=(o.offset||p.range.start)+o.size,y=function(a){a?(v=v.concat(a),(w+=1)>=r&&h.call(i,v,b,c)):h.call(i,null,b,c)};for(q=0,r=l.length;r>q;q+=1)s=x,t=x+l[q].referenced_size-1,x+=l[q].referenced_size,u={start:s,end:t},d.call(i,b,null,u,p,y)}else i.log("Parsing segments from SIDX."),j=a.call(i,o,p),h.call(i,j,b,c)}else{
if(o)p.range.start=o.offset||p.range.start,p.range.end=p.range.start+(o.size||e);else{if(f<p.bytesLoaded)return void h.call(i,null,b,c);var z=n.getLastBox();z&&z.size?(p.range.start=z.offset+z.size,p.range.end=p.range.start+e):p.range.end+=e}d.call(i,b,c,p.range,p,h)}}},k.onloadend=k.onerror=function(){m&&(m=!1,i.errHandler.downloadError("SIDX",p.url,k),h.call(i,null,b,c))},e.call(i,k,p),i.log("Perform SIDX load: "+p.url)},e=function(a,b){a.open("GET",this.requestModifierExt.modifyRequestURL(b.url)),a.responseType="arraybuffer",a.setRequestHeader("Range","bytes="+b.range.start+"-"+b.range.end),a=this.requestModifierExt.modifyRequestHeader(a),a.send(null)},f=function(a,b,c){var d=this;a?d.notify(Dash.dependencies.BaseURLExtensions.eventList.ENAME_SEGMENTS_LOADED,{segments:a,representation:b,mediaType:c}):d.notify(Dash.dependencies.BaseURLExtensions.eventList.ENAME_SEGMENTS_LOADED,{segments:null,representation:b,mediaType:c},new MediaPlayer.vo.Error(null,"error loading segments",null))};return{log:void 0,errHandler:void 0,requestModifierExt:void 0,boxParser:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,loadSegments:function(a,b,c){var e=c?c.split("-"):null;c=e?{start:parseFloat(e[0]),end:parseFloat(e[1])}:null,d.call(this,a,b,c,null,f.bind(this))},loadInitialization:c}},Dash.dependencies.BaseURLExtensions.prototype={constructor:Dash.dependencies.BaseURLExtensions},Dash.dependencies.BaseURLExtensions.eventList={ENAME_INITIALIZATION_LOADED:"initializationLoaded",ENAME_SEGMENTS_LOADED:"segmentsLoaded"},Dash.dependencies.DashManifestExtensions=function(){"use strict";this.timelineConverter=void 0},Dash.dependencies.DashManifestExtensions.prototype={constructor:Dash.dependencies.DashManifestExtensions,getIsTypeOf:function(a,b){"use strict";var c,d,e,f=a.ContentComponent_asArray,g="text"!==b?new RegExp(b):new RegExp("(vtt|ttml)"),h=!1,i=!1;if(a.Representation_asArray.length>0&&a.Representation_asArray[0].hasOwnProperty("codecs")&&"stpp"==a.Representation_asArray[0].codecs)return"fragmentedText"==b;if(f){if(f.length>1)return"muxed"==b;f[0]&&f[0].contentType===b&&(h=!0,i=!0)}if(a.hasOwnProperty("mimeType")&&(h=g.test(a.mimeType),i=!0),!i)for(c=0,d=a.Representation_asArray.length;!i&&d>c;)e=a.Representation_asArray[c],e.hasOwnProperty("mimeType")&&(h=g.test(e.mimeType),i=!0),c+=1;return h},getIsAudio:function(a){"use strict";return this.getIsTypeOf(a,"audio")},getIsVideo:function(a){"use strict";return this.getIsTypeOf(a,"video")},getIsFragmentedText:function(a){"use strict";return this.getIsTypeOf(a,"fragmentedText")},getIsText:function(a){"use strict";return this.getIsTypeOf(a,"text")},getIsMuxed:function(a){return this.getIsTypeOf(a,"muxed")},getIsTextTrack:function(a){return"text/vtt"===a||"application/ttml+xml"===a},getLanguageForAdaptation:function(a){var b="";return a.hasOwnProperty("lang")&&(b=a.lang),b},getViewpointForAdaptation:function(a){return a.hasOwnProperty("Viewpoint")?a.Viewpoint:null},getRolesForAdaptation:function(a){return a.hasOwnProperty("Role_asArray")?a.Role_asArray:[]},getAccessibilityForAdaptation:function(a){return a.hasOwnProperty("Accessibility_asArray")?a.Accessibility_asArray:[]},getAudioChannelConfigurationForAdaptation:function(a){return a.hasOwnProperty("AudioChannelConfiguration_asArray")?a.AudioChannelConfiguration_asArray:[]},getIsMain:function(a){"use strict";return this.getRolesForAdaptation(a).filter(function(a){return"main"===a.value})[0]},processAdaptation:function(a){"use strict";return void 0!==a.Representation_asArray&&null!==a.Representation_asArray&&a.Representation_asArray.sort(function(a,b){return a.bandwidth-b.bandwidth}),a},getAdaptationForId:function(a,b,c){"use strict";var d,e,f=b.Period_asArray[c].AdaptationSet_asArray;for(d=0,e=f.length;e>d;d+=1)if(f[d].hasOwnProperty("id")&&f[d].id===a)return f[d];return null},getAdaptationForIndex:function(a,b,c){"use strict";return b.Period_asArray[c].AdaptationSet_asArray[a]},getIndexForAdaptation:function(a,b,c){"use strict";var d,e,f=b.Period_asArray[c].AdaptationSet_asArray;for(d=0,e=f.length;e>d;d+=1)if(f[d]===a)return d;return-1},getAdaptationsForType:function(a,b,c){"use strict";var d,e,f=this,g=a.Period_asArray[b].AdaptationSet_asArray,h=[];for(d=0,e=g.length;e>d;d+=1)this.getIsTypeOf(g[d],c)&&h.push(f.processAdaptation(g[d]));return h},getAdaptationForType:function(a,b,c){"use strict";var d,e,f,g=this;if(!(f=this.getAdaptationsForType(a,b,c))||0===f.length)return null;for(d=0,e=f.length;e>d;d+=1)if(g.getIsMain(f[d]))return f[d];return f[0]},getCodec:function(a){"use strict";var b=a.Representation_asArray[0];return b.mimeType+';codecs="'+b.codecs+'"'},getMimeType:function(a){"use strict";return a.Representation_asArray[0].mimeType},getKID:function(a){"use strict";return a&&a.hasOwnProperty("cenc:default_KID")?a["cenc:default_KID"]:null},getContentProtectionData:function(a){"use strict";return a&&a.hasOwnProperty("ContentProtection_asArray")&&0!==a.ContentProtection_asArray.length?a.ContentProtection_asArray:null},getIsDynamic:function(a){"use strict";var b=!1;return a.hasOwnProperty("type")&&(b="dynamic"===a.type),b},getIsDVR:function(a){"use strict";var b,c=this.getIsDynamic(a);return b=!isNaN(a.timeShiftBufferDepth),c&&b},getIsOnDemand:function(a){"use strict";var b=!1;return a.profiles&&a.profiles.length>0&&(b=-1!==a.profiles.indexOf("urn:mpeg:dash:profile:isoff-on-demand:2011")),b},getDuration:function(a){return a.hasOwnProperty("mediaPresentationDuration")?a.mediaPresentationDuration:Number.MAX_VALUE},getBandwidth:function(a){"use strict";return a.bandwidth},getRefreshDelay:function(a){"use strict";var b=NaN;return a.hasOwnProperty("minimumUpdatePeriod")&&(b=Math.max(parseFloat(a.minimumUpdatePeriod),2)),b},getRepresentationCount:function(a){"use strict";return a.Representation_asArray.length},getBitrateListForAdaptation:function(a){if(!a||!a.Representation_asArray||!a.Representation_asArray.length)return null;for(var b=this.processAdaptation(a),c=b.Representation_asArray,d=c.length,e=[],f=0;d>f;f+=1)e.push(c[f].bandwidth);return e},getRepresentationFor:function(a,b){"use strict";return b.Representation_asArray[a]},getRepresentationsForAdaptation:function(a,b){for(var c,d,e,f,g,h=this,i=h.processAdaptation(a.Period_asArray[b.period.index].AdaptationSet_asArray[b.index]),j=[],k=0;k<i.Representation_asArray.length;k+=1)f=i.Representation_asArray[k],c=new Dash.vo.Representation,c.index=k,c.adaptation=b,f.hasOwnProperty("id")&&(c.id=f.id),f.hasOwnProperty("bandwidth")&&(c.bandwidth=f.bandwidth),f.hasOwnProperty("maxPlayoutRate")&&(c.maxPlayoutRate=f.maxPlayoutRate),f.hasOwnProperty("SegmentBase")?(e=f.SegmentBase,c.segmentInfoType="SegmentBase"):f.hasOwnProperty("SegmentList")?(e=f.SegmentList,c.segmentInfoType="SegmentList",c.useCalculatedLiveEdgeTime=!0):f.hasOwnProperty("SegmentTemplate")?(e=f.SegmentTemplate,e.hasOwnProperty("SegmentTimeline")?(c.segmentInfoType="SegmentTimeline",g=e.SegmentTimeline.S_asArray[e.SegmentTimeline.S_asArray.length-1],(!g.hasOwnProperty("r")||g.r>=0)&&(c.useCalculatedLiveEdgeTime=!0)):c.segmentInfoType="SegmentTemplate",e.hasOwnProperty("initialization")&&(c.initialization=e.initialization.split("$Bandwidth$").join(f.bandwidth).split("$RepresentationID$").join(f.id))):(e=f.BaseURL,c.segmentInfoType="BaseURL"),e.hasOwnProperty("Initialization")?(d=e.Initialization,d.hasOwnProperty("sourceURL")?c.initialization=d.sourceURL:d.hasOwnProperty("range")&&(c.initialization=f.BaseURL,c.range=d.range)):f.hasOwnProperty("mimeType")&&h.getIsTextTrack(f.mimeType)&&(c.initialization=f.BaseURL,c.range=0),e.hasOwnProperty("timescale")&&(c.timescale=e.timescale),e.hasOwnProperty("duration")&&(c.segmentDuration=e.duration/c.timescale),e.hasOwnProperty("startNumber")&&(c.startNumber=e.startNumber),e.hasOwnProperty("indexRange")&&(c.indexRange=e.indexRange),e.hasOwnProperty("presentationTimeOffset")&&(c.presentationTimeOffset=e.presentationTimeOffset/c.timescale),c.MSETimeOffset=h.timelineConverter.calcMSETimeOffset(c),j.push(c);return j},getAdaptationsForPeriod:function(a,b){for(var c,d,e=a.Period_asArray[b.index],f=[],g=0;g<e.AdaptationSet_asArray.length;g+=1)d=e.AdaptationSet_asArray[g],c=new Dash.vo.AdaptationSet,d.hasOwnProperty("id")&&(c.id=d.id),c.index=g,c.period=b,this.getIsMuxed(d)?c.type="muxed":this.getIsAudio(d)?c.type="audio":this.getIsVideo(d)?c.type="video":this.getIsFragmentedText(d)?c.type="fragmentedText":c.type="text",f.push(c);return f},getRegularPeriods:function(a,b){var c,d,e=this,f=[],g=e.getIsDynamic(a),h=null,i=null,j=null,k=null;for(c=0,d=a.Period_asArray.length;d>c;c+=1)i=a.Period_asArray[c],i.hasOwnProperty("start")?(k=new Dash.vo.Period,k.start=i.start):null!==h&&i.hasOwnProperty("duration")&&null!==j?(k=new Dash.vo.Period,k.start=j.start+j.duration,k.duration=i.duration):0!==c||g||(k=new Dash.vo.Period,k.start=0),null!==j&&isNaN(j.duration)&&(j.duration=k.start-j.start),null!==k&&i.hasOwnProperty("id")&&(k.id=i.id),null!==k&&i.hasOwnProperty("duration")&&(k.duration=i.duration),null!==k&&(k.index=c,k.mpd=b,f.push(k),h=i,j=k),i=null,k=null;return 0===f.length?f:(null!==j&&isNaN(j.duration)&&(j.duration=e.getEndTimeForLastPeriod(a,j)-j.start),f)},getMpd:function(a){var b=new Dash.vo.Mpd;return b.manifest=a,a.hasOwnProperty("availabilityStartTime")?b.availabilityStartTime=new Date(a.availabilityStartTime.getTime()):b.availabilityStartTime=new Date(a.loadedTime.getTime()),a.hasOwnProperty("availabilityEndTime")&&(b.availabilityEndTime=new Date(a.availabilityEndTime.getTime())),a.hasOwnProperty("suggestedPresentationDelay")&&(b.suggestedPresentationDelay=a.suggestedPresentationDelay),a.hasOwnProperty("timeShiftBufferDepth")&&(b.timeShiftBufferDepth=a.timeShiftBufferDepth),a.hasOwnProperty("maxSegmentDuration")&&(b.maxSegmentDuration=a.maxSegmentDuration),b},getFetchTime:function(a,b){return this.timelineConverter.calcPresentationTimeFromWallTime(a.loadedTime,b)},getCheckTime:function(a,b){var c,d=this,e=NaN;return a.hasOwnProperty("minimumUpdatePeriod")&&(c=d.getFetchTime(a,b),e=c+a.minimumUpdatePeriod),e},getEndTimeForLastPeriod:function(a,b){var c,d=this.getCheckTime(a,b);if(a.mediaPresentationDuration)c=a.mediaPresentationDuration;else{if(isNaN(d))throw new Error("Must have @mediaPresentationDuration or @minimumUpdatePeriod on MPD or an explicit @duration on the last period.");c=d}return c},getEventsForPeriod:function(a,b){var c=a.Period_asArray,d=c[b.index].EventStream_asArray,e=[];if(d)for(var f=0;f<d.length;f+=1){var g=new Dash.vo.EventStream;if(g.period=b,g.timescale=1,!d[f].hasOwnProperty("schemeIdUri"))throw"Invalid EventStream. SchemeIdUri has to be set";g.schemeIdUri=d[f].schemeIdUri,d[f].hasOwnProperty("timescale")&&(g.timescale=d[f].timescale),d[f].hasOwnProperty("value")&&(g.value=d[f].value);for(var h=0;h<d[f].Event_asArray.length;h+=1){var i=new Dash.vo.Event;i.presentationTime=0,i.eventStream=g,d[f].Event_asArray[h].hasOwnProperty("presentationTime")&&(i.presentationTime=d[f].Event_asArray[h].presentationTime),d[f].Event_asArray[h].hasOwnProperty("duration")&&(i.duration=d[f].Event_asArray[h].duration),d[f].Event_asArray[h].hasOwnProperty("id")&&(i.id=d[f].Event_asArray[h].id),e.push(i)}}return e},getEventStreams:function(a,b){var c=[];if(!a)return c;for(var d=0;d<a.length;d++){var e=new Dash.vo.EventStream;if(e.timescale=1,e.representation=b,!a[d].hasOwnProperty("schemeIdUri"))throw"Invalid EventStream. SchemeIdUri has to be set";e.schemeIdUri=a[d].schemeIdUri,a[d].hasOwnProperty("timescale")&&(e.timescale=a[d].timescale),a[d].hasOwnProperty("value")&&(e.value=a[d].value),c.push(e)}return c},getEventStreamForAdaptationSet:function(a,b){var c=a.Period_asArray[b.period.index].AdaptationSet_asArray[b.index].InbandEventStream_asArray;return this.getEventStreams(c,null)},getEventStreamForRepresentation:function(a,b){var c=a.Period_asArray[b.adaptation.period.index].AdaptationSet_asArray[b.adaptation.index].Representation_asArray[b.index].InbandEventStream_asArray;return this.getEventStreams(c,b)},getUTCTimingSources:function(a){"use strict";var b=this,c=b.getIsDynamic(a),d=a.hasOwnProperty("availabilityStartTime"),e=a.UTCTiming_asArray,f=[];return(c||d)&&e&&e.forEach(function(a){var b=new Dash.vo.UTCTiming;a.hasOwnProperty("schemeIdUri")&&(b.schemeIdUri=a.schemeIdUri,a.hasOwnProperty("value")&&(b.value=a.value.toString(),f.push(b)))}),f}},Dash.dependencies.DashMetricsExtensions=function(){"use strict";var a=function(a,b){var c,d,e,f,g,h;for(d=a.AdaptationSet_asArray,g=0;g<d.length;g+=1)for(c=d[g],f=c.Representation_asArray,h=0;h<f.length;h+=1)if(e=f[h],b===e.id)return h;return-1},b=function(a,b){var c,d,e,f,g,h;for(d=a.AdaptationSet_asArray,g=0;g<d.length;g+=1)for(c=d[g],f=c.Representation_asArray,h=0;h<f.length;h+=1)if(e=f[h],b===e.id)return e;return null},c=function(a,b){return this.manifestExt.getIsTypeOf(a,b)},d=function(a,b){var d,e,f,g;if(!a||!b)return-1;for(e=a.AdaptationSet_asArray,g=0;g<e.length;g+=1)if(d=e[g],f=d.Representation_asArray,c.call(this,d,b))return f.length;return-1},e=function(a,c){var d,e=this,f=e.manifestModel.getValue(),g=f.Period_asArray[c];return d=b.call(e,g,a),null===d?null:d.bandwidth},f=function(b,c){var d=this,e=d.manifestModel.getValue(),f=e.Period_asArray[c];return a.call(d,f,b)},g=function(a,b){var c=this,e=c.manifestModel.getValue(),f=e.Period_asArray[b];return d.call(this,f,a)},h=function(a,b){var c=this.system.getObject("abrController"),d=0;return c&&(d=c.getTopQualityIndexFor(a,b)),d},i=function(a){if(null===a)return null;var b,c,d=a.RepSwitchList;return null===d||d.length<=0?null:(b=d.length,c=b-1,d[c])},j=function(a){if(null===a)return null;var b,c,d=a.BufferLevel;return null===d||d.length<=0?null:(b=d.length,c=b-1,d[c])},k=function(a){return a.RequestsQueue},l=function(a){if(null===a)return null;var b,c=a.PlayList;return null===c||c.length<=0?null:(b=c[c.length-1].trace,null===b||b.length<=0?null:b[b.length-1].playbackspeed)},m=function(a){if(null===a)return null;var b,c,d=a.HttpList,e=null;if(null===d||d.length<=0)return null;for(b=d.length,c=b-1;c>=0;){if(d[c].responsecode){e=d[c];break}c-=1}return e},n=function(a){return null===a?[]:a.HttpList?a.HttpList:[]},o=function(a){if(null===a)return null;var b,c,d=a.DroppedFrames;return null===d||d.length<=0?null:(b=d.length,c=b-1,d[c])},p=function(a){if(null===a)return null;var b,c,d=a.SchedulingInfo;return null===d||d.length<=0?null:(b=d.length,c=b-1,d[c])},q=function(a){if(null===a)return null;var b,c,d=a.ManifestUpdate;return null===d||d.length<=0?null:(b=d.length,c=b-1,d[c])},r=function(a){if(null===a)return null;var b,c=a.DVRInfo;return null===c||c.length<=0?null:(b=c.length-1,c[b])},s=function(a,b){var c,d,e,f={};if(null===a)return null;for(c=n(a),e=c.length-1;e>=0;e-=1)if(d=c[e],d.type===MediaPlayer.vo.metrics.HTTPRequest.MPD_TYPE){f=u(d.responseHeaders);break}return void 0===f[b]?null:f[b]},t=function(a,b){if(null===a)return null;var c,d=m(a);return null===d||null===d.responseHeaders?null:(c=u(d.responseHeaders),void 0===c[b]?null:c[b])},u=function(a){var b={};if(!a)return b;for(var c=a.split("\r\n"),d=0,e=c.length;e>d;d++){var f=c[d],g=f.indexOf(": ");g>0&&(b[f.substring(0,g)]=f.substring(g+2))}return b};return{manifestModel:void 0,manifestExt:void 0,system:void 0,getBandwidthForRepresentation:e,getIndexForRepresentation:f,getMaxIndexForBufferType:g,getMaxAllowedIndexForBufferType:h,getCurrentRepresentationSwitch:i,getCurrentBufferLevel:j,getCurrentPlaybackRate:l,getCurrentHttpRequest:m,getHttpRequests:n,getCurrentDroppedFrames:o,getCurrentSchedulingInfo:p,getCurrentDVRInfo:r,getCurrentManifestUpdate:q,getLatestFragmentRequestHeaderValueByID:t,getLatestMPDRequestHeaderValueByID:s,getRequestsQueue:k}},Dash.dependencies.DashMetricsExtensions.prototype={constructor:Dash.dependencies.DashMetricsExtensions},Dash.dependencies.FragmentExtensions=function(){"use strict";return{log:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,boxParser:void 0,getSamplesInfo:function(a){var b,c,d,e,f,g,h,i,j,k=this.boxParser.parse(a),l=k.getBox("tfhd"),m=k.getBox("tfdt"),n=k.getBox("trun"),o=k.getBox("moof");for(d=n.sample_count,f=m.baseMediaDecodeTime,j=(l.base_data_offset||0)+(n.data_offset||0),g=[],i=0;d>i;i++)h=n.samples[i],b=void 0!==h.sample_duration?h.sample_duration:l.default_sample_duration,e=void 0!==h.sample_size?h.sample_size:l.default_sample_size,c=void 0!==h.sample_composition_time_offset?h.sample_composition_time_offset:0,g.push({dts:f,cts:f+c,duration:b,offset:o.offset+j,size:e}),j+=e,f+=b;return g},getMediaTimescaleFromMoov:function(a){var b=this.boxParser.parse(a),c=b.getBox("mdhd");return c?c.timescale:NaN}}},Dash.dependencies.FragmentExtensions.prototype={constructor:Dash.dependencies.FragmentExtensions},Dash.dependencies.FragmentExtensions.eventList={ENAME_FRAGMENT_LOADING_COMPLETED:"fragmentLoadingCompleted"},Dash.vo.AdaptationSet=function(){"use strict";this.period=null,this.index=-1,this.type=null},Dash.vo.AdaptationSet.prototype={constructor:Dash.vo.AdaptationSet},Dash.vo.Event=function(){"use strict";this.duration=NaN,this.presentationTime=NaN,this.id=NaN,this.messageData="",this.eventStream=null,this.presentationTimeDelta=NaN},Dash.vo.Event.prototype={constructor:Dash.vo.Event},Dash.vo.EventStream=function(){"use strict";this.adaptionSet=null,this.representation=null,this.period=null,this.timescale=1,this.value="",this.schemeIdUri=""},Dash.vo.EventStream.prototype={constructor:Dash.vo.EventStream},Dash.vo.Mpd=function(){"use strict";this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.checkTime=NaN,this.clientServerTimeShift=0,this.isClientServerTimeSyncCompleted=!1},Dash.vo.Mpd.prototype={constructor:Dash.vo.Mpd},Dash.vo.Period=function(){"use strict";this.id=null,this.index=-1,this.duration=NaN,this.start=NaN,this.mpd=null},Dash.vo.Period.prototype={constructor:Dash.vo.Period},Dash.vo.Representation=function(){"use strict";this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.segmentDuration=NaN,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=NaN,this.segmentAvailabilityRange=null,this.availableSegmentsNumber=0,this.bandwidth=NaN,this.maxPlayoutRate=NaN},Dash.vo.Representation.prototype={constructor:Dash.vo.Representation},Dash.vo.Segment=function(){"use strict";this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=NaN,this.replacementTime=null,this.replacementNumber=NaN,this.mediaStartTime=NaN,this.presentationStartTime=NaN,this.availabilityStartTime=NaN,this.availabilityEndTime=NaN,this.availabilityIdx=NaN,this.wallStartTime=NaN,this.representation=null},Dash.vo.Segment.prototype={constructor:Dash.vo.Segment},Dash.vo.UTCTiming=function(){"use strict";this.schemeIdUri="",this.value=""},Dash.vo.UTCTiming.prototype={constructor:Dash.vo.UTCTiming},MediaPlayer.dependencies.ErrorHandler=function(){"use strict";var a=MediaPlayer.events.ERROR;return{eventBus:void 0,capabilityError:function(b){this.eventBus.dispatchEvent({type:a,error:"capability",event:b})},downloadError:function(b,c,d){this.eventBus.dispatchEvent({type:a,error:"download",event:{id:b,url:c,request:d}})},manifestError:function(b,c,d){this.eventBus.dispatchEvent({type:a,error:"manifestError",event:{message:b,id:c,manifest:d}})},closedCaptionsError:function(b,c,d){this.eventBus.dispatchEvent({type:a,error:"cc",event:{message:b,id:c,cc:d}})},mediaSourceError:function(b){this.eventBus.dispatchEvent({type:a,error:"mediasource",event:b})},mediaKeySessionError:function(b){this.eventBus.dispatchEvent({type:a,error:"key_session",event:b})},mediaKeyMessageError:function(b){this.eventBus.dispatchEvent({type:a,error:"key_message",event:b})},mediaKeySystemSelectionError:function(b){this.eventBus.dispatchEvent({type:a,error:"key_system_selection",event:b})}}},MediaPlayer.dependencies.ErrorHandler.prototype={constructor:MediaPlayer.dependencies.ErrorHandler},MediaPlayer.dependencies.FragmentLoader=function(){"use strict";var a=MediaPlayer.dependencies.FragmentLoader.RETRY_ATTEMPTS,b=MediaPlayer.dependencies.FragmentLoader.RETRY_INTERVAL,c=[],d=function(a,e){var f=new XMLHttpRequest,g=[],h=!0,i=!0,j=null,k=this,l=function(b,c){i=!1;var d,e,h=new Date,l=f.response,m=null;g.push({s:h,d:h.getTime()-j.getTime(),b:[l?l.byteLength:0]}),b.firstByteDate||(b.firstByteDate=b.requestStartDate),b.requestEndDate=h,d=b.firstByteDate.getTime()-b.requestStartDate.getTime(),e=b.requestEndDate.getTime()-b.firstByteDate.getTime(),k.log((c?"loaded ":"failed ")+b.mediaType+":"+b.type+":"+b.startTime+" ("+f.status+", "+d+"ms, "+e+"ms)"),m=k.metricsModel.addHttpRequest(a.mediaType,null,a.type,a.url,f.responseURL||null,a.range,a.requestStartDate,b.firstByteDate,b.requestEndDate,f.status,a.duration,f.getAllResponseHeaders()),c&&g.forEach(function(a){k.metricsModel.appendHttpTrace(m,a.s,a.d,a.b)})};c.push(f),a.requestStartDate=new Date,g.push({s:a.requestStartDate,d:0,b:[0]}),j=a.requestStartDate,f.open("GET",k.requestModifierExt.modifyRequestURL(a.url),!0),f.responseType="arraybuffer",f=k.requestModifierExt.modifyRequestHeader(f),a.range&&f.setRequestHeader("Range","bytes="+a.range),f.onprogress=function(b){var c=new Date;h&&(h=!1,(!b.lengthComputable||b.lengthComputable&&b.total!=b.loaded)&&(a.firstByteDate=c)),b.lengthComputable&&(a.bytesLoaded=b.loaded,a.bytesTotal=b.total),g.push({s:c,d:c.getTime()-j.getTime(),b:[f.response?f.response.byteLength:0]}),j=c,k.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_PROGRESS,{request:a})},f.onload=function(){f.status<200||f.status>299||(l(a,!0),k.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_COMPLETED,{request:a,response:f.response}))},f.onloadend=f.onerror=function(){-1!==c.indexOf(f)&&(c.splice(c.indexOf(f),1),i&&(l(a,!1),e>0?(k.log("Failed loading fragment: "+a.mediaType+":"+a.type+":"+a.startTime+", retry in "+b+"ms attempts: "+e),e--,setTimeout(function(){d.call(k,a,e)},b)):(k.log("Failed loading fragment: "+a.mediaType+":"+a.type+":"+a.startTime+" no retry attempts left"),k.errHandler.downloadError("content",a.url,f),k.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_COMPLETED,{request:a,bytes:null},new MediaPlayer.vo.Error(null,"failed loading fragment",null)))))},f.send()},e=function(a){var b=this,c=new XMLHttpRequest,d=!1;c.open("HEAD",a.url,!0),c.onload=function(){c.status<200||c.status>299||(d=!0,b.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,{request:a,exists:!0}))},c.onloadend=c.onerror=function(){d||b.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,{request:a,exists:!1})},c.send()};return{metricsModel:void 0,errHandler:void 0,log:void 0,requestModifierExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,load:function(b){b?d.call(this,b,a):this.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_COMPLETED,{request:b,bytes:null},new MediaPlayer.vo.Error(null,"request is null",null))},checkForExistence:function(a){return a?void e.call(this,a):void this.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,{request:a,exists:!1})},abort:function(){var a,b,d=c.length;for(a=0;d>a;a+=1)b=c[a],c[a]=null,b.abort(),b=null;c=[]}}},MediaPlayer.dependencies.FragmentLoader.RETRY_ATTEMPTS=3,MediaPlayer.dependencies.FragmentLoader.RETRY_INTERVAL=500,MediaPlayer.dependencies.FragmentLoader.prototype={constructor:MediaPlayer.dependencies.FragmentLoader},MediaPlayer.dependencies.FragmentLoader.eventList={ENAME_LOADING_COMPLETED:"loadingCompleted",ENAME_LOADING_PROGRESS:"loadingProgress",ENAME_CHECK_FOR_EXISTENCE_COMPLETED:"checkForExistenceCompleted"},MediaPlayer.dependencies.LiveEdgeFinder=function(){"use strict";var a,b=!1,c=NaN,d=null,e=MediaPlayer.rules.SynchronizationRulesCollection.prototype.BEST_GUESS_RULES,f=function(a){var b=((new Date).getTime()-c)/1e3;d=a.value,this.notify(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,{liveEdge:d,searchTime:b},null===d?new MediaPlayer.vo.Error(MediaPlayer.dependencies.LiveEdgeFinder.LIVE_EDGE_NOT_FOUND_ERROR_CODE,"live edge has not been found",null):null)},g=function(d){var g=this;!g.streamProcessor.isDynamic()||b||d.error||(a=g.synchronizationRulesCollection.getRules(e),b=!0,c=(new Date).getTime(),g.rulesController.applyRules(a,g.streamProcessor,f.bind(g),null,function(a,b){return b}))},h=function(a){e=a.error?MediaPlayer.rules.SynchronizationRulesCollection.prototype.BEST_GUESS_RULES:MediaPlayer.rules.SynchronizationRulesCollection.prototype.TIME_SYNCHRONIZED_RULES};return{system:void 0,synchronizationRulesCollection:void 0,rulesController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this[MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED]=g,this[MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED]=h},initialize:function(a){this.streamProcessor=a,this.fragmentLoader=a.fragmentLoader},abortSearch:function(){b=!1,c=NaN},getLiveEdge:function(){return d},reset:function(){this.abortSearch(),d=null}}},MediaPlayer.dependencies.LiveEdgeFinder.prototype={constructor:MediaPlayer.dependencies.LiveEdgeFinder},MediaPlayer.dependencies.LiveEdgeFinder.eventList={ENAME_LIVE_EDGE_SEARCH_COMPLETED:"liveEdgeFound"},MediaPlayer.dependencies.LiveEdgeFinder.LIVE_EDGE_NOT_FOUND_ERROR_CODE=1,MediaPlayer.dependencies.ManifestLoader=function(){"use strict";var a=500,b=function(a){var b="";return-1!==a.indexOf("/")&&(-1!==a.indexOf("?")&&(a=a.substring(0,a.indexOf("?"))),b=a.substring(0,a.lastIndexOf("/")+1)),b},c=function(d,e){var f,g,h,i,j,k=b(d),l=new XMLHttpRequest,m=new Date,n=null,o=!0,p=this;g=function(){var a=null;l.status<200||l.status>299||(o=!1,n=new Date,l.responseURL&&l.responseURL!==d&&(k=b(l.responseURL),a=l.responseURL),p.metricsModel.addHttpRequest("stream",null,MediaPlayer.vo.metrics.HTTPRequest.MPD_TYPE,d,a,null,m,l.firstByteDate||null,n,l.status,null,l.getAllResponseHeaders()),f=p.parser.parse(l.responseText,k,p.xlinkController),f?(f.url=a||d,f.loadedTime=n,p.metricsModel.addManifestUpdate("stream",f.type,m,n,f.availabilityStartTime),p.xlinkController.resolveManifestOnLoad(f)):p.notify(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,{manifest:null},new MediaPlayer.vo.Error(null,"Failed loading manifest: "+d,null)))},h=function(){o&&(o=!1,p.metricsModel.addHttpRequest("stream",null,MediaPlayer.vo.metrics.HTTPRequest.MPD_TYPE,d,l.responseURL||null,null,m,l.firstByteDate||null,new Date,l.status,null,l.getAllResponseHeaders()),e>0?(p.log("Failed loading manifest: "+d+", retry in "+a+"ms attempts: "+e),e--,setTimeout(function(){c.call(p,d,e)},a)):(p.log("Failed loading manifest: "+d+" no retry attempts left"),p.errHandler.downloadError("manifest",d,l),p.notify(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,null,new Error("Failed loading manifest: "+d+" no retry attempts left"))))},i=function(a){j&&(j=!1,(!a.lengthComputable||a.lengthComputable&&a.total!=a.loaded)&&(l.firstByteDate=new Date))};try{l.onload=g,l.onloadend=h,l.onerror=h,l.onprogress=i,l.open("GET",p.requestModifierExt.modifyRequestURL(d),!0),l.send()}catch(a){l.onerror()}},d=function(a){this.notify(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,{manifest:a.data.manifest})};return{log:void 0,parser:void 0,errHandler:void 0,metricsModel:void 0,requestModifierExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,system:void 0,load:function(a){c.call(this,a,3)},setup:function(){d=d.bind(this),this.xlinkController=this.system.getObject("xlinkController"),this.xlinkController.subscribe(MediaPlayer.dependencies.XlinkController.eventList.ENAME_XLINK_READY,this,d)}}},MediaPlayer.dependencies.ManifestLoader.prototype={constructor:MediaPlayer.dependencies.ManifestLoader},MediaPlayer.dependencies.ManifestLoader.eventList={ENAME_MANIFEST_LOADED:"manifestLoaded"},MediaPlayer.dependencies.ManifestUpdater=function(){"use strict";var a,b=NaN,c=null,d=!0,e=!1,f=function(){null!==c&&(clearInterval(c),c=null)},g=function(){f.call(this),isNaN(b)||(this.log("Refresh manifest in "+b+" seconds."),c=setTimeout(i.bind(this),Math.min(1e3*b,Math.pow(2,31)-1),this))},h=function(a){var c,e;this.manifestModel.setValue(a),this.log("Manifest has been refreshed."),c=this.manifestExt.getRefreshDelay(a),e=((new Date).getTime()-a.loadedTime.getTime())/1e3,b=Math.max(c-e,0),this.notify(MediaPlayer.dependencies.ManifestUpdater.eventList.ENAME_MANIFEST_UPDATED,{manifest:a}),d||g.call(this)},i=function(){var b,c,f=this;d||e||(e=!0,b=f.manifestModel.getValue(),c=b.url,b.hasOwnProperty("Location")&&(c=b.Location),a.load(c))},j=function(a){a.error||h.call(this,a.data.manifest)},k=function(){d=!1,g.call(this)},l=function(){d=!0,f.call(this)},m=function(){e=!1};return{log:void 0,system:void 0,subscribe:void 0,unsubscribe:void 0,notify:void 0,manifestModel:void 0,manifestExt:void 0,setup:function(){this[MediaPlayer.dependencies.StreamController.eventList.ENAME_STREAMS_COMPOSED]=m,this[MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED]=j,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED]=k,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PAUSED]=l},initialize:function(b){e=!1,d=!0,a=b,a.subscribe(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,this)},setManifest:function(a){h.call(this,a)},getManifestLoader:function(){return a},reset:function(){d=!0,e=!1,f.call(this),a.unsubscribe(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,this),b=NaN}}},MediaPlayer.dependencies.ManifestUpdater.prototype={constructor:MediaPlayer.dependencies.ManifestUpdater},MediaPlayer.dependencies.ManifestUpdater.eventList={ENAME_MANIFEST_UPDATED:"manifestUpdated"},MediaPlayer.dependencies.Notifier=function(){"use strict";var a,b="observableId",c=0,d=function(){return this[b]||(c+=1,this[b]="_id_"+c),this[b]};return{system:void 0,setup:function(){a=this.system,a.mapValue("notify",this.notify),a.mapValue("subscribe",this.subscribe),a.mapValue("unsubscribe",this.unsubscribe)},notify:function(){var b=arguments[0]+d.call(this),c=new MediaPlayer.vo.Event;c.sender=this,c.type=arguments[0],c.data=arguments[1],c.error=arguments[2],c.timestamp=(new Date).getTime(),a.notify.call(a,b,c)},subscribe:function(b,c,e,f){if(!e&&c[b]&&(e=c[b]=c[b].bind(c)),!c)throw"observer object cannot be null or undefined";if(!e)throw"event handler cannot be null or undefined";b+=d.call(this),a.mapHandler(b,void 0,e,f)},unsubscribe:function(b,c,e){e=e||c[b],b+=d.call(this),a.unmapHandler(b,void 0,e)}}},MediaPlayer.dependencies.Notifier.prototype={constructor:MediaPlayer.dependencies.Notifier},MediaPlayer.dependencies.Stream=function(){"use strict";var a,b,c=[],d=!1,e=!1,f=null,g={},h=!1,i=!1,j=null,k=function(a){a.error&&(this.errHandler.mediaKeySessionError(a.error),this.log(a.error),this.reset())},l=function(a){return"text"===a.type?a.mimeType:a.type},m=function(a,b,c){var d,e,f=this,g=a.type;if("muxed"===g&&a)return e="Multiplexed representations are intentionally not supported, as they are not compliant with the DASH-AVC/264 guidelines",this.log(e),this.errHandler.manifestError(e,"multiplexedrep",this.manifestModel.getValue()),!1;if("text"===g||"fragmentedText"===g)return!0;if(d=a.codec,f.log(g+" codec: "+d),a.contentProtection&&!f.capabilities.supportsEncryptedMedia())f.errHandler.capabilityError("encryptedmedia");else if(!f.capabilities.supportsCodec(f.videoModel.getElement(),d))return e=g+"Codec ("+d+") is not supported.",f.errHandler.manifestError(e,"codec",c),f.log(e),!1;return!0},n=function(a){var b=w.call(this,a.data.oldMediaInfo);if(b){
var d=this.playbackController.getTime(),e=b.getBuffer(),f=a.data.newMediaInfo,g=this.manifestModel.getValue(),h=c.indexOf(b),i=b.getMediaSource();"fragmentedText"!==f.type?(b.reset(!0),o.call(this,f,g,i,{buffer:e,replaceIdx:h,currentTime:d}),this.playbackController.seek(this.playbackController.getTime())):(b.setIndexHandlerTime(d),b.updateMediaInfo(g,f))}},o=function(a,b,d,e){var g=this,h=g.system.getObject("streamProcessor"),i=this.adapter.getAllMediaInfoForType(b,f,a.type);if(h.initialize(l.call(g,a),g.fragmentController,d,g,j),g.abrController.updateTopQualityIndex(a),e?(h.setBuffer(e.buffer),c[e.replaceIdx]=h,h.setIndexHandlerTime(e.currentTime)):c.push(h),"text"===a.type||"fragmentedText"===a.type){for(var k,m=0;m<i.length;m++)i[m].index===a.index&&(k=m),h.updateMediaInfo(b,i[m]);"fragmentedText"===a.type&&h.updateMediaInfo(b,i[k])}else h.updateMediaInfo(b,a);return h},p=function(a,b){var c,d=this,e=d.manifestModel.getValue(),g=this.adapter.getAllMediaInfoForType(e,f,a),h=null;if(!g||0===g.length)return void d.log("No "+a+" data.");for(var i=0,j=g.length;j>i;i+=1)h=g[i],m.call(d,h,b,e)&&d.mediaController.isMultiTrackSupportedByType(h.type)&&d.mediaController.addTrack(h,f);0!==this.mediaController.getTracksFor(a,f).length&&(this.mediaController.checkInitialMediaSettings(f),c=this.mediaController.getCurrentTrackFor(a,f),o.call(this,c,e,b))},q=function(a){var b,d=this,g=d.manifestModel.getValue();if(j=d.system.getObject("eventController"),b=d.adapter.getEventsFor(g,f),j.addInlineEvents(b),h=!0,p.call(d,"video",a),p.call(d,"audio",a),p.call(d,"text",a),p.call(d,"fragmentedText",a),p.call(d,"muxed",a),t.call(d),e=!0,h=!1,0===c.length){var i="No streams to play.";d.errHandler.manifestError(i,"nostreams",g),d.log(i)}else d.liveEdgeFinder.initialize(c[0]),d.liveEdgeFinder.subscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,d.playbackController),r.call(this)},r=function(){var b=this,j=c.length,k=!!g.audio||!!g.video,l=k?new MediaPlayer.vo.Error(MediaPlayer.dependencies.Stream.DATA_UPDATE_FAILED_ERROR_CODE,"Data update failed",null):null,m=0;for(m;j>m;m+=1)if(c[m].isUpdating()||h)return;i=!0,b.eventBus.dispatchEvent({type:MediaPlayer.events.STREAM_INITIALIZED,data:{streamInfo:f}}),b.notify(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,{streamInfo:f},l),e&&!d&&(a.init(b.manifestModel.getValue(),s.call(this,"audio"),s.call(this,"video")),d=!0)},s=function(a){for(var b=c.length,d=null,e=0;b>e;e+=1)if(d=c[e],d.getType()===a)return d.getMediaInfo();return null},t=function(){for(var a=0,b=c.length;b>a;a+=1)c[a].createBuffer()},u=function(){var a=x(),b=a.length,c=0;for(c;b>c;c+=1)if(!a[c].isBufferingCompleted())return;this.notify(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_BUFFERING_COMPLETED,{streamInfo:f})},v=function(a){var b=a.sender.streamProcessor.getType();g[b]=a.error,r.call(this)},w=function(a){return!!a&&x.call(this).filter(function(b){return b.getType()===a.type})[0]},x=function(){var a,b,d=[],e=0,f=c.length;for(e;f>e;e+=1)b=c[e],("audio"===(a=b.getType())||"video"===a||"fragmentedText"===a)&&d.push(b);return d},y=function(a){var b,e,g,k=this,l=c.length,m=k.manifestModel.getValue(),n=0;for(d=!1,f=a,k.log("Manifest updated... set new data on buffers."),j&&(e=k.adapter.getEventsFor(m,f),j.addInlineEvents(e)),h=!0,i=!1,n;l>n;n+=1)g=c[n],b=k.adapter.getMediaInfoForType(m,f,g.getType()),this.abrController.updateTopQualityIndex(b),g.updateMediaInfo(m,b);h=!1,r.call(k)};return{system:void 0,eventBus:void 0,manifestModel:void 0,sourceBufferExt:void 0,adapter:void 0,videoModel:void 0,fragmentController:void 0,playbackController:void 0,mediaController:void 0,capabilities:void 0,log:void 0,errHandler:void 0,liveEdgeFinder:void 0,abrController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFERING_COMPLETED]=u,this[Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED]=v,this[MediaPlayer.dependencies.MediaController.eventList.CURRENT_TRACK_CHANGED]=n},initialize:function(c,d){f=c,a=d,b=k.bind(this),a.addEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,b),a.addEventListener(MediaPlayer.dependencies.ProtectionController.events.SERVER_CERTIFICATE_UPDATED,b),a.addEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_ADDED,b),a.addEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CREATED,b),a.addEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,b),a.addEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,b),a.addEventListener(MediaPlayer.dependencies.ProtectionController.events.LICENSE_REQUEST_COMPLETE,b)},activate:function(a){d?t.call(this):q.call(this,a)},deactivate:function(){var a=c.length,b=0;for(b;a>b;b+=1)c[b].reset();c=[],d=!1,e=!1,this.resetEventController()},reset:function(f){this.playbackController.pause();var k,l=c.length,m=0;for(m;l>m;m+=1)k=c[m],k.reset(f),k=null;j&&j.reset(),c=[],h=!1,i=!1,this.fragmentController&&this.fragmentController.reset(),this.fragmentController=void 0,this.liveEdgeFinder.abortSearch(),this.liveEdgeFinder.unsubscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,this.playbackController),a.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,b),a.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.SERVER_CERTIFICATE_UPDATED,b),a.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_ADDED,b),a.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CREATED,b),a.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,b),a.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,b),a.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.LICENSE_REQUEST_COMPLETE,b),e=!1,d=!1,g={}},getDuration:function(){return f.duration},getStartTime:function(){return f.start},getStreamIndex:function(){return f.index},getId:function(){return f.id},getStreamInfo:function(){return f},hasMedia:function(a){return null!==s.call(this,a)},getBitrateListFor:function(a){var b=s.call(this,a);return this.abrController.getBitrateList(b)},startEventController:function(){j.start()},resetEventController:function(){j.reset()},isActivated:function(){return d},isInitialized:function(){return i},updateData:y}},MediaPlayer.dependencies.Stream.prototype={constructor:MediaPlayer.dependencies.Stream},MediaPlayer.dependencies.Stream.DATA_UPDATE_FAILED_ERROR_CODE=1,MediaPlayer.dependencies.Stream.eventList={ENAME_STREAM_UPDATED:"streamUpdated",ENAME_STREAM_BUFFERING_COMPLETED:"streamBufferingCompleted"},MediaPlayer.dependencies.StreamProcessor=function(){"use strict";var a,b=null,c=null,d=null,e=null,f=[],g=function(a){var b=this,c="video"===a||"audio"===a||"fragmentedText"===a?"bufferController":"textController";return b.system.getObject(c)};return{system:void 0,videoModel:void 0,indexHandler:void 0,liveEdgeFinder:void 0,timelineConverter:void 0,abrController:void 0,playbackController:void 0,baseURLExt:void 0,adapter:void 0,manifestModel:void 0,initialize:function(c,f,h,i,j){var k,l=this,m=l.system.getObject("representationController"),n=l.system.getObject("scheduleController"),o=l.liveEdgeFinder,p=l.abrController,q=l.indexHandler,r=l.baseURLExt,s=l.playbackController,t=l.system.getObject("mediaController"),u=this.system.getObject("fragmentLoader"),v=g.call(l,c);b=i,d=c,e=j,a=b.getStreamInfo().manifestInfo.isDynamic,l.bufferController=v,l.scheduleController=n,l.representationController=m,l.fragmentController=f,l.fragmentLoader=u,m.subscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,v),f.subscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_INIT_FRAGMENT_LOADED,v),"video"===d||"audio"===d||"fragmentedText"===d?(p.subscribe(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,v),p.subscribe(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,m),p.subscribe(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,n),o.subscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,this.timelineConverter),o.subscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,m),o.subscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,n),m.subscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_STARTED,n),m.subscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,n),b.subscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,n),m.subscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,s),f.subscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADED,v),f.subscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADING_START,n),f.subscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,n),f.subscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,v),f.subscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,n.scheduleRulesCollection.bufferLevelRule),v.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,s),v.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_CLEARED,n),v.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED,n),v.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED,n),v.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED,m),v.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,n),v.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_INIT_REQUESTED,n),v.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFERING_COMPLETED,b),v.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_QUOTA_EXCEEDED,n),v.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN,n.scheduleRulesCollection.bufferLevelRule),v.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED,n.scheduleRulesCollection.bufferLevelRule),v.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED,s),s.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PROGRESS,v),s.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED,v),s.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED,v),s.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED,n),s.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,v),s.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,n),s.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED,n),s.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,n.scheduleRulesCollection.playbackTimeRule),s.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,p.abrRulesCollection.insufficientBufferRule),a&&s.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,m),s.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,v),s.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,n),r.subscribe(Dash.dependencies.BaseURLExtensions.eventList.ENAME_INITIALIZATION_LOADED,q),r.subscribe(Dash.dependencies.BaseURLExtensions.eventList.ENAME_SEGMENTS_LOADED,q),("video"===d||"audio"===d)&&t.subscribe(MediaPlayer.dependencies.MediaController.eventList.CURRENT_TRACK_CHANGED,v)):v.subscribe(MediaPlayer.dependencies.TextController.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,n),m.subscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,b),q.initialize(this),q.setCurrentTime(s.getStreamStartTime(this.getStreamInfo())),v.initialize(d,h,l),n.initialize(d,this),p.initialize(d,this),k=this.getFragmentModel(),k.setLoader(u),k.subscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_STARTED,f),k.subscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,f),k.subscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_STREAM_COMPLETED,f),k.subscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,n),u.subscribe(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_COMPLETED,k),u.subscribe(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_PROGRESS,p),("video"===d||"audio"===d||"fragmentedText"===d)&&(v.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN,k),v.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED,k),v.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_REJECTED,k)),m.initialize(this)},isUpdating:function(){return this.representationController.isUpdating()},getType:function(){return d},getABRController:function(){return this.abrController},getFragmentLoader:function(){return this.fragmentLoader},getBuffer:function(){return this.bufferController.getBuffer()},setBuffer:function(a){this.bufferController.setBuffer(a)},getFragmentModel:function(){return this.scheduleController.getFragmentModel()},getStreamInfo:function(){return b.getStreamInfo()},updateMediaInfo:function(a,b){b===c||b&&c&&b.type!==c.type||(c=b),-1===f.indexOf(b)&&f.push(b),this.adapter.updateData(a,this)},getMediaInfoArr:function(){return f},getMediaInfo:function(){return c},getMediaSource:function(){return this.bufferController.getMediaSource()},getScheduleController:function(){return this.scheduleController},getEventController:function(){return e},start:function(){this.scheduleController.start()},stop:function(){this.scheduleController.stop()},getIndexHandlerTime:function(){return this.adapter.getIndexHandlerTime(this)},setIndexHandlerTime:function(a){this.adapter.setIndexHandlerTime(this,a)},getCurrentRepresentationInfo:function(){return this.adapter.getCurrentRepresentationInfo(this.manifestModel.getValue(),this.representationController)},getRepresentationInfoForQuality:function(a){return this.adapter.getRepresentationInfoForQuality(this.manifestModel.getValue(),this.representationController,a)},isBufferingCompleted:function(){return this.bufferController.isBufferingCompleted()},createBuffer:function(){return this.bufferController.getBuffer()||this.bufferController.createBuffer(c)},isDynamic:function(){return a},reset:function(f){var g=this,h=g.bufferController,i=g.representationController,j=g.scheduleController,k=g.liveEdgeFinder,l=g.fragmentController,m=g.abrController,n=g.playbackController,o=this.system.getObject("mediaController"),p=this.indexHandler,q=this.baseURLExt,r=this.getFragmentModel(),s=this.fragmentLoader;m.unsubscribe(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,h),m.unsubscribe(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,i),m.unsubscribe(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,j),k.unsubscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,this.timelineConverter),k.unsubscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,j),k.unsubscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,i),i.unsubscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_STARTED,j),i.unsubscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,h),i.unsubscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,j),i.unsubscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,b),i.unsubscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,n),b.unsubscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,j),l.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_INIT_FRAGMENT_LOADED,h),l.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADED,h),l.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADING_START,j),l.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,j),l.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,h),l.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,j.scheduleRulesCollection.bufferLevelRule),h.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,n),h.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_CLEARED,j),h.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED,j),h.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED,j),h.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED,i),h.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,j),h.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_INIT_REQUESTED,j),h.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFERING_COMPLETED,b),h.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,j),h.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN,j.scheduleRulesCollection.bufferLevelRule),h.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED,j.scheduleRulesCollection.bufferLevelRule),h.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED,n),n.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PROGRESS,h),n.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED,h),n.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED,h),n.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED,j),n.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,h),n.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,j),n.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED,j),n.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,i),n.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,h),n.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,j),n.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,j.scheduleRulesCollection.playbackTimeRule),n.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,m.abrRulesCollection.insufficientBufferRule),q.unsubscribe(Dash.dependencies.BaseURLExtensions.eventList.ENAME_INITIALIZATION_LOADED,p),q.unsubscribe(Dash.dependencies.BaseURLExtensions.eventList.ENAME_SEGMENTS_LOADED,p),h.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN,r),h.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED,r),h.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_REJECTED,r),r.unsubscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_STARTED,l),r.unsubscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,l),r.unsubscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_STREAM_COMPLETED,l),r.unsubscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,j),s.unsubscribe(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_COMPLETED,r),s.unsubscribe(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_PROGRESS,m),r.reset(),("video"===d||"audio"===d)&&o.unsubscribe(MediaPlayer.dependencies.MediaController.eventList.CURRENT_TRACK_CHANGED,h),p.reset(),this.bufferController.reset(f),this.scheduleController.reset(),this.bufferController=null,this.scheduleController=null,this.representationController=null,this.videoModel=null,this.fragmentController=null,a=void 0,b=null,c=null,d=null,e=null}}},MediaPlayer.dependencies.StreamProcessor.prototype={constructor:MediaPlayer.dependencies.StreamProcessor},MediaPlayer.utils.TTMLParser=function(){"use strict";var a,b,c,d=3600,e=60,f=/^([0-9][0-9]+):([0-5][0-9]):([0-5][0-9])|(60)(\.([0-9])+)?$/,g={},h={},i={},j={top:"85%;",left:"5%;",width:"90%;",height:"10%;","align-items":"flex-start;",overflow:"visible;","-ms-writing-mode":"lr-tb, horizontal-tb;;","-webkit-writing-mode":"horizontal-tb;","-moz-writing-mode":"horizontal-tb;","writing-mode":"horizontal-tb;"},k={color:"rgb(255,255,255);",direction:"ltr;","font-family":"monospace, sans-serif;","font-style":"normal;","line-height":"normal;","font-weight":"normal;","text-align":"start;","justify-content":"flex-start;","text-decoration":"none;","unicode-bidi":"normal;","white-space":"normal;",width:"100%;"},l={monospace:"font-family: monospace;",sansSerif:"font-family: sans-serif;",serif:"font-family: serif;",monospaceSansSerif:"font-family: monospace, sans-serif;",monospaceSerif:"font-family: monospace, serif;",proportionalSansSerif:"font-family: Arial;",proportionalSerif:"font-family: Times New Roman;",default:"font-family: monospace, sans-serif;"},m={right:["justify-content: flex-end;","text-align: right;"],start:["justify-content: flex-start;","text-align: start;"],center:["justify-content: center;","text-align: center;"],end:["justify-content: flex-end;","text-align: end;"],left:["justify-content: flex-start;","text-align: left;"]},n={start:"text-align: start;",center:"text-align: center;",end:"text-align: end;",auto:""},o={wrap:"white-space: normal;",noWrap:"white-space: nowrap;"},p={normal:"unicode-bidi: normal;",embed:"unicode-bidi: embed;",bidiOverride:"unicode-bidi: bidi-override;"},q={before:"align-items: flex-start;",center:"align-items: center;",after:"align-items: flex-end;"},r={lrtb:"-webkit-writing-mode: horizontal-tb;writing-mode: horizontal-tb;",rltb:"-webkit-writing-mode: horizontal-tb;writing-mode: horizontal-tb;direction: rtl;unicode-bidi: bidi-override;",tbrl:"-webkit-writing-mode: vertical-rl;writing-mode: vertical-rl;-webkit-text-orientation: upright;text-orientation: upright;",tblr:"-webkit-writing-mode: vertical-lr;writing-mode: vertical-lr;-webkit-text-orientation: upright;text-orientation: upright;",lr:"-webkit-writing-mode: horizontal-tb;writing-mode: horizontal-tb;",rl:"-webkit-writing-mode: horizontal-tb;writing-mode: horizontal-tb;direction: rtl;",tb:"-webkit-writing-mode: vertical-rl;writing-mode: vertical-rl;-webkit-text-orientation: upright;text-orientation: upright;"},s=function(b){var c,g,h;if(!f.test(b))return NaN;if(c=b.split(":"),g=parseFloat(c[0])*d+parseFloat(c[1])*e+parseFloat(c[2]),c[3]){if(!(h=a.tt.frameRate)||isNaN(h))return NaN;g+=parseFloat(c[3])/h}return g},t=function(){var b=a.hasOwnProperty("tt"),c=!!b&&a.tt.hasOwnProperty("head"),d=!!c&&a.tt.head.hasOwnProperty("layout"),e=!!c&&a.tt.head.hasOwnProperty("styling"),f=!!b&&a.tt.hasOwnProperty("body");return b&&c&&d&&e&&f},u=function(a,b){var c=Object.keys(a).filter(function(c){return("xmlns"===c.split(":")[0]||"xmlns"===c.split(":")[1])&&a[c]===b}).map(function(a){return a.split(":")[2]||a.split(":")[1]});return 1!=c.length?null:c[0]},v=function(a,b){for(var c in a)if(a.hasOwnProperty(c)){if(("object"==typeof a[c]||a[c]instanceof Object)&&!Array.isArray(a[c]))v(a[c],b);else if(Array.isArray(a[c]))for(var d=0;d<a[c].length;d++)v(a[c][d],b);var e=c.slice(c.indexOf(b)+b.length+1);a[e]=a[c],delete a[c]}},w=function(a){return a.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()},x=function(a){var b=a.slice(1),c=b.match(/.{2}/g),d=parseFloat(parseInt(parseInt(c[3],16)/255*1e3)/1e3);return"rgba("+c.slice(0,3).map(function(a){return parseInt(a,16)}).join(",")+","+d+");"},y=function(a,b){for(var c=0;c<b.length;c++)if(b[c].indexOf(a)>-1)return!0;return!1},z=function(a,b){for(var c=0;c<b.length;c++)if(b[c].indexOf(a)>-1)return b[c];return null},A=function(a,b){b.splice(b.indexOf(z(a,b)),1)},B=function(a,b){for(var c=0;c<a.length;c++)for(var d=0;d<b.length;d++)a[c]&&a[c].split(":")[0].indexOf(b[d].split(":")[0])>-1&&a.splice(c,1);return a.concat(b)},C=function(a,b){var c=[];for(var d in a)if(a.hasOwnProperty(d)){var e=d.replace("ebutts:","");e=e.replace("xml:",""),e=e.replace("tts:",""),e=w(e),a[e]=a[d],delete a[d]}if("line-padding"in a){var f=parseFloat(a["line-padding"].slice(a["line-padding"].indexOf(":")+1,a["line-padding"].indexOf("c")));"id"in a&&(i[a.id]=f);var j=f*b[0]+"px;";c.push("padding-left:"+j),c.push("padding-right:"+j)}if("font-size"in a){var k=parseFloat(a["font-size"].slice(a["font-size"].indexOf(":")+1,a["font-size"].indexOf("%")));"id"in a&&(g[a.id]=k);var q=k/100*b[1]+"px;";c.push("font-size:"+q)}if("line-heigt"in a)if("normal"===a["line-height"])c.push("line-heigth: normal;");else{var r=parseFloat(a["line-heigt"].slice(a["line-heigt"].indexOf(":")+1,a["line-heigt"].indexOf("%")));"id"in a&&(h[a.id]=r);var s=r/100*b[1]+"px;";c.push(d+":"+s)}"font-family"in a&&(a["font-family"]in l?c.push(l[a["font-family"]]):c.push("font-family:"+a["font-family"]+";")),"text-align"in a&&a["text-align"]in m&&(c.push(m[a["text-align"]][0]),c.push(m[a["text-align"]][1])),"multi-row-align"in a&&(y("text-align",c)&&"auto"!=a["multi-row-align"]&&A("text-align",c),a["multi-row-align"]in n&&c.push(n[a["multi-row-align"]]));var t;return"background-color"in a&&(a["background-color"].indexOf("#")>-1&&a["background-color"].length-1==8?(t=x(a["background-color"]),c.push("background-color: "+t)):c.push("background-color:"+a["background-color"]+";")),"color"in a&&(a.color.indexOf("#")>-1&&a.color.length-1==8?(t=x(a.color),c.push("color: "+t)):c.push("color:"+a.color+";")),"wrap-option"in a&&(a["wrap-option"]in o?c.push(o[a["wrap-option"]]):c.push("white-space:"+a["wrap-option"])),"unicode-bidi"in a&&(a["unicode-bidi"]in p?c.push(p[a["unicode-bidi"]]):c.push("unicode-bidi:"+a["unicode-bidi"])),"font-style"in a&&c.push("font-style:"+a["font-style"]+";"),"font-weight"in a&&c.push("font-weight:"+a["font-weight"]+";"),"direction"in a&&c.push("direction:"+a.direction+";"),"text-decoration"in a&&c.push("text-decoration:"+a["text-decoration"]+";"),c},D=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d["xml:id"]===b||d.id===b)return d}return null},E=function(a,c){var d=[];return a.match(/\S+/g).forEach(function(a){var e=D(b,a);if(e){var f=C(JSON.parse(JSON.stringify(e)),c);d=d.concat(f)}}),d},F=function(a,b){var c=[];for(var d in a){var e=d.replace("tts:","");e=e.replace("xml:",""),e=w(e),a[e]=a[d],e!==d&&delete a[d]}if("extent"in a){var f=a.extent.split(/\s/);c.push("width: "+f[0]+";"),c.push("height: "+f[1]+";")}if("origin"in a){var g=a.origin.split(/\s/);c.push("left: "+g[0]+";"),c.push("top: "+g[1]+";")}if("display-align"in a&&c.push(q[a["display-align"]]),"writing-mode"in a&&c.push(r[a["writing-mode"]]),"style"in a){var h=E(a.style,b);c=c.concat(h)}return"padding"in a&&c.push("padding:"+a.padding+";"),"overflow"in a&&c.push("overflow:"+a.overflow+";"),"show-background"in a&&c.push("show-background:"+a["show-background"]+";"),"id"in a&&c.push("regionID:"+a.id+";"),c},G=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d["xml:id"]===b||d.id===b)return d}return null},H=function(a,b){var d=[];return a.match(/\S+/g).forEach(function(a){var e=G(c,a);if(e){var f=F(JSON.parse(JSON.stringify(e)),b);d=d.concat(f)}}),d},I=function(){var b=[32,15];return a.tt.hasOwnProperty("ttp:cellResolution")?a.tt["ttp:cellResolution"].split(" ").map(parseFloat):b},J=function(a,b){for(var c=z("padding-left",b),d=z("padding-right",b),e=c.concat(" "+d),f="",g="",h="",i=Array.prototype.slice.call(a.children),j=a.getElementsByClassName("lineBreak")[0],k=i.indexOf(j),l=[];-1!=k;)l.push(k),k=i.indexOf(j,k+1);var m="</span>",n="<br>",o='<span class="spanPadding" style="-webkit-box-decoration-break: clone; ';if(l.length)l.forEach(function(a,b){if(0===b){for(var c="",d=0;a>d;d++)f+=i[d].outerHTML,0===d&&(c=e.concat(i[d].style.cssText));f=o+c+'">'+f}for(var j="",k=a+1;k<i.length;k++)g+=i[k].outerHTML,k===i.length-1&&(j+=e.concat(i[k].style.cssText));g=o+j+'">'+g,f&&g&&b===l.length-1?h+=f+m+n+g+m:f&&g&&b!==l.length-1?h+=f+m+n+g+m+n:f&&!g?h+=f+m:!f&&g&&b===l.length-1?h+=g+m:!f&&g&&b!==l.length-1&&(h+=g+m+n)});else{for(var p="",q=0;q<i.length;q++)p+=i[q].style.cssText;h=o+e+p+'">'+a.innerHTML+m}return h},K=function(a,b){var c=document.createElement("div");return a.forEach(function(a){if(!a.hasOwnProperty("metadata"))if(a.hasOwnProperty("span")){var d=a.span.__children,e=document.createElement("span");if(a.span.hasOwnProperty("style")){var f=E(a.span.style,b);e.className="spanPadding "+a.span.style,e.style.cssText=f.join(" ")}d.forEach(function(a){if(!d.hasOwnProperty("metadata"))if(a.hasOwnProperty("#text")){var b=document.createTextNode(a["#text"]);e.appendChild(b)}else if("br"in a){e.hasChildNodes()&&c.appendChild(e);var f=document.createElement("br");f.className="lineBreak",c.appendChild(f);var g=document.createElement("span");g.className=e.className,g.style.cssText=e.style.cssText,e=g}}),c.appendChild(e)}else if(a.hasOwnProperty("br")){var g=document.createElement("br");g.className="lineBreak",c.appendChild(g)}else if(a.hasOwnProperty("#text")){var h=document.createElement("span");h.innerHTML=a["#text"],c.appendChild(h)}}),c},L=function(a,b,c){var d,e,f=[],g=a.region,h=b.region;return h&&(d=H(h,c)),g?(e=f.concat(H(g,c)),f=d?B(d,e):e):d&&(f=d),N(f,j),f},M=function(b,c){var d,e,f,g=[],h=b.style,i=a.tt.body.style,j=a.tt.body.div.style,l="";return i&&(d=E(i,c),l="paragraph "+i),j&&(e=E(j,c),d?(e=B(d,e),l+=" "+j):l="paragraph "+j),h?(f=E(h,c),d&&e?(g=B(e,f),l+=" "+h):d?(g=B(d,f),l+=" "+h):e?(g=B(e,f),l+=" "+h):(g=f,l="paragraph "+h)):d&&!e?g=d:!d&&e&&(g=e),N(g,k),[g,l]},N=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(y(c,a)||a.push(c+":"+b[c]))};return{parse:function(d){var e,f=this,j=new X2JS([],"",!1);a=j.xml_str2json(d),f.videoModel.getTTMLRenderingDiv()&&(e="html");var l=u(a,"http://www.w3.org/ns/ttml");if(l&&v(a,l),c=a.tt.head.layout.region_asArray,b=a.tt.head.styling.style_asArray,!t()){throw"TTML document has incorrect structure"}var m=I(),n=f.videoModel.getElement().clientWidth,o=f.videoModel.getElement().clientHeight,p=[n/m[0],o/m[1]];k["font-size"]=p[1]+"px;";for(var q=[],r=0;r<c.length;r++)q.push(F(JSON.parse(JSON.stringify(c[r])),p));var w=u(a.tt,"http://www.w3.org/ns/ttml#parameter");a.tt.hasOwnProperty(w+":frameRate")&&(a.tt.frameRate=parseInt(a.tt[w+":frameRate"],10));var x=[];return a.tt.body_asArray[0].__children.forEach(function(b){var c=b.div.p_asArray;if(!c||0===c.length){var d="TTML document does not contain any cues";throw d}var f,j,k,l;c.forEach(function(c){if(c.hasOwnProperty("begin")&&c.hasOwnProperty("end"))f=s(c.begin),j=s(c.end);else{if(!c.span.hasOwnProperty("begin")||!c.span.hasOwnProperty("end"))throw d="TTML document has incorrect timing value";k=s(c.span.begin),l=s(c.span.end)}
if(void 0!==c["smpte:backgroundImage"])for(var r=a.tt.head.metadata.image_asArray,t=0;t<r.length;t+=1)"#"+r[t]["xml:id"]==c["smpte:backgroundImage"]&&x.push({start:k||f,end:l||j,id:r[t]["xml:id"],data:"data:image/"+r[t].imagetype.toLowerCase()+";base64, "+r[t].__text,type:"image"});else if("html"===e){h={},i={},g={};var u="";if((c.hasOwnProperty("id")||c.hasOwnProperty("xml:id"))&&(u=c["xml:id"]||c.id),(isNaN(f)||isNaN(j))&&(isNaN(k)||isNaN(l)))throw d="TTML document has incorrect timing value";var v=L(c,b.div,p),w=M(c,p),B=w[1];w=w[0];var C=document.createElement("div");C.className=B;var D=c.__children,E=K(D,p);E.className="cueDirUniWrapper",y("unicode-bidi",w)&&(E.style.cssText+=z("unicode-bidi",w),A("unicode-bidi",w)),y("direction",w)&&(E.style.cssText+=z("direction",w),A("direction",w)),y("padding-left",w)&&y("padding-right",w)&&(E.innerHTML=J(E,w)),y("padding-left",w)&&y("padding-right",w)&&(A("padding-left",w),A("padding-right",w));var F="";if(y("regionID",v)){var G=z("regionID",v);F=G.slice(G.indexOf(":")+1,G.length-1)}w&&(C.style.cssText=w.join(" ")+"display:flex;"),v&&(v=v.join(" ")),C.appendChild(E);var H=document.createElement("div");H.appendChild(C),H.id="subtitle_"+u,H.style.cssText="position: absolute; z-index: 2147483647; margin: 0; display: flex; box-sizing: border-box; pointer-events: none;"+v,0===Object.keys(g).length&&(g.defaultFontSize="100"),x.push({start:k||f,end:l||j,type:"html",cueHTMLElement:H,regions:q,regionID:F,cueID:u,videoHeight:o,videoWidth:n,cellResolution:m,fontSize:g||{defaultFontSize:"100"},lineHeight:h,linePadding:i})}else{var I="",N=c.__children;N.length&&N.forEach(function(a){if(a.hasOwnProperty("span")){var b=a.span.__children;b.forEach(function(a){b.hasOwnProperty("metadata")||(a.hasOwnProperty("#text")?I+=a["#text"].replace(/[\r\n]+/gm," ").trim():"br"in a&&(I+="\n"))})}else I+=a.hasOwnProperty("br")?"\n":a["#text"].replace(/[\r\n]+/gm," ").trim()}),x.push({start:k||f,end:l||j,data:I,type:"text"})}})}),x},videoModel:void 0}},MediaPlayer.dependencies.TextSourceBuffer=function(){var a=!1,b=null,c=function(){for(var b=this.videoModel.getElement(),c=b.textTracks,d=c.length,e=this,f=0;d>f;f++){var g=c[f];if(a="showing"!==g.mode,"showing"===g.mode){if(e.textTrackExtensions.getCurrentTrackIdx()!==f){var h=e.textTrackExtensions.getCurrentTextTrack();null!==h&&(e.textTrackExtensions.deleteTrackCues(h),"html"===h.renderingType&&(e.textTrackExtensions.removeCueStyle(),e.textTrackExtensions.clearCues())),e.textTrackExtensions.setCurrentTrackIdx(f),e.mediaController.isCurrentTrack(e.allTracks[f])||(e.textTrackExtensions.deleteTrackCues(e.textTrackExtensions.getCurrentTextTrack()),e.fragmentModel.cancelPendingRequests(),e.fragmentModel.abortRequests(),e.buffered.clear(),e.mediaController.setTrack(e.allTracks[f]))}break}}a&&e.textTrackExtensions.setCurrentTrackIdx(-1)};return{system:void 0,videoModel:void 0,errHandler:void 0,adapter:void 0,manifestExt:void 0,mediaController:void 0,streamController:void 0,initialize:function(a,b){this.sp=b.streamProcessor,this.mediaInfos=this.sp.getMediaInfoArr(),this.textTrackExtensions=this.system.getObject("textTrackExtensions"),this.isFragmented=!this.manifestExt.getIsTextTrack(a),this.isFragmented&&(this.fragmentModel=this.sp.getFragmentModel(),this.buffered=this.system.getObject("customTimeRanges"),this.initializationSegmentReceived=!1,this.timescale=9e4,this.allTracks=this.mediaController.getTracksFor("fragmentedText",this.streamController.getActiveStreamInfo()))},append:function(a,c){function d(a,b){var c=new MediaPlayer.vo.TextTrackInfo,d={subtitle:"subtitles",caption:"captions"},e=function(){var a=b.roles.length>0?d[b.roles[0]]:d.caption;return a=a!==d.caption||a!==d.subtitle?d.caption:a};c.captionData=a,c.lang=b.lang,c.label=b.id,c.video=i.videoModel.getElement(),c.defaultTrack=i.getIsDefault(b),c.isFragmented=i.isFragmented,c.kind=e(),i.textTrackExtensions.addTextTrack(c,i.mediaInfos.length)}var e,f,g,h,i=this,j=c.mediaInfo,k=j.type,l=j.mimeType;if("fragmentedText"===k){var m=i.system.getObject("fragmentExt");if(this.initializationSegmentReceived)for(f=m.getSamplesInfo(a),g=0;g<f.length;g++){this.firstSubtitleStart||(this.firstSubtitleStart=f[0].cts-c.start*this.timescale),f[g].cts-=this.firstSubtitleStart,this.buffered.add(f[g].cts/this.timescale,(f[g].cts+f[g].duration)/this.timescale),h=window.UTF8.decode(new Uint8Array(a.slice(f[g].offset,f[g].offset+f[g].size))),b=null!==b?b:i.getParser(l);try{e=b.parse(h),this.textTrackExtensions.addCaptions(this.firstSubtitleStart/this.timescale,e)}catch(a){}}else{for(this.initializationSegmentReceived=!0,g=0;g<this.mediaInfos.length;g++)d(null,this.mediaInfos[g]);this.timescale=m.getMediaTimescaleFromMoov(a)}}else{a=new Uint8Array(a),h=window.UTF8.decode(a);try{e=i.getParser(l).parse(h),d(e,j)}catch(a){i.errHandler.closedCaptionsError(a,"parse",h)}}},getIsDefault:function(a){return a.index===this.mediaInfos[0].index},abort:function(){this.textTrackExtensions.deleteAllTextTracks(),a=!1,b=null},getParser:function(a){var b;return"text/vtt"===a?b=this.system.getObject("vttParser"):("application/ttml+xml"===a||"application/mp4"===a)&&(b=this.system.getObject("ttmlParser")),b},getAllTracksAreDisabled:function(){return a},setTextTrack:c}},MediaPlayer.dependencies.TextSourceBuffer.prototype={constructor:MediaPlayer.dependencies.TextSourceBuffer},MediaPlayer.dependencies.TimeSyncController=function(){"use strict";var a,b=5e3,c=0,d=!1,e=!1,f=function(a){d=a},g=function(){return d},h=function(a){e=a},i=function(a){c=a},j=function(){return c},k=function(a){var b,c,d=1e3,e=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+\-])([0-9]{2})([0-9]{2}))?/,f=e.exec(a);return b=Date.UTC(parseInt(f[1],10),parseInt(f[2],10)-1,parseInt(f[3],10),parseInt(f[4],10),parseInt(f[5],10),f[6]&&(parseInt(f[6],10)||0),f[7]&&parseFloat(f[7])*d||0),f[9]&&f[10]&&(c=60*parseInt(f[9],10)+parseInt(f[10],10),b+=("+"===f[8]?-1:1)*c*60*d),new Date(b).getTime()},l=function(a){var b=Date.parse(a);return isNaN(b)&&(b=k(a)),b},m=function(a){return Date.parse(a)},n=function(a){return Date.parse(a)},o=function(a,b,c){c()},p=function(a,b,c){var d=l(a);return isNaN(d)?void c():void b(d)},q=function(a,c,d,e,f){var g,h,i=!1,j=new XMLHttpRequest,k=f?"HEAD":"GET",l=c.match(/\S+/g);c=l.shift(),g=function(){i||(i=!0,l.length?q(a,l.join(" "),d,e,f):e())},h=function(){var b,c;200===j.status&&(b=f?j.getResponseHeader("Date"):j.response,c=a(b),isNaN(c)||(d(c),i=!0))},j.open(k,c),j.timeout=b||0,j.onload=h,j.onloadend=g,j.send()},r=function(a,b,c){q.call(this,n,a,b,c,!0)},s={"urn:mpeg:dash:utc:http-head:2014":r,"urn:mpeg:dash:utc:http-xsdate:2014":q.bind(null,l),"urn:mpeg:dash:utc:http-iso:2014":q.bind(null,m),"urn:mpeg:dash:utc:direct:2014":p,"urn:mpeg:dash:utc:http-head:2012":r,"urn:mpeg:dash:utc:http-xsdate:2012":q.bind(null,l),"urn:mpeg:dash:utc:http-iso:2012":q.bind(null,m),"urn:mpeg:dash:utc:direct:2012":p,"urn:mpeg:dash:utc:http-ntp:2014":o,"urn:mpeg:dash:utc:ntp:2014":o,"urn:mpeg:dash:utc:sntp:2014":o},t=function(){var a=this.metricsModel.getReadOnlyMetricsFor("stream"),b=this.metricsExt.getLatestMPDRequestHeaderValueByID(a,"Date"),d=null!==b?new Date(b).getTime():Number.NaN;isNaN(d)?u.call(this,!0):(i(d-(new Date).getTime()),u.call(this,!1,d/1e3,c))},u=function(a,b,c){f(!1),this.notify(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,{time:b,offset:c},a?new MediaPlayer.vo.Error(MediaPlayer.dependencies.TimeSyncController.TIME_SYNC_FAILED_ERROR_CODE):null)},v=function(b,c){var d=this,e=c||0,g=b[e],h=function(b,c){var e=!b||!c;e&&a?t.call(d):u.call(d,e,b,c)};f(!0),g?s.hasOwnProperty(g.schemeIdUri)?s[g.schemeIdUri](g.value,function(a){var b=(new Date).getTime(),c=a-b;i(c),d.log("Local time:      "+new Date(b)),d.log("Server time:     "+new Date(a)),d.log("Difference (ms): "+c),h.call(d,a,c)},function(){v.call(d,b,e+1)}):v.call(d,b,e+1):(i(0),h.call(d))};return{log:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,metricsModel:void 0,metricsExt:void 0,getOffsetToDeviceTimeMs:function(){return j()},initialize:function(b,c){a=c,g()||(v.call(this,b),h(!0))},reset:function(){h(!1),f(!1)}}},MediaPlayer.dependencies.TimeSyncController.prototype={constructor:MediaPlayer.dependencies.TimeSyncController},MediaPlayer.dependencies.TimeSyncController.eventList={ENAME_TIME_SYNCHRONIZATION_COMPLETED:"timeSynchronizationComplete"},MediaPlayer.dependencies.TimeSyncController.TIME_SYNC_FAILED_ERROR_CODE=1,MediaPlayer.utils.VTTParser=function(){"use strict";var a=/(?:\r\n|\r|\n)/gm,b=/-->/,c=/(^[\s]+|[\s]+$)/g,d=/\s\b/g,e=function(a){var b=a.split(":"),c=b.length-1;return a=60*parseInt(b[c-1],10)+parseFloat(b[c]),2===c&&(a+=3600*parseInt(b[0],10)),a},f=function(a){var c=a.split(b),e=c[1].split(d);return e.shift(),c[1]=e[0],e.shift(),{cuePoints:c,styles:g(e)}},g=function(a){var b={};return a.forEach(function(a){if(a.split(/:/).length>1){var c=a.split(/:/)[1];c&&-1!=c.search(/%/)&&(c=parseInt(c.replace(/%/,""))),(a.match(/align/)||a.match(/A/))&&(b.align=c),(a.match(/line/)||a.match(/L/))&&(b.line=c),(a.match(/position/)||a.match(/P/))&&(b.position=c),(a.match(/size/)||a.match(/S/))&&(b.size=c)}}),b},h=function(a,c){for(var d,e=c,f="",g="";""!==a[e]&&e<a.length;)e++;if((d=e-c)>1)for(var h=0;d>h;h++){if(g=a[c+h],g.match(b)){f="";break}f+=g,h!==d-1&&(f+="\n")}else g=a[c],g.match(b)||(f=g);return decodeURI(f)};return{log:void 0,parse:function(d){var g,i,j=[];d=d.split(a),g=d.length,i=-1;for(var k=0;g>k;k++){var l=d[k];if(l.length>0&&"WEBVTT"!==l&&l.match(b)){var m=f(l),n=m.cuePoints,o=m.styles,p=h(d,k+1),q=e(n[0].replace(c,"")),r=e(n[1].replace(c,""));!isNaN(q)&&!isNaN(r)&&q>=i&&r>q?""!==p?(i=q,j.push({start:q,end:r,data:p,styles:o})):this.log("Skipping cue due to empty/malformed cue text"):this.log("Skipping cue due to incorrect cue timing")}}return j}}},MediaPlayer.dependencies.XlinkLoader=function(){"use strict";var a=500,b=function(c,d,e,f){var g,h,i,j,k=new XMLHttpRequest,l=this,m=!0,n=!0,o=new Date;h=function(){k.status<200||k.status>299||(n=!1,l.metricsModel.addHttpRequest("stream",null,MediaPlayer.vo.metrics.HTTPRequest.XLINK_EXPANSION_TYPE,c,k.responseURL||null,null,o,k.firstByteDate||null,new Date,k.status,null,k.getAllResponseHeaders()),j=k.responseText,d.resolved=!0,j?(d.resolvedContent=j,l.notify(MediaPlayer.dependencies.XlinkLoader.eventList.ENAME_XLINKELEMENT_LOADED,{element:d,resolveObject:e})):(d.resolvedContent=null,l.notify(MediaPlayer.dependencies.XlinkLoader.eventList.ENAME_XLINKELEMENT_LOADED,{element:d,resolveObject:e},new MediaPlayer.vo.Error(null,"Failed loading Xlink element: "+c,null))))},g=function(){n&&(n=!1,l.metricsModel.addHttpRequest("stream",null,MediaPlayer.vo.metrics.HTTPRequest.XLINK_EXPANSION_TYPE,c,k.responseURL||null,null,o,k.firstByteDate||null,new Date,k.status,null,k.getAllResponseHeaders()),f>0?(console.log("Failed loading xLink content: "+c+", retry in "+a+"ms attempts: "+f),f--,setTimeout(function(){b.call(l,c,d,e,f)},a)):(console.log("Failed loading Xlink content: "+c+" no retry attempts left"),l.errHandler.downloadError("xlink",c,k),d.resolved=!0,d.resolvedContent=null,l.notify(MediaPlayer.dependencies.XlinkLoader.eventList.ENAME_XLINKELEMENT_LOADED,{element:d,resolveObject:e},new Error("Failed loading xlink Element: "+c+" no retry attempts left"))))},i=function(a){m&&(m=!1,(!a.lengthComputable||a.lengthComputable&&a.total!=a.loaded)&&(k.firstByteDate=new Date))};try{k.onload=h,k.onloadend=g,k.onerror=g,k.onprogress=i,k.open("GET",l.requestModifierExt.modifyRequestURL(c),!0),k.send()}catch(a){console.log("Error"),k.onerror()}};return{errHandler:void 0,metricsModel:void 0,requestModifierExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,load:function(a,c,d){"urn:mpeg:dash:resolve-to-zero:2013"===a?(c.resolvedContent=null,c.resolved=!0,this.notify(MediaPlayer.dependencies.XlinkLoader.eventList.ENAME_XLINKELEMENT_LOADED,{element:c,resolveObject:d})):b.call(this,a,c,d,1)}}},MediaPlayer.dependencies.XlinkLoader.prototype={constructor:MediaPlayer.dependencies.XlinkLoader},MediaPlayer.dependencies.XlinkLoader.eventList={ENAME_XLINKELEMENT_LOADED:"xlinkElementLoaded"},MediaPlayer.dependencies.AbrController=function(){"use strict";var a,b=!0,c={},d={},e={},f={},g={},h={},i={},j=function(a,b){return d[b]=d[b]||{},d[b].hasOwnProperty(a)||(d[b][a]=0),d[b][a]},k=function(a,b,c){d[b]=d[b]||{},d[b][a]=c},l=function(a,b){return e[b]=e[b]||{},e[b].hasOwnProperty(a)||(e[b][a]=0),e[b][a]},m=function(a,b,c){e[b]=e[b]||{},e[b][a]=c},n=function(a,b,d){c[b]=c[b]||{},c[b][a]=d},o=function(a){return f[a]},p=function(a,b){f[a]=b},q=function(a){return f.hasOwnProperty("max")&&f.max.hasOwnProperty(a)?f.max[a]:NaN},r=function(a,b){f.max=f.max||{},f.max[a]=b},s=function(a,b){return c[b]=c[b]||{},c[b].hasOwnProperty(a)||(c[b][a]=0),t.call(this,c[b][a],a)},t=function(a,b){var c=q(b);if(isNaN(c))return a;var d=this.getQualityForBitrate(h[b].getMediaInfo(),c);return Math.min(a,d)},u=function(c){if(0===MediaPlayer.dependencies.ScheduleController.LOADING_REQUEST_THRESHOLD&&b){var d=this,e=c.data.request.mediaType,f=d.abrRulesCollection.getRules(MediaPlayer.rules.ABRRulesCollection.prototype.ABANDON_FRAGMENT_RULES),g=h[e].getScheduleController(),i=g.getFragmentModel(),j=function(b){function c(b){a=setTimeout(function(){d.setAbandonmentStateFor(b,MediaPlayer.dependencies.AbrController.ALLOW_LOAD)},MediaPlayer.dependencies.AbrController.ABANDON_TIMEOUT)}if(b.confidence===MediaPlayer.rules.SwitchRequest.prototype.STRONG){var f=i.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.LOADING}),h=b.value;d.getQualityFor(e,d.streamController.getActiveStreamInfo())>h&&(i.abortRequests(),d.setAbandonmentStateFor(e,MediaPlayer.dependencies.AbrController.ABANDON_LOAD),d.setPlaybackQuality(e,d.streamController.getActiveStreamInfo(),h),g.replaceCanceledRequests(f),c(e))}};d.rulesController.applyRules(f,h[e],j,c,function(a,b){return b})}};return{log:void 0,abrRulesCollection:void 0,rulesController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,streamController:void 0,setup:function(){this[MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_PROGRESS]=u},initialize:function(a,b){h[a]=b,i[a]=i[a]||{},i[a].state=MediaPlayer.dependencies.AbrController.ALLOW_LOAD},getAutoSwitchBitrate:function(){return b},setAutoSwitchBitrate:function(a){b=a},getPlaybackQuality:function(a){var c,d,e,f,g=this,h=a.getType(),n=a.getStreamInfo().id,o=function(b){var e=s.call(g,h,n);c=b.value,f=b.confidence,0>c&&(c=0),c>e&&(c=e),d=j(h,n),c===d||i[h].state===MediaPlayer.dependencies.AbrController.ABANDON_LOAD&&c>d||(k(h,n,c),m(h,n,f),g.notify(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,{mediaType:h,streamInfo:a.getStreamInfo(),oldQuality:d,newQuality:c}))};c=j(h,n),f=l(h,n),b&&(e=g.abrRulesCollection.getRules(MediaPlayer.rules.ABRRulesCollection.prototype.QUALITY_SWITCH_RULES),g.rulesController.applyRules(e,a,o.bind(g),c,function(a,b){return a=a===MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE?0:a,Math.max(a,b)}))},setPlaybackQuality:function(a,b,c){var d=b.id,e=j(a,d);if(null===c||isNaN(c)||c%1!=0)throw"argument is not an integer";c!==e&&c>=0&&c<=s.call(this,a,d)&&(k(a,b.id,c),this.notify(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,{mediaType:a,streamInfo:b,oldQuality:e,newQuality:c}))},setAbandonmentStateFor:function(a,b){i[a].state=b},getAbandonmentStateFor:function(a){return i[a].state},getQualityFor:function(a,b){return j(a,b.id)},getConfidenceFor:function(a,b){return l(a,b.id)},setInitialBitrateFor:function(a,b){p(a,b)},getInitialBitrateFor:function(a){return o(a)},setMaxAllowedBitrateFor:function(a,b){r(a,b)},getMaxAllowedBitrateFor:function(a){return q(a)},getQualityForBitrate:function(a,b){for(var c,d=this.getBitrateList(a),e=d.length,f=0;e>f;f+=1)if(c=d[f],1e3*b<=c.bitrate)return Math.max(f-1,0);return e-1},getBitrateList:function(a){if(!a||!a.bitrateList)return null;for(var b,c=a.bitrateList,d=a.type,e=[],f=0,g=c.length;g>f;f+=1)b=new MediaPlayer.vo.BitrateInfo,b.mediaType=d,b.qualityIndex=f,b.bitrate=c[f],e.push(b);return e},setAverageThroughput:function(a,b){g[a]=b},getAverageThroughput:function(a){return g[a]},updateTopQualityIndex:function(a){var b,c=a.type,d=a.streamInfo.id;return b=a.representationCount-1,n(c,d,b),b},isPlayingAtTopQuality:function(a){var b=this,c=a.id,d=b.getQualityFor("audio",a),e=b.getQualityFor("video",a);return d===s.call(this,"audio",c)&&e===s.call(this,"video",c)},getTopQualityIndexFor:s,reset:function(){b=!0,c={},d={},e={},h={},i={},g={},clearTimeout(a),a=null}}},MediaPlayer.dependencies.AbrController.prototype={constructor:MediaPlayer.dependencies.AbrController},MediaPlayer.dependencies.AbrController.eventList={ENAME_QUALITY_CHANGED:"qualityChanged"},MediaPlayer.dependencies.AbrController.DEFAULT_VIDEO_BITRATE=1e3,MediaPlayer.dependencies.AbrController.DEFAULT_AUDIO_BITRATE=100,MediaPlayer.dependencies.AbrController.ABANDON_LOAD="abandonload",MediaPlayer.dependencies.AbrController.ALLOW_LOAD="allowload",MediaPlayer.dependencies.AbrController.ABANDON_TIMEOUT=1e4,MediaPlayer.dependencies.AbrController.BANDWIDTH_SAFETY=.9,MediaPlayer.dependencies.BufferController=function(){"use strict";var a,b,c,d,e=.5,f=0,g=-1,h=!1,i=0,j=0,k=Number.POSITIVE_INFINITY,l=-1,m=-1,n=null,o=null,p=0,q=!1,r=!1,s=!1,t=function(c){if(!c||!a||!this.streamProcessor)return null;var d=null;try{(d=this.sourceBufferExt.createSourceBuffer(a,c))&&d.hasOwnProperty("initialize")&&d.initialize(b,this)}catch(a){this.errHandler.mediaSourceError("Error creating "+b+" source buffer.")}return this.setBuffer(d),P.call(this,this.streamProcessor.getRepresentationInfoForQuality(f).MSETimeOffset),d},u=function(){return this.streamProcessor.getStreamInfo().id===this.streamController.getActiveStreamInfo().id},v=function(){var a=this.streamProcessor.getFragmentModel().getRequests({state:MediaPlayer.dependencies.FragmentModel.states.LOADING}),c=T.call(this),d=this.virtualBuffer.getChunks({streamId:c,mediaType:b,segmentType:MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE,quality:g});return!(g>f&&(w(d,g)||w(a,g)))&&g!==f},w=function(a,b){var c=0,d=a.length;for(c;d>c;c+=1)if(a[c].quality===b)return!0;return!1},x=function(a){var b,c=this;a.data.fragmentModel===c.streamProcessor.getFragmentModel()&&(c.log("Initialization finished loading"),b=a.data.chunk,this.virtualBuffer.append(b),b.quality===f&&v.call(c)&&ca.call(c))},y=function(a){if(a.data.fragmentModel===this.streamProcessor.getFragmentModel()){var b,c=a.data.chunk,d=c.bytes,e=c.quality,f=c.index,g=this.streamProcessor.getFragmentModel().getRequests({state:MediaPlayer.dependencies.FragmentModel.states.EXECUTED,quality:e,index:f})[0],h=this.streamProcessor.getRepresentationInfoForQuality(e),i=this.manifestModel.getValue(),j=this.adapter.getEventsFor(i,h.mediaInfo,this.streamProcessor),k=this.adapter.getEventsFor(i,h,this.streamProcessor);(j.length>0||k.length>0)&&(b=C.call(this,d,g,j,k),this.streamProcessor.getEventController().addInbandEvents(b)),c.bytes=D.call(this,d),this.virtualBuffer.append(c),R.call(this)}},z=function(a){r=!0,d=a;var b=this,c=a.quality,e=isNaN(a.index);return c!==f&&e||c!==g&&!e?(b.log("reject request - required quality = "+f+" current quality = "+g+" chunk media type = "+a.mediaType+" chunk quality = "+c+" chunk index = "+a.index),void V.call(b,c,a.index)):void b.sourceBufferExt.append(n,a)},A=function(b){if(n===b.data.buffer){this.isBufferingCompleted()&&this.streamProcessor.getStreamInfo().isLast&&this.mediaSourceExt.signalEndOfStream(a);var c,e=this;if(b.error)return b.error.code===MediaPlayer.dependencies.SourceBufferExtensions.QUOTA_EXCEEDED_ERROR_CODE&&(e.virtualBuffer.append(d),k=.8*e.sourceBufferExt.getTotalBufferedTime(n),e.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_QUOTA_EXCEEDED,{criticalBufferLevel:k}),J.call(e,I.call(e))),void(r=!1);if(B.call(e),G.call(e)||(e.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_QUOTA_EXCEEDED,{criticalBufferLevel:k}),J.call(e,I.call(e))),(c=e.sourceBufferExt.getAllRanges(n))&&c.length>0){var f,g;for(f=0,g=c.length;g>f;f+=1)e.log("Buffered Range: "+c.start(f)+" - "+c.end(f))}e.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED,{quality:d.quality,index:d.index,bufferedRanges:c}),U.call(e,d.quality,d.index)}},B=function(){var a=this,b=a.playbackController.getTime(),c=this.streamProcessor.getScheduleController().getFragmentToLoadCount(),d=this.streamProcessor.getCurrentRepresentationInfo().fragmentDuration;return i=a.sourceBufferExt.getBufferLength(n,b),j=c>0?c*d+i:j,S.call(this),a.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED,{bufferLevel:i}),E.call(a),M.call(a),!0},C=function(a,b,c,d){var e,f,g,h,i=[],j=Math.max(isNaN(b.startTime)?0:b.startTime,0),k=[];s=!1,h=c.concat(d);for(var l=0;l<h.length;l++)k[h[l].schemeIdUri]=h[l];g=this.boxParser.parse(a),e=g.getBoxes("emsg");for(var m=0,n=e.length;n>m;m+=1)(f=this.adapter.getEvent(e[m],k,j))&&i.push(f);return i},D=function(a){if(!s)return a;for(var b,c,d=a.length,e=0,f=0,g=Math.pow(256,2),h=Math.pow(256,3),i=new Uint8Array(a.length);d>e;){if(b=String.fromCharCode(a[e+4],a[e+5],a[e+6],a[e+7]),c=a[e]*h+a[e+1]*g+256*a[e+2]+1*a[e+3],"emsg"!=b)for(var j=e;e+c>j;j++)i[f]=a[j],f+=1;e+=c}return i.subarray(0,f)},E=function(){var a=F.call(this),b=2*c,d=i-a;d>=b&&!q?(q=!0,this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN)):b/2>d&&q&&(this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED),q=!1,R.call(this))},F=function(){var a=this.metricsModel.getReadOnlyMetricsFor("video"),b=this.metricsExt.getCurrentBufferLevel(a),c=this.metricsModel.getReadOnlyMetricsFor("audio"),d=this.metricsExt.getCurrentBufferLevel(c);return null===b||null===d?null!==d?d.level:null!==b?b.level:null:Math.min(d.level,b.level)},G=function(){var a=this,b=a.sourceBufferExt.getTotalBufferedTime(n);return k>b},H=function(){var b=0,c=this.playbackController.getTime(),d=this.sourceBufferExt.getBufferRange(n,c);null!==d&&(b=c-d.start-MediaPlayer.dependencies.BufferController.BUFFER_TO_KEEP)>0&&this.sourceBufferExt.remove(n,0,Math.round(d.start+b),a)},I=function(){var a,b,c,d,e,f=this;return n?(a=f.playbackController.getTime(),e=f.streamProcessor.getFragmentModel().getRequests({state:MediaPlayer.dependencies.FragmentModel.states.EXECUTED,time:a})[0],c=e&&!isNaN(e.startTime)?e.startTime:Math.floor(a),d=f.sourceBufferExt.getBufferRange(n,a),null===d&&n.buffered.length>0&&(c=n.buffered.end(n.buffered.length-1)),b=n.buffered.start(0),{start:b,end:c}):null},J=function(b){if(b&&n){var c=this,d=b.start,e=b.end;c.sourceBufferExt.remove(n,d,e,a)}},K=function(a){n===a.data.buffer&&(this.virtualBuffer.updateBufferedRanges({streamId:T.call(this),mediaType:b},this.sourceBufferExt.getAllRanges(n)),B.call(this),this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_CLEARED,{from:a.data.from,to:a.data.to,hasEnoughSpaceToAppend:G.call(this)}),G.call(this)||setTimeout(J.bind(this,I.call(this)),1e3*c))},L=function(){l===m-1&&!h&&(h=!0,this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFERING_COMPLETED))},M=function(){e>i&&!h?O.call(this,!1):O.call(this,!0)},N=function(){return o?MediaPlayer.dependencies.BufferController.BUFFER_LOADED:MediaPlayer.dependencies.BufferController.BUFFER_EMPTY},O=function(a){if(!(o===a||"fragmentedText"===b&&this.textSourceBuffer.getAllTracksAreDisabled())){o=a;var c=N(),d=c===MediaPlayer.dependencies.BufferController.BUFFER_LOADED?MediaPlayer.events.BUFFER_LOADED:MediaPlayer.events.BUFFER_EMPTY;S.call(this),this.eventBus.dispatchEvent({type:d,data:{bufferType:b}}),this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,{hasSufficientBuffer:a}),this.log(o?"Got enough buffer to start.":"Waiting for more buffer before starting playback.")}},P=function(a){n&&n.timestampOffset!==a&&!isNaN(a)&&(n.timestampOffset=a)},Q=function(){if(n){var a=this;B.call(a),R.call(a)}},R=function(){v.call(this)?ca.call(this):Z.call(this)},S=function(){if(u.call(this)){this.metricsModel.addBufferState(b,N(),j);var a,c=i;a=this.virtualBuffer.getTotalBufferLevel(this.streamProcessor.getMediaInfo()),a&&(c+=a),this.metricsModel.addBufferLevel(b,new Date,c)}},T=function(){return this.streamProcessor.getStreamInfo().id},U=function(a,b){r=!1,isNaN(b)?W.call(this,a):X.call(this,b),R.call(this)},V=function(a,b){r=!1,this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_REJECTED,{quality:a,index:b}),R.call(this)},W=function(a){g=a},X=function(a){this.virtualBuffer.storeAppendedChunk(d,n),Y.call(this),l=Math.max(a,l),L.call(this)},Y=function(){var a,c,d,e=this,f=this.virtualBuffer.getChunks({streamId:T.call(this),mediaType:b,segmentType:MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE,appended:!0}),g=new MediaPlayer.utils.CustomTimeRanges,h=new MediaPlayer.utils.CustomTimeRanges,i=this.playbackController.getTime(),j=2*this.streamProcessor.getCurrentRepresentationInfo().fragmentDuration;if(f.forEach(function(a){c=e.mediaController.isCurrentTrack(a.mediaInfo)?h:g,c.add(a.bufferedRange.start,a.bufferedRange.end)}),0!==g.length&&0!==h.length&&(a=this.sourceBufferExt.getBufferLength({buffered:h},i),!(j>a)))for(var k=0,l=g.length;l>k;k+=1)d={start:g.start(k),end:g.end(k)},(e.mediaController.getSwitchMode(b)===MediaPlayer.dependencies.MediaController.trackSwitchModes.ALWAYS_REPLACE||d.start>i)&&J.call(e,d)},Z=function(){var a,c=T.call(this);!n||q||r||v.call(this)||!G.call(this)||(a=this.virtualBuffer.extract({streamId:c,mediaType:b,segmentType:MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE,limit:1})[0])&&z.call(this,a)},$=function(a){if(!a.error){var b,d=this;P.call(d,a.data.currentRepresentation.MSETimeOffset),b=d.streamProcessor.getStreamInfo().manifestInfo.minBufferTime,c!==b&&(d.setMinBufferTime(b),d.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_MIN_BUFFER_TIME_UPDATED,{minBufferTime:b}))}},_=function(a){var b=this;a.data.fragmentModel===b.streamProcessor.getFragmentModel()&&(m=a.data.request.index,L.call(b))},aa=function(a){if(b===a.data.mediaType&&this.streamProcessor.getStreamInfo().id===a.data.streamInfo.id){var c=this,d=a.data.newQuality;f!==d&&(P.call(c,c.streamProcessor.getRepresentationInfoForQuality(d).MSETimeOffset),f=d,v.call(c)&&ca.call(c))}},ba=function(){S.call(this)},ca=function(){var a=this,c=T.call(a),d={streamId:c,mediaType:b,segmentType:MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE,quality:f},e=a.virtualBuffer.getChunks(d)[0];if(e){if(r||!n)return;z.call(a,e)}else a.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_INIT_REQUESTED,{requiredQuality:f})},da=function(a){if(n){var c=this,d=a.data.newMediaInfo,e=d.type,f=a.data.switchMode,g=this.playbackController.getTime(),h={start:0,end:g};if(b===e)switch(f){case MediaPlayer.dependencies.MediaController.trackSwitchModes.ALWAYS_REPLACE:J.call(c,h);break;case MediaPlayer.dependencies.MediaController.trackSwitchModes.NEVER_REPLACE:break;default:this.log("track switch mode is not supported: "+f)}}},ea=function(){R.call(this),(p+=1)%MediaPlayer.dependencies.BufferController.BUFFER_PRUNING_INTERVAL==0&&H.call(this)},fa=function(){M.call(this)};return{sourceBufferExt:void 0,eventBus:void 0,bufferMax:void 0,manifestModel:void 0,errHandler:void 0,mediaSourceExt:void 0,metricsModel:void 0,metricsExt:void 0,streamController:void 0,playbackController:void 0,mediaController:void 0,adapter:void 0,log:void 0,abrController:void 0,boxParser:void 0,system:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,virtualBuffer:void 0,textSourceBuffer:void 0,setup:function(){this[Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED]=$,this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_INIT_FRAGMENT_LOADED]=x,this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADED]=y,this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED]=_,this[MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED]=aa,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PROGRESS]=Q,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING]=Q,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED]=Q,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED]=fa,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED]=ea,this[MediaPlayer.dependencies.MediaController.eventList.CURRENT_TRACK_CHANGED]=da,A=A.bind(this),K=K.bind(this),ba=ba.bind(this),this.sourceBufferExt.subscribe(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,this,A),this.sourceBufferExt.subscribe(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,this,K),this.virtualBuffer.subscribe(MediaPlayer.utils.VirtualBuffer.eventList.CHUNK_APPENDED,this,ba)},initialize:function(a,c,d){var e=this;b=a,e.setMediaType(b),e.setMediaSource(c),e.streamProcessor=d,e.fragmentController=d.fragmentController,e.scheduleController=d.scheduleController,f=e.abrController.getQualityFor(b,d.getStreamInfo())},createBuffer:t,getStreamProcessor:function(){return this.streamProcessor},setStreamProcessor:function(a){this.streamProcessor=a},getBuffer:function(){return n},setBuffer:function(a){n=a},getBufferLevel:function(){return i},getMinBufferTime:function(){return c},setMinBufferTime:function(a){c=a},getCriticalBufferLevel:function(){return k},setMediaSource:function(b){a=b},getMediaSource:function(){return a},isBufferingCompleted:function(){return h},reset:function(b){var e=this;k=Number.POSITIVE_INFINITY,o=null,c=null,g=-1,m=-1,l=-1,f=0,e.sourceBufferExt.unsubscribe(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,e,A),e.sourceBufferExt.unsubscribe(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,e,K),d=null,this.virtualBuffer.unsubscribe(MediaPlayer.utils.VirtualBuffer.eventList.CHUNK_APPENDED,e,ba),q=!1,r=!1,b||(e.sourceBufferExt.abort(a,n),e.sourceBufferExt.removeSourceBuffer(a,n)),n=null}}},MediaPlayer.dependencies.BufferController.BUFFER_SIZE_REQUIRED="required",MediaPlayer.dependencies.BufferController.BUFFER_SIZE_MIN="min",MediaPlayer.dependencies.BufferController.BUFFER_SIZE_INFINITY="infinity",MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME=12,MediaPlayer.dependencies.BufferController.LOW_BUFFER_THRESHOLD=4,MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY=30,MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY_LONG_FORM=300,MediaPlayer.dependencies.BufferController.LONG_FORM_CONTENT_DURATION_THRESHOLD=600,MediaPlayer.dependencies.BufferController.RICH_BUFFER_THRESHOLD=20,MediaPlayer.dependencies.BufferController.BUFFER_LOADED="bufferLoaded",MediaPlayer.dependencies.BufferController.BUFFER_EMPTY="bufferStalled",MediaPlayer.dependencies.BufferController.BUFFER_TO_KEEP=30,MediaPlayer.dependencies.BufferController.BUFFER_PRUNING_INTERVAL=30,MediaPlayer.dependencies.BufferController.prototype={constructor:MediaPlayer.dependencies.BufferController},MediaPlayer.dependencies.BufferController.eventList={ENAME_BUFFER_LEVEL_STATE_CHANGED:"bufferLevelStateChanged",ENAME_BUFFER_LEVEL_UPDATED:"bufferLevelUpdated",ENAME_QUOTA_EXCEEDED:"quotaExceeded",ENAME_BYTES_APPENDED:"bytesAppended",ENAME_BYTES_REJECTED:"bytesRejected",ENAME_BUFFERING_COMPLETED:"bufferingCompleted",ENAME_BUFFER_CLEARED:"bufferCleared",ENAME_INIT_REQUESTED:"initRequested",ENAME_BUFFER_LEVEL_OUTRUN:"bufferLevelOutrun",ENAME_BUFFER_LEVEL_BALANCED:"bufferLevelBalanced",ENAME_MIN_BUFFER_TIME_UPDATED:"minBufferTimeUpdated"},MediaPlayer.dependencies.EventController=function(){"use strict"
;var a={},b={},c={},d=null,e=100,f=e/1e3,g="urn:mpeg:dash:event:2012",h=1,i=function(){j(),a=null,b=null,c=null},j=function(){null!==d&&(clearInterval(d),d=null)},k=function(){this.log("Start Event Controller"),isNaN(e)||(d=setInterval(n.bind(this),e))},l=function(b){var c=this;if(a={},b)for(var d=0;d<b.length;d++){var e=b[d];a[e.id]=e,c.log("Add inline event with id "+e.id)}c.log("Added "+b.length+" inline events")},m=function(a){for(var c=this,d=0;d<a.length;d++){var e=a[d];e.id in b?c.log("Repeated event with id "+e.id):(b[e.id]=e,c.log("Add inband event with id "+e.id))}},n=function(){o.call(this,b),o.call(this,a),p.call(this)},o=function(a){var b,d=this,e=this.videoModel.getCurrentTime();if(a)for(var i=Object.keys(a),j=0;j<i.length;j++){var k=i[j],l=a[k];void 0!==l&&(0===(b=l.presentationTime/l.eventStream.timescale)||e>=b&&b+f>e)&&(d.log("Start Event "+k+" at "+e),l.duration>0&&(c[k]=l),l.eventStream.schemeIdUri==g&&l.eventStream.value==h&&q.call(this),delete a[k])}},p=function(){var a=this;if(c)for(var b=this.videoModel.getCurrentTime(),d=Object.keys(c),e=0;e<d.length;e++){var f=d[e],g=c[f];null!==g&&(g.duration+g.presentationTime)/g.eventStream.timescale<b&&(a.log("Remove Event "+f+" at time "+b),g=null,delete c[f])}},q=function(){var a=this.manifestModel.getValue(),b=a.url;a.hasOwnProperty("Location")&&(b=a.Location),this.log("Refresh manifest @ "+b),this.manifestUpdater.getManifestLoader().load(b)};return{manifestModel:void 0,manifestUpdater:void 0,log:void 0,system:void 0,videoModel:void 0,addInlineEvents:l,addInbandEvents:m,reset:i,clear:j,start:k}},MediaPlayer.dependencies.EventController.prototype={constructor:MediaPlayer.dependencies.EventController},MediaPlayer.dependencies.FragmentController=function(){"use strict";var a=[],b=!1,c=function(b){for(var c=a.length,d=0;c>d;d++)if(a[d].getContext()==b)return a[d];return null},d=function(b,c){var d=this,e=a[0].getContext().streamProcessor,f=e.getStreamInfo().id,g=d.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_EXECUTE_RULES);-1!==g.indexOf(this.scheduleRulesCollection.sameTimeRequestRule)&&this.scheduleRulesCollection.sameTimeRequestRule.setFragmentModels(a,f),d.rulesController.applyRules(g,e,c,b,function(a,b){return b})},e=function(a,b,c){var d=new MediaPlayer.vo.DataChunk;return d.streamId=c,d.mediaInfo=b.mediaInfo,d.segmentType=b.type,d.start=b.startTime,d.duration=b.duration,d.end=d.start+d.duration,d.bytes=a,d.index=b.index,d.quality=b.quality,d},f=function(a){var b=this,c=a.data.request;b.isInitializationRequest(c)?b.notify(MediaPlayer.dependencies.FragmentController.eventList.ENAME_INIT_FRAGMENT_LOADING_START,{request:c,fragmentModel:a.sender}):b.notify(MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADING_START,{request:c,fragmentModel:a.sender})},g=function(a){var b,c=this,d=a.data.request,f=a.data.response,g=a.sender.getContext().streamProcessor.getStreamInfo().id,h=this.isInitializationRequest(d),i=h?MediaPlayer.dependencies.FragmentController.eventList.ENAME_INIT_FRAGMENT_LOADED:MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADED;return f?(b=e.call(this,f,d,g),c.notify(i,{chunk:b,fragmentModel:a.sender}),void k.call(this)):void c.log("No "+d.mediaType+" bytes to push.")},h=function(a){this.notify(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,{request:a.data.request,fragmentModel:a.sender})},i=function(){k.call(this)},j=function(c){var d,e,f,g,h,i=c.value;for(g=0;g<i.length;g+=1)if(e=i[g])for(h=0;h<a.length;h+=1)f=a[h],d=f.getContext().streamProcessor.getType(),e.mediaType===d&&(e instanceof MediaPlayer.vo.FragmentRequest||(e=f.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.PENDING,time:e.startTime})[0]),f.executeRequest(e));b=!1},k=function(a){b||(b=!0,d.call(this,a,j.bind(this)))};return{system:void 0,log:void 0,scheduleRulesCollection:void 0,rulesController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this[MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_STARTED]=f,this[MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED]=g,this[MediaPlayer.dependencies.FragmentModel.eventList.ENAME_STREAM_COMPLETED]=h,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED]=i,this.scheduleRulesCollection.sameTimeRequestRule&&this.subscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,this.scheduleRulesCollection.sameTimeRequestRule)},process:function(a){var b=null;return null!==a&&void 0!==a&&a.byteLength>0&&(b=new Uint8Array(a)),b},getModel:function(b){if(!b)return null;var d=c(b);return d||(d=this.system.getObject("fragmentModel"),d.setContext(b),a.push(d)),d},detachModel:function(b){var c=a.indexOf(b);c>-1&&a.splice(c,1)},isInitializationRequest:function(a){return a&&a.type&&a.type===MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE},prepareFragmentForLoading:function(a,b){a&&b&&a.addRequest(b)&&k.call(this,b)},executePendingRequests:function(){k.call(this)},reset:function(){a=[],this.scheduleRulesCollection.sameTimeRequestRule&&this.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,this.scheduleRulesCollection.sameTimeRequestRule)}}},MediaPlayer.dependencies.FragmentController.prototype={constructor:MediaPlayer.dependencies.FragmentController},MediaPlayer.dependencies.FragmentController.eventList={ENAME_STREAM_COMPLETED:"streamCompleted",ENAME_INIT_FRAGMENT_LOADING_START:"initFragmentLoadingStart",ENAME_MEDIA_FRAGMENT_LOADING_START:"mediaFragmentLoadingStart",ENAME_INIT_FRAGMENT_LOADED:"initFragmentLoaded",ENAME_MEDIA_FRAGMENT_LOADED:"mediaFragmentLoaded"},MediaPlayer.dependencies.MediaController=function(){var a,b,c,d={},e=function(a,b){!this.DOMStorage.isSupported(MediaPlayer.utils.DOMStorage.STORAGE_TYPE_LOCAL)||"video"!==a&&"audio"!==a||localStorage.setItem(MediaPlayer.utils.DOMStorage["LOCAL_STORAGE_"+a.toUpperCase()+"_SETTINGS_KEY"],JSON.stringify({settings:b,timestamp:(new Date).getTime()}))},f=function(a){var b={lang:a.lang,viewpoint:a.viewpoint,roles:a.roles,accessibility:a.accessibility,audioChannelConfiguration:a.audioChannelConfiguration};return b.lang||b.viewpoint||b.role&&b.role.length>0||b.accessibility&&b.accessibility.length>0||b.audioChannelConfiguration&&b.audioChannelConfiguration.length>0?b:null},g=function(a,b){var c=!a.lang||a.lang===b.lang,d=!a.viewpoint||a.viewpoint===b.viewpoint,e=!a.role||!!b.roles.filter(function(b){return b===a.role})[0],f=!a.accessibility||!!b.accessibility.filter(function(b){return b===a.accessibility})[0],g=!a.audioChannelConfiguration||!!b.audioChannelConfiguration.filter(function(b){return b===a.audioChannelConfiguration})[0];return c&&d&&e&&f&&g},h=function(){c={audio:MediaPlayer.dependencies.MediaController.trackSwitchModes.ALWAYS_REPLACE,video:MediaPlayer.dependencies.MediaController.trackSwitchModes.NEVER_REPLACE}},i=function(){a={audio:null,video:null}},j=function(a){var b=this.getSelectionModeForInitialTrack(),c=[],d=function(a){var b,c=0,d=[];return a.forEach(function(a){b=Math.max.apply(Math,a.bitrateList),b>c?(c=b,d=[a]):b===c&&d.push(a)}),d},e=function(a){var b,c=0,d=[];return a.forEach(function(a){b=a.representationCount,b>c?(c=b,d=[a]):b===c&&d.push(a)}),d};switch(b){case MediaPlayer.dependencies.MediaController.trackSelectionModes.HIGHEST_BITRATE:c=d(a),c.length>1&&(c=e(c));break;case MediaPlayer.dependencies.MediaController.trackSelectionModes.WIDEST_RANGE:c=e(a),c.length>1&&(c=d(a));break;default:this.log("track selection mode is not supported: "+b)}return c[0]},k=function(){return{audio:{list:[],storeLastSettings:!0,current:null},video:{list:[],storeLastSettings:!0,current:null},text:{list:[],storeLastSettings:!0,current:null},fragmentedText:{list:[],storeLastSettings:!0,current:null}}};return{log:void 0,system:void 0,errHandler:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,DOMStorage:void 0,setup:function(){i.call(this),h.call(this)},checkInitialMediaSettings:function(a){var b=this;["audio","video","text","fragmentedText"].forEach(function(c){var d=b.getInitialSettings(c),e=b.getTracksFor(c,a),f=!1;d||(d=b.DOMStorage.getSavedMediaSettings(c),b.setInitialSettings(c,d)),e&&0!==e.length&&(d&&e.forEach(function(a){!f&&g.call(b,d,a)&&(b.setTrack(a),f=!0)}),f||b.setTrack(j.call(b,e)))})},addTrack:function(a){var b=a?a.type:null,c=a?a.streamInfo.id:null,e=this.getInitialSettings(b);return!(!a||!this.isMultiTrackSupportedByType(b))&&(d[c]=d[c]||k.call(this),!(d[c][b].list.indexOf(a)>=0)&&(d[c][b].list.push(a),e&&g.call(this,e,a)&&!this.getCurrentTrackFor(b,a.streamInfo)&&this.setTrack(a),!0))},getTracksFor:function(a,b){if(!a||!b)return[];var c=b.id;return d[c]&&d[c][a]?d[c][a].list:[]},getCurrentTrackFor:function(a,b){return a&&b?d[b.id][a].current:null},isCurrentTrack:function(a){var b=a.type,c=a.streamInfo.id;return d[c]&&d[c][b]&&this.isTracksEqual(d[c][b].current,a)},setTrack:function(a){if(a){var b=a.type,g=a.streamInfo,h=g.id,i=this.getCurrentTrackFor(b,g);if(d[h]&&d[h][b]&&(!i||!this.isTracksEqual(a,i))){d[h][b].current=a,i&&this.notify(MediaPlayer.dependencies.MediaController.eventList.CURRENT_TRACK_CHANGED,{oldMediaInfo:i,newMediaInfo:a,switchMode:c[b]});var j=f.call(this,a);j&&d[h][b].storeLastSettings&&(j.roles&&(j.role=j.roles[0],delete j.roles),j.accessibility&&(j.accessibility=j.accessibility[0]),j.audioChannelConfiguration&&(j.audioChannelConfiguration=j.audioChannelConfiguration[0]),e.call(this,b,j))}}},setInitialSettings:function(b,c){b&&c&&(a[b]=c)},getInitialSettings:function(b){return b?a[b]:null},setSwitchMode:function(a,b){return!MediaPlayer.dependencies.MediaController.trackSwitchModes[b]?void this.log("track switch mode is not supported: "+b):void(c[a]=b)},getSwitchMode:function(a){return c[a]},setSelectionModeForInitialTrack:function(a){return!MediaPlayer.dependencies.MediaController.trackSelectionModes[a]?void this.log("track selection mode is not supported: "+a):void(b=a)},getSelectionModeForInitialTrack:function(){return b||MediaPlayer.dependencies.MediaController.DEFAULT_INIT_TRACK_SELECTION_MODE},isMultiTrackSupportedByType:function(a){return"audio"===a||"video"===a||"text"===a||"fragmentedText"===a},isTracksEqual:function(a,b){var c=a.id===b.id,d=a.viewpoint===b.viewpoint,e=a.lang===b.lang,f=a.roles.toString()==b.roles.toString(),g=a.accessibility.toString()==b.accessibility.toString(),h=a.audioChannelConfiguration.toString()==b.audioChannelConfiguration.toString();return c&&d&&e&&f&&g&&h},reset:function(){h.call(this),d={},a={audio:null,video:null}}}},MediaPlayer.dependencies.MediaController.prototype={constructor:MediaPlayer.dependencies.MediaController},MediaPlayer.dependencies.MediaController.eventList={CURRENT_TRACK_CHANGED:"currenttrackchanged"},MediaPlayer.dependencies.MediaController.trackSwitchModes={NEVER_REPLACE:"NEVER_REPLACE",ALWAYS_REPLACE:"ALWAYS_REPLACE"},MediaPlayer.dependencies.MediaController.trackSelectionModes={HIGHEST_BITRATE:"HIGHEST_BITRATE",WIDEST_RANGE:"WIDEST_RANGE"},MediaPlayer.dependencies.MediaController.DEFAULT_INIT_TRACK_SELECTION_MODE=MediaPlayer.dependencies.MediaController.trackSelectionModes.HIGHEST_BITRATE,MediaPlayer.dependencies.PlaybackController=function(){"use strict";var a,b,c,d,e=1e3,f=0,g=NaN,h=null,i={},j={},k=NaN,l=function(a){var b,d=parseInt(this.uriQueryFragModel.getURIFragmentData().s);return c?(!isNaN(d)&&d>1262304e3&&((b=d-a.manifestInfo.availableFrom.getTime()/1e3)>g||b<g-a.manifestInfo.DVRWindowSize)&&(b=null),b=b||g):b=!isNaN(d)&&d<a.duration&&d>=0?d:a.start,b},m=function(b){var c=this,d=c.metricsModel.getReadOnlyMetricsFor("video")||c.metricsModel.getReadOnlyMetricsFor("audio"),e=c.metricsExt.getCurrentDVRInfo(d),f=e?e.range:null;return f?b>=f.start&&b<=f.end?b:Math.max(f.end-2*a.manifestInfo.minBufferTime,f.start):NaN},n=function(){if(null===h){var a=this,b=function(){G.call(a)};h=setInterval(b,e)}},o=function(){clearInterval(h),h=null},p=function(){if(!j[a.id]&&!this.isSeeking()){var b=l.call(this,a);this.log("Starting playback at offset: "+b),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,{seekTime:b})}},q=function(){if(!this.isPaused()&&c&&0!==b.getElement().readyState){var a=this.getTime(),d=m.call(this,a);!isNaN(d)&&d!==a&&this.seek(d)}},r=function(b){if(!b.error){var c=this.adapter.convertDataToTrack(this.manifestModel.getValue(),b.data.currentRepresentation),d=c.mediaInfo.streamInfo;a.id===d.id&&(a=c.mediaInfo.streamInfo,q.call(this))}},s=function(a){a.error||0===b.getElement().readyState||p.call(this)},t=function(){b&&(b.unlisten("canplay",u),b.unlisten("play",v),b.unlisten("playing",w),b.unlisten("pause",x),b.unlisten("error",F),b.unlisten("seeking",y),b.unlisten("seeked",z),b.unlisten("timeupdate",A),b.unlisten("progress",B),b.unlisten("ratechange",C),b.unlisten("loadedmetadata",D),b.unlisten("ended",E))},u=function(){this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_CAN_PLAY)},v=function(){this.log("<video> play"),q.call(this),n.call(this),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED,{startTime:this.getTime()})},w=function(){this.log("<video> playing"),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PLAYING,{playingTime:this.getTime()})},x=function(){this.log("<video> pause"),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PAUSED)},y=function(){this.log("<video> seek"),n.call(this),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,{seekTime:this.getTime()})},z=function(){this.log("<video> seeked"),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKED)},A=function(){var a=this.getTime();a!==f&&(f=a,this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED,{timeToEnd:this.getTimeToStreamEnd()}))},B=function(){var c,d,e,f=b.getElement().buffered;f.length&&(c=f.length-1,d=f.end(c),e=l.call(this,a)+a.duration-d),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PROGRESS,{bufferedRanges:b.getElement().buffered,remainingUnbufferedDuration:e})},C=function(){this.log("<video> ratechange: ",this.getPlaybackRate()),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED)},D=function(){this.log("<video> loadedmetadata"),(!c||this.timelineConverter.isTimeSyncCompleted())&&p.call(this),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_METADATA_LOADED),n.call(this)},E=function(){this.log("<video> ended"),o.call(this),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ENDED)},F=function(a){var b=a.target||a.srcElement;this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ERROR,{error:b.error})},G=function(){this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,{isDynamic:c,time:new Date})},H=function(b){var c,d=b.data.bufferedRanges,e=a.id,f=this.getTime(),g=b.sender.streamProcessor,h=g.getType(),k=this.system.getObject("streamController").getStreamById(a.id),m=l.call(this,a),n=this.adapter.getFragmentRequestForTime(g,g.getCurrentRepresentationInfo(),m,{ignoreIsFinished:!0}),o=n?n.index:null,p=i[e];b.data.index===o&&(j[e]=j[e]||{},j[e][h]=!0,j[e].ready=!(k.hasMedia("audio")&&!j[e].audio||k.hasMedia("video")&&!j[e].video)),!d||!d.length||j[e]&&j[e].seekCompleted||(c=Math.max(d.start(0),a.start),i[e]=void 0===i[e]?c:Math.max(i[e],c),p===i[e]&&f===p||!j[e]||!j[e].ready||f>i[e]||(this.isSeeking()?i={}:(this.seek(i[e]),j[e].seekCompleted=!0)))},I=function(c){var d=c.sender.streamProcessor.getType();c.sender.streamProcessor.getStreamInfo().id===a.id&&b.setStallState(d,!c.data.hasSufficientBuffer)},J=function(){b.listen("canplay",u),b.listen("play",v),b.listen("playing",w),b.listen("pause",x),b.listen("error",F),b.listen("seeking",y),b.listen("seeked",z),b.listen("timeupdate",A),b.listen("progress",B),b.listen("ratechange",C),b.listen("loadedmetadata",D),b.listen("ended",E)};return{system:void 0,log:void 0,timelineConverter:void 0,uriQueryFragModel:void 0,metricsModel:void 0,metricsExt:void 0,manifestModel:void 0,manifestExt:void 0,videoModel:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,adapter:void 0,setup:function(){this[Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED]=r,this[MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED]=s,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED]=H,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED]=I,u=u.bind(this),v=v.bind(this),w=w.bind(this),x=x.bind(this),F=F.bind(this),y=y.bind(this),z=z.bind(this),A=A.bind(this),B=B.bind(this),C=C.bind(this),D=D.bind(this),E=E.bind(this)},initialize:function(d){b=this.videoModel,a=d,i={},t.call(this),J.call(this),c=a.manifestInfo.isDynamic,g=d.start},getStreamStartTime:l,getTimeToStreamEnd:function(){var c=b.getCurrentTime();return l.call(this,a)+a.duration-c},getStreamId:function(){return a.id},getStreamDuration:function(){return a.duration},getTime:function(){return b.getCurrentTime()},getPlaybackRate:function(){return b.getPlaybackRate()},getPlayedRanges:function(){return b.getElement().played},getIsDynamic:function(){return c},setLiveStartTime:function(a){g=a},getLiveStartTime:function(){return g},setLiveDelayAttributes:function(a,b){k=a,d=b},getLiveDelay:function(b){var c=this.manifestExt.getMpd(this.manifestModel.getValue());return d&&c.hasOwnProperty("suggestedPresentationDelay")?c.suggestedPresentationDelay:isNaN(b)?2*a.manifestInfo.minBufferTime:b*k},start:function(){b.play()},isPaused:function(){return b.isPaused()},pause:function(){b&&b.pause()},isSeeking:function(){return b.getElement().seeking},seek:function(a){b&&a!==this.getTime()&&(this.log("Do seek: "+a),b.setCurrentTime(a))},reset:function(){o.call(this),t.call(this),b=null,a=null,f=0,g=NaN,i={},j={},c=void 0,d=void 0,k=NaN}}},MediaPlayer.dependencies.PlaybackController.prototype={constructor:MediaPlayer.dependencies.PlaybackController},MediaPlayer.dependencies.PlaybackController.eventList={ENAME_CAN_PLAY:"canPlay",ENAME_PLAYBACK_STARTED:"playbackStarted",ENAME_PLAYBACK_PLAYING:"playbackPlaying",ENAME_PLAYBACK_STOPPED:"playbackStopped",ENAME_PLAYBACK_PAUSED:"playbackPaused",ENAME_PLAYBACK_ENDED:"playbackEnded",ENAME_PLAYBACK_SEEKING:"playbackSeeking",ENAME_PLAYBACK_SEEKED:"playbackSeeked",ENAME_PLAYBACK_TIME_UPDATED:"playbackTimeUpdated",ENAME_PLAYBACK_PROGRESS:"playbackProgress",ENAME_PLAYBACK_RATE_CHANGED:"playbackRateChanged",ENAME_PLAYBACK_METADATA_LOADED:"playbackMetaDataLoaded",ENAME_PLAYBACK_ERROR:"playbackError",ENAME_WALLCLOCK_TIME_UPDATED:"wallclockTimeUpdated"},MediaPlayer.dependencies.ProtectionController=function(){"use strict";var a,b,c,d=null,e=[],f=!1,g=function(a){var b=null,d=a.systemString;return c&&(b=d in c?c[d]:null),b},h=function(c,d){var f=this,g=[],h=[];b&&h.push(new MediaPlayer.vo.protection.MediaCapability(b.codec)),a&&g.push(new MediaPlayer.vo.protection.MediaCapability(a.codec));var i,j=new MediaPlayer.vo.protection.KeySystemConfiguration(g,h,"optional","temporary"===f.sessionType?"optional":"required",[f.sessionType]),k=[];if(this.keySystem){for(i=0;i<c.length;i++)if(this.keySystem===c[i].ks){k.push({ks:c[i].ks,configs:[j]});var l={};l[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE]=function(a){a.error?d||f.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,error:"DRM: KeySystem Access Denied! -- "+a.error}):(f.log("KeySystem Access Granted"),f.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,data:a.data}),f.createKeySession(c[i].initData))},this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,l,void 0,!0),this.protectionModel.requestKeySystemAccess(k);break}}else if(void 0===this.keySystem){this.keySystem=null,e.push(c);for(var m=0;m<c.length;m++)k.push({ks:c[m].ks,configs:[j]});var n,o={};o[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE]=function(a){a.error?(f.keySystem=void 0,f.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,o),d||f.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,error:"DRM: KeySystem Access Denied! -- "+a.error})):(n=a.data,f.log("KeySystem Access Granted ("+n.keySystem.systemString+")!  Selecting key system..."),f.protectionModel.selectKeySystem(n))},o[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED]=function(a){if(a.error)f.keySystem=void 0,d||f.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,error:"DRM: Error selecting key system! -- "+a.error});else{f.keySystem=f.protectionModel.keySystem,f.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,data:n});for(var b=0;b<e.length;b++)for(i=0;i<e[b].length;i++)if(f.keySystem===e[b][i].ks){f.createKeySession(e[b][i].initData);break}}},this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,o,void 0,!0),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,o,void 0,!0),this.protectionModel.requestKeySystemAccess(k)}else e.push(c)},i=function(a,b){this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.LICENSE_REQUEST_COMPLETE,data:a,error:b})},j=function(a){if(a.error)return void this.log(a.error);var b=a.data;this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_MESSAGE,data:b});var c=b.messageType?b.messageType:"license-request",d=b.message,e=b.sessionToken,f=g(this.keySystem),h=this.keySystem.systemString,j=this.protectionExt.getLicenseServer(this.keySystem,f,c),k=i.bind(this),l={sessionToken:e,messageType:c};if(!j)return this.log("DRM: License server request not required for this message (type = "+a.data.messageType+").  Session ID = "+e.getSessionID()),void k(l);if(this.protectionExt.isClearKey(this.keySystem)){var m=this.protectionExt.processClearKeyLicenseRequest(f,d);if(m)return this.log("DRM: ClearKey license request handled by application!"),k(l),void this.protectionModel.updateKeySession(e,m)}var n=new XMLHttpRequest,o=this,p=null;if(f)if(f.serverURL){var q=f.serverURL;"string"==typeof q&&""!==q?p=q:"object"==typeof q&&q.hasOwnProperty(c)&&(p=q[c])}else f.laURL&&""!==f.laURL&&(p=f.laURL);else(p=this.keySystem.getLicenseServerURLFromInitData(MediaPlayer.dependencies.protection.CommonEncryption.getPSSHData(e.initData)))||(p=a.data.laURL);if(!(p=j.getServerURLFromMessage(p,d,c)))return void k(l,"DRM: No license server URL specified!");n.open(j.getHTTPMethod(c),p,!0),n.responseType=j.getResponseType(h,c),n.onload=function(){200==this.status?(k(l),o.protectionModel.updateKeySession(e,j.getLicenseMessage(this.response,h,c))):k(l,"DRM: "+h+' update, XHR status is "'+this.statusText+'" ('+this.status+"), expected to be 200. readyState is "+this.readyState+".  Response is "+(this.response?j.getErrorResponse(this.response,h,c):"NONE"))},n.onabort=function(){k(l,"DRM: "+h+' update, XHR aborted. status is "'+this.statusText+'" ('+this.status+"), readyState is "+this.readyState)},n.onerror=function(){k(l,"DRM: "+h+' update, XHR error. status is "'+this.statusText+'" ('+this.status+"), readyState is "+this.readyState)};var r=function(a){var b;if(a)for(b in a)"authorization"===b.toLowerCase()&&(n.withCredentials=!0),n.setRequestHeader(b,a[b])};f&&r(f.httpRequestHeaders),r(this.keySystem.getRequestHeadersFromMessage(d)),f&&f.withCredentials&&(n.withCredentials=!0),n.send(this.keySystem.getLicenseRequestFromMessage(d))},k=function(a){if("cenc"!==a.data.initDataType)return void this.log("DRM:  Only 'cenc' initData is supported!  Ignoring initData of type: "+a.data.initDataType);var b=a.data.initData;ArrayBuffer.isView(b)&&(b=b.buffer);var c=this.protectionExt.getSupportedKeySystems(b);return 0===c.length?void this.log("Received needkey event with initData, but we don't support any of the key systems!"):void h.call(this,c,!1)},l=function(a){a.error?this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.SERVER_CERTIFICATE_UPDATED,data:null,error:"DRM: Failed to update license server certificate. -- "+a.error}):(this.log("DRM: License server certificate successfully updated."),this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.SERVER_CERTIFICATE_UPDATED,data:null,error:null}))},m=function(a){a.error?this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CREATED,data:null,error:"DRM: Failed to create key session. -- "+a.error}):(this.log("DRM: Session created.  SessionID = "+a.data.getSessionID()),this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CREATED,data:a.data,error:null}))},n=function(){this.log("DRM: Key added."),this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_ADDED,data:null,error:null})},o=function(a){this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_ADDED,data:null,error:"DRM: MediaKeyError - sessionId: "+a.data.sessionToken.getSessionID()+".  "+a.data.error})},p=function(a){a.error?this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CLOSED,data:null,error:"DRM Failed to close key session. -- "+a.error}):(this.log("DRM: Session closed.  SessionID = "+a.data),this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CLOSED,data:a.data,error:null}))},q=function(a){a.error?this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_REMOVED,data:null,error:"DRM Failed to remove key session. -- "+a.error}):(this.log("DRM: Session removed.  SessionID = "+a.data),this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_REMOVED,data:a.data,error:null}))},r=function(a){this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_STATUSES_CHANGED,data:a.data,error:null})};return{system:void 0,log:void 0,protectionExt:void 0,keySystem:void 0,sessionType:"temporary",setup:function(){this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE]=j.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY]=k.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED]=l.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ADDED]=n.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR]=o.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED]=m.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED]=p.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED]=q.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED]=r.bind(this),d=this.protectionExt.getKeySystems(),this.protectionModel=this.system.getObject("protectionModel"),this.protectionModel.init(),this.eventBus=this.system.getObject("eventBusCl"),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ADDED,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED,this)},init:function(c,d,e){if(!f){var g,i;d||e||(g=this.system.getObject("adapter"),i=g.getStreamsInfo(c)[0]),a=d||(i?g.getMediaInfoForType(c,i,"audio"):null),b=e||(i?g.getMediaInfoForType(c,i,"video"):null);var j=b||a,k=this.protectionExt.getSupportedKeySystemsFromContentProtection(j.contentProtection);k&&k.length>0&&h.call(this,k,!0),f=!0}},addEventListener:function(a,b){this.eventBus.addEventListener(a,b)},removeEventListener:function(a,b){this.eventBus.removeEventListener(a,b)},teardown:function(){this.setMediaElement(null),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ADDED,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED,this),this.keySystem=void 0,this.protectionModel.teardown(),this.protectionModel=void 0},createKeySession:function(a){var b=MediaPlayer.dependencies.protection.CommonEncryption.getPSSHForKeySystem(this.keySystem,a);if(b){for(var c=this.protectionModel.getAllInitData(),d=0;d<c.length;d++)if(this.protectionExt.initDataEquals(b,c[d]))return void this.log("Ignoring initData because we have already seen it!");try{this.protectionModel.createKeySession(b,this.sessionType)}catch(a){this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CREATED,data:null,error:"Error creating key session! "+a.message})}}else this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CREATED,data:null,error:"Selected key system is "+this.keySystem.systemString+".  needkey/encrypted event contains no initData corresponding to that key system!"})},loadKeySession:function(a){this.protectionModel.loadKeySession(a)},removeKeySession:function(a){this.protectionModel.removeKeySession(a)},closeKeySession:function(a){this.protectionModel.closeKeySession(a)},setServerCertificate:function(a){this.protectionModel.setServerCertificate(a)},setMediaElement:function(a){a?(this.protectionModel.setMediaElement(a),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY,this)):null===a&&(this.protectionModel.setMediaElement(a),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY,this))},setSessionType:function(a){this.sessionType=a},setProtectionData:function(a){c=a}}},MediaPlayer.dependencies.ProtectionController.events={KEY_SYSTEM_SELECTED:"keySystemSelected",SERVER_CERTIFICATE_UPDATED:"serverCertificateUpdated",KEY_ADDED:"keyAdded",KEY_SESSION_CREATED:"keySessionCreated",KEY_SESSION_REMOVED:"keySessionRemoved",KEY_SESSION_CLOSED:"keySessionClosed",KEY_STATUSES_CHANGED:"keyStatusesChanged",KEY_MESSAGE:"keyMessage",
LICENSE_REQUEST_COMPLETE:"licenseRequestComplete"},MediaPlayer.dependencies.ProtectionController.prototype={constructor:MediaPlayer.dependencies.ProtectionController},MediaPlayer.dependencies.ScheduleController=function(){"use strict";var a,b,c,d,e,f=0,g=!0,h=null,i=!1,j=null,k=null,l=!0,m=function(a,b){var c=0,d=null;!1===l&&(d=k.start,c=a.getTime()-d.getTime(),k.duration=c,k.stopreason=b,l=!0)},n=function(){b&&(i=!1,g&&(g=!1),this.log("start"),w.call(this))},o=function(){g&&(r.call(this,e.quality),K.call(this,MediaPlayer.vo.metrics.PlayList.INITIAL_PLAY_START_REASON)),n.call(this)},p=function(a){i||(i=!0,this.log("stop"),a&&c.cancelPendingRequests(),m(new Date,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON))},q=function(a){var b=this,c=b.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.NEXT_FRAGMENT_RULES);b.rulesController.applyRules(c,b.streamProcessor,a,null,function(a,b){return b})},r=function(a){var b,d=this;return b=d.adapter.getInitRequest(d.streamProcessor,a),null!==b&&d.fragmentController.prepareFragmentForLoading(c,b),b},s=function(a){var b=this,c=b.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_SCHEDULE_RULES);b.rulesController.applyRules(c,b.streamProcessor,a,f,function(a,b){return a=a===MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE?0:a,Math.max(a,b)})},t=function(a){var b,d,f,g=a.length;for(f=0;g>f;f+=1)b=a[f],d=b.startTime+b.duration/2+.1,b=this.adapter.getFragmentRequestForTime(this.streamProcessor,e,d,{timeThreshold:0,ignoreIsFinished:!0}),this.fragmentController.prepareFragmentForLoading(c,b)},u=function(a){var b=this;return f=a.value,0>=f?void b.fragmentController.executePendingRequests():void q.call(b,v.bind(b))},v=function(a){var b=a.value;null===b||b instanceof MediaPlayer.vo.FragmentRequest||(b=this.adapter.getFragmentRequestForTime(this.streamProcessor,e,b.startTime)),b?(f--,this.fragmentController.prepareFragmentForLoading(c,b)):this.fragmentController.executePendingRequests()},w=function(){var a=(new Date).getTime(),b=!h||a-h>c.getLoadingTime();this.abrController.getPlaybackQuality(this.streamProcessor),!b||i||this.playbackController.isPaused()&&this.playbackController.getPlayedRanges().length>0&&(!this.scheduleWhilePaused||d)||(h=a,s.call(this,u.bind(this)))},x=function(a){a.error||(e=this.adapter.convertDataToTrack(this.manifestModel.getValue(),a.data.currentRepresentation))},y=function(a){a.error||(e=this.streamProcessor.getCurrentRepresentationInfo(),d&&null===this.liveEdgeFinder.getLiveEdge()||(b=!0),b&&o.call(this))},z=function(a){a.data.fragmentModel===this.streamProcessor.getFragmentModel()&&(this.log("Stream is complete"),m(new Date,MediaPlayer.vo.metrics.PlayList.Trace.END_OF_CONTENT_STOP_REASON))},A=function(a){var b=this;a.data.fragmentModel===b.streamProcessor.getFragmentModel()&&w.call(b)},B=function(a){a.error&&p.call(this)},C=function(){L.call(this)},D=function(){p.call(this,!1)},E=function(a){r.call(this,a.data.requiredQuality)},F=function(a){c.removeExecutedRequestsBeforeTime(a.data.to),a.data.hasEnoughSpaceToAppend&&n.call(this)},G=function(a){var b=this;a.data.hasSufficientBuffer||b.playbackController.isSeeking()||(b.log("Stalling Buffer"),m(new Date,MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON))},H=function(){w.call(this)},I=function(){p.call(this,!1)},J=function(b){if(a===b.data.mediaType&&this.streamProcessor.getStreamInfo().id===b.data.streamInfo.id){var d,f=this;if(d=c.cancelPendingRequests(b.data.oldQuality),null===(e=f.streamProcessor.getRepresentationInfoForQuality(b.data.newQuality))||void 0===e)throw"Unexpected error!";t.call(f,d),m(new Date,MediaPlayer.vo.metrics.PlayList.Trace.REPRESENTATION_SWITCH_STOP_REASON)}},K=function(b){var c=new Date,d=this.playbackController.getTime();m(c,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON),j=this.metricsModel.addPlayList(a,c,d,b)},L=function(){var a=this,b=a.playbackController.getTime(),c=a.playbackController.getPlaybackRate(),d=new Date;!0===l&&e&&j&&(l=!1,k=a.metricsModel.appendPlayListTrace(j,e.id,null,d,b,null,c,null))},M=function(a){var b=this,d=r.call(b,a.data.CCIndex);c.executeRequest(d)},N=function(){n.call(this)},O=function(a){g||c.cancelPendingRequests();var b=this.metricsModel.getMetricsFor("stream"),d=this.metricsExt.getCurrentManifestUpdate(b);this.log("seek: "+a.data.seekTime),K.call(this,MediaPlayer.vo.metrics.PlayList.SEEK_START_REASON),this.metricsModel.updateManifestUpdateInfo(d,{latency:e.DVRWindow.end-this.playbackController.getTime()})},P=function(){L.call(this)},Q=function(){w.call(this)},R=function(a){if(!a.error){var c,d,f=this,g=a.data.liveEdge,h=e.mediaInfo.streamInfo.manifestInfo,i=g-Math.min(f.playbackController.getLiveDelay(e.fragmentDuration),h.DVRWindowSize/2),j=f.metricsModel.getMetricsFor("stream"),k=f.metricsExt.getCurrentManifestUpdate(j),l=f.playbackController.getLiveStartTime();c=f.adapter.getFragmentRequestForTime(f.streamProcessor,e,i,{ignoreIsFinished:!0}),d=c.startTime,(isNaN(l)||d>l)&&f.playbackController.setLiveStartTime(d),f.metricsModel.updateManifestUpdateInfo(k,{currentTime:d,presentationStartTime:g,latency:g-d,clientTimeOffset:f.timelineConverter.getClientTimeOffset()}),b=!0}};return{log:void 0,system:void 0,metricsModel:void 0,manifestModel:void 0,metricsExt:void 0,scheduleWhilePaused:void 0,timelineConverter:void 0,abrController:void 0,playbackController:void 0,adapter:void 0,scheduleRulesCollection:void 0,rulesController:void 0,numOfParallelRequestAllowed:void 0,setup:function(){this[MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED]=R,this[MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED]=J,this[Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_STARTED]=D,this[Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED]=x,this[MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED]=y,this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADING_START]=A,this[MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED]=B,this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED]=z,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_CLEARED]=F,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED]=C,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED]=G,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED]=H,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_INIT_REQUESTED]=E,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_QUOTA_EXCEEDED]=I,this[MediaPlayer.dependencies.TextController.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED]=M,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED]=N,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING]=O,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED]=P,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED]=Q},initialize:function(b,e){var f=this;a=b,f.setMediaType(a),f.streamProcessor=e,f.fragmentController=e.fragmentController,f.liveEdgeFinder=e.liveEdgeFinder,f.bufferController=e.bufferController,d=e.isDynamic(),c=this.fragmentController.getModel(this),MediaPlayer.dependencies.ScheduleController.LOADING_REQUEST_THRESHOLD=f.numOfParallelRequestAllowed,f.scheduleRulesCollection.bufferLevelRule&&f.scheduleRulesCollection.bufferLevelRule.setScheduleController(f),f.scheduleRulesCollection.pendingRequestsRule&&f.scheduleRulesCollection.pendingRequestsRule.setScheduleController(f),f.scheduleRulesCollection.playbackTimeRule&&f.scheduleRulesCollection.playbackTimeRule.setScheduleController(f)},getFragmentModel:function(){return c},getFragmentToLoadCount:function(){return f},replaceCanceledRequests:t,reset:function(){var a=this;p.call(a,!0),a.bufferController.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN,a.scheduleRulesCollection.bufferLevelRule),a.bufferController.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED,a.scheduleRulesCollection.bufferLevelRule),c.abortRequests(),a.fragmentController.detachModel(c),f=0},start:n,stop:p}},MediaPlayer.dependencies.ScheduleController.prototype={constructor:MediaPlayer.dependencies.ScheduleController},MediaPlayer.dependencies.ScheduleController.LOADING_REQUEST_THRESHOLD=0,MediaPlayer.dependencies.StreamController=function(){"use strict";var a,b,c,d,e,f,g=[],h=!1,i=.2,j=!0,k=!1,l=!1,m=!1,n=!1,o=function(a){this.system.getObject("mediaController").subscribe(MediaPlayer.dependencies.MediaController.eventList.CURRENT_TRACK_CHANGED,a),a.subscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,this.liveEdgeFinder),a.subscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_BUFFERING_COMPLETED,this)},p=function(a){a.unsubscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,this.liveEdgeFinder),a.unsubscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_BUFFERING_COMPLETED,this)},q=function(a,b,c){this.eventBus.dispatchEvent({type:a,data:{fromStreamInfo:b?b.getStreamInfo():null,toStreamInfo:c.getStreamInfo()}})},r=function(){a.isActivated()&&k&&0===a.getStreamInfo().index&&(a.startEventController(),j&&this.playbackController.start())},s=function(){k=!0,r.call(this)},t=function(a){var b=a.data.error?a.data.error.code:0,c="";if(-1!==b){switch(b){case 1:c="MEDIA_ERR_ABORTED";break;case 2:c="MEDIA_ERR_NETWORK";break;case 3:c="MEDIA_ERR_DECODE";break;case 4:c="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:c="MEDIA_ERR_ENCRYPTED";break;default:c="UNKNOWN"}n=!0,this.log("Video Element Error: "+c),a.error&&this.log(a.error),this.errHandler.mediaSourceError(c),this.reset()}},u=function(a){var b=this,c=b.videoExt.getPlaybackQuality(b.videoModel.getElement());c&&b.metricsModel.addDroppedFrames("video",c),b.playbackController.isSeeking()||a.data.timeToEnd<i&&this.mediaSourceExt.signalEndOfStream(d)},v=function(){A.call(this,a,y())},w=function(b){var c=z(b.data.seekTime);c&&c!==a&&A.call(this,a,c,b.data.seekTime)},x=function(a){var b=y(),c=a.data.streamInfo.isLast;d&&c&&this.mediaSourceExt.signalEndOfStream(d),b&&b.activate(d)},y=function(){var b=a.getStreamInfo().start,c=a.getStreamInfo().duration;return g.filter(function(a){return a.getStreamInfo().start===b+c})[0]},z=function(a){var b=0,c=null,d=g.length;d>0&&(b+=g[0].getStartTime());for(var e=0;d>e;e++)if(c=g[e],(b+=c.getDuration())>a)return c;return null},A=function(b,c,d){if(!l&&b&&c&&b!==c){q.call(this,MediaPlayer.events.STREAM_SWITCH_STARTED,b,c),l=!0;var e=this,f=function(){void 0!==d&&e.playbackController.seek(d),e.playbackController.start(),a.startEventController(),l=!1,q.call(e,MediaPlayer.events.STREAM_SWITCH_COMPLETED,b,c)};setTimeout(function(){p.call(e,b),b.deactivate(),a=c,o.call(e,c),e.playbackController.initialize(a.getStreamInfo()),B.call(e,f)},0)}},B=function(b){var c,e=this,f=function(g){e.log("MediaSource is open!"),e.log(g),window.URL.revokeObjectURL(c),d.removeEventListener("sourceopen",f),d.removeEventListener("webkitsourceopen",f),C.call(e),a.activate(d),b&&b()};d?e.mediaSourceExt.detachMediaSource(e.videoModel):d=e.mediaSourceExt.createMediaSource(),d.addEventListener("sourceopen",f,!1),d.addEventListener("webkitsourceopen",f,!1),c=e.mediaSourceExt.attachMediaSource(d,e.videoModel)},C=function(){var b,c,e=this;b=a.getStreamInfo().manifestInfo.duration,c=e.mediaSourceExt.setDuration(d,b),e.log("Duration successfully set to: "+c)},D=function(){var e,f,i,j,k,l,n,p=this,r=p.manifestModel.getValue(),s=p.metricsModel.getMetricsFor("stream"),t=p.metricsExt.getCurrentManifestUpdate(s),u=[];if(r){l=p.adapter.getStreamsInfo(r),this.capabilities.supportsEncryptedMedia()&&(b||(b=this.system.getObject("protectionController"),this.eventBus.dispatchEvent({type:MediaPlayer.events.PROTECTION_CREATED,data:{controller:b,manifest:r}}),h=!0),b.setMediaElement(this.videoModel.getElement()),c&&b.setProtectionData(c));try{if(0===l.length)throw new Error("There are no streams");for(p.metricsModel.updateManifestUpdateInfo(t,{currentTime:p.videoModel.getCurrentTime(),buffered:p.videoModel.getElement().buffered,presentationStartTime:l[0].start,clientTimeOffset:p.timelineConverter.getClientTimeOffset()}),m=!0,j=0,f=l.length;f>j;j+=1){for(e=l[j],k=0,i=g.length;i>k;k+=1)g[k].getId()===e.id&&(n=g[k],u.push(n),n.updateData(e));n||(n=p.system.getObject("stream"),n.initialize(e,b,c),n.subscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,p),u.push(n),a&&n.updateData(e)),p.metricsModel.addManifestUpdateStreamInfo(t,e.id,e.index,e.start,e.duration),n=null}g=u,a||(a=g[0],q.call(p,MediaPlayer.events.STREAM_SWITCH_STARTED,null,a),p.playbackController.initialize(a.getStreamInfo()),o.call(p,a),q.call(p,MediaPlayer.events.STREAM_SWITCH_COMPLETED,null,a)),d||B.call(this),m=!1,E.call(p)}catch(a){p.errHandler.manifestError(a.message,"nostreamscomposed",r),p.reset()}}},E=function(){if(!m){var a=this,b=g.length,c=0;for(r.call(this),c;b>c;c+=1)if(!g[c].isInitialized())return;a.notify(MediaPlayer.dependencies.StreamController.eventList.ENAME_STREAMS_COMPOSED)}},F=function(){E.call(this)},G=function(){D.call(this)},H=function(a){if(a.error)this.reset();else{this.log("Manifest has loaded.");var b=a.data.manifest,c=this.adapter.getStreamsInfo(b)[0],d=this.adapter.getMediaInfoForType(b,c,"video")||this.adapter.getMediaInfoForType(b,c,"audio"),g=this.adapter.getDataForMedia(d),h=this.manifestExt.getRepresentationsForAdaptation(b,g)[0].useCalculatedLiveEdgeTime;h&&(this.log("SegmentTimeline detected using calculated Live Edge Time"),f=!1);var i=this.manifestExt.getUTCTimingSources(a.data.manifest),j=!this.manifestExt.getIsDynamic(b)||h?i:i.concat(e);this.timeSyncController.initialize(h?i:j,f)}};return{system:void 0,capabilities:void 0,videoModel:void 0,manifestUpdater:void 0,manifestLoader:void 0,manifestModel:void 0,manifestExt:void 0,adapter:void 0,playbackController:void 0,log:void 0,metricsModel:void 0,metricsExt:void 0,videoExt:void 0,liveEdgeFinder:void 0,mediaSourceExt:void 0,timelineConverter:void 0,protectionExt:void 0,timeSyncController:void 0,virtualBuffer:void 0,errHandler:void 0,eventBus:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this[MediaPlayer.dependencies.ManifestUpdater.eventList.ENAME_MANIFEST_UPDATED]=H,this[MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED]=F,this[MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_BUFFERING_COMPLETED]=x,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING]=w,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED]=u,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ENDED]=v,this[MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED]=G,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_CAN_PLAY]=s,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ERROR]=t},getAutoPlay:function(){return j},getActiveStreamInfo:function(){return a?a.getStreamInfo():null},isStreamActive:function(b){return a.getId()===b.id},setUTCTimingSources:function(a,b){e=a,f=b},getStreamById:function(a){return g.filter(function(b){return b.getId()===a})[0]},initialize:function(a,d,e){j=a,b=d,c=e,this.timeSyncController.subscribe(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,this.timelineConverter),this.timeSyncController.subscribe(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,this.liveEdgeFinder),this.timeSyncController.subscribe(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,this),this.playbackController.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED,this.manifestUpdater),this.playbackController.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PAUSED,this.manifestUpdater),this.playbackController.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ENDED,this),this.subscribe(MediaPlayer.dependencies.StreamController.eventList.ENAME_STREAMS_COMPOSED,this.manifestUpdater),this.manifestUpdater.subscribe(MediaPlayer.dependencies.ManifestUpdater.eventList.ENAME_MANIFEST_UPDATED,this),this.manifestUpdater.initialize(this.manifestLoader)},load:function(a){this.manifestLoader.load(a)},loadWithManifest:function(a){this.manifestUpdater.setManifest(a)},reset:function(){a&&p.call(this,a);var e,f=this.system.getObject("mediaController");this.timeSyncController.unsubscribe(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,this.timelineConverter),this.timeSyncController.unsubscribe(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,this.liveEdgeFinder),this.timeSyncController.unsubscribe(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,this),this.timeSyncController.reset();for(var i=0,j=g.length;j>i;i++)e=g[i],e.unsubscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,this),f.unsubscribe(MediaPlayer.dependencies.MediaController.eventList.CURRENT_TRACK_CHANGED,e),e.reset(n);g=[],this.unsubscribe(MediaPlayer.dependencies.StreamController.eventList.ENAME_STREAMS_COMPOSED,this.manifestUpdater),this.playbackController.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED,this.manifestUpdater),this.playbackController.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PAUSED,this.manifestUpdater),this.playbackController.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ENDED,this),this.manifestUpdater.unsubscribe(MediaPlayer.dependencies.ManifestUpdater.eventList.ENAME_MANIFEST_UPDATED,this),this.manifestUpdater.reset(),this.metricsModel.clearAllCurrentMetrics();var o=this.manifestModel.getValue()?this.manifestModel.getValue().url:null;if(this.manifestModel.setValue(null),this.timelineConverter.reset(),this.liveEdgeFinder.reset(),this.adapter.reset(),this.virtualBuffer.reset(),l=!1,m=!1,a=null,k=!1,n=!1,d&&(this.mediaSourceExt.detachMediaSource(this.videoModel),d=null),b)if(h){var q={},r=this;q[MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE]=function(){h=!1,b=null,c=null,o&&r.eventBus.dispatchEvent({type:MediaPlayer.events.PROTECTION_DESTROYED,data:o}),r.notify(MediaPlayer.dependencies.StreamController.eventList.ENAME_TEARDOWN_COMPLETE)},b.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE,q,void 0,!0),b.teardown()}else b.setMediaElement(null),b=null,c=null,this.notify(MediaPlayer.dependencies.StreamController.eventList.ENAME_TEARDOWN_COMPLETE);else this.notify(MediaPlayer.dependencies.StreamController.eventList.ENAME_TEARDOWN_COMPLETE)}}},MediaPlayer.dependencies.StreamController.prototype={constructor:MediaPlayer.dependencies.StreamController},MediaPlayer.dependencies.StreamController.eventList={ENAME_STREAMS_COMPOSED:"streamsComposed",ENAME_TEARDOWN_COMPLETE:"streamTeardownComplete"},MediaPlayer.dependencies.TextController=function(){var a=!1,b=null,c=null,d=null,e=function(){this.notify(MediaPlayer.dependencies.TextController.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,{CCIndex:0})},f=function(a){var b=this;a.data.fragmentModel===b.streamProcessor.getFragmentModel()&&a.data.chunk.bytes&&b.sourceBufferExt.append(c,a.data.chunk)};return{sourceBufferExt:void 0,log:void 0,system:void 0,errHandler:void 0,videoModel:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this[Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED]=e,this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_INIT_FRAGMENT_LOADED]=f},initialize:function(a,b,c){var e=this;d=a,e.setMediaSource(b),e.representationController=c.representationController,e.streamProcessor=c},createBuffer:function(e){try{c=this.sourceBufferExt.createSourceBuffer(b,e),a||(c.hasOwnProperty("initialize")&&c.initialize(d,this),a=!0)}catch(a){this.errHandler.mediaSourceError("Error creating "+d+" source buffer.")}return c},getBuffer:function(){return c},setBuffer:function(a){c=a},setMediaSource:function(a){b=a},reset:function(a){a||(this.sourceBufferExt.abort(b,c),this.sourceBufferExt.removeSourceBuffer(b,c))}}},MediaPlayer.dependencies.TextController.prototype={constructor:MediaPlayer.dependencies.TextController},MediaPlayer.dependencies.TextController.eventList={ENAME_CLOSED_CAPTIONING_REQUESTED:"closedCaptioningRequested"},MediaPlayer.dependencies.XlinkController=function(){"use strict";var a,b,c,d,e="onLoad",f="onActuate",g="Period",h="AdaptationSet",i="EventStream",j="urn:mpeg:dash:resolve-to-zero:2013",k=function(b){var f,h=this;d=new X2JS(a,"",!0),c=b,f=o(c.Period_asArray,c,g,e),l.call(h,f,g,e)},l=function(a,b,c){var d,e,f,g=this,h={};for(h.elements=a,h.type=b,h.resolveType=c,0===h.elements.length&&n.call(g,h),f=0;f<h.elements.length;f+=1)d=h.elements[f],e=-1!==d.url.indexOf("http://")?d.url:d.originalContent.BaseURL+d.url,g.xlinkLoader.load(e,d,h)},m=function(a){var b,c,e,f="";b=a.data.element,c=a.data.resolveObject,b.resolvedContent&&(e=b.resolvedContent.indexOf(">")+1,f=b.resolvedContent.substr(0,e)+"<response>"+b.resolvedContent.substr(e)+"</response>",b.resolvedContent=d.xml_str2json(f)),r.call(this,c)&&n.call(this,c)},n=function(a){var b,d,j=[];if(p.call(this,a),a.resolveType===f&&this.notify(MediaPlayer.dependencies.XlinkController.eventList.ENAME_XLINK_READY,{manifest:c}),a.resolveType===e)switch(a.type){case g:for(b=0;b<c[g+"_asArray"].length;b++)d=c[g+"_asArray"][b],d.hasOwnProperty(h+"_asArray")&&(j=j.concat(o.call(this,d[h+"_asArray"],d,h,e))),d.hasOwnProperty(i+"_asArray")&&(j=j.concat(o.call(this,d[i+"_asArray"],d,i,e)));l.call(this,j,h,e);break;case h:this.notify(MediaPlayer.dependencies.XlinkController.eventList.ENAME_XLINK_READY,{manifest:c})}},o=function(a,b,c,d){var e,f,g,h=[];for(f=a.length-1;f>=0;f-=1)e=a[f],e.hasOwnProperty("xlink:href")&&e["xlink:href"]===j&&a.splice(f,1);for(f=0;f<a.length;f++)e=a[f],e.hasOwnProperty("xlink:href")&&e.hasOwnProperty("xlink:actuate")&&e["xlink:actuate"]===d&&(g=q(e["xlink:href"],b,c,f,d,e),h.push(g));return h},p=function(a){var d,e,f,g,h,i,j=[];for(g=a.elements.length-1;g>=0;g--){if(d=a.elements[g],e=d.type+"_asArray",!d.resolvedContent||s())delete d.originalContent["xlink:actuate"],delete d.originalContent["xlink:href"],j.push(d.originalContent);else if(d.resolvedContent)for(h=0;h<d.resolvedContent[e].length;h++)f=d.resolvedContent[e][h],j.push(f);for(d.parentElement[e].splice(d.index,1),i=0;i<j.length;i++)d.parentElement[e].splice(d.index+i,0,j[i]);j=[]}a.elements.length>0&&b.run(c)},q=function(a,b,c,d,e,f){return{url:a,parentElement:b,type:c,index:d,resolveType:e,originalContent:f,resolvedContent:null,resolved:!1}},r=function(a){var b,c;for(b=0;b<a.elements.length;b++)if(c=a.elements[b],!1===c.resolved)return!1;return!0},s=function(){return!1};return{xlinkLoader:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){m=m.bind(this),this.xlinkLoader.subscribe(MediaPlayer.dependencies.XlinkLoader.eventList.ENAME_XLINKELEMENT_LOADED,this,m)},resolveManifestOnLoad:function(a){k.call(this,a)},setMatchers:function(b){a=b},setIron:function(a){b=a}}},MediaPlayer.dependencies.XlinkController.prototype={constructor:MediaPlayer.dependencies.XlinkController},MediaPlayer.dependencies.XlinkController.eventList={ENAME_XLINK_ALLELEMENTSLOADED:"xlinkAllElementsLoaded",ENAME_XLINK_READY:"xlinkReady"},MediaPlayer.dependencies.MediaSourceExtensions=function(){"use strict"},MediaPlayer.dependencies.MediaSourceExtensions.prototype={constructor:MediaPlayer.dependencies.MediaSourceExtensions,createMediaSource:function(){"use strict";var a="WebKitMediaSource"in window;return"MediaSource"in window?new MediaSource:a?new WebKitMediaSource:null},attachMediaSource:function(a,b){"use strict";var c=window.URL.createObjectURL(a);return b.setSource(c),c},detachMediaSource:function(a){"use strict";a.setSource("")},setDuration:function(a,b){"use strict";return a.duration!=b&&(a.duration=b),a.duration},signalEndOfStream:function(a){"use strict";var b=a.sourceBuffers,c=b.length,d=0;if("open"===a.readyState){for(d;c>d;d+=1)if(b[d].updating)return;a.endOfStream()}}},MediaPlayer.dependencies.ProtectionExtensions=function(){"use strict";this.system=void 0,this.log=void 0,this.keySystems=[],this.notify=void 0,this.subscribe=void 0,this.unsubscribe=void 0,this.clearkeyKeySystem=void 0},MediaPlayer.dependencies.ProtectionExtensions.prototype={constructor:MediaPlayer.dependencies.ProtectionExtensions,setup:function(){var a;a=this.system.getObject("ksPlayReady"),this.keySystems.push(a),a=this.system.getObject("ksWidevine"),this.keySystems.push(a),a=this.system.getObject("ksClearKey"),this.keySystems.push(a),this.clearkeyKeySystem=a},getKeySystems:function(){return this.keySystems},getKeySystemBySystemString:function(a){for(var b=0;b<this.keySystems.length;b++)if(this.keySystems[b].systemString===a)return this.keySystems[b];return null},isClearKey:function(a){return a===this.clearkeyKeySystem},initDataEquals:function(a,b){if(a.byteLength===b.byteLength){for(var c=new Uint8Array(a),d=new Uint8Array(b),e=0;e<c.length;e++)if(c[e]!==d[e])return!1;return!0}return!1},getSupportedKeySystemsFromContentProtection:function(a){var b,c,d,e,f=[];if(a)for(d=0;d<this.keySystems.length;++d)for(c=this.keySystems[d],e=0;e<a.length;++e)if(b=a[e],b.schemeIdUri.toLowerCase()===c.schemeIdURI){var g=c.getInitData(b);g&&f.push({ks:this.keySystems[d],initData:g})}return f},getSupportedKeySystems:function(a){var b,c=[],d=MediaPlayer.dependencies.protection.CommonEncryption.parsePSSHList(a);for(b=0;b<this.keySystems.length;++b)this.keySystems[b].uuid in d&&c.push({ks:this.keySystems[b],initData:d[this.keySystems[b].uuid]});return c},getLicenseServer:function(a,b,c){if("license-release"===c||"individualization-request"==c)return null;var d=null;return b&&b.hasOwnProperty("drmtoday")?d=this.system.getObject("serverDRMToday"):"com.widevine.alpha"===a.systemString?d=this.system.getObject("serverWidevine"):"com.microsoft.playready"===a.systemString?d=this.system.getObject("serverPlayReady"):"org.w3.clearkey"===a.systemString&&(d=this.system.getObject("serverClearKey")),d},processClearKeyLicenseRequest:function(a,b){try{return MediaPlayer.dependencies.protection.KeySystem_ClearKey.getClearKeysFromProtectionData(a,b)}catch(a){return this.log("Failed to retrieve clearkeys from ProtectionData"),null}}},MediaPlayer.dependencies.RequestModifierExtensions=function(){"use strict";return{modifyRequestURL:function(a){return a},modifyRequestHeader:function(a){return a}}},MediaPlayer.dependencies.SourceBufferExtensions=function(){"use strict";this.system=void 0,this.notify=void 0,this.subscribe=void 0,this.unsubscribe=void 0,this.manifestExt=void 0},MediaPlayer.dependencies.SourceBufferExtensions.prototype={constructor:MediaPlayer.dependencies.SourceBufferExtensions,createSourceBuffer:function(a,b){"use strict";var c=this,d=b.codec,e=null;try{if(d.match(/application\/mp4;\s*codecs="stpp"/i))throw new Error("not really supported");e=a.addSourceBuffer(d)}catch(a){if(!b.isText&&-1===d.indexOf('codecs="stpp"'))throw a;e=c.system.getObject("textSourceBuffer")}return e},removeSourceBuffer:function(a,b){"use strict";try{a.removeSourceBuffer(b)}catch(a){}},getBufferRange:function(a,b,c){"use strict";var d,e,f=null,g=0,h=0,i=null,j=null,k=0,l=c||.15;try{f=a.buffered}catch(a){return null}if(null!==f&&void 0!==f){for(e=0,d=f.length;d>e;e+=1)if(g=f.start(e),h=f.end(e),null===i)k=Math.abs(g-b),b>=g&&h>b?(i=g,j=h):l>=k&&(i=g,j=h);else{if(k=g-j,!(l>=k))break;j=h}if(null!==i)return{start:i,end:j}}return null},getAllRanges:function(a){try{return a.buffered}catch(a){return null}},getTotalBufferedTime:function(a){var b,c,d=this.getAllRanges(a),e=0;if(!d)return e;for(c=0,b=d.length;b>c;c+=1)e+=d.end(c)-d.start(c);return e},getBufferLength:function(a,b,c){"use strict";var d;return d=this.getBufferRange(a,b,c),null===d?0:d.end-b},getRangeDifference:function(a,b){if(!b)return null;var c,d,e,f,g,h,i,j,k,l=this.getAllRanges(b);if(!l)return null;for(var m=0,n=l.length;n>m;m+=1){if(j=a.length>m,g=j?{start:a.start(m),end:a.end(m)}:null,c=l.start(m),d=l.end(m),!g)return k={start:c,end:d};if(e=g.start===c,f=g.end===d,!e||!f){if(e)k={start:g.end,end:d};else{if(!f)return k={start:c,end:d};k={start:c,end:g.start}}return h=a.length>m+1?{start:a.start(m+1),end:a.end(m+1)}:null,i=n>m+1?{start:l.start(m+1),end:l.end(m+1)}:null,!h||i&&i.start===h.start&&i.end===h.end||(k.end=h.start),k}}return null},waitForUpdateEnd:function(a,b){"use strict";var c,d=50,e=function(){a.updating||(clearInterval(c),b())},f=function(){a.updating||(a.removeEventListener("updateend",f,!1),b())};if(!a.updating)return void b();if("function"==typeof a.addEventListener)try{a.addEventListener("updateend",f,!1)}catch(a){c=setInterval(e,d)}else c=setInterval(e,d)},append:function(a,b){var c=this,d=b.bytes,e="append"in a?"append":"appendBuffer"in a?"appendBuffer":null,f="Object"===Object.prototype.toString.call(a).slice(8,-1);if(e)try{c.waitForUpdateEnd(a,function(){f?a[e](d,b):a[e](d),c.waitForUpdateEnd(a,function(){c.notify(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,{buffer:a,bytes:d})})})}catch(b){c.notify(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,{buffer:a,bytes:d},new MediaPlayer.vo.Error(b.code,b.message,null))}},remove:function(a,b,c,d){var e=this;try{e.waitForUpdateEnd(a,function(){b>=0&&c>b&&"ended"!==d.readyState&&a.remove(b,c),e.waitForUpdateEnd(a,function(){e.notify(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,{buffer:a,from:b,to:c})})})}catch(d){e.notify(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,{buffer:a,from:b,to:c},new MediaPlayer.vo.Error(d.code,d.message,null))}},abort:function(a,b){"use strict";try{"open"===a.readyState&&b.abort()}catch(a){}}},MediaPlayer.dependencies.SourceBufferExtensions.QUOTA_EXCEEDED_ERROR_CODE=22,MediaPlayer.dependencies.SourceBufferExtensions.eventList={ENAME_SOURCEBUFFER_REMOVE_COMPLETED:"sourceBufferRemoveCompleted",ENAME_SOURCEBUFFER_APPEND_COMPLETED:"sourceBufferAppendCompleted"},MediaPlayer.utils.TextTrackExtensions=function(){"use strict";var a,b,c=[],d=[],e=-1,f=0,g=0,h=null,i=null,j=!1,k=function(a){var d=c[a].kind,e=void 0!==c[a].label?c[a].label:c[a].lang,f=c[a].lang,g=j?b.addTextTrack(d,e,f):document.createElement("track");return j||(g.kind=d,g.label=e,g.srclang=f),g};return{mediaController:void 0,videoModel:void 0,eventBus:void 0,setup:function(){a=window.VTTCue||window.TextTrackCue,j=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./)},addTextTrack:function(a,f){if(c.push(a),void 0===b&&(b=a.video),h=this.videoModel.getTTMLRenderingDiv(),c.length===f){for(var g=0,i=0;i<c.length;i++){var l=k(i);e=i,d.push(l),c[i].defaultTrack&&(l.default=!0,g=i),j||b.appendChild(l),this.addCaptions(0,c[i].captionData),this.eventBus.dispatchEvent({type:MediaPlayer.events.TEXT_TRACK_ADDED})}e=g,this.eventBus.dispatchEvent({type:MediaPlayer.events.TEXT_TRACKS_ADDED,data:{index:e,tracks:c}})}},checkVideoSize:function(){var a=this.getCurrentTextTrack();if(a&&"html"===a.renderingType){var c=b.clientWidth,d=b.clientHeight;if(c!=f||d!=g){f=c,g=d,h.style.width=f+"px",h.style.height=g+"px";for(var e=0;e<a.activeCues.length;++e){var i=a.activeCues[e];i.scaleCue(i)}}}},scaleCue:function(a){var b,c,d,e=f,h=g,i=[e/a.cellResolution[0],h/a.cellResolution[1]]
;if(a.linePadding)for(b in a.linePadding)if(a.linePadding.hasOwnProperty(b)){var j=a.linePadding[b];c=(j*i[0]).toString();for(var k=document.getElementsByClassName("spanPadding"),l=0;l<k.length;l++)k[l].style.cssText=k[l].style.cssText.replace(/(padding-left\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+c),k[l].style.cssText=k[l].style.cssText.replace(/(padding-right\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+c)}if(a.fontSize)for(b in a.fontSize)if(a.fontSize.hasOwnProperty(b)){var m=a.fontSize[b]/100;c=(m*i[1]).toString(),d="defaultFontSize"!==b?document.getElementsByClassName(b):document.getElementsByClassName("paragraph");for(var n=0;n<d.length;n++)d[n].style.cssText=d[n].style.cssText.replace(/(font-size\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+c)}if(a.lineHeight)for(b in a.lineHeight)if(a.lineHeight.hasOwnProperty(b)){var o=a.lineHeight[b]/100;c=(o*i[1]).toString(),d=document.getElementsByClassName(b);for(var p=0;p<d.length;p++)d[p].style.cssText=d[p].style.cssText.replace(/(line-height\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+c)}},addCaptions:function(d,f){var g=this.getCurrentTextTrack();if(g){g.mode="showing";for(var j in f){var k,l=f[j];i||"html"!=l.type||(i=setInterval(this.checkVideoSize.bind(this),500)),"image"==l.type?(k=new a(l.start-d,l.end-d,""),k.image=l.data,k.id=l.id,k.size=0,k.type="image",k.onenter=function(){var a=new Image;a.id="ttmlImage_"+this.id,a.src=this.image,a.className="cue-image",h?h.appendChild(a):b.parentNode.appendChild(a)},k.onexit=function(){var a,c,d;for(a=h||b.parentNode,d=a.childNodes,c=0;c<d.length;c++)d[c].id=="ttmlImage_"+this.id&&a.removeChild(d[c])}):"html"==l.type?("html"!==g.renderingType&&(g.renderingType="html"),a!==window.TextTrackCue&&(document.getElementById("caption-style")?document.getElementById("caption-style").sheet.cssRules.length||this.setCueStyle():this.setCueStyle()),k=new a(l.start-d,l.end-d,""),k.cueHTMLElement=l.cueHTMLElement,k.regions=l.regions,k.regionID=l.regionID,k.cueID=l.cueID,k.videoWidth=l.videoWidth,k.videoHeight=l.videoHeight,k.cellResolution=l.cellResolution,k.fontSize=l.fontSize,k.lineHeight=l.lineHeight,k.linePadding=l.linePadding,k.scaleCue=this.scaleCue,h.style.width=b.clientWidth+"px",h.style.height=b.clientHeight+"px",k.onenter=function(){"showing"==g.mode&&(h.appendChild(this.cueHTMLElement),this.scaleCue(this))},k.onexit=function(){for(var a=h.childNodes,b=0;b<a.length;++b)a[b].id=="subtitle_"+this.cueID&&h.removeChild(a[b])}):(k=new a(l.start-d,l.end-d,l.data),l.styles&&(void 0!==l.styles.align&&k.hasOwnProperty("align")&&(k.align=l.styles.align),void 0!==l.styles.line&&k.hasOwnProperty("line")&&(k.line=l.styles.line),void 0!==l.styles.position&&k.hasOwnProperty("position")&&(k.position=l.styles.position),void 0!==l.styles.size&&k.hasOwnProperty("size")&&(k.size=l.styles.size))),g.addCue(k)}c[e].isFragmented||(g.mode=c[e].defaultTrack?"showing":"hidden")}},getCurrentTextTrack:function(){return e>=0?b.textTracks[e]:null},getCurrentTrackIdx:function(){return e},setCurrentTrackIdx:function(a){e=a},getTextTrack:function(a){return b.textTracks[a]},deleteTrackCues:function(a){if(a.cues){for(var b=a.cues,c=b.length-1,d=c;d>=0;d--)a.removeCue(b[d]);a.mode="disabled"}},deleteAllTextTracks:function(){for(var a=d.length,e=0;a>e;e++)j?this.deleteTrackCues(this.getTextTrack(e)):b.removeChild(d[e]);d=[],c=[],i&&(clearInterval(i),i=null)},deleteTextTrack:function(a){b.removeChild(d[a]),d.splice(a,1)},setCueStyle:function(){var a;document.getElementById("caption-style")?a=document.getElementById("caption-style"):(a=document.createElement("style"),a.id="caption-style"),document.head.appendChild(a);var c=a.sheet;b.id?c.addRule("#"+b.id+"::cue","background: transparent"):0!==b.classList.length?c.addRule("."+b.className+"::cue","background: transparent"):c.addRule("video::cue","background: transparent")},removeCueStyle:function(){if(a!==window.TextTrackCue){var b=document.getElementById("caption-style").sheet;b.cssRules&&b.cssRules.length>0&&b.deleteRule(0)}},clearCues:function(){for(;h.firstChild;)h.removeChild(h.firstChild)}}},MediaPlayer.dependencies.VideoModelExtensions=function(){"use strict";return{getPlaybackQuality:function(a){var b="webkitDroppedFrameCount"in a,c="getVideoPlaybackQuality"in a,d=null;return c?d=a.getVideoPlaybackQuality():b&&(d={droppedVideoFrames:a.webkitDroppedFrameCount,creationTime:new Date}),d}}},MediaPlayer.dependencies.VideoModelExtensions.prototype={constructor:MediaPlayer.dependencies.VideoModelExtensions},MediaPlayer.dependencies.FragmentModel=function(){"use strict";var a=null,b=[],c=[],d=[],e=[],f=!1,g=function(a){var b=this;b.notify(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_STARTED,{request:a}),b.fragmentLoader.load(a)},h=function(a,b){var c=a.indexOf(b);-1!==c&&a.splice(c,1)},i=function(a,b,c){var d,e=a.length-1,f=NaN,g=NaN,h=null;for(d=e;d>=0;d-=1)if(h=a[d],f=h.startTime,g=f+h.duration,c=c||h.duration/2,!isNaN(f)&&!isNaN(g)&&b+c>=f&&g>b-c||isNaN(f)&&isNaN(b))return h;return null},j=function(a,b){return b?b.hasOwnProperty("time")?[i.call(this,a,b.time,b.threshold)]:a.filter(function(a){for(var c in b)if("state"!==c&&b.hasOwnProperty(c)&&a[c]!=b[c])return!1;return!0}):a},k=function(a){var f;switch(a){case MediaPlayer.dependencies.FragmentModel.states.PENDING:f=c;break;case MediaPlayer.dependencies.FragmentModel.states.LOADING:f=d;break;case MediaPlayer.dependencies.FragmentModel.states.EXECUTED:f=b;break;case MediaPlayer.dependencies.FragmentModel.states.REJECTED:f=e;break;default:f=[]}return f},l=function(a,f){if(a){var g=a.mediaType,h=new Date,i=a.type,j=a.startTime,k=a.availabilityStartTime,l=a.duration,m=a.quality,n=a.range;this.metricsModel.addSchedulingInfo(g,h,i,j,k,l,m,n,f),this.metricsModel.addRequestsQueue(g,c,d,b,e)}},m=function(a){var c=a.data.request,e=a.data.response,f=a.error;d.splice(d.indexOf(c),1),e&&!f&&b.push(c),l.call(this,c,f?MediaPlayer.dependencies.FragmentModel.states.FAILED:MediaPlayer.dependencies.FragmentModel.states.EXECUTED),this.notify(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,{request:c,response:e},f)},n=function(a){var c=this.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.EXECUTED,quality:a.data.quality,index:a.data.index})[0];c&&(h.call(this,b,c),isNaN(a.data.index)||(e.push(c),l.call(this,c,MediaPlayer.dependencies.FragmentModel.states.REJECTED)))},o=function(){f=!0},p=function(){f=!1};return{system:void 0,log:void 0,metricsModel:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,manifestExt:void 0,setup:function(){this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN]=o,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED]=p,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_REJECTED]=n,this[MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_COMPLETED]=m},setLoader:function(a){this.fragmentLoader=a},setContext:function(b){a=b},getContext:function(){return a},getIsPostponed:function(){return f},addRequest:function(a){return!!(this.manifestExt.getIsTextTrack(a.mediaType)||a&&!this.isFragmentLoadedOrPending(a))&&(c.push(a),l.call(this,a,MediaPlayer.dependencies.FragmentModel.states.PENDING),!0)},isFragmentLoadedOrPending:function(a){var e=function(a,b){return"complete"===a.action&&a.action===b.action},f=function(a,b){return a.url===b.url&&a.startTime===b.startTime},g=function(a,b){return isNaN(a.index)&&isNaN(b.index)&&a.quality===b.quality},h=function(b){var c,d,h=!1,i=b.length;for(d=0;i>d;d+=1)if(c=b[d],f(a,c)||g(a,c)||e(a,c)){h=!0;break}return h};return h(c)||h(d)||h(b)},getRequests:function(a){var b,c=[],d=[],e=1;if(!a||!a.state)return c;a.state instanceof Array?(e=a.state.length,b=a.state):b=[a.state];for(var f=0;e>f;f+=1)c=k.call(this,b[f]),d=d.concat(j.call(this,c,a));return d},getLoadingTime:function(){var a,c,d=0;for(c=b.length-1;c>=0;c-=1)if(a=b[c],a.requestEndDate instanceof Date&&a.firstByteDate instanceof Date){d=a.requestEndDate.getTime()-a.firstByteDate.getTime();break}return d},removeExecutedRequest:function(a){h.call(this,b,a)},removeRejectedRequest:function(a){h.call(this,e,a)},removeExecutedRequestsBeforeTime:function(a){var c,d=b.length-1,e=NaN,f=null;for(c=d;c>=0;c-=1)f=b[c],e=f.startTime,!isNaN(e)&&a>e&&h.call(this,b,f)},cancelPendingRequests:function(a){var b=this,d=c,e=d;return c=[],void 0!==a&&(c=d.filter(function(b){return b.quality!==a&&(e.splice(e.indexOf(b),1),!0)})),e.forEach(function(a){l.call(b,a,MediaPlayer.dependencies.FragmentModel.states.CANCELED)}),e},abortRequests:function(){var a=[];for(this.fragmentLoader.abort();d.length>0;)a.push(d[0]),h.call(this,d,d[0]);return d=[],a},executeRequest:function(a){var e=this,f=c.indexOf(a);if(a&&-1!==f)switch(c.splice(f,1),a.action){case"complete":b.push(a),l.call(e,a,MediaPlayer.dependencies.FragmentModel.states.EXECUTED),e.notify(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_STREAM_COMPLETED,{request:a});break;case"download":d.push(a),l.call(e,a,MediaPlayer.dependencies.FragmentModel.states.LOADING),g.call(e,a);break;default:this.log("Unknown request action.")}},reset:function(){this.abortRequests(),this.cancelPendingRequests(),a=null,b=[],c=[],d=[],e=[],f=!1}}},MediaPlayer.dependencies.FragmentModel.prototype={constructor:MediaPlayer.dependencies.FragmentModel},MediaPlayer.dependencies.FragmentModel.eventList={ENAME_STREAM_COMPLETED:"streamCompleted",ENAME_FRAGMENT_LOADING_STARTED:"fragmentLoadingStarted",ENAME_FRAGMENT_LOADING_COMPLETED:"fragmentLoadingCompleted"},MediaPlayer.dependencies.FragmentModel.states={PENDING:"pending",LOADING:"loading",EXECUTED:"executed",REJECTED:"rejected",CANCELED:"canceled",FAILED:"failed"},MediaPlayer.models.ManifestModel=function(){"use strict";var a;return{system:void 0,eventBus:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,getValue:function(){return a},setValue:function(b){a=b,this.eventBus.dispatchEvent({type:MediaPlayer.events.MANIFEST_LOADED,data:b}),this.notify(MediaPlayer.models.ManifestModel.eventList.ENAME_MANIFEST_UPDATED,{manifest:b})}}},MediaPlayer.models.ManifestModel.prototype={constructor:MediaPlayer.models.ManifestModel},MediaPlayer.models.ManifestModel.eventList={ENAME_MANIFEST_UPDATED:"manifestUpdated"},MediaPlayer.models.MetricsModel=function(){"use strict";return{system:void 0,eventBus:void 0,adapter:void 0,streamMetrics:{},metricsChanged:function(){this.eventBus.dispatchEvent({type:MediaPlayer.events.METRICS_CHANGED,data:{}})},metricChanged:function(a){this.eventBus.dispatchEvent({type:MediaPlayer.events.METRIC_CHANGED,data:{stream:a}}),this.metricsChanged()},metricUpdated:function(a,b,c){this.eventBus.dispatchEvent({type:MediaPlayer.events.METRIC_UPDATED,data:{stream:a,metric:b,value:c}}),this.metricChanged(a)},metricAdded:function(a,b,c){this.eventBus.dispatchEvent({type:MediaPlayer.events.METRIC_ADDED,data:{stream:a,metric:b,value:c}}),this.metricChanged(a)},clearCurrentMetricsForType:function(a){delete this.streamMetrics[a],this.metricChanged(a)},clearAllCurrentMetrics:function(){var a=this;this.streamMetrics={},this.metricsChanged.call(a)},getReadOnlyMetricsFor:function(a){return this.streamMetrics.hasOwnProperty(a)?this.streamMetrics[a]:null},getMetricsFor:function(a){var b;return this.streamMetrics.hasOwnProperty(a)?b=this.streamMetrics[a]:(b=this.system.getObject("metrics"),this.streamMetrics[a]=b),b},addTcpConnection:function(a,b,c,d,e,f){var g=new MediaPlayer.vo.metrics.TCPConnection;return g.tcpid=b,g.dest=c,g.topen=d,g.tclose=e,g.tconnect=f,this.getMetricsFor(a).TcpList.push(g),this.metricAdded(a,this.adapter.metricsList.TCP_CONNECTION,g),g},addHttpRequest:function(a,b,c,d,e,f,g,h,i,j,k,l){var m=new MediaPlayer.vo.metrics.HTTPRequest;return e&&e!==d&&(this.addHttpRequest(a,null,c,d,null,f,g,null,null,null,k,null),m.actualurl=e),m.stream=a,m.tcpid=b,m.type=c,m.url=d,m.range=f,m.trequest=g,m.tresponse=h,m.tfinish=i,m.responsecode=j,m.mediaduration=k,m.responseHeaders=l,this.getMetricsFor(a).HttpList.push(m),this.metricAdded(a,this.adapter.metricsList.HTTP_REQUEST,m),m},appendHttpTrace:function(a,b,c,d){var e=new MediaPlayer.vo.metrics.HTTPRequest.Trace;return e.s=b,e.d=c,e.b=d,a.trace.push(e),a.interval||(a.interval=0),a.interval+=c,this.metricUpdated(a.stream,this.adapter.metricsList.HTTP_REQUEST_TRACE,a),e},addRepresentationSwitch:function(a,b,c,d,e){var f=new MediaPlayer.vo.metrics.RepresentationSwitch;return f.t=b,f.mt=c,f.to=d,f.lto=e,this.getMetricsFor(a).RepSwitchList.push(f),this.metricAdded(a,this.adapter.metricsList.TRACK_SWITCH,f),f},addBufferLevel:function(a,b,c){var d=new MediaPlayer.vo.metrics.BufferLevel;return d.t=b,d.level=c,this.getMetricsFor(a).BufferLevel.push(d),this.metricAdded(a,this.adapter.metricsList.BUFFER_LEVEL,d),d},addBufferState:function(a,b,c){var d=new MediaPlayer.vo.metrics.BufferState;return d.target=c,d.state=b,this.getMetricsFor(a).BufferState.push(d),this.metricAdded(a,this.adapter.metricsList.BUFFER_STATE,d),d},addDVRInfo:function(a,b,c,d){var e=new MediaPlayer.vo.metrics.DVRInfo;return e.time=b,e.range=d,e.manifestInfo=c,this.getMetricsFor(a).DVRInfo.push(e),this.metricAdded(a,this.adapter.metricsList.DVR_INFO,e),e},addDroppedFrames:function(a,b){var c=new MediaPlayer.vo.metrics.DroppedFrames,d=this.getMetricsFor(a).DroppedFrames;return c.time=b.creationTime,c.droppedFrames=b.droppedVideoFrames,d.length>0&&d[d.length-1]==c?d[d.length-1]:(d.push(c),this.metricAdded(a,this.adapter.metricsList.DROPPED_FRAMES,c),c)},addSchedulingInfo:function(a,b,c,d,e,f,g,h,i){var j=new MediaPlayer.vo.metrics.SchedulingInfo;return j.mediaType=a,j.t=b,j.type=c,j.startTime=d,j.availabilityStartTime=e,j.duration=f,j.quality=g,j.range=h,j.state=i,this.getMetricsFor(a).SchedulingInfo.push(j),this.metricAdded(a,this.adapter.metricsList.SCHEDULING_INFO,j),j},addRequestsQueue:function(a,b,c,d,e){var f=new MediaPlayer.vo.metrics.RequestsQueue;f.pendingRequests=b,f.loadingRequests=c,f.executedRequests=d,f.rejectedRequests=e,this.getMetricsFor(a).RequestsQueue=f,this.metricAdded(a,this.adapter.metricsList.REQUESTS_QUEUE,f)},addManifestUpdate:function(a,b,c,d,e,f,g,h,i,j){var k=new MediaPlayer.vo.metrics.ManifestUpdate,l=this.getMetricsFor("stream");return k.mediaType=a,k.type=b,k.requestTime=c,k.fetchTime=d,k.availabilityStartTime=e,k.presentationStartTime=f,k.clientTimeOffset=g,k.currentTime=h,k.buffered=i,k.latency=j,l.ManifestUpdate.push(k),this.metricAdded(a,this.adapter.metricsList.MANIFEST_UPDATE,k),k},updateManifestUpdateInfo:function(a,b){if(a){for(var c in b)a[c]=b[c];this.metricUpdated(a.mediaType,this.adapter.metricsList.MANIFEST_UPDATE,a)}},addManifestUpdateStreamInfo:function(a,b,c,d,e){if(a){var f=new MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo;return f.id=b,f.index=c,f.start=d,f.duration=e,a.streamInfo.push(f),this.metricUpdated(a.mediaType,this.adapter.metricsList.MANIFEST_UPDATE_STREAM_INFO,a),f}return null},addManifestUpdateRepresentationInfo:function(a,b,c,d,e,f,g,h){if(a){var i=new MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo;return i.id=b,i.index=c,i.streamIndex=d,i.mediaType=e,i.startNumber=g,i.fragmentInfoType=h,i.presentationTimeOffset=f,a.trackInfo.push(i),this.metricUpdated(a.mediaType,this.adapter.metricsList.MANIFEST_UPDATE_TRACK_INFO,a),i}return null},addPlayList:function(a,b,c,d){var e=new MediaPlayer.vo.metrics.PlayList;return e.stream=a,e.start=b,e.mstart=c,e.starttype=d,this.getMetricsFor(a).PlayList.push(e),this.metricAdded(a,this.adapter.metricsList.PLAY_LIST,e),e},appendPlayListTrace:function(a,b,c,d,e,f,g,h){var i=new MediaPlayer.vo.metrics.PlayList.Trace;return i.representationid=b,i.subreplevel=c,i.start=d,i.mstart=e,i.duration=f,i.playbackspeed=g,i.stopreason=h,a.trace.push(i),this.metricUpdated(a.stream,this.adapter.metricsList.PLAY_LIST_TRACE,a),i}}},MediaPlayer.models.MetricsModel.prototype={constructor:MediaPlayer.models.MetricsModel},MediaPlayer.models.ProtectionModel=function(){},MediaPlayer.models.ProtectionModel.eventList={ENAME_NEED_KEY:"needkey",ENAME_KEY_SYSTEM_ACCESS_COMPLETE:"keySystemAccessComplete",ENAME_KEY_SYSTEM_SELECTED:"keySystemSelected",ENAME_VIDEO_ELEMENT_SELECTED:"videoElementSelected",ENAME_SERVER_CERTIFICATE_UPDATED:"serverCertificateUpdated",ENAME_KEY_MESSAGE:"keyMessage",ENAME_KEY_ADDED:"keyAdded",ENAME_KEY_ERROR:"keyError",ENAME_KEY_SESSION_CREATED:"keySessionCreated",ENAME_KEY_SESSION_REMOVED:"keySessionRemoved",ENAME_KEY_SESSION_CLOSED:"keySessionClosed",ENAME_KEY_STATUSES_CHANGED:"keyStatusesChanged",ENAME_TEARDOWN_COMPLETE:"protectionTeardownComplete"},MediaPlayer.models.ProtectionModel_01b=function(){var a,b=null,c=null,d=[],e=[],f=function(){var b=this;return{handleEvent:function(f){var g=null;switch(f.type){case c.needkey:var i=ArrayBuffer.isView(f.initData)?f.initData.buffer:f.initData;b.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY,new MediaPlayer.vo.protection.NeedKey(i,"cenc"));break;case c.keyerror:if(g=h(e,f.sessionId),g||(g=h(d,f.sessionId)),g){var j="";switch(f.errorCode.code){case 1:j+="MEDIA_KEYERR_UNKNOWN - An unspecified error occurred. This value is used for errors that don't match any of the other codes.";break;case 2:j+="MEDIA_KEYERR_CLIENT - The Key System could not be installed or updated.";break;case 3:j+="MEDIA_KEYERR_SERVICE - The message passed into update indicated an error from the license service.";break;case 4:j+="MEDIA_KEYERR_OUTPUT - There is no available output device with the required characteristics for the content protection system.";break;case 5:j+="MEDIA_KEYERR_HARDWARECHANGE - A hardware configuration change caused a content protection error.";break;case 6:j+="MEDIA_KEYERR_DOMAIN - An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain."}j+="  System Code = "+f.systemCode,b.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR,new MediaPlayer.vo.protection.KeyError(g,j))}else b.log("No session token found for key error");break;case c.keyadded:g=h(e,f.sessionId),g||(g=h(d,f.sessionId)),g?b.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ADDED,g):b.log("No session token found for key added");break;case c.keymessage:if(a=null!==f.sessionId&&void 0!==f.sessionId,a?!(g=h(e,f.sessionId))&&d.length>0&&(g=d.shift(),e.push(g),g.sessionID=f.sessionId):d.length>0&&(g=d.shift(),e.push(g),0!==d.length&&b.errHandler.mediaKeyMessageError("Multiple key sessions were creates with a user-agent that does not support sessionIDs!! Unpredictable behavior ahead!")),g){var k=ArrayBuffer.isView(f.message)?f.message.buffer:f.message;g.keyMessage=k,b.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,new MediaPlayer.vo.protection.KeyMessage(g,k,f.defaultURL))}else b.log("No session token found for key message")}}}},g=null,h=function(a,b){if(b&&a){for(var c=a.length,d=0;c>d;d++)if(a[d].sessionID==b)return a[d];return null}return null},i=function(){b.removeEventListener(c.keyerror,g),b.removeEventListener(c.needkey,g),b.removeEventListener(c.keymessage,g),b.removeEventListener(c.keyadded,g)};return{system:void 0,log:void 0,errHandler:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,protectionExt:void 0,keySystem:null,setup:function(){g=f.call(this)},init:function(){var a=document.createElement("video");c=MediaPlayer.models.ProtectionModel_01b.detect(a)},teardown:function(){b&&i();for(var a=0;a<e.length;a++)this.closeKeySession(e[a]);this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE)},getAllInitData:function(){var a,b=[];for(a=0;a<d.length;a++)b.push(d[a].initData);for(a=0;a<e.length;a++)b.push(e[a].initData);return b},requestKeySystemAccess:function(a){var c=b;c||(c=document.createElement("video"));for(var d=!1,e=0;e<a.length;e++)for(var f=a[e].ks.systemString,g=a[e].configs,h=null,i=null,j=0;j<g.length;j++){var k=g[j].videoCapabilities;if(k&&0!==k.length){i=[];for(var l=0;l<k.length;l++)""!==c.canPlayType(k[l].contentType,f)&&i.push(k[l])}if(!(!h&&!i||h&&0===h.length||i&&0===i.length)){d=!0;var m=new MediaPlayer.vo.protection.KeySystemConfiguration(h,i),n=this.protectionExt.getKeySystemBySystemString(f),o=new MediaPlayer.vo.protection.KeySystemAccess(n,m);this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,o);break}}d||this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,null,"Key system access denied! -- No valid audio/video content configurations detected!")},selectKeySystem:function(a){this.keySystem=a.keySystem,this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED)},setMediaElement:function(a){b!==a&&(b&&i(),(b=a)&&(b.addEventListener(c.keyerror,g),b.addEventListener(c.needkey,g),b.addEventListener(c.keymessage,g),b.addEventListener(c.keyadded,g),this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_VIDEO_ELEMENT_SELECTED)))},createKeySession:function(f){if(!this.keySystem)throw new Error("Can not create sessions until you have selected a key system");if(a||0===e.length){var g={sessionID:null,initData:f,getSessionID:function(){return this.sessionID},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"}};return d.push(g),b[c.generateKeyRequest](this.keySystem.systemString,new Uint8Array(f)),g}throw new Error("Multiple sessions not allowed!")},updateKeySession:function(a,d){var e=a.sessionID;if(this.protectionExt.isClearKey(this.keySystem))for(var f=0;f<d.keyPairs.length;f++)b[c.addKey](this.keySystem.systemString,d.keyPairs[f].key,d.keyPairs[f].keyID,e);else b[c.addKey](this.keySystem.systemString,new Uint8Array(d),a.initData,e)},closeKeySession:function(a){b[c.cancelKeyRequest](this.keySystem.systemString,a.sessionID)},setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){}}},MediaPlayer.models.ProtectionModel_01b.prototype={constructor:MediaPlayer.models.ProtectionModel_01b},MediaPlayer.models.ProtectionModel_01b.APIs=[{generateKeyRequest:"generateKeyRequest",addKey:"addKey",cancelKeyRequest:"cancelKeyRequest",needkey:"needkey",keyerror:"keyerror",keyadded:"keyadded",keymessage:"keymessage"},{generateKeyRequest:"webkitGenerateKeyRequest",addKey:"webkitAddKey",cancelKeyRequest:"webkitCancelKeyRequest",needkey:"webkitneedkey",keyerror:"webkitkeyerror",keyadded:"webkitkeyadded",keymessage:"webkitkeymessage"}],MediaPlayer.models.ProtectionModel_01b.detect=function(a){for(var b=MediaPlayer.models.ProtectionModel_01b.APIs,c=0;c<b.length;c++){var d=b[c];if("function"==typeof a[d.generateKeyRequest]&&"function"==typeof a[d.addKey]&&"function"==typeof a[d.cancelKeyRequest])return d}return null},MediaPlayer.models.ProtectionModel_21Jan2015=function(){var a=null,b=null,c=[],d=function(a,b){var c=this;!function(b){var e=a[b].ks,f=a[b].configs;navigator.requestMediaKeySystemAccess(e.systemString,f).then(function(a){var b="function"==typeof a.getConfiguration?a.getConfiguration():null,d=new MediaPlayer.vo.protection.KeySystemAccess(e,b);d.mksa=a,c.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,d)}).catch(function(){++b<a.length?d.call(c,a,b):c.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,null,"Key system access denied!")})}(b)},e=function(a){var b=a.session;return b.removeEventListener("keystatuseschange",a),b.removeEventListener("message",a),b.close()},f=function(){var a=this;return{handleEvent:function(b){switch(b.type){case"encrypted":if(b.initData){var c=ArrayBuffer.isView(b.initData)?b.initData.buffer:b.initData;a.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY,new MediaPlayer.vo.protection.NeedKey(c,b.initDataType))}}}}},g=null,h=function(a){for(var b=0;b<c.length;b++)if(c[b]===a){c.splice(b,1);break}},i=function(a,b,d){var e=this,f={session:a,initData:b,handleEvent:function(a){switch(a.type){case"keystatuseschange":e.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED,this);break;case"message":var b=ArrayBuffer.isView(a.message)?a.message.buffer:a.message;e.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,new MediaPlayer.vo.protection.KeyMessage(this,b,void 0,a.messageType))}},getSessionID:function(){return this.session.sessionId},getExpirationTime:function(){return this.session.expiration},getKeyStatuses:function(){return this.session.keyStatuses},getSessionType:function(){return d}};return a.addEventListener("keystatuseschange",f),a.addEventListener("message",f),a.closed.then(function(){h(f),e.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,f.getSessionID())}),c.push(f),f};return{system:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,protectionExt:void 0,keySystem:null,setup:function(){g=f.call(this)},init:function(){},teardown:function(){var b,d=c.length,f=this;if(0!==d)for(var i=function(b){h(b),0===c.length&&(a?(a.removeEventListener("encrypted",g),a.setMediaKeys(null).then(function(){f.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE)})):f.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE))},j=0;d>j;j++)b=c[j],function(a){b.session.closed.then(function(){i(a)}),e(b).catch(function(){i(a)})}(b);else this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE)},getAllInitData:function(){for(var a=[],b=0;b<c.length;b++)a.push(c[b].initData);return a},requestKeySystemAccess:function(a){d.call(this,a,0)},selectKeySystem:function(c){var d=this;c.mksa.createMediaKeys().then(function(e){d.keySystem=c.keySystem,b=e,a&&a.setMediaKeys(b),d.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED)}).catch(function(){d.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,null,"Error selecting keys system ("+c.keySystem.systemString+")! Could not create MediaKeys -- TODO")})},setMediaElement:function(c){a!==c&&(a&&(a.removeEventListener("encrypted",g),a.setMediaKeys(null)),(a=c)&&(a.addEventListener("encrypted",g),b&&a.setMediaKeys(b)))},setServerCertificate:function(a){if(!this.keySystem||!b)throw new Error("Can not set server certificate until you have selected a key system");var c=this;b.setServerCertificate(a).then(function(){c.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED)}).catch(function(a){c.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED,null,"Error updating server certificate -- "+a.name)})},createKeySession:function(a,c){if(!this.keySystem||!b)throw new Error("Can not create sessions until you have selected a key system");var d=b.createSession(c),e=i.call(this,d,a,c),f=this;d.generateRequest("cenc",a).then(function(){f.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,e)}).catch(function(a){h(e),f.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,null,"Error generating key request -- "+a.name)})},updateKeySession:function(a,b){var c=a.session,d=this;this.protectionExt.isClearKey(this.keySystem)&&(b=b.toJWK()),c.update(b).catch(function(b){d.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR,new MediaPlayer.vo.protection.KeyError(a,"Error sending update() message! "+b.name))})},loadKeySession:function(a){if(!this.keySystem||!b)throw new Error("Can not load sessions until you have selected a key system");var c=b.createSession(),d=this;c.load(a).then(function(b){if(b){var e=i.call(this,c);d.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,e)}else d.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,null,"Could not load session! Invalid Session ID ("+a+")")}).catch(function(b){d.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,null,"Could not load session ("+a+")! "+b.name)})},removeKeySession:function(a){var b=a.session,c=this;b.remove().then(function(){c.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED,a.getSessionID())},function(b){c.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED,null,"Error removing session ("+a.getSessionID()+"). "+b.name)})},closeKeySession:function(a){var b=this;e(a).catch(function(c){h(a),b.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,null,"Error closing session ("+a.getSessionID()+") "+c.name)})}}},MediaPlayer.models.ProtectionModel_21Jan2015.detect=function(a){return void 0!==a.onencrypted&&void 0!==a.mediaKeys&&(void 0!==navigator.requestMediaKeySystemAccess&&"function"==typeof navigator.requestMediaKeySystemAccess)},MediaPlayer.models.ProtectionModel_21Jan2015.prototype={constructor:MediaPlayer.models.ProtectionModel_21Jan2015},MediaPlayer.models.ProtectionModel_3Feb2014=function(){var a=null,b=null,c=null,d=null,e=[],f=function(){var a=this;return{handleEvent:function(b){switch(b.type){case d.needkey:if(b.initData){var c=ArrayBuffer.isView(b.initData)?b.initData.buffer:b.initData;a.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY,new MediaPlayer.vo.protection.NeedKey(c,"cenc"))}}}}},g=null,h=function(){var c=null,e=function(){a.removeEventListener("loadedmetadata",c),a[d.setMediaKeys](b),this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_VIDEO_ELEMENT_SELECTED)};a.readyState>=1?e.call(this):(c=e.bind(this),a.addEventListener("loadedmetadata",c))},i=function(a,b){var c=this;return{session:a,initData:b,handleEvent:function(a){switch(a.type){case d.error:c.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR,new MediaPlayer.vo.protection.KeyError(this,"KeyError"));break;case d.message:var b=ArrayBuffer.isView(a.message)?a.message.buffer:a.message;c.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,new MediaPlayer.vo.protection.KeyMessage(this,b,a.destinationURL));break;case d.ready:c.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ADDED,this);break;case d.close:c.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,this.getSessionID())}},getSessionID:function(){return this.session.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"}}};return{system:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,protectionExt:void 0,keySystem:null,setup:function(){g=f.call(this)},init:function(){var a=document.createElement("video");d=MediaPlayer.models.ProtectionModel_3Feb2014.detect(a)},teardown:function(){try{for(var b=0;b<e.length;b++)this.closeKeySession(e[b]);a&&a.removeEventListener(d.needkey,g),this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE)}catch(a){this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE,null,"Error tearing down key sessions and MediaKeys! -- "+a.message)}},getAllInitData:function(){for(var a=[],b=0;b<e.length;b++)a.push(e[b].initData);return a},requestKeySystemAccess:function(a){for(var b=!1,c=0;c<a.length;c++)for(var e=a[c].ks.systemString,f=a[c].configs,g=null,h=null,i=0;i<f.length;i++){var j=f[i].audioCapabilities,k=f[i].videoCapabilities;if(j&&0!==j.length){g=[];for(var l=0;l<j.length;l++)window[d.MediaKeys].isTypeSupported(e,j[l].contentType)&&g.push(j[l])}if(k&&0!==k.length){h=[];for(var m=0;m<k.length;m++)window[d.MediaKeys].isTypeSupported(e,k[m].contentType)&&h.push(k[m])}if(!(!g&&!h||g&&0===g.length||h&&0===h.length)){b=!0;var n=new MediaPlayer.vo.protection.KeySystemConfiguration(g,h),o=this.protectionExt.getKeySystemBySystemString(e),p=new MediaPlayer.vo.protection.KeySystemAccess(o,n);this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,p);break}}b||this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,null,"Key system access denied! -- No valid audio/video content configurations detected!")},selectKeySystem:function(e){try{b=e.mediaKeys=new window[d.MediaKeys](e.keySystem.systemString),this.keySystem=e.keySystem,c=e,a&&h.call(this),
this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED)}catch(a){this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,null,"Error selecting keys system ("+this.keySystem.systemString+")! Could not create MediaKeys -- TODO")}},setMediaElement:function(c){a!==c&&(a&&a.removeEventListener(d.needkey,g),(a=c)&&(a.addEventListener(d.needkey,g),b&&h.call(this)))},createKeySession:function(a){if(!this.keySystem||!b||!c)throw new Error("Can not create sessions until you have selected a key system");var f=c.ksConfiguration.videoCapabilities[0].contentType,g=b.createSession(f,new Uint8Array(a)),h=i.call(this,g,a);g.addEventListener(d.error,h),g.addEventListener(d.message,h),g.addEventListener(d.ready,h),g.addEventListener(d.close,h),e.push(h),this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,h)},updateKeySession:function(a,b){var c=a.session;this.protectionExt.isClearKey(this.keySystem)?c.update(new Uint8Array(b.toJWK())):c.update(new Uint8Array(b))},closeKeySession:function(a){var b=a.session;b.removeEventListener(d.error,a),b.removeEventListener(d.message,a),b.removeEventListener(d.ready,a),b.removeEventListener(d.close,a);for(var c=0;c<e.length;c++)if(e[c]===a){e.splice(c,1);break}b[d.release]()},setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){}}},MediaPlayer.models.ProtectionModel_3Feb2014.APIs=[{setMediaKeys:"setMediaKeys",MediaKeys:"MediaKeys",release:"close",needkey:"needkey",error:"keyerror",message:"keymessage",ready:"keyadded",close:"keyclose"},{setMediaKeys:"msSetMediaKeys",MediaKeys:"MSMediaKeys",release:"close",needkey:"msneedkey",error:"mskeyerror",message:"mskeymessage",ready:"mskeyadded",close:"mskeyclose"}],MediaPlayer.models.ProtectionModel_3Feb2014.detect=function(a){for(var b=MediaPlayer.models.ProtectionModel_3Feb2014.APIs,c=0;c<b.length;c++){var d=b[c];if("function"==typeof a[d.setMediaKeys]&&"function"==typeof window[d.MediaKeys])return d}return null},MediaPlayer.models.ProtectionModel_3Feb2014.prototype={constructor:MediaPlayer.models.ProtectionModel_3Feb2014},MediaPlayer.models.URIQueryAndFragmentModel=function(){"use strict";var a=new MediaPlayer.vo.URIFragmentData,b=[];return{parseURI:function(c){function d(a,b,c,d){var e=d[0].split(/[=]/);return d.push({key:e[0],value:e[1]}),d.shift(),d}function e(a,c,d){return c>0&&(i&&0===b.length?b=d[c].split(/[&]/):j&&(f=d[c].split(/[&]/))),d}if(!c)return null;var f=[],g=new RegExp(/[?]/),h=new RegExp(/[#]/),i=g.test(c),j=h.test(c);return c.split(/[?#]/).map(e),b.length>0&&(b=b.reduce(d,null)),f.length>0&&(f=f.reduce(d,null),f.forEach(function(b){a[b.key]=b.value})),c},getURIFragmentData:function(){return a},getURIQueryData:function(){return b},reset:function(){a=new MediaPlayer.vo.URIFragmentData,b=[]}}},MediaPlayer.models.URIQueryAndFragmentModel.prototype={constructor:MediaPlayer.models.URIQueryAndFragmentModel},MediaPlayer.models.VideoModel=function(){"use strict";var a,b,c=[],d=function(){return c.length>0},e=function(b){null===b||a.seeking||(this.setPlaybackRate(0),!0!==c[b]&&(c.push(b),c[b]=!0))},f=function(a){if(null!==a){c[a]=!1;var b=c.indexOf(a);-1!==b&&c.splice(b,1),!1===d()&&this.setPlaybackRate(1)}},g=function(a,b){b?e.call(this,a):f.call(this,a)};return{system:void 0,play:function(){a.play()},pause:function(){a.pause()},isPaused:function(){return a.paused},getPlaybackRate:function(){return a.playbackRate},setPlaybackRate:function(b){!a||a.readyState<2||(a.playbackRate=b)},getCurrentTime:function(){return a.currentTime},setCurrentTime:function(b){if(a.currentTime!=b)try{a.currentTime=b}catch(c){0===a.readyState&&c.code===c.INVALID_STATE_ERR&&setTimeout(function(){a.currentTime=b},400)}},setStallState:function(a,b){g.call(this,a,b)},listen:function(b,c){a.addEventListener(b,c,!1)},unlisten:function(b,c){a.removeEventListener(b,c,!1)},getElement:function(){return a},setElement:function(b){a=b},getTTMLRenderingDiv:function(){return b},setTTMLRenderingDiv:function(a){b=a,b.style.position="absolute",b.style.display="flex",b.style.overflow="hidden",b.style.zIndex=2147483647,b.style.pointerEvents="none",b.style.top=0,b.style.left=0},setSource:function(b){a.src=b}}},MediaPlayer.models.VideoModel.prototype={constructor:MediaPlayer.models.VideoModel},MediaPlayer.dependencies.protection.CommonEncryption={findCencContentProtection:function(a){for(var b=null,c=0;c<a.length;++c){var d=a[c];"urn:mpeg:dash:mp4protection:2011"===d.schemeIdUri.toLowerCase()&&"cenc"===d.value.toLowerCase()&&(b=d)}return b},getPSSHData:function(a){var b=8,c=new DataView(a),d=c.getUint8(b);return b+=20,d>0&&(b+=4+16*c.getUint32(b)),b+=4,a.slice(b)},getPSSHForKeySystem:function(a,b){var c=MediaPlayer.dependencies.protection.CommonEncryption.parsePSSHList(b);return c.hasOwnProperty(a.uuid.toLowerCase())?c[a.uuid.toLowerCase()]:null},parseInitDataFromContentProtection:function(a){return"pssh"in a?BASE64.decodeArray(a.pssh.__text).buffer:null},parsePSSHList:function(a){if(null===a)return[];for(var b=new DataView(a),c=!1,d={},e=0;!c;){var f,g,h,i,j=e;if(e>=b.buffer.byteLength)break;if(f=b.getUint32(e),g=e+f,e+=4,1886614376===b.getUint32(e))if(e+=4,0===(h=b.getUint8(e))||1===h){e+=1,e+=3,i="";var k,l;for(k=0;4>k;k++)l=b.getUint8(e+k).toString(16),i+=1===l.length?"0"+l:l;for(e+=4,i+="-",k=0;2>k;k++)l=b.getUint8(e+k).toString(16),i+=1===l.length?"0"+l:l;for(e+=2,i+="-",k=0;2>k;k++)l=b.getUint8(e+k).toString(16),i+=1===l.length?"0"+l:l;for(e+=2,i+="-",k=0;2>k;k++)l=b.getUint8(e+k).toString(16),i+=1===l.length?"0"+l:l;for(e+=2,i+="-",k=0;6>k;k++)l=b.getUint8(e+k).toString(16),i+=1===l.length?"0"+l:l;e+=6,i=i.toLowerCase(),b.getUint32(e),e+=4,d[i]=b.buffer.slice(j,g),e=g}else e=g;else e=g}return d}},MediaPlayer.dependencies.protection.KeySystem=function(){},MediaPlayer.dependencies.protection.KeySystem_Access=function(){"use strict"},MediaPlayer.dependencies.protection.KeySystem_Access.prototype={constructor:MediaPlayer.dependencies.protection.KeySystem_Access},MediaPlayer.dependencies.protection.KeySystem_ClearKey=function(){"use strict";var a="1077efec-c0b2-4d02-ace3-3c1e52e2fb4b";return{system:void 0,schemeIdURI:"urn:uuid:"+a,systemString:"org.w3.clearkey",uuid:a,getInitData:MediaPlayer.dependencies.protection.CommonEncryption.parseInitDataFromContentProtection,getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(a){return new Uint8Array(a)},getLicenseServerURLFromInitData:function(){return null}}},MediaPlayer.dependencies.protection.KeySystem_ClearKey.prototype={constructor:MediaPlayer.dependencies.protection.KeySystem_ClearKey},MediaPlayer.dependencies.protection.KeySystem_ClearKey.getClearKeysFromProtectionData=function(a,b){var c=null;if(a){for(var d=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(b))),e=[],f=0;f<d.kids.length;f++){var g=d.kids[f],h=a.clearkeys.hasOwnProperty(g)?a.clearkeys[g]:null;if(!h)throw new Error("DRM: ClearKey keyID ("+g+") is not known!");e.push(new MediaPlayer.vo.protection.KeyPair(g,h))}c=new MediaPlayer.vo.protection.ClearKeyKeySet(e)}return c},MediaPlayer.dependencies.protection.KeySystem_PlayReady=function(){"use strict";var a="9a04f079-9840-4286-ab92-e65be0885f95",b="utf16",c=function(a){var c,d,e={},f=new DOMParser,g="utf16"===b?new Uint16Array(a):new Uint8Array(a);c=String.fromCharCode.apply(null,g),d=f.parseFromString(c,"application/xml");for(var h=d.getElementsByTagName("name"),i=d.getElementsByTagName("value"),j=0;j<h.length;j++)e[h[j].childNodes[0].nodeValue]=i[j].childNodes[0].nodeValue;return e.hasOwnProperty("Content")&&(e["Content-Type"]=e.Content,delete e.Content),e},d=function(a){var c,d,e=new DOMParser,f=null,g="utf16"===b?new Uint16Array(a):new Uint8Array(a);if(c=String.fromCharCode.apply(null,g),d=e.parseFromString(c,"application/xml"),d.getElementsByTagName("Challenge")[0]){var h=d.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;h&&(f=BASE64.decode(h))}return f},e=function(a){if(a)for(var b=new DataView(a),c=b.getUint16(4,!0),d=6,e=new DOMParser,f=0;c>f;f++){var g=b.getUint16(d,!0);d+=2;var h=b.getUint16(d,!0);if(d+=2,1===g){var i=a.slice(d,d+h),j=String.fromCharCode.apply(null,new Uint16Array(i)),k=e.parseFromString(j,"application/xml");if(k.getElementsByTagName("LA_URL")[0]){var l=k.getElementsByTagName("LA_URL")[0].childNodes[0].nodeValue;if(l)return l}if(k.getElementsByTagName("LUI_URL")[0]){var m=k.getElementsByTagName("LUI_URL")[0].childNodes[0].nodeValue;if(m)return m}}else d+=h}return null},f=function(a){var b,c,d,e,f,g=0,h=new Uint8Array([112,115,115,104,0,0,0,0]),i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),j=null;if("pssh"in a)return MediaPlayer.dependencies.protection.CommonEncryption.parseInitDataFromContentProtection(a);if("pro"in a)j=BASE64.decodeArray(a.pro.__text);else{if(!("prheader"in a))return null;j=BASE64.decodeArray(a.prheader.__text)}return b=j.length,c=4+h.length+i.length+4+b,d=new ArrayBuffer(c),e=new Uint8Array(d),f=new DataView(d),f.setUint32(g,c),g+=4,e.set(h,g),g+=h.length,e.set(i,g),g+=i.length,f.setUint32(g,b),g+=4,e.set(j,g),g+=b,e.buffer};return{schemeIdURI:"urn:uuid:"+a,systemString:"com.microsoft.playready",uuid:a,getInitData:f,getRequestHeadersFromMessage:c,getLicenseRequestFromMessage:d,getLicenseServerURLFromInitData:e,setPlayReadyMessageFormat:function(a){if("utf8"!==a&&"utf16"!==a)throw new Error("Illegal PlayReady message format! -- "+a);b=a}}},MediaPlayer.dependencies.protection.KeySystem_PlayReady.prototype={constructor:MediaPlayer.dependencies.protection.KeySystem_PlayReady},MediaPlayer.dependencies.protection.KeySystem_Widevine=function(){"use strict";var a="edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";return{schemeIdURI:"urn:uuid:"+a,systemString:"com.widevine.alpha",uuid:a,getInitData:MediaPlayer.dependencies.protection.CommonEncryption.parseInitDataFromContentProtection,getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(a){return new Uint8Array(a)},getLicenseServerURLFromInitData:function(){return null}}},MediaPlayer.dependencies.protection.KeySystem_Widevine.prototype={constructor:MediaPlayer.dependencies.protection.KeySystem_Widevine},MediaPlayer.dependencies.protection.servers.ClearKey=function(){"use strict";return{getServerURLFromMessage:function(a,b){var c=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(b)));a+="/?";for(var d=0;d<c.kids.length;d++)a+=c.kids[d]+"&";return a=a.substring(0,a.length-1)},getHTTPMethod:function(){return"GET"},getResponseType:function(){return"json"},getLicenseMessage:function(a){if(!a.hasOwnProperty("keys"))return null;var b,c=[];for(b=0;b<a.keys.length;b++){var d=a.keys[b],e=d.kid.replace(/=/g,""),f=d.k.replace(/=/g,"");c.push(new MediaPlayer.vo.protection.KeyPair(e,f))}return new MediaPlayer.vo.protection.ClearKeyKeySet(c)},getErrorResponse:function(a){return String.fromCharCode.apply(null,new Uint8Array(a))}}},MediaPlayer.dependencies.protection.servers.ClearKey.prototype={constructor:MediaPlayer.dependencies.protection.servers.ClearKey},MediaPlayer.dependencies.protection.servers.DRMToday=function(){"use strict";var a={"com.widevine.alpha":{responseType:"json",getLicenseMessage:function(a){return BASE64.decodeArray(a.license)},getErrorResponse:function(a){return a}},"com.microsoft.playready":{responseType:"arraybuffer",getLicenseMessage:function(a){return a},getErrorResponse:function(a){return String.fromCharCode.apply(null,new Uint8Array(a))}}};return{getServerURLFromMessage:function(a){return a},getHTTPMethod:function(){return"POST"},getResponseType:function(b){return a[b].responseType},getLicenseMessage:function(b,c){return a[c].getLicenseMessage(b)},getErrorResponse:function(b,c){return a[c].getErrorResponse(b)}}},MediaPlayer.dependencies.protection.servers.DRMToday.prototype={constructor:MediaPlayer.dependencies.protection.servers.DRMToday},MediaPlayer.dependencies.protection.servers.LicenseServer=function(){},MediaPlayer.dependencies.protection.servers.PlayReady=function(){"use strict";return{getServerURLFromMessage:function(a){return a},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(a){return a},getErrorResponse:function(a){return String.fromCharCode.apply(null,new Uint8Array(a))}}},MediaPlayer.dependencies.protection.servers.PlayReady.prototype={constructor:MediaPlayer.dependencies.protection.servers.PlayReady},MediaPlayer.dependencies.protection.servers.Widevine=function(){"use strict";return{getServerURLFromMessage:function(a){return a},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(a){return a},getErrorResponse:function(a){return String.fromCharCode.apply(null,new Uint8Array(a))}}},MediaPlayer.dependencies.protection.servers.Widevine.prototype={constructor:MediaPlayer.dependencies.protection.servers.Widevine},MediaPlayer.rules.ABRRulesCollection=function(){"use strict";var a=[],b=[];return{insufficientBufferRule:void 0,bufferOccupancyRule:void 0,throughputRule:void 0,abandonRequestRule:void 0,getRules:function(c){switch(c){case MediaPlayer.rules.ABRRulesCollection.prototype.QUALITY_SWITCH_RULES:return a;case MediaPlayer.rules.ABRRulesCollection.prototype.ABANDON_FRAGMENT_RULES:return b;default:return null}},setup:function(){a.push(this.insufficientBufferRule),a.push(this.throughputRule),a.push(this.bufferOccupancyRule),b.push(this.abandonRequestRule)}}},MediaPlayer.rules.ABRRulesCollection.prototype={constructor:MediaPlayer.rules.ABRRulesCollection,QUALITY_SWITCH_RULES:"qualitySwitchRules",ABANDON_FRAGMENT_RULES:"abandonFragmentRules"},MediaPlayer.rules.AbandonRequestsRule=function(){"use strict";var a={},b={},c=function(b,c){a[b]=a[b]||{},a[b][c]=a[b][c]||{}};return{metricsExt:void 0,log:void 0,execute:function(d,e){var f,g=(new Date).getTime(),h=d.getMediaInfo(),i=h.type,j=d.getCurrentValue(),k=d.getTrackInfo(),l=j.data.request,m=d.getStreamProcessor().getABRController(),n=new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,MediaPlayer.rules.SwitchRequest.prototype.WEAK);if(!isNaN(l.index)){if(c(i,l.index),null===(f=a[i][l.index])||null===l.firstByteDate||b.hasOwnProperty(f.id))return void e(n);if(void 0===f.firstByteTime&&(f.firstByteTime=l.firstByteDate.getTime(),f.segmentDuration=l.duration,f.bytesTotal=l.bytesTotal,f.id=l.index),f.bytesLoaded=l.bytesLoaded,f.elapsedTime=g-f.firstByteTime,f.bytesLoaded<f.bytesTotal&&f.elapsedTime>=500){if(f.measuredBandwidthInKbps=Math.round(8*f.bytesLoaded/f.elapsedTime),f.estimatedTimeOfDownload=(8*f.bytesTotal*.001/f.measuredBandwidthInKbps).toFixed(2),f.estimatedTimeOfDownload<1.5*f.segmentDuration||0===k.quality)return void e(n);if(!b.hasOwnProperty(f.id)){var o=m.getQualityForBitrate(h,f.measuredBandwidthInKbps*MediaPlayer.dependencies.AbrController.BANDWIDTH_SAFETY);n=new MediaPlayer.rules.SwitchRequest(o,MediaPlayer.rules.SwitchRequest.prototype.STRONG),b[f.id]=f,this.log("AbandonRequestsRule ( ",i,"frag id",f.id,") is asking to abandon and switch to quality to ",o," measured bandwidth was",f.measuredBandwidthInKbps),delete a[i][f.id]}}else f.bytesLoaded===f.bytesTotal&&delete a[i][f.id]}e(n)},reset:function(){a={},b={}}}},MediaPlayer.rules.AbandonRequestsRule.prototype={constructor:MediaPlayer.rules.AbandonRequestsRule},MediaPlayer.rules.BufferOccupancyRule=function(){"use strict";var a=0;return{log:void 0,metricsModel:void 0,execute:function(b,c){var d=this,e=(new Date).getTime()/1e3,f=b.getMediaInfo(),g=b.getTrackInfo(),h=f.type,i=isNaN(g.fragmentDuration)?2:g.fragmentDuration/2,j=b.getCurrentValue(),k=b.getStreamProcessor(),l=k.getABRController(),m=this.metricsModel.getReadOnlyMetricsFor(h),n=m.BufferLevel.length>0?m.BufferLevel[m.BufferLevel.length-1]:null,o=m.BufferState.length>0?m.BufferState[m.BufferState.length-1]:null,p=f.representationCount-1,q=new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,MediaPlayer.rules.SwitchRequest.prototype.WEAK);return i>e-a||l.getAbandonmentStateFor(h)===MediaPlayer.dependencies.AbrController.ABANDON_LOAD?void c(q):(null!==n&&null!==o&&n.level>o.target&&n.level-o.target>MediaPlayer.dependencies.BufferController.RICH_BUFFER_THRESHOLD&&f.representationCount>1&&(q=new MediaPlayer.rules.SwitchRequest(p,MediaPlayer.rules.SwitchRequest.prototype.STRONG)),q.value!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&q.value!==j&&d.log("BufferOccupancyRule requesting switch to index: ",q.value,"type: ",h," Priority: ",q.priority===MediaPlayer.rules.SwitchRequest.prototype.DEFAULT?"Default":q.priority===MediaPlayer.rules.SwitchRequest.prototype.STRONG?"Strong":"Weak"),void c(q))},reset:function(){a=0}}},MediaPlayer.rules.BufferOccupancyRule.prototype={constructor:MediaPlayer.rules.BufferOccupancyRule},MediaPlayer.rules.InsufficientBufferRule=function(){"use strict";var a={},b=0,c=function(b,c){a[b]=a[b]||{},a[b].state=c,c!==MediaPlayer.dependencies.BufferController.BUFFER_LOADED||a[b].firstBufferLoadedEvent||(a[b].firstBufferLoadedEvent=!0)},d=function(){a={}};return{log:void 0,metricsModel:void 0,playbackController:void 0,setup:function(){this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING]=d},execute:function(d,e){var f=this,g=(new Date).getTime(),h=d.getMediaInfo().type,i=d.getCurrentValue(),j=f.metricsModel.getReadOnlyMetricsFor(h),k=j.BufferState.length>0?j.BufferState[j.BufferState.length-1]:null,l=new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,MediaPlayer.rules.SwitchRequest.prototype.WEAK);return 1e3>g-b||null===k?void e(l):(c(h,k.state),k.state===MediaPlayer.dependencies.BufferController.BUFFER_EMPTY&&void 0!==a[h].firstBufferLoadedEvent&&(l=new MediaPlayer.rules.SwitchRequest(0,MediaPlayer.rules.SwitchRequest.prototype.STRONG)),l.value!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&l.value!==i&&f.log("InsufficientBufferRule requesting switch to index: ",l.value,"type: ",h," Priority: ",l.priority===MediaPlayer.rules.SwitchRequest.prototype.DEFAULT?"Default":l.priority===MediaPlayer.rules.SwitchRequest.prototype.STRONG?"Strong":"Weak"),b=g,void e(l))},reset:function(){a={},b=0}}},MediaPlayer.rules.InsufficientBufferRule.prototype={constructor:MediaPlayer.rules.InsufficientBufferRule},MediaPlayer.rules.ThroughputRule=function(){"use strict";var a=[],b=0,c=2,d=3,e=function(b,c){a[b]=a[b]||[],c!==1/0&&c!==a[b][a[b].length-1]&&a[b].push(c)},f=function(b,e){var f=0,g=e?c:d,h=a[b],i=h.length;if(g=g>i?i:g,i>0){for(var j=i-g,k=0,l=j;i>l;l++)k+=h[l];f=k/g}return h.length>g&&h.shift(),f*MediaPlayer.dependencies.AbrController.BANDWIDTH_SAFETY/1e3};return{log:void 0,metricsExt:void 0,metricsModel:void 0,manifestExt:void 0,manifestModel:void 0,execute:function(a,c){var d,g,h,i=this,j=(new Date).getTime()/1e3,k=a.getMediaInfo(),l=k.type,m=a.getCurrentValue(),n=a.getTrackInfo(),o=i.metricsModel.getReadOnlyMetricsFor(l),p=a.getStreamProcessor(),q=p.getABRController(),r=p.isDynamic(),s=i.metricsExt.getCurrentHttpRequest(o),t=isNaN(n.fragmentDuration)?2:n.fragmentDuration/2,u=o.BufferState.length>0?o.BufferState[o.BufferState.length-1]:null,v=o.BufferLevel.length>0?o.BufferLevel[o.BufferLevel.length-1]:null,w=new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,MediaPlayer.rules.SwitchRequest.prototype.WEAK);if(t>j-b||!o||null===s||s.type!==MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE||null===u||null===v)return void c(w);if(d=(s.tfinish.getTime()-s.tresponse.getTime())/1e3,s.trace.length&&(h=Math.round(8*s.trace[s.trace.length-1].b/d),e(l,h)),g=Math.round(f(l,r)),q.setAverageThroughput(l,g),q.getAbandonmentStateFor(l)!==MediaPlayer.dependencies.AbrController.ABANDON_LOAD){if(u.state===MediaPlayer.dependencies.BufferController.BUFFER_LOADED&&(v.level>=2*MediaPlayer.dependencies.BufferController.LOW_BUFFER_THRESHOLD||r)){var x=q.getQualityForBitrate(k,g);w=new MediaPlayer.rules.SwitchRequest(x,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT)}w.value!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&w.value!==m&&i.log("ThroughputRule requesting switch to index: ",w.value,"type: ",l," Priority: ",w.priority===MediaPlayer.rules.SwitchRequest.prototype.DEFAULT?"Default":w.priority===MediaPlayer.rules.SwitchRequest.prototype.STRONG?"Strong":"Weak","Average throughput",Math.round(g),"kbps")}c(w)},reset:function(){a=[],b=0}}},MediaPlayer.rules.ThroughputRule.prototype={constructor:MediaPlayer.rules.ThroughputRule},MediaPlayer.rules.RulesContext=function(a,b){"use strict";var c=a.getCurrentRepresentationInfo(),d=a;return{getStreamInfo:function(){return c.mediaInfo.streamInfo},getMediaInfo:function(){return c.mediaInfo},getTrackInfo:function(){return c},getCurrentValue:function(){return b},getManifestInfo:function(){return c.mediaInfo.streamInfo.manifestInfo},getStreamProcessor:function(){return d}}},MediaPlayer.rules.RulesContext.prototype={constructor:MediaPlayer.rules.RulesContext},MediaPlayer.rules.RulesController=function(){"use strict";var a={},b=["execute"],c=function(a){return a===this.SCHEDULING_RULE||a===this.ABR_RULE},d=function(a){var c=b.length,d=0;for(d;c>d;d+=1)if(!a.hasOwnProperty(b[d]))return!1;return!0},e=function(a,b){return new MediaPlayer.rules.RulesContext(a,b)},f=function(a){var b=a.execute.bind(a);return a.execute=function(c,d){b(c,function(b){d.call(a,new MediaPlayer.rules.SwitchRequest(b.value,b.priority))})},"function"!=typeof a.reset&&(a.reset=function(){}),a},g=function(a,b,c){var e,g,h,i,j,k;for(g in b)if(i=b[g],j=i.length)for(k=0;j>k;k+=1)e=i[k],d.call(this,e)&&(e=f.call(this,e),h=a.getRules(g),c&&(c=!1,h.length=0),this.system.injectInto(e),h.push(e))};return{system:void 0,log:void 0,SCHEDULING_RULE:0,ABR_RULE:1,SYNC_RULE:2,initialize:function(){a[this.ABR_RULE]=this.system.getObject("abrRulesCollection"),a[this.SCHEDULING_RULE]=this.system.getObject("scheduleRulesCollection"),a[this.SYNC_RULE]=this.system.getObject("synchronizationRulesCollection")},setRules:function(b,d){c.call(this,b)&&d&&g.call(this,a[b],d,!0)},addRules:function(b,d){c.call(this,b)&&d&&g.call(this,a[b],d,!1)},applyRules:function(a,b,c,f,g){var h,i,j=a.length,k=j,l={},m=e.call(this,b,f),n=function(a){var b,d;a.value!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(l[a.priority]=g(l[a.priority],a.value)),--j||(l[MediaPlayer.rules.SwitchRequest.prototype.WEAK]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(d=MediaPlayer.rules.SwitchRequest.prototype.WEAK,b=l[MediaPlayer.rules.SwitchRequest.prototype.WEAK]),l[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(d=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,b=l[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]),l[MediaPlayer.rules.SwitchRequest.prototype.STRONG]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(d=MediaPlayer.rules.SwitchRequest.prototype.STRONG,b=l[MediaPlayer.rules.SwitchRequest.prototype.STRONG]),d!=MediaPlayer.rules.SwitchRequest.prototype.STRONG&&d!=MediaPlayer.rules.SwitchRequest.prototype.WEAK&&(d=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT),c({value:void 0!==b?b:f,confidence:d}))};for(l[MediaPlayer.rules.SwitchRequest.prototype.STRONG]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,l[MediaPlayer.rules.SwitchRequest.prototype.WEAK]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,l[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,i=0;k>i;i+=1)h=a[i],d.call(this,h)?h.execute(m,n):j--},reset:function(){var b,c,d=a[this.ABR_RULE],e=a[this.SCHEDULING_RULE],f=a[this.SYNC_RULE],g=(d.getRules(MediaPlayer.rules.ABRRulesCollection.prototype.QUALITY_SWITCH_RULES)||[]).concat(e.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.NEXT_FRAGMENT_RULES)||[]).concat(e.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_SCHEDULE_RULES)||[]).concat(e.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_EXECUTE_RULES)||[]).concat(f.getRules(MediaPlayer.rules.SynchronizationRulesCollection.prototype.TIME_SYNCHRONIZED_RULES)||[]).concat(f.getRules(MediaPlayer.rules.SynchronizationRulesCollection.prototype.BEST_GUESS_RULES)||[]),h=g.length;for(c=0;h>c;c+=1)b=g[c],"function"==typeof b.reset&&b.reset();a={}}}},MediaPlayer.rules.RulesController.prototype={constructor:MediaPlayer.rules.RulesController},MediaPlayer.rules.BufferLevelRule=function(){"use strict";var a={},b={},c={},d=function(a){var b=this.metricsExt.getCurrentHttpRequest(a);return null!==b?(b.tresponse.getTime()-b.trequest.getTime())/1e3:0},e=function(a,b,c){return c?this.playbackController.getLiveDelay():isNaN(b)||MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME<b&&b>a?Math.max(MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME,a):a>=b?Math.min(b,MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME):Math.min(b,a)},f=function(a,b,c){var f=this,g=c.bufferController.getCriticalBufferLevel(),h=f.metricsModel.getReadOnlyMetricsFor("video"),i=f.metricsModel.getReadOnlyMetricsFor("audio"),j=e.call(this,c.bufferController.getMinBufferTime(),b,a),k=j,l=c.bufferController.bufferMax,m=0;return l===MediaPlayer.dependencies.BufferController.BUFFER_SIZE_MIN?m=j:l===MediaPlayer.dependencies.BufferController.BUFFER_SIZE_INFINITY?m=b:l===MediaPlayer.dependencies.BufferController.BUFFER_SIZE_REQUIRED&&(!a&&f.abrController.isPlayingAtTopQuality(c.streamProcessor.getStreamInfo())&&(k=MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY),m=k+Math.max(d.call(f,h),d.call(f,i))),m=Math.min(m,g)},g=function(a,c){return b[a]&&b[a][c]},h=function(b,c){return a[b]&&a[b][c]},i=function(a){var c=a.data.fragmentModel.getContext().streamProcessor.getStreamInfo().id;b[c]=b[c]||{},b[c][a.data.request.mediaType]=!0},j=function(b){var c=b.sender.streamProcessor.getStreamInfo().id;a[c]=a[c]||{},a[c][b.sender.streamProcessor.getType()]=!0},k=function(b){var c=b.sender.streamProcessor.getStreamInfo().id;a[c]=a[c]||{},a[c][b.sender.streamProcessor.getType()]=!1};return{metricsExt:void 0,metricsModel:void 0,abrController:void 0,playbackController:void 0,mediaController:void 0,virtualBuffer:void 0,setup:function(){this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN]=j,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED]=k,this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED]=i},setScheduleController:function(a){var b=a.streamProcessor.getStreamInfo().id;c[b]=c[b]||{},c[b][a.streamProcessor.getType()]=a},execute:function(a,b){var d=a.getStreamInfo(),e=d.id,i=a.getMediaInfo(),j=i.type;if(h(e,j))return void b(new MediaPlayer.rules.SwitchRequest(0,MediaPlayer.rules.SwitchRequest.prototype.STRONG));var k,l=this.metricsModel.getReadOnlyMetricsFor(j),m=this.mediaController.getSwitchMode(),n=this.metricsExt.getCurrentBufferLevel(l)?this.metricsExt.getCurrentBufferLevel(l).level:0,o=this.playbackController.getTime(),p=this.virtualBuffer.getChunks({streamId:e,mediaType:j,appended:!0,mediaInfo:i,forRange:{start:o,end:o+n}}),q=p&&p.length>0?p[p.length-1].bufferedRange.end-o:null,r=m===MediaPlayer.dependencies.MediaController.trackSwitchModes.NEVER_REPLACE?n:q||0,s=c[e][j],t=s.streamProcessor.getCurrentRepresentationInfo(),u=s.streamProcessor.isDynamic(),v=this.metricsExt.getCurrentPlaybackRate(l),w=d.manifestInfo.duration,x=r/Math.max(v,1),y=t.fragmentDuration,z=u?Number.POSITIVE_INFINITY:w-o,A=Math.min(f.call(this,u,w,s),z),B=Math.max(A-x,0);k=Math.ceil(B/y),x>=z&&!g(e,j)&&(k=k||1),b(new MediaPlayer.rules.SwitchRequest(k,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT))},reset:function(){a={},b={},c={}}}},MediaPlayer.rules.BufferLevelRule.prototype={constructor:MediaPlayer.rules.BufferLevelRule},MediaPlayer.rules.PendingRequestsRule=function(){"use strict";var a={};return{metricsExt:void 0,setScheduleController:function(b){var c=b.streamProcessor.getStreamInfo().id;a[c]=a[c]||{},a[c][b.streamProcessor.getType()]=b},execute:function(b,c){var d=b.getMediaInfo().type,e=b.getStreamInfo().id,f=b.getCurrentValue(),g=a[e][d],h=g.getFragmentModel(),i=h.getRequests({state:[MediaPlayer.dependencies.FragmentModel.states.PENDING,MediaPlayer.dependencies.FragmentModel.states.LOADING]}),j=h.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.REJECTED}),k=j.length,l=i.length,m=Math.max(f-l,0);return k>0?void c(new MediaPlayer.rules.SwitchRequest(k,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT)):l>3?void c(new MediaPlayer.rules.SwitchRequest(0,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT)):0===f?void c(new MediaPlayer.rules.SwitchRequest(m,MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE)):void c(new MediaPlayer.rules.SwitchRequest(m,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT))},reset:function(){a={}}}},MediaPlayer.rules.PendingRequestsRule.prototype={constructor:MediaPlayer.rules.PendingRequestsRule},MediaPlayer.rules.PlaybackTimeRule=function(){"use strict";var a={},b={},c=function(b){setTimeout(function(){var c=b.data.seekTime;a.audio=c,a.video=c,a.fragmentedText=c},0)};return{adapter:void 0,sourceBufferExt:void 0,virtualBuffer:void 0,playbackController:void 0,textSourceBuffer:void 0,setup:function(){this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING]=c},setScheduleController:function(a){var c=a.streamProcessor.getStreamInfo().id;b[c]=b[c]||{},b[c][a.streamProcessor.getType()]=a},execute:function(c,d){var e,f,g,h=c.getMediaInfo(),i=h.type,j=c.getStreamInfo().id,k=b[j][i],l=.1,m=b[j][i].streamProcessor,n=m.getCurrentRepresentationInfo(),o=a?a[i]:null,p=void 0!==o&&null!==o,q=p?MediaPlayer.rules.SwitchRequest.prototype.STRONG:MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,r=k.getFragmentModel().getRequests({state:MediaPlayer.dependencies.FragmentModel.states.REJECTED})[0],s=!!r&&!p,t=m.getIndexHandlerTime(),u=this.playbackController.getTime(),v=r?r.startTime+r.duration:null,w=!p&&r&&(v>u&&r.startTime<=t||isNaN(t)),x=m.bufferController.getBuffer(),y=null;if(f=p?o:w?r.startTime:t,!p&&!r&&f>u+MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY)return void d(new MediaPlayer.rules.SwitchRequest(null,q));if(r&&k.getFragmentModel().removeRejectedRequest(r),isNaN(f)||"fragmentedText"===i&&this.textSourceBuffer.getAllTracksAreDisabled())return void d(new MediaPlayer.rules.SwitchRequest(null,q));for(p&&(a[i]=null),x&&null!==(y=this.sourceBufferExt.getBufferRange(m.bufferController.getBuffer(),f))&&(e=this.virtualBuffer.getChunks({streamId:j,mediaType:i,appended:!0,mediaInfo:h,forRange:y}))&&e.length>0&&(f=e[e.length-1].bufferedRange.end),g=this.adapter.getFragmentRequestForTime(m,n,f,{keepIdx:s}),w&&g&&g.index!==r.index&&(g=this.adapter.getFragmentRequestForTime(m,n,r.startTime+r.duration/2+l,{keepIdx:s,timeThreshold:0}));g&&m.getFragmentModel().isFragmentLoadedOrPending(g);){if("complete"===g.action){g=null,m.setIndexHandlerTime(NaN);break}g=this.adapter.getNextFragmentRequest(m,n)}g&&!w&&m.setIndexHandlerTime(g.startTime+g.duration),d(new MediaPlayer.rules.SwitchRequest(g,q))},reset:function(){a={},b={}}}},MediaPlayer.rules.PlaybackTimeRule.prototype={constructor:MediaPlayer.rules.PlaybackTimeRule},MediaPlayer.rules.SameTimeRequestRule=function(){"use strict";var a={},b=function(a,b){var c,e,f,g,h,i=0,j=a.length;for(i;j>i;i+=1)for(f=a[i].getRequests({state:MediaPlayer.dependencies.FragmentModel.states.PENDING}),d.call(this,f,"index"),g=0,h=f.length;h>g;g++){if(c=f[g],isNaN(c.startTime)&&"complete"!==c.action){e=c;break}c.startTime>b&&(!e||c.startTime<e.startTime)&&(e=c)}return e||c},c=function(a,b){var c,d,e=a.length,f=null;for(d=0;e>d;d+=1)(c=a[d].getRequests({state:MediaPlayer.dependencies.FragmentModel.states.PENDING,time:b})[0])&&(!f||c.startTime>f.startTime)&&(f=c);return f},d=function(a,b){var c=function(a,c){return a[b]<c[b]||isNaN(a[b])&&"complete"!==a.action?-1:a[b]>c[b]?1:0}
;a.sort(c)},e=function(b,c){return a[b]&&a[b][c]?a[b][c]:NaN},f=function(b){var c=b.data.fragmentModel,d=b.data.request,e=c.getContext().streamProcessor.getStreamInfo().id,f=d.mediaType;a[e]=a[e]||{},a[e][f]=d.index-1};return{playbackController:void 0,setup:function(){this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED]=f},setFragmentModels:function(a,b){this.fragmentModels=this.fragmentModels||{},this.fragmentModels[b]=a},execute:function(a,d){var f,g,h,i,j,k,l,m,n,o=a.getStreamInfo().id,p=a.getCurrentValue(),q=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,r=this.fragmentModels[o],s=new Date,t=null,u=r?r.length:null,v=!1,w=[];if(!r||!u)return void d(new MediaPlayer.rules.SwitchRequest([],q));if(k=this.playbackController.getTime(),l=c(r,k),!(j=l||b(r,k)||p))return void d(new MediaPlayer.rules.SwitchRequest([],q));for(i=0;u>i;i+=1)if(g=r[i],("video"===(f=g.getContext().streamProcessor.getType())||"audio"===f||"fragmentedText"===f)&&(m=g.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.PENDING}),n=g.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.LOADING}).length,!g.getIsPostponed()||isNaN(j.startTime))){if(n>MediaPlayer.dependencies.ScheduleController.LOADING_REQUEST_THRESHOLD)return void d(new MediaPlayer.rules.SwitchRequest([],q));if(t=t||(j===l?k:j.startTime),-1===m.indexOf(j)){if(h=g.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.PENDING,time:t})[0],h||0!==j.index||(h=m.filter(function(a){return a.index===j.index})[0]),h)w.push(h);else if(!(h=g.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.LOADING,time:t})[0]||g.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.EXECUTED,time:t})[0])&&j.index!==e.call(this,o,j.mediaType)&&"fragmentedText"!==f){v=!0;break}}else w.push(j)}return w=w.filter(function(a){return"complete"===a.action||s.getTime()>=a.availabilityStartTime.getTime()}),v?void d(new MediaPlayer.rules.SwitchRequest([],q)):void d(new MediaPlayer.rules.SwitchRequest(w,q))},reset:function(){a={}}}},MediaPlayer.rules.SameTimeRequestRule.prototype={constructor:MediaPlayer.rules.SameTimeRequestRule},MediaPlayer.rules.ScheduleRulesCollection=function(){"use strict";var a=[],b=[],c=[];return{bufferLevelRule:void 0,pendingRequestsRule:void 0,playbackTimeRule:void 0,sameTimeRequestRule:void 0,getRules:function(d){switch(d){case MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_SCHEDULE_RULES:return a;case MediaPlayer.rules.ScheduleRulesCollection.prototype.NEXT_FRAGMENT_RULES:return c;case MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_EXECUTE_RULES:return b;default:return null}},setup:function(){a.push(this.bufferLevelRule),a.push(this.pendingRequestsRule),c.push(this.playbackTimeRule),b.push(this.sameTimeRequestRule)}}},MediaPlayer.rules.ScheduleRulesCollection.prototype={constructor:MediaPlayer.rules.ScheduleRulesCollection,FRAGMENTS_TO_SCHEDULE_RULES:"fragmentsToScheduleRules",NEXT_FRAGMENT_RULES:"nextFragmentRules",FRAGMENTS_TO_EXECUTE_RULES:"fragmentsToExecuteRules"},MediaPlayer.rules.SwitchRequest=function(a,b){"use strict";this.value=a,this.priority=b,void 0===this.value&&(this.value=999),void 0===this.priority&&(this.priority=.5)},MediaPlayer.rules.SwitchRequest.prototype={constructor:MediaPlayer.rules.SwitchRequest,NO_CHANGE:999,DEFAULT:.5,STRONG:1,WEAK:0},MediaPlayer.rules.LiveEdgeBinarySearchRule=function(){"use strict";var a,b,c,d=43200,e=NaN,f=null,g=NaN,h=null,i=!1,j=NaN,k=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,l=function(a,d,e,f){var g,i=this;if(null===f)g=i.adapter.generateFragmentRequestForTime(c,h,a),l.call(i,a,d,e,g);else{var j=function(c){b.unsubscribe(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,i,j),c.data.exists?d.call(i,c.data.request,a):e.call(i,c.data.request,a)};b.subscribe(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,i,j),b.checkForExistence(f)}},m=function(b,d){var j,p,q;return i?void o.call(this,!1,d):(q=d-e,j=q>0?e-q:e+Math.abs(q)+g,void(j<f.start&&j>f.end?a(new MediaPlayer.rules.SwitchRequest(null,k)):(p=this.adapter.getFragmentRequestForTime(c,h,j,{ignoreIsFinished:!0}),l.call(this,j,n,m,p))))},n=function(b,d){var m,n,p=b.startTime,q=this;if(!i){if(!h.fragmentDuration)return void a(new MediaPlayer.rules.SwitchRequest(p,k));if(i=!0,f.end=p+2*g,d===e)return n=d+j,m=q.adapter.getFragmentRequestForTime(c,h,n,{ignoreIsFinished:!0}),void l.call(q,n,function(){o.call(q,!0,n)},function(){a(new MediaPlayer.rules.SwitchRequest(n,k))},m)}o.call(this,!0,d)},o=function(b,d){var e,g,i;b?f.start=d:f.end=d,e=Math.floor(f.end-f.start)<=j,e?a(new MediaPlayer.rules.SwitchRequest(b?d:d-j,k)):(i=(f.start+f.end)/2,g=this.adapter.getFragmentRequestForTime(c,h,i,{ignoreIsFinished:!0}),l.call(this,i,n,m,g))};return{metricsExt:void 0,adapter:void 0,timelineConverter:void 0,execute:function(i,o){var p,q,r=this;if(a=o,c=i.getStreamProcessor(),b=c.getFragmentLoader(),h=i.getTrackInfo(),j=h.fragmentDuration,q=h.DVRWindow,e=q.end,h.useCalculatedLiveEdgeTime){var s=r.timelineConverter.getExpectedLiveEdge();return r.timelineConverter.setExpectedLiveEdge(e),void a(new MediaPlayer.rules.SwitchRequest(s,k))}f={start:Math.max(0,e-d),end:e+d},g=Math.floor((q.end-q.start)/2),p=r.adapter.getFragmentRequestForTime(c,h,e,{ignoreIsFinished:!0}),l.call(r,e,n,m,p)},reset:function(){e=NaN,f=null,g=NaN,h=null,i=!1,j=NaN,c=null,b=null}}},MediaPlayer.rules.LiveEdgeBinarySearchRule.prototype={constructor:MediaPlayer.rules.LiveEdgeBinarySearchRule},MediaPlayer.rules.LiveEdgeWithTimeSynchronizationRule=function(){"use strict";return{timelineConverter:void 0,execute:function(a,b){var c=a.getTrackInfo(),d=c.DVRWindow.end,e=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT;if(c.useCalculatedLiveEdgeTime){var f=this.timelineConverter.getExpectedLiveEdge();this.timelineConverter.setExpectedLiveEdge(d),b(new MediaPlayer.rules.SwitchRequest(f,e))}else b(new MediaPlayer.rules.SwitchRequest(d,e))}}},MediaPlayer.rules.LiveEdgeWithTimeSynchronizationRule.prototype={constructor:MediaPlayer.rules.LiveEdgeWithTimeSynchronizationRule},MediaPlayer.rules.SynchronizationRulesCollection=function(){"use strict";var a=[],b=[];return{liveEdgeBinarySearchRule:void 0,liveEdgeWithTimeSynchronizationRule:void 0,getRules:function(c){switch(c){case MediaPlayer.rules.SynchronizationRulesCollection.prototype.TIME_SYNCHRONIZED_RULES:return a;case MediaPlayer.rules.SynchronizationRulesCollection.prototype.BEST_GUESS_RULES:return b;default:return null}},setup:function(){a.push(this.liveEdgeWithTimeSynchronizationRule),b.push(this.liveEdgeBinarySearchRule)}}},MediaPlayer.rules.SynchronizationRulesCollection.prototype={constructor:MediaPlayer.rules.SynchronizationRulesCollection,TIME_SYNCHRONIZED_RULES:"withAccurateTimeSourceRules",BEST_GUESS_RULES:"bestGuestRules"},MediaPlayer.utils.BoxParser=function(){"use strict";return{system:void 0,log:void 0,parse:function(a){if(!a)return null;void 0===a.fileStart&&(a.fileStart=0);var b=ISOBoxer.parseBuffer(a),c=this.system.getObject("isoFile");return c.setData(b),c}}},MediaPlayer.utils.BoxParser.prototype={constructor:MediaPlayer.utils.BoxParser},MediaPlayer.utils.Capabilities=function(){"use strict"},MediaPlayer.utils.Capabilities.prototype={constructor:MediaPlayer.utils.Capabilities,system:void 0,log:void 0,supportsMediaSource:function(){"use strict";var a="WebKitMediaSource"in window,b="MediaSource"in window;return a||b},supportsEncryptedMedia:function(){return this.system.hasMapping("protectionModel")},supportsCodec:function(a,b){"use strict";if(!(a instanceof HTMLMediaElement))throw"element must be of type HTMLMediaElement.";var c=a.canPlayType(b);return"probably"===c||"maybe"===c}},MediaPlayer.utils.CustomTimeRanges=function(){return{customTimeRangeArray:[],length:0,add:function(a,b){var c=0;for(c=0;c<this.customTimeRangeArray.length&&a>this.customTimeRangeArray[c].start;c++);for(this.customTimeRangeArray.splice(c,0,{start:a,end:b}),c=0;c<this.customTimeRangeArray.length-1;c++)this.mergeRanges(c,c+1)&&c--;this.length=this.customTimeRangeArray.length},clear:function(){this.customTimeRangeArray=[],this.length=0},remove:function(a,b){for(var c=0;c<this.customTimeRangeArray.length;c++)if(a<=this.customTimeRangeArray[c].start&&b>=this.customTimeRangeArray[c].end)this.customTimeRangeArray.splice(c,1),c--;else{if(a>this.customTimeRangeArray[c].start&&b<this.customTimeRangeArray[c].end){this.customTimeRangeArray.splice(c+1,0,{start:b,end:this.customTimeRangeArray[c].end}),this.customTimeRangeArray[c].end=a;break}a>this.customTimeRangeArray[c].start&&a<this.customTimeRangeArray[c].end?this.customTimeRangeArray[c].end=a:b>this.customTimeRangeArray[c].start&&b<this.customTimeRangeArray[c].end&&(this.customTimeRangeArray[c].start=b)}this.length=this.customTimeRangeArray.length},mergeRanges:function(a,b){var c=this.customTimeRangeArray[a],d=this.customTimeRangeArray[b];return c.start<=d.start&&d.start<=c.end&&c.end<=d.end?(c.end=d.end,this.customTimeRangeArray.splice(b,1),!0):d.start<=c.start&&c.start<=d.end&&d.end<=c.end?(c.start=d.start,this.customTimeRangeArray.splice(b,1),!0):d.start<=c.start&&c.start<=d.end&&c.end<=d.end?(this.customTimeRangeArray.splice(a,1),!0):c.start<=d.start&&d.start<=c.end&&d.end<=c.end&&(this.customTimeRangeArray.splice(b,1),!0)},start:function(a){return this.customTimeRangeArray[a].start},end:function(a){return this.customTimeRangeArray[a].end}}},MediaPlayer.utils.CustomTimeRanges.prototype={constructor:MediaPlayer.utils.CustomTimeRanges},MediaPlayer.utils.DOMStorage=function(){var a,b=!0,c=!0,d=function(a,b){void 0===b||isNaN(b)||"number"!=typeof b||(MediaPlayer.utils.DOMStorage[a]=b)},e=function(a){if(!this.isSupported(MediaPlayer.utils.DOMStorage.STORAGE_TYPE_LOCAL)||!c)return null;var b=MediaPlayer.utils.DOMStorage["LOCAL_STORAGE_"+a.toUpperCase()+"_SETTINGS_KEY"],d=JSON.parse(localStorage.getItem(b))||{},e=(new Date).getTime()-parseInt(d.timestamp)>=MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_MEDIA_SETTINGS_EXPIRATION||!1,f=d.settings;return e&&(localStorage.removeItem(b),f=null),f};return{system:void 0,log:void 0,abrController:void 0,checkInitialBitrate:function(){["video","audio"].forEach(function(a){if(void 0===this.abrController.getInitialBitrateFor(a)){if(this.isSupported(MediaPlayer.utils.DOMStorage.STORAGE_TYPE_LOCAL)&&b){var c=MediaPlayer.utils.DOMStorage["LOCAL_STORAGE_"+a.toUpperCase()+"_BITRATE_KEY"],d=JSON.parse(localStorage.getItem(c))||{},e=(new Date).getTime()-parseInt(d.timestamp)>=MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_BITRATE_EXPIRATION||!1,f=parseInt(d.bitrate);isNaN(f)||e?e&&localStorage.removeItem(c):(this.abrController.setInitialBitrateFor(a,f),this.log("Last bitrate played for "+a+" was "+f))}void 0===this.abrController.getInitialBitrateFor(a)&&this.abrController.setInitialBitrateFor(a,MediaPlayer.dependencies.AbrController["DEFAULT_"+a.toUpperCase()+"_BITRATE"])}},this)},getSavedMediaSettings:e,enableLastBitrateCaching:function(a,c){b=a,d.call(this,"LOCAL_STORAGE_BITRATE_EXPIRATION",c)},enableLastMediaSettingsCaching:function(a,b){c=a,d.call(this,"LOCAL_STORAGE_MEDIA_SETTINGS_EXPIRATION",b)},isSupported:function(b){if(void 0!==a)return a;a=!1;var c,d="1",e="1";try{c=window[b]}catch(b){return this.log("Warning: DOMStorage access denied: "+b.message),a}if(!c||b!==MediaPlayer.utils.DOMStorage.STORAGE_TYPE_LOCAL&&b!==MediaPlayer.utils.DOMStorage.STORAGE_TYPE_SESSION)return a;try{c.setItem(d,e),c.removeItem(d),a=!0}catch(a){this.log("Warning: DOMStorage is supported, but cannot be used: "+a.message)}return a}}},MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_VIDEO_BITRATE_KEY="dashjs_vbitrate",MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_AUDIO_BITRATE_KEY="dashjs_abitrate",MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_AUDIO_SETTINGS_KEY="dashjs_asettings",MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_VIDEO_SETTINGS_KEY="dashjs_vsettings",MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_BITRATE_EXPIRATION=36e4,MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_MEDIA_SETTINGS_EXPIRATION=36e4,MediaPlayer.utils.DOMStorage.STORAGE_TYPE_LOCAL="localStorage",MediaPlayer.utils.DOMStorage.STORAGE_TYPE_SESSION="sessionStorage",MediaPlayer.utils.DOMStorage.prototype={constructor:MediaPlayer.utils.DOMStorage},MediaPlayer.utils.Debug=function(){"use strict";var a,b=!0,c=!1,d=!1,e=(new Date).getTime();return{system:void 0,eventBus:void 0,setup:function(){this.system.mapValue("log",this.log),this.system.mapOutlet("log"),a=this.eventBus},setLogTimestampVisible:function(a){c=a},showCalleeName:function(a){d=a},setLogToBrowserConsole:function(a){b=a},getLogToBrowserConsole:function(){return b},log:function(){var f="",g=null;c&&(g=(new Date).getTime(),f+="["+(g-e)+"]"),d&&this.getName&&(f+="["+this.getName()+"]"),this.getMediaType&&this.getMediaType()&&(f+="["+this.getMediaType()+"]"),f.length>0&&(f+=" "),Array.apply(null,arguments).forEach(function(a){f+=a+" "}),b&&console.log(f),a.dispatchEvent({type:"log",message:f})}}},MediaPlayer.utils.EventBus=function(){"use strict";var a,b=function(b,c){var d=(c?"1":"0")+b;return d in a||(a[d]=[]),a[d]};return function(){a={}}(),{addEventListener:function(a,c,d){var e=b(a,d);-1===e.indexOf(c)&&e.push(c)},removeEventListener:function(a,c,d){var e=b(a,d),f=e.indexOf(c);-1!==f&&e.splice(f,1)},dispatchEvent:function(a){for(var c=b(a.type,!1).slice(),d=0;d<c.length;d++)c[d].call(this,a);return!a.defaultPrevented}}},MediaPlayer.utils.IsoFile=function(){"use strict";var a,b={offset:"_offset",size:"size",type:"type"},c={references:"references",timescale:"timescale",earliest_presentation_time:"earliest_presentation_time",first_offset:"first_offset"},d={reference_type:"reference_type",referenced_size:"referenced_size",subsegment_duration:"subsegment_duration"},e={id:"id",value:"value",timescale:"timescale",scheme_id_uri:"scheme_id_uri",presentation_time_delta:"presentation_time_delta",event_duration:"event_duration",message_data:"message_data"},f={timescale:"timescale"},g={base_data_offset:"base_data_offset",sample_description_index:"sample_description_index",default_sample_duration:"default_sample_duration",default_sample_size:"default_sample_size",default_sample_flags:"default_sample_flags",flags:"flags"},h={version:"version",baseMediaDecodeTime:"baseMediaDecodeTime",flags:"flags"},i={sample_count:"sample_count",first_sample_flags:"first_sample_flags",data_offset:"data_offset",flags:"flags",samples:"samples"},j={sample_size:"sample_size",sample_duration:"sample_duration",sample_composition_time_offset:"sample_composition_time_offset"},k=function(a,b,c){for(var d in c)b[d]=a[c[d]]},l=function(a){if(!a)return null;var l,m,n=new MediaPlayer.vo.IsoBox;switch(k(a,n,b),a.hasOwnProperty("_incomplete")&&(n.isComplete=!a._incomplete),n.type){case"sidx":if(k(a,n,c),n.references)for(l=0,m=n.references.length;m>l;l+=1)k(a.references[l],n.references[l],d);break;case"emsg":k(a,n,e);break;case"mdhd":k(a,n,f);break;case"tfhd":k(a,n,g);break;case"tfdt":k(a,n,h);break;case"trun":if(k(a,n,i),n.samples)for(l=0,m=n.samples.length;m>l;l+=1)k(a.samples[l],n.samples[l],j)}return n},m=function(b){return b&&a&&a.boxes&&0!==a.boxes.length?l.call(this,a.fetch(b)):null},n=function(b){for(var c,d=a.fetchAll(b),e=[],f=0,g=d.length;g>f;f+=1)(c=l.call(this,d[f]))&&e.push(c);return e};return{getBox:m,getBoxes:n,setData:function(b){a=b},getLastBox:function(){if(!a||!a.boxes||!a.boxes.length)return null;var b=a.boxes[a.boxes.length-1].type,c=n.call(this,b);return c[c.length-1]},getOffset:function(){return a._cursor.offset}}},MediaPlayer.utils.IsoFile.prototype={constructor:MediaPlayer.utils.IsoFile},MediaPlayer.utils.VirtualBuffer=function(){var a={},b=function(a,b){var c=function(a,c){return a[b]<c[b]?-1:a[b]>c[b]?1:0};a.sort(c)},c=function(b){var c=b.streamId,d=b.mediaType;return a[c]?a[c][d]:null},d=function(a,b,c){var d,e,f,g,h=[],i=b.start,j=b.end;return a.forEach(function(a){d=a.bufferedRange.start,e=a.bufferedRange.end,f=d>=i&&j>d,g=e>i&&j>=e,(f||g)&&(h.push(a),c&&(a.bufferedRange.start=f?d:i,a.bufferedRange.end=g?e:j))}),h},e=function(){var a={};return a.audio={calculatedBufferedRanges:new MediaPlayer.utils.CustomTimeRanges,actualBufferedRanges:new MediaPlayer.utils.CustomTimeRanges,appended:[]},a.audio[MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE]=[],a.audio[MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE]=[],a.video={calculatedBufferedRanges:new MediaPlayer.utils.CustomTimeRanges,actualBufferedRanges:new MediaPlayer.utils.CustomTimeRanges,appended:[]},a.video[MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE]=[],a.video[MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE]=[],a.fragmentedText={calculatedBufferedRanges:new MediaPlayer.utils.CustomTimeRanges,actualBufferedRanges:new MediaPlayer.utils.CustomTimeRanges,appended:[]},a.fragmentedText[MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE]=[],a.fragmentedText[MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE]=[],a};return{system:void 0,sourceBufferExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,append:function(c){var d=c.streamId,f=c.mediaInfo.type,g=c.segmentType,h=c.start,i=c.end;a[d]=a[d]||e(),a[d][f][g].push(c),b(a[d][f][g],"index"),isNaN(h)||isNaN(i)||(a[d][f].calculatedBufferedRanges.add(h,i),this.notify(MediaPlayer.utils.VirtualBuffer.eventList.CHUNK_APPENDED,{chunk:c}))},storeAppendedChunk:function(c,d){if(c&&d){var e,f,g=c.streamId,h=c.mediaInfo.type,i=a[g][h].actualBufferedRanges,j=this.getChunks({streamId:g,mediaType:h,appended:!0,start:c.start})[0];if(j?(f=a[g][h].appended.indexOf(j),a[g][h].appended[f]=c):a[g][h].appended.push(c),b(a[g][h].appended,"start"),!(e=this.sourceBufferExt.getRangeDifference(i,d)))return void(j&&(c.bufferedRange=j.bufferedRange));c.bufferedRange=e,i.add(e.start,e.end),j&&(c.bufferedRange.start=Math.min(j.bufferedRange.start,e.start),c.bufferedRange.end=Math.max(j.bufferedRange.end,e.end))}},updateBufferedRanges:function(b,c){if(b){var e,f,g=b.streamId,h=b.mediaType,i=this.getChunks({streamId:g,mediaType:h,appended:!0}),j=[];if(a[g][h].actualBufferedRanges=new MediaPlayer.utils.CustomTimeRanges,!c||0===c.length)return void(a[g][h].appended=[]);for(var k=0,l=c.length;l>k;k+=1)e=c.start(k),f=c.end(k),a[g][h].actualBufferedRanges.add(e,f),j=j.concat(d.call(this,i,{start:e,end:f},!0));a[g][h].appended=j}},getChunks:function(a){var b,e=c.call(this,a),f=a.segmentType,g=a.appended,h=a.removeOrigin,i=a.limit||Number.POSITIVE_INFINITY,j=this.system.getObject("mediaController"),k=0,l=[];return e?(delete a.streamId,delete a.mediaType,delete a.segmentType,delete a.removeOrigin,delete a.limit,delete a.appended,b=g?e.appended:f?e[f]:[],l=b.filter(function(b,c,d){if(k>=i)return!1;for(var f in a){if("mediaInfo"===f)return j.isTracksEqual(b[f],a[f]);if(a.hasOwnProperty(f)&&b[f]!=a[f])return!1}return h&&(e.calculatedBufferedRanges.remove(b.start,b.end),d.splice(c,1)),k+=1,!0}),a.forRange&&(l=d.call(this,l,a.forRange,!1)),l):l},extract:function(a){return a.removeOrigin=!0,this.getChunks(a)},getTotalBufferLevel:function(b){var c=b.type,d=0;for(var e in a)a.hasOwnProperty(e)&&(d+=this.sourceBufferExt.getTotalBufferedTime({buffered:a[e][c].calculatedBufferedRanges}));return d},reset:function(){a={}}}},MediaPlayer.utils.VirtualBuffer.prototype={constructor:MediaPlayer.utils.VirtualBuffer},MediaPlayer.utils.VirtualBuffer.eventList={CHUNK_APPENDED:"chunkAppended"},MediaPlayer.vo.BitrateInfo=function(){"use strict";this.mediaType=null,this.bitrate=null,this.qualityIndex=NaN},MediaPlayer.vo.BitrateInfo.prototype={constructor:MediaPlayer.vo.BitrateInfo},MediaPlayer.vo.DataChunk=function(){"use strict";this.streamId=null,this.mediaInfo=null,this.segmentType=null,this.quality=NaN,this.index=NaN,this.bytes=null,this.start=NaN,this.end=NaN,this.duration=NaN},MediaPlayer.vo.DataChunk.prototype={constructor:MediaPlayer.vo.DataChunk},MediaPlayer.vo.Error=function(a,b,c){"use strict";this.code=a||null,this.message=b||null,this.data=c||null},MediaPlayer.vo.Error.prototype={constructor:MediaPlayer.vo.Error},MediaPlayer.vo.Event=function(){"use strict";this.type=null,this.sender=null,this.data=null,this.error=null,this.timestamp=NaN},MediaPlayer.vo.Event.prototype={constructor:MediaPlayer.vo.Event},MediaPlayer.vo.FragmentRequest=function(){"use strict";this.action="download",this.startTime=NaN,this.mediaType=null,this.mediaInfo=null,this.type=null,this.duration=NaN,this.timescale=NaN,this.range=null,this.url=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.quality=NaN,this.index=NaN,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null,this.bytesLoaded=NaN,this.bytesTotal=NaN},MediaPlayer.vo.FragmentRequest.prototype={constructor:MediaPlayer.vo.FragmentRequest,ACTION_DOWNLOAD:"download",ACTION_COMPLETE:"complete"},MediaPlayer.vo.IsoBox=function(){"use strict";this.offset=NaN,this.type=null,this.size=NaN,this.isComplete=!0},MediaPlayer.vo.IsoBox.prototype={constructor:MediaPlayer.vo.IsoBox},MediaPlayer.vo.ManifestInfo=function(){"use strict";this.DVRWindowSize=NaN,this.loadedTime=null,this.availableFrom=null,this.minBufferTime=NaN,this.duration=NaN,this.isDynamic=!1,this.maxFragmentDuration=null},MediaPlayer.vo.ManifestInfo.prototype={constructor:MediaPlayer.vo.ManifestInfo},MediaPlayer.vo.MediaInfo=function(){"use strict";this.id=null,this.index=null,this.type=null,this.streamInfo=null,this.representationCount=0,this.lang=null,this.viewpoint=null,this.accessibility=null,this.audioChannelConfiguration=null,this.roles=null,this.codec=null,this.mimeType=null,this.contentProtection=null,this.isText=!1,this.KID=null,this.bitrateList=null},MediaPlayer.vo.MediaInfo.prototype={constructor:MediaPlayer.vo.MediaInfo},MediaPlayer.models.MetricsList=function(){"use strict";return{TcpList:[],HttpList:[],RepSwitchList:[],BufferLevel:[],BufferState:[],PlayList:[],DroppedFrames:[],SchedulingInfo:[],DVRInfo:[],ManifestUpdate:[],RequestsQueue:null}},MediaPlayer.models.MetricsList.prototype={constructor:MediaPlayer.models.MetricsList},MediaPlayer.vo.StreamInfo=function(){"use strict";this.id=null,this.index=null,this.start=NaN,this.duration=NaN,this.manifestInfo=null,this.isLast=!0},MediaPlayer.vo.StreamInfo.prototype={constructor:MediaPlayer.vo.StreamInfo},MediaPlayer.vo.TextTrackInfo=function(){"use strict";this.video=null,this.captionData=null,this.label=null,this.lang=null,this.defaultTrack=!1,this.kind=null,this.isFragmented=!1},MediaPlayer.vo.TextTrackInfo.prototype={constructor:MediaPlayer.vo.TextTrackInfo},MediaPlayer.vo.TrackInfo=function(){"use strict";this.id=null,this.quality=null,this.DVRWindow=null,this.fragmentDuration=null,this.mediaInfo=null,this.MSETimeOffset=null},MediaPlayer.vo.TrackInfo.prototype={constructor:MediaPlayer.vo.TrackInfo},MediaPlayer.vo.URIFragmentData=function(){"use strict";this.t=null,this.xywh=null,this.track=null,this.id=null,this.s=null},MediaPlayer.vo.URIFragmentData.prototype={constructor:MediaPlayer.vo.URIFragmentData},MediaPlayer.vo.metrics.BufferLevel=function(){"use strict";this.t=null,this.level=null},MediaPlayer.vo.metrics.BufferLevel.prototype={constructor:MediaPlayer.vo.metrics.BufferLevel},MediaPlayer.vo.metrics.BufferState=function(){"use strict";this.target=null,this.state=MediaPlayer.dependencies.BufferController.BUFFER_EMPTY},MediaPlayer.vo.metrics.BufferState.prototype={constructor:MediaPlayer.vo.metrics.BufferState},MediaPlayer.vo.metrics.DVRInfo=function(){"use strict";this.time=null,this.range=null,this.manifestInfo=null},MediaPlayer.vo.metrics.DVRInfo.prototype={constructor:MediaPlayer.vo.metrics.DVRInfo},MediaPlayer.vo.metrics.DroppedFrames=function(){"use strict";this.time=null,this.droppedFrames=null},MediaPlayer.vo.metrics.DroppedFrames.prototype={constructor:MediaPlayer.vo.metrics.DroppedFrames},MediaPlayer.vo.metrics.HTTPRequest=function(){"use strict";this.stream=null,this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.tfinish=null,this.responsecode=null,this.interval=null,this.mediaduration=null,this.responseHeaders=null,this.trace=[]},MediaPlayer.vo.metrics.HTTPRequest.prototype={constructor:MediaPlayer.vo.metrics.HTTPRequest},MediaPlayer.vo.metrics.HTTPRequest.Trace=function(){"use strict";this.s=null,this.d=null,this.b=[]},MediaPlayer.vo.metrics.HTTPRequest.Trace.prototype={constructor:MediaPlayer.vo.metrics.HTTPRequest.Trace},MediaPlayer.vo.metrics.HTTPRequest.MPD_TYPE="MPD",MediaPlayer.vo.metrics.HTTPRequest.XLINK_EXPANSION_TYPE="XLink Expansion",MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE="Initialization Segment",MediaPlayer.vo.metrics.HTTPRequest.INDEX_SEGMENT_TYPE="Index Segment",MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE="Media Segment",MediaPlayer.vo.metrics.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE="Bitstream Switching Segment",MediaPlayer.vo.metrics.HTTPRequest.OTHER_TYPE="other",MediaPlayer.vo.metrics.ManifestUpdate=function(){"use strict";this.mediaType=null,this.type=null,this.requestTime=null,this.fetchTime=null,this.availabilityStartTime=null,this.presentationStartTime=0,this.clientTimeOffset=0,this.currentTime=null,this.buffered=null,this.latency=0,this.streamInfo=[],this.trackInfo=[]},MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo=function(){"use strict";this.id=null,this.index=null,this.start=null,this.duration=null},MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo=function(){"use strict";this.id=null,this.index=null,this.mediaType=null,this.streamIndex=null,this.presentationTimeOffset=null,this.startNumber=null,this.fragmentInfoType=null},MediaPlayer.vo.metrics.ManifestUpdate.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate},MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo},MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo},MediaPlayer.vo.metrics.PlayList=function(){"use strict";this.stream=null,this.start=null,this.mstart=null,this.starttype=null,this.trace=[]},MediaPlayer.vo.metrics.PlayList.Trace=function(){"use strict";this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null},MediaPlayer.vo.metrics.PlayList.prototype={constructor:MediaPlayer.vo.metrics.PlayList},MediaPlayer.vo.metrics.PlayList.INITIAL_PLAY_START_REASON="initial_start",MediaPlayer.vo.metrics.PlayList.SEEK_START_REASON="seek",MediaPlayer.vo.metrics.PlayList.Trace.prototype={constructor:MediaPlayer.vo.metrics.PlayList.Trace()},MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON="user_request",MediaPlayer.vo.metrics.PlayList.Trace.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",MediaPlayer.vo.metrics.PlayList.Trace.END_OF_CONTENT_STOP_REASON="end_of_content",MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON="rebuffering",MediaPlayer.vo.metrics.RepresentationSwitch=function(){"use strict";this.t=null,this.mt=null,this.to=null,this.lto=null},MediaPlayer.vo.metrics.RepresentationSwitch.prototype={constructor:MediaPlayer.vo.metrics.RepresentationSwitch},MediaPlayer.vo.metrics.RequestsQueue=function(){"use strict";this.pendingRequests=[],this.loadingRequests=[],this.executedRequests=[],this.rejectedRequests=[]},MediaPlayer.vo.metrics.RequestsQueue.prototype={constructor:MediaPlayer.vo.metrics.RequestsQueue},MediaPlayer.vo.metrics.SchedulingInfo=function(){"use strict";this.mediaType=null,this.t=null,this.type=null,this.startTime=null,this.availabilityStartTime=null,this.duration=null,this.quality=null,this.range=null,this.state=null},MediaPlayer.vo.metrics.SchedulingInfo.prototype={constructor:MediaPlayer.vo.metrics.SchedulingInfo},MediaPlayer.vo.metrics.TCPConnection=function(){"use strict";this.tcpid=null,this.dest=null,this.topen=null,this.tclose=null,this.tconnect=null},MediaPlayer.vo.metrics.TCPConnection.prototype={constructor:MediaPlayer.vo.metrics.TCPConnection},MediaPlayer.vo.protection.ClearKeyKeySet=function(a,b){if(b&&"persistent"!==b&&"temporary"!==b)throw new Error("Invalid ClearKey key set type!  Must be one of 'persistent' or 'temporary'");this.keyPairs=a,this.type=b,this.toJWK=function(){var a,b=this.keyPairs.length,c={};for(c.keys=[],a=0;b>a;a++){var d={kty:"oct",alg:"A128KW",kid:this.keyPairs[a].keyID,k:this.keyPairs[a].key};c.keys.push(d)}this.type&&(c.type=this.type);var e=JSON.stringify(c),f=e.length,g=new ArrayBuffer(f),h=new Uint8Array(g);for(a=0;f>a;a++)h[a]=e.charCodeAt(a);return g}},MediaPlayer.vo.protection.ClearKeyKeySet.prototype={constructor:MediaPlayer.vo.protection.ClearKeyKeySet},MediaPlayer.vo.protection.KeyError=function(a,b){"use strict";this.sessionToken=a,this.error=b},MediaPlayer.vo.protection.KeyError.prototype={constructor:MediaPlayer.vo.protection.KeyError},MediaPlayer.vo.protection.KeyMessage=function(a,b,c,d){"use strict";this.sessionToken=a,this.message=b,this.defaultURL=c,this.messageType=d||"license-request"},MediaPlayer.vo.protection.KeyMessage.prototype={constructor:MediaPlayer.vo.protection.KeyMessage},MediaPlayer.vo.protection.KeyPair=function(a,b){"use strict";this.keyID=a,this.key=b},MediaPlayer.vo.protection.KeyPair.prototype={constructor:MediaPlayer.vo.protection.KeyPair},MediaPlayer.vo.protection.KeySystemAccess=function(a,b){this.keySystem=a,this.ksConfiguration=b},MediaPlayer.vo.protection.KeySystemAccess.prototype={constructor:MediaPlayer.vo.protection.KeySystemAccess},MediaPlayer.vo.protection.KeySystemConfiguration=function(a,b,c,d,e){this.initDataTypes=["cenc"],this.audioCapabilities=a,this.videoCapabilities=b,this.distinctiveIdentifier=c,this.persistentState=d,this.sessionTypes=e},MediaPlayer.vo.protection.KeySystemConfiguration.prototype={constructor:MediaPlayer.vo.protection.KeySystemConfiguration},MediaPlayer.vo.protection.LicenseRequestComplete=function(a,b,c){"use strict";this.message=a,this.sessionToken=b,this.messageType=c||"license-request"},MediaPlayer.vo.protection.LicenseRequestComplete.prototype={constructor:MediaPlayer.vo.protection.LicenseRequestComplete},MediaPlayer.vo.protection.MediaCapability=function(a,b){this.contentType=a,this.robustness=b},MediaPlayer.vo.protection.MediaCapability.prototype={constructor:MediaPlayer.vo.protection.MediaCapability},MediaPlayer.vo.protection.NeedKey=function(a,b){this.initData=a,this.initDataType=b},MediaPlayer.vo.protection.NeedKey.prototype={constructor:MediaPlayer.vo.protection.NeedKey},MediaPlayer.vo.protection.ProtectionData=function(a,b,c){this.serverURL=a,this.httpRequestHeaders=b,this.clearkeys=c},MediaPlayer.vo.protection.ProtectionData.prototype={constructor:MediaPlayer.vo.protection.ProtectionData},MediaPlayer.vo.protection.SessionToken=function(){};!function(a){var b,c,d=a.event;b=d.special.debouncedresize={setup:function(){a(this).on("resize",b.handler)},teardown:function(){a(this).off("resize",b.handler)},handler:function(a,e){var f=this,g=arguments,h=function(){a.type="debouncedresize",d.dispatch.apply(f,g)};c&&clearTimeout(c),e&&h(),c=setTimeout(h,b.threshold)},threshold:150}}(jQuery),function(a,b){"function"==typeof define&&define.amd?define(["raphael"],function(c){return b(c||a.Raphael)}):b(Raphael)}(this,function(a){a.fn.freeTransform=function(a,b,c){function d(a){("set"===a.type?a.items:[a]).map(function(a){"set"===a.type?d(a):m.items.push({el:a,attrs:{rotate:0,scale:{x:1,y:1},translate:{x:0,y:0}},transformString:a.matrix.toTransformString()})})}function e(a){var b,c,d=[],e=[{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}];return"number"!=typeof a&&(a=0),b={x:m.attrs.rotate*Math.PI/180,y:(m.attrs.rotate+90)*Math.PI/180},c={x:m.attrs.size.x/2*m.attrs.scale.x+a,y:m.attrs.size.y/2*m.attrs.scale.y+a},e.map(function(a){d.push({x:m.attrs.center.x+m.attrs.translate.x+a.x*c.x*Math.cos(b.x)+a.y*c.y*Math.cos(b.y),y:m.attrs.center.y+m.attrs.translate.y+a.x*c.x*Math.sin(b.x)+a.y*c.y*Math.sin(b.y)})}),d}function f(){var a={x:/^([0-9]+)%$/.exec(q.width),
y:/^([0-9]+)%$/.exec(q.height)};return{x:a.x?q.canvas.clientWidth||q.canvas.parentNode.clientWidth*parseInt(a.x[1],10)*.01:q.canvas.clientWidth||q.width,y:a.y?q.canvas.clientHeight||q.canvas.parentNode.clientHeight*parseInt(a.y[1],10)*.01:q.canvas.clientHeight||q.height}}function g(a){var b,c,d,e={x:0,y:0},g={x:0,y:0};a&&m.opts.snap.drag&&(b=a.x,c=a.y,[0,1].map(function(){e.x=b-Math.round(b/m.opts.snap.drag)*m.opts.snap.drag,e.y=c-Math.round(c/m.opts.snap.drag)*m.opts.snap.drag,Math.abs(e.x)<=m.opts.snapDist.drag&&(g.x=e.x),Math.abs(e.y)<=m.opts.snapDist.drag&&(g.y=e.y),b+=a.width-g.x,c+=a.height-g.y}),m.attrs.translate.x-=g.x,m.attrs.translate.y-=g.y),m.opts.boundary&&(m.opts.boundarywidth=m.opts.boundarywidth||f().x*(m.o.viewBoxRatio&&m.o.viewBoxRatio.x||1),m.opts.boundaryheight=m.opts.boundaryheight||f().y*(m.o.viewBoxRatio&&m.o.viewBoxRatio.y||1),m.attrs.center.x+m.attrs.translate.x<m.opts.boundaryx&&(m.attrs.translate.x+=m.opts.boundaryx-(m.attrs.center.x+m.attrs.translate.x)),m.attrs.center.y+m.attrs.translate.y<m.opts.boundaryy&&(m.attrs.translate.y+=m.opts.boundaryy-(m.attrs.center.y+m.attrs.translate.y)),m.attrs.center.x+m.attrs.translate.x>m.opts.boundaryx+m.opts.boundarywidth&&(m.attrs.translate.x+=m.opts.boundaryx+m.opts.boundarywidth-(m.attrs.center.x+m.attrs.translate.x)),m.attrs.center.y+m.attrs.translate.y>m.opts.boundaryy+m.opts.boundaryheight&&(m.attrs.translate.y+=m.opts.boundaryy+m.opts.boundaryheight-(m.attrs.center.y+m.attrs.translate.y))),e=Math.abs(m.attrs.rotate%m.opts.snap.rotate),e=Math.min(e,m.opts.snap.rotate-e),e<m.opts.snapDist.rotate&&(m.attrs.rotate=Math.round(m.attrs.rotate/m.opts.snap.rotate)*m.opts.snap.rotate),e={x:Math.abs(m.attrs.scale.x*m.attrs.size.x%m.opts.snap.scale),y:Math.abs(m.attrs.scale.y*m.attrs.size.x%m.opts.snap.scale)},e={x:Math.min(e.x,m.opts.snap.scale-e.x),y:Math.min(e.y,m.opts.snap.scale-e.y)},e.x<m.opts.snapDist.scale&&(m.attrs.scale.x=Math.round(m.attrs.scale.x*m.attrs.size.x/m.opts.snap.scale)*m.opts.snap.scale/m.attrs.size.x),e.y<m.opts.snapDist.scale&&(m.attrs.scale.y=Math.round(m.attrs.scale.y*m.attrs.size.y/m.opts.snap.scale)*m.opts.snap.scale/m.attrs.size.y),m.opts.range.rotate&&(d=(360+m.attrs.rotate)%360,d>180&&(d-=360),d<m.opts.range.rotate[0]&&(m.attrs.rotate+=m.opts.range.rotate[0]-d),d>m.opts.range.rotate[1]&&(m.attrs.rotate+=m.opts.range.rotate[1]-d)),m.opts.range.scale&&(m.attrs.scale.x*m.attrs.size.x<m.opts.range.scale[0]&&(m.attrs.scale.x=m.opts.range.scale[0]/m.attrs.size.x),m.attrs.scale.y*m.attrs.size.y<m.opts.range.scale[0]&&(m.attrs.scale.y=m.opts.range.scale[0]/m.attrs.size.y),m.attrs.scale.x*m.attrs.size.x>m.opts.range.scale[1]&&(m.attrs.scale.x=m.opts.range.scale[1]/m.attrs.size.x),m.attrs.scale.y*m.attrs.size.y>m.opts.range.scale[1]&&(m.attrs.scale.y=m.opts.range.scale[1]/m.attrs.size.y))}function h(){return{x:m.attrs.scale.x*m.attrs.size.x>=m.opts.range.scale[0]&&m.attrs.scale.x*m.attrs.size.x<=m.opts.range.scale[1],y:m.attrs.scale.y*m.attrs.size.y>=m.opts.range.scale[0]&&m.attrs.scale.y*m.attrs.size.y<=m.opts.range.scale[1]}}function i(a){"x"===a?m.attrs.scale.y=m.attrs.scale.x/m.attrs.ratio:m.attrs.scale.x=m.attrs.scale.y*m.attrs.ratio}function k(a){var b,c={};for(b in a)c[b]="object"==typeof a[b]?k(a[b]):a[b];return c}function l(a){var b=[];m.callback&&(a.map(function(a,c){a&&b.push(a)}),clearTimeout(p),p=setTimeout(function(){m.callback&&m.callback(m,b,e())},.1))}var m,n,o,p,q=this,r=a.getBBox(!0);return a.freeTransform?a.freeTransform:(Array.prototype.hasOwnProperty("map")||(Array.prototype.map=function(a,b){o=[];for(n in this)this.hasOwnProperty(n)&&(o[n]=a.call(b,this[n],n,this));return o}),Array.prototype.hasOwnProperty("indexOf")||(Array.prototype.indexOf=function(a,b){for(n=b||0,j=this.length;n<j;n++)if(this[n]===a)return n;return-1}),m=a.freeTransform={attrs:{x:r.x,y:r.y,size:{x:r.width,y:r.height},center:{x:r.x+r.width/2,y:r.y+r.height/2},rotate:0,scale:{x:1,y:1},translate:{x:0,y:0},ratio:1},axes:null,bbox:null,callback:null,items:[],handles:{center:null,x:null,y:null},offset:{rotate:0,scale:{x:1,y:1},translate:{x:0,y:0}},opts:{animate:!1,attrs:{fill:"#fff",stroke:"#000"},boundary:{x:q._left||0,y:q._top||0,width:null,height:null},customCorners:!1,distance:1.3,drag:!0,draw:!1,keepRatio:!1,range:{rotate:[-180,180],scale:[-99999,99999]},rotate:!0,scale:!0,snap:{rotate:0,scale:0,drag:0},snapDist:{rotate:0,scale:0,drag:7},size:5},subject:a},m.updateHandles=function(){var a,b,c,d,g,h,i,j=[[-1,-1],[1,-1],[1,1],[-1,1],[0,-1],[1,0],[0,1],[-1,0]];return(m.handles.bbox||m.opts.rotate.indexOf("self")>=0)&&(b=a=e(0),m.opts.customCorners&&"number"==typeof m.opts.customCorners.distance&&(b=e(m.opts.customCorners.distance))),c={x:m.attrs.rotate*Math.PI/180,y:(m.attrs.rotate+90)*Math.PI/180},d={x:m.attrs.size.x/2*m.attrs.scale.x,y:m.attrs.size.y/2*m.attrs.scale.y},m.axes.map(function(a){m.handles[a]&&(g=m.attrs.center.x+m.attrs.translate.x+d[a]*m.opts.distance*Math.cos(c[a]),h=m.attrs.center.y+m.attrs.translate.y+d[a]*m.opts.distance*Math.sin(c[a]),i={x:1,y:1},q._viewBox&&(i={x:q._viewBox[2]/f().x,y:q._viewBox[3]/f().y}),m.opts.boundary&&(g=Math.max(Math.min(g,m.opts.boundary.x+(m.opts.boundary.width||f().x*i.x)),m.opts.boundary.x),h=Math.max(Math.min(h,m.opts.boundary.y+(m.opts.boundary.height||f().y*i.y)),m.opts.boundary.y)),m.handles[a].disc.attr({cx:g,cy:h}),m.handles[a].line.toFront().attr({path:[["M",m.attrs.center.x+m.attrs.translate.x,m.attrs.center.y+m.attrs.translate.y],["L",m.handles[a].disc.attrs.cx,m.handles[a].disc.attrs.cy]]}),m.handles[a].disc.toFront())}),m.bbox&&(m.bbox.toFront().attr({path:[["M",a[0].x,a[0].y],["L",a[1].x,a[1].y],["L",a[2].x,a[2].y],["L",a[3].x,a[3].y],["L",a[0].x,a[0].y]]}),m.handles.bbox&&m.handles.bbox.map(function(c,d){var e,f,g,h;c.isCorner?(e=b[d].x,f=b[d].y):(g=d%4,h=(g+1)%a.length,e=(b[g].x+b[h].x)/2,f=(b[g].y+b[h].y)/2),c.element.toFront().attr({x:e-(c.isCorner?m.opts.customCorners?Math.ceil(m.opts.customCorners.size/2):m.opts.size.bboxCorners:m.opts.size.bboxSides),y:f-(c.isCorner?m.opts.customCorners?Math.ceil(m.opts.customCorners.size/2):m.opts.size.bboxCorners:m.opts.size.bboxSides)}).transform(m.opts.customCorners?null:"R"+m.attrs.rotate),c.x=j[d][0],c.y=j[d][1]})),m.circle&&m.circle.attr({cx:m.attrs.center.x+m.attrs.translate.x,cy:m.attrs.center.y+m.attrs.translate.y,r:Math.max(d.x,d.y)*m.opts.distance}),m.handles.center&&m.handles.center.disc.toFront().attr({cx:m.attrs.center.x+m.attrs.translate.x,cy:m.attrs.center.y+m.attrs.translate.y}),m.opts.rotate.indexOf("self")>=0&&(d=Math.max(Math.sqrt(Math.pow(a[1].x-a[0].x,2)+Math.pow(a[1].y-a[0].y,2)),Math.sqrt(Math.pow(a[2].x-a[1].x,2)+Math.pow(a[2].y-a[1].y,2)))/2),m},m.showHandles=function(){var b,c,d,e,j=[];if(draggables=[],m.hideHandles(),m.axes.map(function(a){m.handles[a]={},m.handles[a].line=q.path(["M",m.attrs.center.x,m.attrs.center.y]).attr({stroke:m.opts.attrs.stroke,"stroke-dasharray":"- ",opacity:.5}),m.handles[a].disc=q.circle(m.attrs.center.x,m.attrs.center.y,m.opts.size.axes).attr(m.opts.attrs)}),m.opts.draw.indexOf("bbox")>=0)for(m.bbox=q.path("").attr({stroke:m.opts.attrs.stroke,"stroke-dasharray":"- ",opacity:.5}),m.handles.bbox=[],b=m.opts.scale.indexOf("bboxCorners")||m.opts.customCorners>=0?0:4;b<(-1===m.opts.scale.indexOf("bboxSides")?4:8);b++)c={},c.index=b,c.axis=b%2?"x":"y",c.isCorner=b<4,c.isCorner&&m.opts.customCorners?c.element=q.image(m.opts.customCorners.corners[b].image,m.attrs.center.x,m.attrs.center.y,m.opts.customCorners.size,m.opts.customCorners.size):c.element=q.rect(m.attrs.center.x,m.attrs.center.y,2*m.opts.size[c.isCorner?"bboxCorners":"bboxSides"],2*m.opts.size[c.isCorner?"bboxCorners":"bboxSides"]).attr(m.opts.attrs),m.handles.bbox[b]=c;return-1!==m.opts.draw.indexOf("circle")&&(m.circle=q.circle(0,0,0).attr({stroke:m.opts.attrs.stroke,"stroke-dasharray":"- ",opacity:.3})),-1!==m.opts.drag.indexOf("center")&&(m.handles.center={},m.handles.center.disc=q.circle(m.attrs.center.x,m.attrs.center.y,m.opts.size.center).attr(m.opts.attrs)),m.axes.map(function(a){m.handles[a]&&j.push({element:m.handles[a].disc,rotate:-1!==m.opts.rotate.indexOf("axis"+a.toUpperCase()),scale:-1!==m.opts.scale.indexOf("axis"+a.toUpperCase()),axis:a,isCorner:!1})}),m.opts.customCorners&&m.handles.bbox.map(function(a){var b;void 0!==m.opts.customCorners.corners[a.index]&&("rotate"!==(b=m.opts.customCorners.corners[a.index].action)&&"scale"!==b||j.push({element:a.element,rotate:"rotate"===b,scale:"scale"===b,axis:"x",isCorner:!0}))}),j.map(function(a){a.element.drag(function(b,c){var d,e,h,j,k,n,o={x:m.o.scale.x<0,y:m.o.scale.y<0};m.o.viewBoxRatio&&(b*=m.o.viewBoxRatio.x,c*=m.o.viewBoxRatio.y),d=b+a.element.ox,e=c+a.element.oy,a.rotate&&(h=Math.atan2(e-m.o.center.y-m.o.translate.y,d-m.o.center.x-m.o.translate.x),m.attrs.rotate=180*h/Math.PI-m.o.angle,o[a.axis]&&(m.attrs.rotate-=180)),m.opts.boundary&&(d=Math.max(Math.min(d,m.opts.boundary.x+(m.opts.boundary.width||f().x*(m.o.viewBoxRatio&&m.o.viewBoxRatio.x||1))),m.opts.boundary.x),e=Math.max(Math.min(e,m.opts.boundary.y+(m.opts.boundary.height||f().y*(m.o.viewBoxRatio&&m.o.viewBoxRatio.y||1))),m.opts.boundary.y)),j=d-m.o.center.x-m.o.translate.x-(m.opts.customCorners?m.opts.customCorners.distance:0),k=e-m.o.center.y-m.o.translate.y-(m.opts.customCorners?m.opts.customCorners.distance:0),n=Math.sqrt(Math.pow(j,2)+Math.pow(k,2)),a.scale&&(m.attrs.scale[a.axis]=n/(m.o.size[a.axis]/2*m.o.distance),o[a.axis]&&(m.attrs.scale[a.axis]*=-1)),g(),-1!==m.opts.keepRatio.indexOf("axis"+a.axis.toUpperCase())?i(a.axis):m.attrs.ratio=m.attrs.scale.x/m.attrs.scale.y,m.attrs.scale.x&&m.attrs.scale.y&&m.apply(),l([a.rotate?"rotate":null,a.scale?"scale":null])},function(){m.o=k(m.attrs),q._viewBox&&(m.o.viewBoxRatio={x:q._viewBox[2]/f().x,y:q._viewBox[3]/f().y}),a.element.ox=this.attrs.cx?this.attrs.cx:this.attrs.x+this.attrs.width/2,a.element.oy=this.attrs.cy?this.attrs.cy:this.attrs.y+this.attrs.height/2,a.isCorner?(hypotenuse=Math.sqrt(Math.pow(m.o.size.x*m.o.scale.x,2)+Math.pow(m.o.size.y*m.o.scale.y,2))/2,opposite=m.o.size.x*m.o.scale.x/2,pos={x:a.element.ox-(m.o.center.x+m.o.x+m.o.translate.x),y:a.element.oy-(m.o.center.y+m.o.y+m.o.translate.y)},m.o.distance=hypotenuse/opposite,m.o.angle=90-180*Math.atan2(pos.x,pos.y)/Math.PI-m.o.rotate):(m.o.distance=m.opts.distance,m.o.angle="y"===a.axis?90:0),l([a.rotate?"rotate start":null,a.scale?"scale start":null])},function(){l([a.rotate?"rotate end":null,a.scale?"scale end":null])})}),m.opts.draw.indexOf("bbox")>=0&&!m.opts.customCorners&&(-1!==m.opts.scale.indexOf("bboxCorners")||-1!==m.opts.scale.indexOf("bboxSides"))&&m.handles.bbox.map(function(a){a.element.drag(function(b,c){var d,e,f,j,n,o,p,q,r,s,t,u,v,w=k(m.attrs),x={x:0,y:0};m.o.viewBoxRatio&&(b*=m.o.viewBoxRatio.x,c*=m.o.viewBoxRatio.y),d=m.o.rotate.sin,e=m.o.rotate.cos,f=b*e-c*d,j=b*d+c*e,f*=Math.abs(a.x),j*=Math.abs(a.y),n=f*e+j*d,o=f*-d+j*e,m.attrs.translate={x:m.o.translate.x+n/2,y:m.o.translate.y+o/2},p=m.o.handlePos.cx+b-m.attrs.center.x-m.attrs.translate.x,q=m.o.handlePos.cy+c-m.attrs.center.y-m.attrs.translate.y,f=p*e-q*d,j=p*d+q*e,a.isCorner&&-1!==m.opts.keepRatio.indexOf("bboxCorners")&&(t=m.attrs.size.x*m.attrs.scale.x/(m.attrs.size.y*m.attrs.scale.y),u=f*a.x*(1/t),v=j*a.y*t,v>u*t?f=v*a.x:j=u*a.y),r=2*f*a.x/m.o.size.x,s=2*j*a.y/m.o.size.y,m.attrs.scale={x:r||m.attrs.scale.x,y:s||m.attrs.scale.y},h().x&&h().y||(m.attrs=w),g(),(a.isCorner&&-1!==m.opts.keepRatio.indexOf("bboxCorners")||!a.isCorner&&-1!==m.opts.keepRatio.indexOf("bboxSides"))&&(i(a.axis),x.x=(m.attrs.scale.x-m.o.scale.x)*m.o.size.x*a.x,x.y=(m.attrs.scale.y-m.o.scale.y)*m.o.size.y*a.y,f=x.x*e+x.y*d,j=-x.x*d+x.y*e,m.attrs.translate.x=m.o.translate.x+f/2,m.attrs.translate.y=m.o.translate.y+j/2),m.attrs.ratio=m.attrs.scale.x/m.attrs.scale.y,l(["scale"]),m.apply()},function(){var b=(360-m.attrs.rotate)%360/180*Math.PI,c=a.element.attr(["x","y"]);m.o=k(m.attrs),m.o.handlePos={cx:c.x+m.opts.size[a.isCorner?"bboxCorners":"bboxSides"],cy:c.y+m.opts.size[a.isCorner?"bboxCorners":"bboxSides"]},m.o.rotate={sin:Math.sin(b),cos:Math.cos(b)},q._viewBox&&(m.o.viewBoxRatio={x:q._viewBox[2]/f().x,y:q._viewBox[3]/f().y}),l(["scale start"])},function(){l(["scale end"])})}),m.opts.customCorners&&m.handles.bbox.map(function(a){void 0!==m.opts.customCorners.corners[a.index]&&-1===["drag","rotate","scale"].indexOf(m.opts.customCorners.corners[a.index].action)&&(a.element.drag(function(){return!1}),a.element.click(function(){l(["custom:"+m.opts.customCorners.corners[a.index].action])}))}),m.opts.drag.indexOf("self")>=0&&-1===m.opts.scale.indexOf("self")&&-1===m.opts.rotate.indexOf("self")&&draggables.push(a),m.opts.drag.indexOf("center")>=0&&draggables.push(m.handles.center.disc),m.opts.customCorners&&m.handles.bbox.map(function(a){void 0!==m.opts.customCorners.corners[a.index]&&"drag"===m.opts.customCorners.corners[a.index].action&&draggables.push(a.element)}),draggables.map(function(b){b.drag(function(a,b){var c=k(m.o.bbox);m.o.viewBoxRatio&&(a*=m.o.viewBoxRatio.x,b*=m.o.viewBoxRatio.y),m.attrs.translate.x=m.o.translate.x+a,m.attrs.translate.y=m.o.translate.y+b,c.x+=a,c.y+=b,g(c),l(["drag"]),m.apply()},function(){m.o=k(m.attrs),m.opts.snap.drag&&(m.o.bbox=a.getBBox()),q._viewBox&&(m.o.viewBoxRatio={x:q._viewBox[2]/f().x,y:q._viewBox[3]/f().y}),m.axes.map(function(a){m.handles[a]&&(m.handles[a].disc.ox=m.handles[a].disc.attrs.cx,m.handles[a].disc.oy=m.handles[a].disc.attrs.cy)}),l(["drag start"])},function(){l(["drag end"])})}),d=m.opts.rotate.indexOf("self")>=0,e=m.opts.scale.indexOf("self")>=0,(d||e)&&a.drag(function(a,b,c,f){var h,i,j={x:m.o.scale.x<0,y:m.o.scale.y<0};d&&(h=Math.atan2(f-m.o.center.y-m.o.translate.y,c-m.o.center.x-m.o.translate.x),m.attrs.rotate=m.o.rotate+180*h/Math.PI-m.o.deg),e&&(i=Math.sqrt(Math.pow(c-m.o.center.x-m.o.translate.x,2)+Math.pow(f-m.o.center.y-m.o.translate.y,2)),m.attrs.scale.x=m.attrs.scale.y=(j.x?-1:1)*m.o.scale.x+(i-m.o.radius)/(m.o.size.x/2),j.x&&(m.attrs.scale.x*=-1),j.y&&(m.attrs.scale.y*=-1)),g(),m.apply(),l([d?"rotate":null,e?"scale":null])},function(a,b){m.o=k(m.attrs),m.o.deg=180*Math.atan2(b-m.o.center.y-m.o.translate.y,a-m.o.center.x-m.o.translate.x)/Math.PI,m.o.radius=Math.sqrt(Math.pow(a-m.o.center.x-m.o.translate.x,2)+Math.pow(b-m.o.center.y-m.o.translate.y,2)),q._viewBox&&(m.o.viewBoxRatio={x:q._viewBox[2]/f().x,y:q._viewBox[3]/f().y}),l([d?"rotate start":null,e?"scale start":null])},function(){l([d?"rotate end":null,e?"scale end":null])}),m.updateHandles(),m},m.hideHandles=function(a){var a=a||{};return void 0===a.undrag&&(a.undrag=!0),a.undrag&&m.items.map(function(a){a.el.undrag()}),m.handles.center&&(m.handles.center.disc.remove(),m.handles.center=null),["x","y"].map(function(a){m.handles[a]&&(m.handles[a].disc.remove(),m.handles[a].line.remove(),m.handles[a]=null)}),m.bbox&&(m.bbox.remove(),m.bbox=null,m.handles.bbox&&(m.handles.bbox.map(function(a){a.element.remove()}),m.handles.bbox=null)),m.circle&&(m.circle.remove(),m.circle=null),m},m.setOpts=function(a,b){var c,d;void 0!==b&&(m.callback="function"==typeof b&&b);for(c in a)if(a[c]&&a[c].constructor===Object){!1===m.opts[c]&&(m.opts[c]={});for(d in a[c])a[c].hasOwnProperty(d)&&(m.opts[c][d]=a[c][d])}else m.opts[c]=a[c];return!0===m.opts.animate&&(m.opts.animate={delay:700,easing:"linear"}),!0===m.opts.drag&&(m.opts.drag=["center","self"]),!0===m.opts.keepRatio&&(m.opts.keepRatio=["axisX","axisY","bboxCorners","bboxSides"]),!0===m.opts.rotate&&(m.opts.rotate=["axisX","axisY"]),!0===m.opts.scale&&(m.opts.scale=["axisX","axisY","bboxCorners","bboxSides"]),["drag","draw","keepRatio","rotate","scale"].map(function(a){!1===m.opts[a]&&(m.opts[a]=[])}),m.axes=[],(m.opts.rotate.indexOf("axisX")>=0||m.opts.scale.indexOf("axisX")>=0)&&m.axes.push("x"),(m.opts.rotate.indexOf("axisY")>=0||m.opts.scale.indexOf("axisY")>=0)&&m.axes.push("y"),["drag","rotate","scale"].map(function(a){m.opts.snapDist[a]||(m.opts.snapDist[a]=m.opts.snap[a])}),m.opts.range={rotate:[parseFloat(m.opts.range.rotate[0]),parseFloat(m.opts.range.rotate[1])],scale:[parseFloat(m.opts.range.scale[0]),parseFloat(m.opts.range.scale[1])]},m.opts.snap={drag:parseFloat(m.opts.snap.drag)||0,rotate:parseFloat(m.opts.snap.rotate)||0,scale:parseFloat(m.opts.snap.scale)||0},m.opts.snapDist={drag:parseFloat(m.opts.snapDist.drag)||0,rotate:parseFloat(m.opts.snapDist.rotate)||0,scale:parseFloat(m.opts.snapDist.scale)||0},"string"==typeof m.opts.size&&(m.opts.size=parseFloat(m.opts.size)||0),isNaN(m.opts.size)||(m.opts.size={axes:m.opts.size,bboxCorners:m.opts.size,bboxSides:m.opts.size,center:m.opts.size}),m.opts.customCorners&&(m.opts.customCorners.size=parseFloat(m.opts.customCorners.size)||0,m.opts.customCorners.distance=parseFloat(m.opts.customCorners.distance)||0),m.showHandles(),l(["init"]),m},m.setOpts(b,c),m.apply=function(){return m.items.map(function(a,b){var c={x:m.attrs.center.x+m.offset.translate.x,y:m.attrs.center.y+m.offset.translate.y},d=m.attrs.rotate-m.offset.rotate,e={x:m.attrs.scale.x/m.offset.scale.x,y:m.attrs.scale.y/m.offset.scale.y},f={x:m.attrs.translate.x-m.offset.translate.x,y:m.attrs.translate.y-m.offset.translate.y};m.opts.animate?(l(["animate start"]),a.el.animate({transform:["R",d,c.x,c.y,"S",e.x,e.y,c.x,c.y,"T",f.x,f.y]+m.items[b].transformString},m.opts.animate.delay,m.opts.animate.easing,function(){l(["animate end"]),m.updateHandles()})):(a.el.transform(["R",d,c.x,c.y,"S",e.x,e.y,c.x,c.y,"T",f.x,f.y]+m.items[b].transformString),l(["apply"]),m.updateHandles())}),m},m.unplug=function(){var b=m.attrs;return m.hideHandles(),delete a.freeTransform,b},d(a),m.items.map(function(a,b){a.el._&&a.el._.transform&&"object"==typeof a.el._.transform&&a.el._.transform.map(function(a){if(a[0])switch(a[0].toUpperCase()){case"T":m.items[b].attrs.translate.x+=a[1],m.items[b].attrs.translate.y+=a[2];break;case"S":m.items[b].attrs.scale.x*=a[1],m.items[b].attrs.scale.y*=a[2];break;case"R":m.items[b].attrs.rotate+=a[1]}})}),"set"!==a.type&&(m.attrs.rotate=m.items[0].attrs.rotate,m.attrs.scale=m.items[0].attrs.scale,m.attrs.translate=m.items[0].attrs.translate,m.items[0].attrs={rotate:0,scale:{x:1,y:1},translate:{x:0,y:0}},m.items[0].transformString=""),m.attrs.ratio=m.attrs.scale.x/m.attrs.scale.y,m.updateHandles(),m)}}),function(a){function b(b){if("string"==typeof b.data&&(b.data={keys:b.data}),b.data&&b.data.keys&&"string"==typeof b.data.keys){var c=b.handler,d=b.data.keys.toLowerCase().split(" ");b.handler=function(b){if(this===b.target||!(a.hotkeys.options.filterInputAcceptingElements&&a.hotkeys.textInputTypes.test(b.target.nodeName)||a.hotkeys.options.filterContentEditable&&a(b.target).attr("contenteditable")||a.hotkeys.options.filterTextInputs&&a.inArray(b.target.type,a.hotkeys.textAcceptingInputTypes)>-1)){var e="keypress"!==b.type&&a.hotkeys.specialKeys[b.which],f=String.fromCharCode(b.which).toLowerCase(),g="",h={};a.each(["alt","ctrl","shift"],function(a,c){b[c+"Key"]&&e!==c&&(g+=c+"+")}),b.metaKey&&!b.ctrlKey&&"meta"!==e&&(g+="meta+"),b.metaKey&&"meta"!==e&&g.indexOf("alt+ctrl+shift+")>-1&&(g=g.replace("alt+ctrl+shift+","hyper+")),e?h[g+e]=!0:(h[g+f]=!0,h[g+a.hotkeys.shiftNums[f]]=!0,"shift+"===g&&(h[a.hotkeys.shiftNums[f]]=!0));for(var i=0,j=d.length;i<j;i++)if(h[d[i]])return c.apply(this,arguments)}}}}a.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"},textAcceptingInputTypes:["text","password","number","email","url","range","date","month","week","time","datetime","datetime-local","search","color","tel"],textInputTypes:/textarea|input|select/i,options:{filterInputAcceptingElements:!0,filterTextInputs:!0,filterContentEditable:!0}},a.each(["keydown","keyup","keypress"],function(){a.event.special[this]={add:b}})}(jQuery||this.jQuery||window.jQuery),$.Class("fr.ina.amalia.player.helpers.BrowserFeatureDetection",{isMobilePlatform:function(){return navigator.userAgent.match(/(iPod|iPhone|iPad)/)||navigator.userAgent.toLowerCase().indexOf("android")>-1}},{settings:{},logger:null,init:function(a){this.settings=$.extend({debug:!1},a||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug}))},isSupportsVideos:function(){return document.createElement("video").canPlayType?(null!==this.logger&&this.logger.info("Support html5"),!0):(null!==this.logger&&this.logger.info("Can't support html5"),!1)},isSupportsMp4:function(){if(this.isSupportsVideos()){return document.createElement("video").canPlayType("video/mp4")?(null!==this.logger&&this.logger.info("Support mp4"),!0):(null!==this.logger&&this.logger.info("Can't support mp4"),!1)}return!1}}),$.Class("fr.ina.amalia.player.helpers.HTML5Helper",{inFullScreen:function(){return!(!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)||!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement))},toggleFullScreen:function(a,b){if(!1===fr.ina.amalia.player.helpers.HTML5Helper.inFullScreen()||!0===b){var c=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullscreen||a.webkitEnterFullscreen;if(void 0!==c&&c)return c.call(a),!0}else{var d=document.cancelFullScreen||document.mozCancelFullScreen||document.webkitCancelFullScreen||document.exitFullscreen||document.msExitFullscreen;if(void 0!==d&&d)return d.call(document),!1}}},{}),$.Class("fr.ina.amalia.player.helpers.UtilitiesHelper",{formatTime:function(a,b,c){var d=d||"f",e=b||25,f=Math.floor(Math.floor(1e5*(a-Math.floor(a)))*e/1e5),g=Math.floor(a/60),h=Math.floor(g/60),i=a%60;switch(a=Math.floor(a%60),g=Math.floor(g%60),g=g>=10?g:"0"+g,h=h>=10?h:"0"+h,a=a>=10?a:"0"+a,f=f>=10?f:"0"+f,c){case"h":d=h;break;case"m":d=h+":"+g;break;case"s":d=h+":"+g+":"+a;break;case"seconds":d=parseFloat(3600*parseFloat(h)+60*parseFloat(g)+parseFloat(i)).toFixed(4);break;case"mms":d=h+":"+g+":"+a+"."+i.toFixed(4).split(".")[1];break;case"ms":d=h+":"+g+":"+a+"."+i.toFixed(2).split(".")[1];break;case"f":d=h+":"+g+":"+a+":"+f;break;default:d=h+":"+g+":"+a+":"+i.toFixed(2).split(".")[1]}return d},getTimeRange:function(a,b,c){var d=[],e=c||25,f=void 0===b?"1":b;a=Math.floor(a);for(var g=0;g<=a;g+=f)if("f"===b){g=Math.floor(g);for(var h=0;h<e;h++)g+=1e3/e/1e3,d.push(fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(g,c))}else d.push(fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(g,c));return d},getRangesWithStartAndEndTime:function(a,b,c){for(var d=[],e=void 0===c?"1":c,f=a;f<=b;f+=e)d.push(f);return d},convertHourToSeconde:function(a){var b=null,c=/\d{2}:\d{2}:\d{2}/,d=c.exec(a);if(null!==d){d=a.split(":");b=60*Math.floor(d[0])*60+60*Math.floor(d[1])+parseFloat(d[2])}return b},convertTimeFPSToSeconde:function(a,b){var c=null,d=b||25,e=/\d{2}:\d{2}:\d{2}:\d{2}/,f=e.exec(a);if(null!==f){f=a.split(":");c=60*Math.floor(f[0])*60+60*Math.floor(f[1])+parseFloat(f[2])+1e3*parseFloat(f[3])/d/1e3}return c},uint6ToB64:function(a){return a<26?a+65:a<52?a+71:a<62?a-4:62===a?43:63===a?47:65},b64ToUint6:function(a){return a>64&&a<91?a-65:a>96&&a<123?a-71:a>47&&a<58?a+4:43===a?62:47===a?63:0},base64DecToArr:function(a,b){for(var c,d,e=a.replace(/[^A-Za-z0-9\+\/]/g,""),f=e.length,g=b?Math.ceil((3*f+1>>2)/b)*b:3*f+1>>2,h=new Uint8Array(g),i=0,j=0,k=0;k<f;k++)if(d=3&k,i|=fr.ina.amalia.player.helpers.UtilitiesHelper.b64ToUint6(e.charCodeAt(k))<<18-6*d,3===d||f-k==1){for(c=0;c<3&&j<g;c++,j++)h[j]=i>>>(16>>>c&24)&255;i=0}return h},generateUUID:function(a){var b=(new Date).getTime();return(a||"")+"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=(b+16*Math.random())%16|0;return b=Math.floor(b/16),("x"===a?c:c&&11).toString(16)})},htmlEscape:function(a){return String(a).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}},{}),$.Class("fr.ina.amalia.player.PlayerErrorCode",{ACCESS_DENIED:1001,MEDIA_FILE_NOT_FOUND:2001,CUSTOM_ERROR:3001,EXCEPTION:4001,HTTP_ERROR:5001,ABORT:6001,TIMEOUT:7008,ERROR:8008,ERROR_HTML5_SUPPORT:8e3,ERROR_LOAD_PLUGIN:9001,ERROR_MANIFEST_DASH:9002,getMessage:function(a){var b=fr.ina.amalia.player.PlayerErrorCode,c=fr.ina.amalia.player.PlayerErrorMessage;switch(a){case b.ACCESS_DENIED:return c.ACCESS_DENIED;case b.MEDIA_FILE_NOT_FOUND:return c.MEDIA_FILE_NOT_FOUND;case b.EXCEPTION:return c.EXCEPTION;case b.HTTP_ERROR:return c.HTTP_ERROR;case b.ABORT:return c.ABORT;case b.TIMEOUT:return c.TIMEOUT;case b.ERROR_LOAD_PLUGIN:return c.ERROR_LOAD_PLUGIN;case b.CUSTOM_ERROR:return c.CUSTOM_ERROR;case b.ERROR:return c.ERROR;case b.ERROR_HTML5_SUPPORT:return c.ERROR_HTML5_SUPPORT;case b.ERROR_MANIFEST_DASH:return c.ERROR_MANIFEST_DASH;default:return c.DEFAULT}}},{}),$.Class("fr.ina.amalia.player.PlayerErrorMessage",{ACCESS_DENIED:"AccÃ¨s refusÃ©.",MEDIA_FILE_NOT_FOUND:"Erreur lors du chargement du mÃ©dia.",EXCEPTION:"An exception occurred.",HTTP_ERROR:"Http response at 400 or 500 level.",ABORT:"Votre requÃªte a Ã©tÃ© interrompue.",TIMEOUT:"Demande dÃ©passÃ©.",ERROR_LOAD_PLUGIN:"Erreur inattendue lors de l'initialisation du plug-in.",CUSTOM_ERROR:"Une erreur s'est produite sur votre lecteur.",ERROR:"Une erreur s'est produite sur votre lecteur.",DEFAULT:"Une erreur s'est produite sur votre lecteur.",ERROR_HTML5_SUPPORT:"Une erreur s'est produite sur votre lecteur: Votre navigateur ne gÃ¨re pas les balises HTML5.",ERROR_MANIFEST_DASH:"Erreur lors du chargement du manifest dash"},{}),$.Class("fr.ina.amalia.player.PlayerEventType",{INIT:"fr.ina.amalia.player.PlayerEventType.INIT",STARTED:"fr.ina.amalia.player.PlayerEventType.STARTED",CAST_PLAYING:"fr.ina.amalia.player.PlayerEventType.CAST_PLAYING",CAST_PAUSED:"fr.ina.amalia.player.PlayerEventType.CAST_PAUSED",PLAYING:"fr.ina.amalia.player.PlayerEventType.PLAYING",PAUSED:"fr.ina.amalia.player.PlayerEventType.PAUSED",ENDED:"fr.ina.amalia.player.PlayerEventType.ENDED",MUTE:"fr.ina.amalia.player.PlayerEventType.MUTE",UN_MUTE:"fr.ina.amalia.player.PlayerEventType.UN_MUTE",VOLUME_CHANGE:"fr.ina.amalia.player.PlayerEventType.VOLUME_CHANGE",TIME_CHANGE:"fr.ina.amalia.player.PlayerEventType.TIME_CHANGE",FULLSCREEN_CHANGE:"fr.ina.amalia.player.PlayerEventType.FULLSCREEN_CHANGES",SEEK:"fr.ina.amalia.player.PlayerEventType.SEEK",ERROR:"fr.ina.amalia.player.PlayerEventType.ERROR",PLUGIN_READY:"fr.ina.amalia.player.PlayerEventType.PLUGIN_READY",PLUGIN_ERROR:"fr.ina.amalia.player.PlayerEventType.PLUGIN_ERROR",DATA_CHANGE:"fr.ina.amalia.player.PlayerEventType.DATA_CHANGE",BEGIN_DATA_CHANGE:"fr.ina.amalia.player.PlayerEventType.BEGIN_DATA_CHANGE",END_DATA_CHANGE:"fr.ina.amalia.player.PlayerEventType.END_DATA_CHANGE",IMAGE_CAPTURE:"fr.ina.amalia.player.PlayerEventType.IMAGE_CAPTURE",ZOOM_RANGE_CHANGE:"fr.ina.amalia.player.PlayerEventType.ZOOM_RANGE_CHANGE",SELECTED_METADATA_CHANGE:"fr.ina.amalia.player.PlayerEventType.SELECTED_METADATA_CHANGE",SELECTED_ITEMS_CHANGE:"fr.ina.amalia.player.PlayerEventType.SELECTED_ITEMS_CHANGE",BIND_METADATA:"fr.ina.amalia.player.PlayerEventType.BIND_METADATA",UNBIND_METADATA:"fr.ina.amalia.player.PlayerEventType.UNBIND_METADATA",PLAYBACK_RATE_CHANGE:"fr.ina.amalia.player.PlayerEventType.PLAYBACK_RATE_CHANGE",START_SEEKING:"fr.ina.amalia.player.PlayerEventType.START_SEEKING",STOP_SEEKING:"fr.ina.amalia.player.PlayerEventType.STOP_SEEKING",SEEKING:"fr.ina.amalia.player.PlayerEventType.SEEKING"},{}),$.Class("fr.ina.amalia.player.PlayerMessage",{PLAYER_OPENSOURCE_LINK:"Disponibles en open source.",PLUGIN_OVERLAY_CONTEXT_MENU_ENABLED_DISABLED_PLUGIN:"Activer/dÃ©sactiver le plugin overlay.",PLUGIN_TIMELINE_LABEL_ELEMENTS:"Ã©lÃ©ments.",PLUGIN_TIMELINE_LABEL_ZOOM_IN:"Zoom avant",PLUGIN_TIMELINE_LABEL_ZOOM_OUT:"Zoom arriÃ¨re",PLUGIN_TIMELINE_LABEL_CHANGE_DISPLAY:"Changer la hauteur des lignes.",PLUGIN_TIMELINE_LABEL_SLIDE_LEFT:"Faire dÃ©filer vers la gauche",PLUGIN_TIMELINE_LABEL_SLIDE_RIGHT:"Faire dÃ©filer vers la droite",PLUGIN_TIMELINE_LABEL_SCROLL_UP:"Faire dÃ©filer vers le haut",PLUGIN_TIMELINE_LABEL_SCROLL_DOWN:"Faire dÃ©filer vers le bas",PLUGIN_TIMELINE_LABEL_SHOW_HIDE_TOOTIP:"Activer/dÃ©sactiver les infobulles",PLUGIN_TIMELINE_LABEL_EXPAND:"Maximiser / Minimiser",PLUGIN_TIMELINE_LABEL_SORT:"Trier",PLUGIN_TIMELINE_LABEL_NAV_POINT_PREV:"Aller au marqueur prÃ©cÃ©dent",PLUGIN_TIMELINE_LABEL_NAV_POINT_NEXT:"Aller au marqueur suivant",PLUGIN_TIMELINE_LABEL_TIMEAXIS:"Axe temporel",PLUGIN_TIMELINE_LABEL_FOCUS:"Zoom",PLUGIN_TIMELINE_LABEL_CLOSE:"Fermer",PLUGIN_METADATA_LIST_EDITOR_LABEL_HEADER:"Metadata list editor",PLUGIN_METADATA_BLOCK_EDITOR_LABEL_HEADER:"Metadata block editor",PLUGIN_METADATA_ITEMS_EDITOR_LABEL_HEADER:"Metadata items editor",PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_ID:"ID",PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_LABAL:"Etiquette",PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_TYPE:"Type",PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_DESCRIPTION:"Description",PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_REFERENCE:"RÃ©fÃ©rence",PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_AUTHOR:"Auteur",PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_SHAPE:"Forme",PLUGIN_METADATA_BLOCK_EDITOR_FORM_LABEL_METADATA_COLOR:"Couleur",PLUGIN_METADATA_ITEMS_EDITOR_NEED_METADTA:"Vous devez sÃ©lectionner au moins un Ã©lÃ©ment dans la liste des mÃ©tadonnÃ©es avant de l'ajouter Ã©lÃ©ment.",PLUGIN_METADATA_ITEMS_EDITOR_NEED_METADTA_ITEM_TYPE:"Vous devez dÃ©finir le type Ã©lÃ©ment.",PLUGIN_TIMELINE_LABEL_BIND:"Attacher/Detacher",PLUGIN_D3JS_CHART_LABELS:["GroupÃ©s","EmpilÃ©s"]},{}),$.Class("fr.ina.amalia.player.BaseLoader",{},{settings:{},logger:null,data:null,handlerData:{},completeHandler:null,player:null,waitLoadEvent:!1,parser:null,init:function(a,b,c,d){this.settings=$.extend({debug:!1,sublocalisations:!1},a||{}),this.player=b,this.parser=null,this.handlerData=$.extend({debug:!1},d||{}),this.completeHandler=c,this.logger=null,void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),this.initialize()},initialize:function(){null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize"),this.initializeParser()},initializeParser:function(){if(this.parser=null,"json"===this.settings.format)this.parser=new fr.ina.amalia.player.parsers.BaseParserMetadata(this.settings);else try{this.parser=eval("new "+this.settings.format+"(this.settings)")}catch(a){this.parser=null,null!==this.logger&&(this.logger.warn("Unknown host configuration type."),this.logger.error(a.stack))}},setRequestType:function(a){this.requestType=a},setDataType:function(a){this.dataType=a},setTimeout:function(a){this.timeout=a},setSendData:function(a){this.sendData=$.extend(this.sendData,a||{})},getSendData:function(){return this.sendData},getWaitLoadEvent:function(){return this.waitLoadEvent},getData:function(){return this.data},onSuccess:function(a,b){null!==this.logger&&this.logger.trace(this.Class.fullName,"onSuccess status: "+b)},onError:function(a){null!==this.logger&&this.logger.trace(this.Class.fullName,"onError status :"+a)}}),fr.ina.amalia.player.BaseLoader.extend("fr.ina.amalia.player.HttpLoader",{},{requestType:"GET",dataType:"json",sendData:{},timeout:12e4,init:function(a,b,c,d){this._super(a,b,c,d),this.waitLoadEvent=!0},initialize:function(){this._super(),
this.load(this.settings.url)},load:function(a){var b=this;$.ajax({type:this.requestType,url:a,timeout:this.timeout,data:this.sendData,dataType:this.dataType,success:function(a,c){b.onSuccess(a,c)},error:function(a,c){b.onError(c)}}),null!==this.logger&&this.logger.trace(this.Class.fullName,"Load url :"+a)},onSuccess:function(a,b){this._super(a,b),this.data=null,null!==this.parser&&(this.data=this.parser.processParserData(a),this.player.addAllMetadata(this.data)),"function"==typeof this.completeHandler&&this.completeHandler(this.handlerData,b)},onError:function(a){this._super(a),this.data=null,"function"==typeof this.completeHandler&&this.completeHandler(this.handlerData,a)}}),fr.ina.amalia.player.BaseLoader.extend("fr.ina.amalia.player.WsLoader",{},{socket:null,listOfMetadata:null,init:function(a,b,c,d){this._super(a,b,c,d),this.waitLoadEvent=!1},initialize:function(){this._super(),this.socket=null,this.listOfMetadata=[],this.connect(this.settings.url),this.player.getContainer().on(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{self:this},this.onPlayerDataChange)},connect:function(a){null!==this.logger&&this.logger.trace(this.Class.fullName,"Load url :"+a),"function"==typeof WebSocket?(this.socket=new WebSocket(a),null!==this.socket&&$(this.socket).on("open",{self:this},this.onOpen).on("close",{self:this},this.onClose).on("message",{self:this},this.onMessage).on("error",{self:this},this.onError)):null!==this.logger&&this.logger.error("Error: WebSocket is not supported by this browser or the server is not started.")},onOpen:function(a){null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"WebSocket connection opened")},onClose:function(a){a.data.self.socket=null,null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"WebSocket connection closed")},onMessage:function(a){try{var b=JSON.parse(a.originalEvent.data);a.data.self.data=a.data.self.parser.processParserData(b);var c=a.data.self.data.viewControl,d=null!==a.data.self.data.viewControl&&a.data.self.data.viewControl.hasOwnProperty("action")?a.data.self.data.viewControl.action:"";if(null!==a.data.self.data)switch(d){case"add-all":a.data.self.player.updateBlockMetadata(a.data.self.data.id,{id:a.data.self.data.id,label:a.data.self.data.label,type:a.data.self.data.hasOwnProperty("type")?a.data.self.data.type:"default",author:null!==c&&c.hasOwnProperty("author")?c.author:"",color:null!==c&&c.hasOwnProperty("color")?c.color:"#3cf",shape:null!==c&&c.hasOwnProperty("shape")&&""!==c.shape?c.shape:"circle"},null),a.data.self.player.addMetadataById(a.data.self.data.id,a.data.self.data.list);break;case"replace-all":a.data.self.player.updateBlockMetadata(a.data.self.data.id,{id:a.data.self.data.id,label:a.data.self.data.label,type:a.data.self.data.hasOwnProperty("type")?a.data.self.data.type:"default",author:null!==c&&c.hasOwnProperty("author")?c.author:"",color:null!==c&&c.hasOwnProperty("color")?c.color:"#3cf",shape:null!==c&&c.hasOwnProperty("shape")&&""!==c.shape?c.shape:"circle"},d),a.data.self.player.replaceAllMetadataById(a.data.self.data.id,a.data.self.data.list);break;case"delete-all":a.data.self.player.deleteAllMetadataById(a.data.self.data.id);break;default:a.data.self.player.updateBlockMetadata(a.data.self.data.id,{id:a.data.self.data.id,label:a.data.self.data.label,type:a.data.self.data.hasOwnProperty("type")?a.data.self.data.type:"default",author:null!==c&&c.hasOwnProperty("author")?c.author:"",color:null!==c&&c.hasOwnProperty("color")?c.color:"#3cf",shape:null!==c&&c.hasOwnProperty("shape")&&""!==c.shape?c.shape:"circle"},null),a.data.self.player.addMetadataById(a.data.self.data.id,a.data.self.data.list)}}catch(b){a.data.self.data=null,null!==a.data.self.logger&&(a.data.self.logger.error("Error to add metadata"),a.data.self.logger.error(a.originalEvent.data))}},onError:function(a){a.data.self.socket=null,a.data.self.data=null,null!==a.data.self.logger&&(a.data.self.logger.error("Error to initialize, web socket connection."),a.data.self.logger.error(a))},onPlayerDataChange:function(a,b){null!==a.data.self.logger&&(a.data.self.logger.trace(a.data.self.Class.fullName,"onPlayerDataChange"),a.data.self.logger.debug(a),a.data.self.logger.debug(a.data.self.player.getMetadataById(b.id)))}}),$.Class("fr.ina.amalia.player.parsers.BaseParserMetadata",{},{settings:{},logger:null,data:null,init:function(a){this.settings=$.extend({debug:!1,mainLevel:!1},a||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug}))},processParserData:function(a){if(null!==a&&void 0!==a){if(!0===a.hasOwnProperty("status")&&!0===a.hasOwnProperty("data")&&0===a.status&&null!==a)return this.parseData(a.data);if(!0===a.hasOwnProperty("id"))return this.parseData(a);if("undefined"!==a.length)return this.parseData(a)}return null!==this.logger&&(this.logger.warn(this.Class.fullName,"Error while filtering Data."),this.logger.warn(a)),null},parseData:function(a){var b=null;if(null!==this.logger&&this.logger.trace(this.Class.fullName,"parseData"),void 0!==a.length){b=[];for(var c in a)if("string"==typeof a[c])try{a[c]=JSON.parse(a[c]),b.push(this.getData(a[c]))}catch(a){null!==this.logger&&this.logger.warn("parseData : Error to find data type.")}else!0===a[c].hasOwnProperty("id")?b.push(this.getData(a[c])):null!==this.logger&&this.logger.warn("parseData : Error to find data type.")}else!0===a.hasOwnProperty("id")?b=this.getData(a):null!==this.logger&&this.logger.warn("parseData : Error to find data type.");return b},getData:function(a){var b=null;if(b={},b.id=a.id,b.type=a.type,b.viewControl=a.hasOwnProperty("viewControl")?a.viewControl:null,b.label=a.hasOwnProperty("label")?a.label:a.id,b.list=[],!0===a.hasOwnProperty("localisation")&&null!==a.localisation&&a.localisation.length>0){var c=null;c=this.settings.hasOwnProperty("parameters")&&null!==this.settings.parameters&&this.settings.parameters.hasOwnProperty("mainLevel")&&!0===this.settings.parameters.mainLevel?a.localisation:!0===a.localisation[0].hasOwnProperty("sublocalisations")&&null!==a.localisation[0].sublocalisations&&a.localisation[0].sublocalisations.hasOwnProperty("localisation")?a.localisation[0].sublocalisations.localisation:a.localisation;var d=null,e=null,f="",g="";if(null!==c&&void 0!==c&&c.hasOwnProperty("length"))for(var h=0;h<c.length;h++)e=c[h],f=e.hasOwnProperty("label")?e.label:"",g=e.hasOwnProperty("thumb")?e.thumb:null,!0===e.hasOwnProperty("tcin")&&!0===e.hasOwnProperty("tcout")?(d={id:!0===e.hasOwnProperty("id")?e.id:null,shape:!0===e.hasOwnProperty("shape")?e.shape:null,data:!0===e.hasOwnProperty("data")?e.data:null,sublocalisations:!0===e.hasOwnProperty("sublocalisations")?e.sublocalisations:null,label:f,thumb:g,tclevel:!0===e.hasOwnProperty("tclevel")?e.tclevel:0,tc:"number"==typeof e.tc?e.tc:fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(e.tc),tcin:"number"==typeof e.tcin?e.tcin:fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(e.tcin),tcout:"number"==typeof e.tcout?e.tcout:fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(e.tcout),duration:fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(e.tcout)-fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(e.tcin),type:!0===e.hasOwnProperty("type")?e.type:null,score:!0===e.hasOwnProperty("score")?parseFloat(e.score):null},b.list.push(d)):!0===e.hasOwnProperty("tc")&&null!==e.tc&&(d={id:!0===e.hasOwnProperty("id")?e.id:null,shape:!0===e.hasOwnProperty("shape")?e.shape:null,data:!0===e.hasOwnProperty("data")?e.data:null,sublocalisations:!0===e.hasOwnProperty("sublocalisations")?e.sublocalisations:null,label:f,thumb:g,tclevel:!0===e.hasOwnProperty("tclevel")?e.tclevel:0,tc:"number"==typeof e.tc?e.tc:fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(e.tc),type:!0===e.hasOwnProperty("type")?e.type:null,score:!0===e.hasOwnProperty("score")?parseFloat(e.score):null},b.list.push(d))}return b}}),$.Class("fr.ina.amalia.player.MetadataManager",{},{mediaPlayer:null,logger:null,settings:{},listOfBlocks:{},listOfMetadata:[],listOfSelectedItems:[],selectedMetadataId:null,init:function(a,b){if(this.mediaPlayer=b,this.listOfBlocks={},this.listOfMetadata=[],this.listOfSelectedItems=[],this.selectedMetadataId=null,this.selectedMetadataId=null,this.settings=$.extend({debug:!1,internalPlugin:!1},a||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),null===this.mediaPlayer)throw new Error("Can't initialize plugin name"+this.Class.fullName)},getBlocksMetadata:function(){try{var a={};for(var b in this.listOfBlocks)if(this.listOfBlocks.hasOwnProperty(b)){var c=JSON.parse(JSON.stringify(this.listOfBlocks[b]));void 0!==this.listOfMetadata[b]?c.localisation=JSON.parse(JSON.stringify(this.listOfMetadata[b],function(a,b){return"refLoc"===a?void 0:b})):c.localisation=null,a[b]=c}return a}catch(a){null!==this.logger&&(this.logger.warn("Error to return blocks"),this.logger.error(a.stack))}return null},getBlockMetadata:function(a){var b=null;try{void 0!==this.listOfBlocks[a]&&(b=this.listOfBlocks[a],void 0!==this.listOfMetadata[a]?b.localisation=JSON.parse(JSON.stringify(this.listOfMetadata[a],function(a,b){return"refLoc"===a?void 0:b})):b.localisation=null)}catch(a){null!==this.logger&&(this.logger.warn("Error to return blocks"),this.logger.error(a.stack))}return b},updateBlockMetadata:function(a,b,c){try{"object"==typeof b?this.listOfBlocks[a]=$.extend(this.listOfBlocks[a],JSON.parse(JSON.stringify(b))):"string"==typeof b&&(this.listOfBlocks[a]=$.extend(this.listOfBlocks[a],JSON.parse(b))),void 0===this.listOfMetadata[a]&&(this.listOfMetadata[a]=[]),this.listOfBlocks[a].hasOwnProperty("localisation")&&this.listOfBlocks[a].localisation&&(this.listOfMetadata[a]=this.listOfBlocks[a].localisation),this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:a,action:c})}catch(a){null!==this.logger&&(this.logger.warn("Error to add blocks"),this.logger.error(a.stack))}},removeBlockMetadata:function(a){return delete this.listOfBlocks[a]},addAllMetadata:function(a){if("object"==typeof a&&null!==a)if(void 0!==a.length)for(var b in a)if(a[b].hasOwnProperty("id")){void 0===this.listOfMetadata[a[b].id]&&(this.listOfMetadata[a[b].id]=[]);for(var c=0;c<a[b].list.length;c++){var d=a[b].list[c];this.listOfMetadata[a[b].id].push(d)}if(!0===a[b].hasOwnProperty("type")){var e=a[b];this.updateBlockMetadata(e.id,{type:e.type,id:e.id,viewControl:e.hasOwnProperty("viewControl")?e.viewControl:null,label:e.hasOwnProperty("label")?e.label:e.id})}else this.updateBlockMetadata(a[b].id,{});this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:a[b].id}),null!==this.logger&&this.logger.info("AddAllMetadata ID:"+a[b].id)}else null!==this.logger&&this.logger.warn("parseData : Error to find data type.");else{void 0===this.listOfMetadata[a.id]&&(this.listOfMetadata[a.id]=[]);for(var f=0;f<a.list.length;f++){var g=a.list[f];this.listOfMetadata[a.id].push(g)}this.updateBlockMetadata(a.id,{id:a.id,label:a.hasOwnProperty("label")?a.label:a.id,type:a.hasOwnProperty("type")?a.type:"",viewControl:a.hasOwnProperty("viewControl")?a.viewControl:null}),this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:a.id}),null!==this.logger&&this.logger.info("Add Metadata ID:"+a.id)}else null!==this.logger&&(this.logger.warn("Error to add metadata."),this.logger.warn(a))},addMetadataById:function(a,b){if(void 0===this.listOfMetadata[a]&&(this.listOfMetadata[a]=[],this.updateBlockMetadata(a,{})),"object"==typeof b){for(var c=0;c<b.length;c++){var d=b[c];this.listOfMetadata[a].push(d)}this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:a})}},replaceAllMetadataById:function(a,b){if(this.listOfMetadata[a]=[],"object"==typeof b){this.listOfMetadata[a]=[];for(var c=0;c<b.length;c++){var d=b[c];this.listOfMetadata[a].push(d)}this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:a})}},deleteAllMetadataById:function(id){if(void 0!==this.listOfMetadata[id]){var deleted=!1;this.listOfMetadata.hasOwnProperty(id)&&(deleted=eval("delete this.listOfMetadata['"+id+"']")),deleted&&(this.removeBlockMetadata(id),this.selectedMetadataId=null,this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.SELECTED_METADATA_CHANGE,{metadataId:this.selectedMetadataId}),this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:id,action:"deleteBlock"}))}return!1},addMetadataItem:function(a,b){if("object"!=typeof this.listOfMetadata[a]&&(this.listOfMetadata[a]=[]),"object"==typeof b){var c=this.listOfMetadata[a].push(b),d=this.listOfMetadata[a][c-1];return this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:a}),d}},getMetadataById:function(a){return void 0===this.listOfMetadata[a]?null:this.listOfMetadata[a]},setMetadataById:function(a,b){if("object"==typeof b)this.listOfMetadata[a]=b;else{if("string"!=typeof b)return!1;try{var c=JSON.parse(b);this.listOfMetadata[a]=c}catch(a){return!1}}return this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:a}),!0},removeMetadataById:function(a){this.listOfMetadata[a]=[],this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:a})},getMetadataWithRange:function(a,b,c){var d=this.getMetadataById(a),e=[];return null!==d&&"object"==typeof d?(e=$.grep(d,function(a){return!a.hasOwnProperty("tc")||null===a.tc||a.tc>=b&&a.tc<=c}),null!==this.logger&&this.logger.trace(this.Class.fullName,"getMetadataWithRange Id:"+a+" Tcin:"+b+" Tcout:"+c+" Number of Elements:"+d.length)):null!==this.logger&&this.logger.warn("GetMetadataWithRange:  No data id:"+a),e},getSelectedMetadataId:function(){return null!==this.selectedMetadataId?this.selectedMetadataId.toString():null},setSelectedMetadataId:function(a){this.selectedMetadataId!==a&&(this.removeAllSelectedItems(),this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{id:this.selectedMetadataId}),this.selectedMetadataId=a,this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.SELECTED_METADATA_CHANGE,{metadataId:this.selectedMetadataId}))},getSelectedItems:function(){return this.listOfSelectedItems},addSelectedItem:function(a){null!==a&&"object"==typeof a&&(a.selected=!0),this.listOfSelectedItems.push(a),this.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.SELECTED_ITEMS_CHANGE,{item:a})},removeSelectedItem:function(a){if("undefined"!==this.listOfSelectedItems[a]&&!1===isNaN(a)){var b=this.listOfSelectedItems[a];null!==b&&"object"==typeof b&&!0===b.hasOwnProperty("selected")&&(b.selected=!1),a>-1&&this.listOfSelectedItems.splice(a,1)}},removeAllSelectedItems:function(){if(void 0!==this.listOfSelectedItems&&this.listOfSelectedItems.hasOwnProperty("length")&&this.listOfSelectedItems.length>0)for(var a=0;a<this.listOfSelectedItems.length;a++){var b=this.listOfSelectedItems[a];null!==b&&"object"==typeof b&&!0===b.hasOwnProperty("selected")&&(b.selected=!1)}this.listOfSelectedItems=[]}}),$.Class("fr.ina.amalia.player.LocalisationManager",{},{logger:null,localisation:null,init:function(){this.localisation=[]},setLoc:function(a){this.localisation=a},getLocTc:function(){if(null!==this.localisation&&this.localisation.length>1){this.localisation.sort(function(a,b){return a.tc="number"==typeof a.tc?a.tc:parseFloat(fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(a.tc)),b.tc="number"==typeof b.tc?b.tc:parseFloat(fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(b.tc)),delete a.firstItem,delete a.lastItem,delete a.tcRange,a.tc-b.tc});for(var a=this.localisation[0],b=this.localisation[this.localisation.length-1],c=0;c<this.localisation.length;c++){var d=this.localisation[c];d.tcRange={min:a.tc,max:b.tc},d.subItem=!0}if(a.hasOwnProperty("tc")&&b.hasOwnProperty("tc"))return a.firstItem=!0,b.lastItem=!0,delete a.range,delete b.range,a.tcRange={max:b.tc},b.tcRange={min:a.tc},{tcin:a.tc,tcout:b.tc}}return null},updateSpacialLocBlock:function(a){if(null!==a&&a.length>0)for(var b=0;b<a.length;b++){var c=a[b];if(c.hasOwnProperty("sublocalisations")&&"object"==typeof c.sublocalisations&&null!==c.sublocalisations){if(c.sublocalisations.localisation.length>0){c.sublocalisations.localisation.sort(function(a,b){return a.tc-b.tc});for(var d=0;d<c.sublocalisations.localisation.length;d++){var e=c.sublocalisations.localisation[d];null===e.tc&&!0===e.deleted&&c.sublocalisations.localisation.splice(d,1)}if(c.sublocalisations.localisation.sort(function(a,b){return a.tc-b.tc}),1===c.sublocalisations.localisation.length){var f=c.sublocalisations.localisation[0];return c.tc=parseFloat(f.tc),c.shape=$.extend({},f.shape),c.sublocalisations=null,delete c.tcin,delete c.tcout,!0}if(c.sublocalisations.localisation.length>1){var g=c.sublocalisations.localisation[0],h=c.sublocalisations.localisation[c.sublocalisations.localisation.length-1];if(g.hasOwnProperty("tc")&&h.hasOwnProperty("tc"))return c.tc=parseFloat(g.tc),c.tcin=parseFloat(g.tc),c.tcout=parseFloat(h.tc),!0}}}else c.hasOwnProperty("delete")&&!0===c.delete&&a.splice(b,1)}return!1},updateLocBlock:function(a){if(null!==a&&a.length>0)for(var b=a.length-1;b>=0;b--){var c=a[b];if(null===c.tc&&null===c.tcin)a.splice(b,1);else if(c.hasOwnProperty("sublocalisations")&&null!==c.sublocalisations&&"object"==typeof c.sublocalisations&&c.sublocalisations.localisation.length>0)for(var d=c.sublocalisations.localisation.length-1;d>=0;d--){var e=c.sublocalisations.localisation[d];null===e.tc&&e.hasOwnProperty("deleted")&&!0===e.deleted&&c.sublocalisations.localisation.splice(d,1)}}return!1},shiftSpacialLocBlock:function(a,b){var c=b-a.tcin;if(a.tcout+=c,a.hasOwnProperty("sublocalisations")&&"object"==typeof a.sublocalisations){if(a.sublocalisations.localisation.length>0){a.sublocalisations.localisation.sort(function(a,b){return a.tc-b.tc});for(var d=0;d<a.sublocalisations.localisation.length;d++){a.sublocalisations.localisation[d].tc+=c}}return!0}return!1},shiftLocBlock:function(a,b,c,d,e){if("object"==typeof a&&a.length>0){a.sort(function(a,b){return a.tc-b.tc});for(var f=0;f<a.length;f++){var g=a[f];(!1===e||!0===e&&g.hasOwnProperty("selected")&&!0===g.selected)&&(g.hasOwnProperty("tc")&&null!==g.tc&&(g.tc+=b),g.hasOwnProperty("tcin")&&null!==g.tcin&&(g.tcin+=b),g.hasOwnProperty("tcout")&&null!==g.tcout&&(g.tcout+=b))}return!0}return!1}}),$.Class("fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase",{},{settings:{},logger:null,element:null,component:null,mediaPlayer:null,init:function(a,b,c){this.parameter=$.extend({debug:!0},a||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.parameter.debug})),this.container=c,this.mediaPlayer=b,this.initialize()},initialize:function(){},show:function(){this.component.show()},hide:function(){this.component.hide()}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.BaseButton",{classCss:"player-base-button",style:""},{initialize:function(){this.component=$("<div>",{class:this.Class.classCss,style:this.Class.style});var a=$("<span>",{class:"button-container"}),b=$("<span>",{class:this.parameter.style});!0===this.parameter.hasOwnProperty("title")&&b.attr("title",this.parameter.title),a.append(b),this.component.on("click",{self:this,component:this.component},this.onClick),this.component.append(a),this.container.append(this.component)},onClick:function(event){if(void 0!==event.data.self.parameter.callback)try{eval(event.data.self.parameter.callback+"(event.data.self.mediaPlayer, event.data.self.parameter)")}catch(a){null!==event.data.self.logger&&event.data.self.logger.warn("Send callback failed.")}}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.TimeLabel",{classCss:"player-timelabel time-display off",style:"",eventTypes:{}},{currentTime:null,timeSeparator:null,duration:null,initialize:function(){this.component=$("<div>",{class:this.Class.classCss,style:this.Class.style}),this.currentTime=$("<span>",{class:"time-current"}),this.timeSeparator=$("<span>",{class:"time-separator"}),this.duration=$("<span>",{class:"time-duration"}),this.component.append(this.currentTime),this.component.append(this.timeSeparator),this.component.append(this.duration),this.container.append(this.component),this.definePlayerEvents()},setCurrentTime:function(a){null!==this.currentTime&&this.currentTime.text(a)},setDuration:function(a){null!==this.duration&&(this.duration.text(a),this.component.removeClass("off").addClass("on"))},definePlayerEvents:function(){this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.TIME_CHANGE,{self:this},this.onTimechange)},onTimechange:function(a,b){var c=fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(b.currentTime,a.data.self.parameter.framerate,a.data.self.parameter.timeFormat),d=fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(b.duration,a.data.self.parameter.framerate,a.data.self.parameter.timeFormat);a.data.self.setCurrentTime(c),a.data.self.setDuration(d)}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.PlayButton",{classCss:"player-play-button",style:"",playIcon:"ajs-icon ajs-icon-controlbar-play"},{initialize:function(){this.component=$("<div>",{class:this.Class.classCss,style:this.Class.style});var a=$("<span>",{class:"button-container"}),b=$("<i>",{class:this.Class.playIcon});a.append(b),this.component.append(a),this.component.on("click",{self:this,component:this.component},this.onClick),this.container.append(this.component),this.definePlayerEvents()},definePlayerEvents:function(){this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.PLAYING,{self:this},this.onPlaying),this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.PAUSED,{self:this},this.onPaused),this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.CAST_PLAYING,{self:this},this.onPlaying),this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.CAST_PAUSED,{self:this},this.onPaused)},onClick:function(a){a.data.self.mediaPlayer.getCastMode()?a.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.CAST_PLAYING):a.data.self.mediaPlayer.play()},onPlaying:function(a){a.data.self.component.addClass("off").removeClass("on")},onPaused:function(a){a.data.self.component.addClass("on").removeClass("off")}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.PauseButton",{classCss:"player-pause-button",style:"",pauseIcon:"ajs-icon ajs-icon-controlbar-pause"},{initialize:function(){this.component=$("<div>",{class:this.Class.classCss,style:this.Class.style});var a=$("<span>",{class:"button-container"}),b=$("<i>",{class:this.Class.pauseIcon});a.append(b),this.component.append(a),this.component.on("click",{self:this,component:this.component},this.onClick),this.container.append(this.component),this.definePlayerEvents(),this.component.addClass("off").removeClass("on")},definePlayerEvents:function(){this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.PLAYING,{self:this},this.onPlaying),this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.PAUSED,{self:this},this.onPaused),this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.CAST_PLAYING,{self:this},this.onPlaying),this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.CAST_PAUSED,{self:this},this.onPaused)},onClick:function(a){a.data.self.mediaPlayer.getCastMode()?a.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.CAST_PAUSED):a.data.self.mediaPlayer.isPaused()?a.data.self.mediaPlayer.play():a.data.self.mediaPlayer.pause()},onPlaying:function(a){a.data.self.component.addClass("on").removeClass("off")},onPaused:function(a){a.data.self.component.addClass("off").removeClass("on")}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.FullscreenButton",{classCss:"player-fullscreen-button",classCssFullscreenOn:"ajs-icon ajs-icon-controlbar-fullscreen",classCssFullscreenOff:"ajs-icon ajs-icon-controlbar-compress",style:"",eventTypes:{CLICK:"fr.ina.amalia.player.plugins.widgets.FullscreenButton.event.click"}},{initialize:function(){this.component=$("<div>",{class:this.Class.classCss,style:this.Class.style});var a=$("<span>",{class:this.Class.classCssFullscreenOn});this.component.append(a),this.component.on("click",{self:this,component:this.component},this.onClick),this.container.append(this.component),this.setFullscreenMode(!1),null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize"),this.definePlayerEvents()},definePlayerEvents:function(){this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.FULLSCREEN_CHANGE,{self:this},this.onFullscreenModeChange)},setFullscreenMode:function(a){!0===a?this.component.find("span").removeClass(this.Class.classCssFullscreenOn).addClass(this.Class.classCssFullscreenOff):this.component.find("span").removeClass(this.Class.classCssFullscreenOff).addClass(this.Class.classCssFullscreenOn)},onClick:function(a){a.data.self.mediaPlayer.toggleFullScreen()},onFullscreenModeChange:function(a,b){a.data.self.setFullscreenMode(b.inFullScreen)}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.VolumeControlBar",{classCss:"player-volume-control",classCssVolumeOn:"ajs-icon ajs-icon-controlbar-volume_max",classCssVolumeUp:"ajs-icon ajs-icon-controlbar-volume_max",classCssVolumeDown:"ajs-icon ajs-icon-controlbar-volume-min",classCssVolumeOff:"ajs-icon ajs-icon-controlbar-volume-off",style:"",eventTypes:{CLICK:"fr.ina.amalia.player.plugins.widgets.VolumeControlBar.event.click",CHANGE:"fr.ina.amalia.player.plugins.widgets.VolumeControlBar.event.change",HOVER:"fr.ina.amalia.player.plugins.widgets.VolumeControlBar.event.hover"}},{sliderStart:0,sliderEnd:100,defaultValue:100,volumeControlComponent:null,volumeSliderComponent:null,initialize:function(){this.volumeSliderComponent=null,this.component=$("<div>",{class:this.Class.classCss,style:this.Class.style});var a='<input class="volume-control" data-width="70" data-height="70" data-displayInput="false" data-displayPrevious="true" data-skin="tron" data-thickness=".2" data-fgColor="#13e7f0"value="'+this.defaultValue+'" >';this.component.append(a);var b=$("<div>",{class:"volume-control-btn"}),c=$("<span>");b.append(c);var d=this;this.component.find("input.volume-control").knob({change:function(a){d.onSlide(a)}}),b.on("mouseover",{self:this},this.onMouseover),b.find("span").on("click",{self:this},this.onClickVolume),this.component.find("div").append(b);var e=$("<div>",{class:"volume-slider-ctn off"});this.volumeSliderComponent=$("<div>",{class:"slider-volume"}),e.append(this.volumeSliderComponent),b.append(e),this.volumeSliderComponent.slider({orientation:"vertical",min:0,max:100,range:"min",value:this.mediaPlayer.getVolume(),slide:function(a,b){d.onSlide(b.value)}}),e.on("mouseleave",{self:this},this.onMouseleave),this.container.append(this.component),this.definePlayerEvents(),this.setValue(this.mediaPlayer.getVolume()),null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize")},definePlayerEvents:function(){this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.VOLUME_CHANGE,{self:this},this.onPlayerVolumeChange)},onClick:function(a){a.data.component.trigger(a.data.self.Class.eventTypes.CLICK),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onClick/triggerevent:"+a.data.self.Class.eventTypes.CLICK)},setValue:function(a){this.component.find("input.volume-control").val(a).trigger("change");var b=this.component.find(".volume-control-btn span:first");b.attr("class",""),0===a?b.addClass(this.Class.classCssVolumeOff):a<50?b.addClass(this.Class.classCssVolumeDown):a>=50&&a<75?b.addClass(this.Class.classCssVolumeUp):a>=75&&b.addClass(this.Class.classCssVolumeOn)},onSlide:function(a){this.component.trigger(this.Class.eventTypes.CHANGE,{value:a}),this.mediaPlayer.setVolume(a),null!==this.logger&&this.logger.trace(this.Class.fullName,"onSlide/triggerevent:"+this.Class.eventTypes.CHANGE+" Value "+a)},onClickVolume:function(a){var b=a.data.self.mediaPlayer.getVolume()>50?0:100;a.data.self.mediaPlayer.setVolume(b),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onClickVolume:"+a.data.self.Class.eventTypes.CHANGE+" Value "+b)},onPlayerVolumeChange:function(a,b){null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onPlayerVolumeChange"+parseInt(b.volume)),a.data.self.setValue(parseInt(b.volume)),a.data.self.volumeSliderComponent.slider("value",parseInt(b.volume))},onMouseover:function(a){a.data.self.component.find(".volume-slider-ctn").addClass("on").removeClass("off"),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onMouseover")},onMouseleave:function(a){a.data.self.component.find(".volume-slider-ctn").addClass("off").removeClass("on"),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onMouseover")}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.ProgressBar",{classCss:"player-progress-bar",style:""},{sliderStart:0,sliderEnd:1e3,sliding:!1,defaultValue:0,lastSlideEvent:0,lastPlaybackState:!1,initialize:function(){this.lastPlaybackState=!1,this.component=$("<div>",{class:this.Class.classCss,style:this.Class.style}),this.component.slider({range:"min",min:this.sliderStart,max:this.sliderEnd,value:this.defaultValue,height:10,framepreview:!0,framepreviewTimeBound:500}),this.component.prepend($("<div>",{class:"buffer-bar"})),this.component.on("slidestart",{self:this,component:this.component},this.onSlideStart),this.component.on("slidestop",{self:this,component:this.component},this.onSlideStop),this.component.on("slide",{self:this,component:this.component},this.onSlide),this.container.append(this.component),this.definePlayerEvents()},setValue:function(a){!1===this.sliding&&this.component.slider("value",10*a)},setTitle:function(a){this.component.attr("title",a)},updateBuffer:function(a,b){this.component.find(".buffer-bar").css({left:a+"%",width:b+"%"})},definePlayerEvents:function(){this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.TIME_CHANGE,{self:this},this.onTimechange)},onTimechange:function(a,b){var c=fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(b.currentTime,a.data.self.settings.framerate,a.data.self.settings.timeFormat);if(a.data.self.setValue(b.percentage),a.data.self.setTitle(c),null!==a.data.self.mediaPlayer.getMediaPlayer()&&void 0!==a.data.self.mediaPlayer.getMediaPlayer().get(0).buffered&&a.data.self.mediaPlayer.getMediaPlayer().get(0).buffered.length>0){var d=a.data.self.mediaPlayer.getMediaPlayer().get(0).buffered.end(Math.max(0,a.data.self.mediaPlayer.getMediaPlayer().get(0).buffered.length-1)),e=100*d/(b.duration-b.tcOffset);a.data.self.updateBuffer(0,e)}},onSlideStart:function(a,b){a.data.self.sliding=!0,a.data.self.lastPlaybackState=!a.data.self.mediaPlayer.isPaused(),a.data.self.mediaPlayer.pause(),a.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.START_SEEKING,{percentage:b.value/10}),
null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onSlideStart Value : "+b.value)},onSlideStop:function(a,b){a.data.self.sliding=!1;var c=a.data.self.mediaPlayer.getDuration(),d=b.value/10,e=c*d/100;a.data.self.mediaPlayer.setCurrentTime(e+a.data.self.mediaPlayer.getTcOffset()),!0===a.data.self.lastPlaybackState&&a.data.self.mediaPlayer.play(),a.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.STOP_SEEKING,{percentage:b.value/10}),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onSlideStop value : "+b.value)},onSlide:function(a,b){if(a.data.self.mediaPlayer.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.SEEKING,{percentage:b.value/10}),!0===a.data.self.parameter.framepreview){if(new Date-a.data.self.lastSlideEvent>a.data.self.parameter.framepreviewTimeBound){a.data.self.lastSlideEvent=new Date;var c=a.data.self.mediaPlayer.getDuration(),d=b.value/10,e=c*d/100;a.data.self.mediaPlayer.setCurrentTime(e+a.data.self.mediaPlayer.getTcOffset()),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onSlide value : "+b.value)}}}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.Label",{classCss:"iplayer-Label label label-default",style:"",eventTypes:{}},{initialize:function(){this.component=$("<div>",{class:this.Class.classCss,style:this.Class.style,text:this.parameter.defaultValue}),this.container.append(this.component),null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize")},setValue:function(a){this.component.text(a)}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.JogShuttleButton",{classCss:"player-jog-shuttle-button",style:""},{playbackSpeed:3,playbackDefaultSpeed:4,playbackSpeedList:[-2,-1,-.5,-.1,1,.5,1.5,4,8],forwardSpeedIdx:0,backwardSpeedIdx:0,backwardSpeedList:[{style:"ajs-icon ajs-icon-jogs-backward-0x",speed:1},{style:"ajs-icon ajs-icon-jogs-backward-1x",speed:-.1},{style:"ajs-icon ajs-icon-jogs-backward-1x",speed:-.25},{style:"ajs-icon ajs-icon-jogs-backward-2x",speed:-.5},{style:"ajs-icon ajs-icon-jogs-backward-2x",speed:-.75},{style:"ajs-icon ajs-icon-jogs-backward-3x",speed:-1},{style:"ajs-icon ajs-icon-jogs-backward-3x",speed:-1.5},{style:"ajs-icon ajs-icon-jogs-backward-4x",speed:-2}],forwardSpeedList:[{style:"ajs-icon ajs-icon-jogs-forward-0x",speed:1},{style:"ajs-icon ajs-icon-jogs-forward-1x",speed:.5},{style:"ajs-icon ajs-icon-jogs-forward-1x",speed:.75},{style:"ajs-icon ajs-icon-jogs-forward-2x",speed:1.5},{style:"ajs-icon ajs-icon-jogs-forward-2x",speed:2},{style:"ajs-icon ajs-icon-jogs-forward-3x",speed:4},{style:"ajs-icon ajs-icon-jogs-forward-3x",speed:6},{style:"ajs-icon ajs-icon-jogs-forward-4x",speed:8}],sliding:!1,initialize:function(){this.forwardSpeedIdx=0,this.backwardSpeedIdx=0,this.sliding=!1,this.component=$("<div>",{class:this.Class.classCss,style:this.Class.style});var a=$("<span>",{class:"button-container"}),b=$("<div>",{class:"backward-container ajs-icon ajs-icon-jogs-backward-4x"}),c=$("<span>",{class:this.backwardSpeedList[0].style});b.append(c),b.on("click",{self:this},this.onClickToBackward),b.on("dblclick",{self:this},this.onDblClickToBackward),a.append(b);var d=$("<div>",{class:"forward-container ajs-icon ajs-icon-jogs-forward-4x"}),e=$("<span>",{class:this.forwardSpeedList[0].style});d.append(e),d.on("click",{self:this},this.onClickToForward),d.on("dblclick",{self:this},this.onDblClickToForward),a.append(d);var f=$("<div>",{class:"jog-shuttle-separator"}).on("mouseover",{self:this},this.onHoverJogShuttle);a.append(f);var g=this,h=$("<div>",{class:"jog-shuttle"}).slider({min:0,max:8,value:g.playbackDefaultSpeed,slide:function(a,b){g.playbackSpeedList.length>=b.value&&g.setPlaybackSpeed(parseFloat(g.playbackSpeedList[b.value])),g.sliding=!0},stop:function(){$(this).slider("option","value",g.playbackDefaultSpeed),g.setPlaybackSpeed(g.playbackDefaultSpeed),g.mediaPlayer.play(),g.sliding=!1,g.component.find("div.jog-shuttle").removeClass("on")}});h.find(".ui-slider-handle").addClass("ajs-icon ajs-icon-jogs-center"),a.append(h),this.component.append(a),this.container.append(this.component),h.find(".ui-slider-handle").on("mouseleave",{self:this},this.onJogShuttleMouseout),this.definePlayerEvents()},definePlayerEvents:function(){this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.PLAYBACK_RATE_CHANGE,{self:this},this.onPlaybackRateChange)},setPlaybackSpeed:function(a){this.playbackSpeed=parseFloat(a),this.mediaPlayer.setPlaybackrate(this.playbackSpeed),null!==this.logger&&this.logger.trace(this.Class.fullName,"playbackRate:"+this.playbackSpeed)},updateControls:function(){var a=parseFloat(this.playbackSpeed),b=$.grep(this.forwardSpeedList,function(b){return b.speed===a}),c=b.length<=0?this.forwardSpeedList[0].style:b[0].style,d=$.grep(this.backwardSpeedList,function(b){return b.speed===a}),e=d.length<=0?this.backwardSpeedList[0].style:d[0].style;this.component.find(".forward-container span:first").attr("class",c),this.component.find(".backward-container span:first").attr("class",e)},onClickToForward:function(a){if(!1===a.data.self.sliding){a.data.self.forwardSpeedIdx=a.data.self.forwardSpeedList.length-1>a.data.self.forwardSpeedIdx?a.data.self.forwardSpeedIdx+1:0,a.data.self.backwardSpeedIdx=0;var b=a.data.self.forwardSpeedList[a.data.self.forwardSpeedIdx].speed;a.data.self.setPlaybackSpeed(b),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onClickToForward : "+a.data.self.forwardSpeedIdx)}},onClickToBackward:function(a){if(!1===a.data.self.sliding){a.data.self.forwardSpeedIdx=0,a.data.self.backwardSpeedIdx=a.data.self.backwardSpeedList.length-1>a.data.self.backwardSpeedIdx?a.data.self.backwardSpeedIdx+1:0;var b=a.data.self.backwardSpeedList[a.data.self.backwardSpeedIdx].speed;a.data.self.setPlaybackSpeed(b),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onClickToBackward :"+a.data.self.backwardSpeedIdx)}},onDblClickToForward:function(a){a.data.self.forwardSpeedIdx=0,a.data.self.mediaPlayer.setCurrentTime(a.data.self.mediaPlayer.getDuration());var b=a.data.self.forwardSpeedList[0].style;a.data.self.component.find(".forward-container span:first").attr("class","ajs-icon ajs-icon-jogs-fast-forward").delay(1500).queue(function(){a.data.self.component.find(".forward-container span:first").attr("class",b)}),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onDbClickToForward : "+a.data.self.forwardSpeedIdx)},onDblClickToBackward:function(a){a.data.self.backwardSpeedIdx=0,a.data.self.mediaPlayer.setCurrentTime(0);var b=a.data.self.backwardSpeedList[0].style;a.data.self.component.find(".backward-container span:first").attr("class","ajs-icon ajs-icon-jogs-fast-backward").delay(1500).queue(function(){a.data.self.component.find(".backward-container span:first").attr("class",b)}),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onDbClickToBackward :"+a.data.self.backwardSpeedIdx)},onHoverJogShuttle:function(a){a.data.self.component.find("div.jog-shuttle").addClass("on")},onJogShuttleMouseout:function(a){!1===a.data.self.sliding&&a.data.self.component.find("div.jog-shuttle").removeClass("on")},onPlaybackRateChange:function(a,b){a.data.self.playbackSpeed=parseFloat(b.rate),a.data.self.updateControls(),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"playbackRate:"+a.data.self.playbackSpeed)}}),fr.ina.amalia.player.plugins.controlBar.widgets.WidgetBase.extend("fr.ina.amalia.player.plugins.controlBar.widgets.ChannelVolumeControlBar",{mainClassCss:"player-channel-volume-control-position",classCss:"player-channel-volume-control",classCssVolumeOn:"ajs-icon ajs-icon-controlbar-volume_max",classCssVolumeDown:"ajs-icon ajs-icon-controlbar-volume-min",classCssVolumeOff:"ajs-icon ajs-icon-controlbar-volume-off",classUnifyVolumeStateOn:"ajs-icon-sound-link-on",classUnifyVolumeStateOff:"ajs-icon-sound-link-off",classLeftVolumeStateOn:"ajs-icon-controlbar-volume-left",classLeftVolumeStateOff:"ajs-icon-controlbar-volume-left-off",classRightVolumeStateOn:"ajs-icon-controlbar-volume-right",classRightVolumeStateOff:"ajs-icon-controlbar-volume-right-off",style:"",eventTypes:{CLICK:"fr.ina.amalia.player.plugins.widgets.VolumeControlBar.event.click",CHANGE:"fr.ina.amalia.player.plugins.widgets.VolumeControlBar.event.change",HOVER:"fr.ina.amalia.player.plugins.widgets.VolumeControlBar.event.hover"}},{sliderStart:0,sliderEnd:100,defaultValue:100,volumeControlComponent:null,audioContext:null,panLeft:null,panRight:null,channelMerger:!1,channelMergerNode:null,unifyVolumeState:!0,initialize:function(){this.defaultValue=100,this.unifyVolumeState=!0,this.channelMerger=!0!==this.parameter.hasOwnProperty("channelMerger")||this.parameter.channelMerger,this.channelMergerNode=!0===this.parameter.hasOwnProperty("channelMergerNode")&&""!==this.parameter.channelMergerNode?this.parameter.channelMergerNode:null;var a=$("<div>",{class:this.Class.mainClassCss});this.component=$("<div>",{class:this.Class.classCss,style:this.Class.style});try{this.mediaPlayer.setVolume(100);var b=window.AudioContext||window.webkitAudioContext;this.audioContext=new b,this.setupAudioNodes()}catch(a){this.audioContext=null,null!==this.logger&&this.logger.warn(a)}null!==this.audioContext&&(this.createChannelVolume(),this.definePlayerEvents(),this.updateVolume()),a.append(this.component),this.container.append(a),null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize")},setupAudioNodes:function(){var a=this.audioContext.createMediaElementSource(this.mediaPlayer.getMediaPlayer().get(0));this.panLeft=this.audioContext.createGain(),this.panRight=this.audioContext.createGain();var b=this.audioContext.createChannelSplitter(2);if(a.connect(b,0,0),b.connect(this.panLeft,0),b.connect(this.panRight,1),null!==this.channelMergerNode){var c=this.audioContext.createPanner();c.coneOuterGain=1,c.coneOuterAngle=180,c.coneInnerAngle=0,"l"===this.channelMergerNode?c.setPosition(-1,0,0):"r"===this.channelMergerNode&&c.setPosition(1,0,0),this.panLeft.connect(c),this.panRight.connect(c),c.connect(this.audioContext.destination)}else if(!0===this.channelMerger)this.panLeft.connect(this.audioContext.destination,0),this.panRight.connect(this.audioContext.destination,0);else if(null===this.channelMergerNode){var d=this.audioContext.createChannelMerger(2);this.panLeft.connect(d,0,0),this.panRight.connect(d,0,1),d.connect(this.audioContext.destination)}},createChannelVolume:function(){var a=this,b=$("<div>",{class:"volume-control-btn"});b.on("click",{self:this},this.onClickToVolume),this.component.append(b);var c=$("<div>",{class:"channel-volume-sliders"});c.on("mouseleave",{self:this},this.onChannelVolumeMouseout);var d=$("<div>",{class:"channel-volume-info"});c.append(d);var e=$("<div>",{class:"channel-volume-info-left"});e.on("click",{self:this},this.onClickLeftVolume);var f=$("<span>",{class:"text ajs-icon "+this.Class.classLeftVolumeStateOn,text:""});e.append(f),d.append(e);var g=$("<div>",{class:"channel-volume-info-mid"}),h=$("<span>",{class:"unify on ajs-icon "+this.Class.classUnifyVolumeStateOn,text:""});h.on("click",{self:this},this.onClickUnifyVolumeState),g.append(h),d.append(g);var i=$("<div>",{class:"channel-volume-info-right"});i.on("click",{self:this},this.onClickRightVolume);var j=$("<span>",{class:"text ajs-icon "+this.Class.classRightVolumeStateOn,text:""});i.append(j),d.append(i);var k=$("<div>",{class:"channel-volume-control"});c.append(k);var l=$("<div>",{class:"channel-volume-control-left"}),m=$("<div>",{class:"left-volume-slider"});m.slider({orientation:"vertical",min:0,max:100,value:100,slide:function(b,c){a.panLeft.gain.value=c.value/100,!0===a.unifyVolumeState&&(a.panRight.gain.value=c.value/100,a.component.find(".right-volume-slider").slider("value",c.value)),a.updateVolume()},change:function(b,c){a.updateVolume(),a.panLeft.gain.value=c.value/100;var d=a.component.find(".right-volume-slider").slider("value");!0===a.unifyVolumeState&&d!==c.value&&(a.panRight.gain.value=c.value/100,a.component.find(".right-volume-slider").slider("value",c.value))}}),l.append(m),k.append(l);var n=$("<div>",{class:"channel-volume-control-mid on"});k.append(n);var o=$("<div>",{class:"channel-volume-control-right"}),p=$("<div>",{class:"right-volume-slider"});p.slider({orientation:"vertical",min:0,max:100,value:100,slide:function(b,c){if(a.panRight.gain.value=c.value/100,!0===a.unifyVolumeState){a.panLeft.gain.value=c.value/100,a.component.find(".left-volume-slider").slider("value",c.value);var d=$(b.target).position().top+$(c.handle).outerWidth()/2,e=$(c.handle).position().top;a.component.find(".channel-volume-control-mid").css("top",e+d+"px")}a.updateVolume()},change:function(b,c){a.updateVolume();var d=$(b.target).position().top+$(c.handle).outerWidth()/2,e=$(c.handle).position().top;a.component.find(".channel-volume-control-mid").css("top",e+d+"px"),a.panRight.gain.value=c.value/100;var f=a.component.find(".left-volume-slider").slider("value");!0===a.unifyVolumeState&&f!==c.value&&(a.panLeft.gain.value=c.value/100,a.component.find(".left-volume-slider").slider("value",c.value))}}),o.append(p),k.append(o),this.component.append(c)},definePlayerEvents:function(){this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.VOLUME_CHANGE,{self:this},this.onPlayerVolumeChange)},updateVolume:function(){var a=this.component.find(".left-volume-slider").slider("value"),b=this.component.find(".right-volume-slider").slider("value"),c=this.component.find(".channel-volume-info-left span.text"),d=this.component.find(".channel-volume-info-right span.text");a<10?c.addClass(this.Class.classLeftVolumeStateOff).removeClass(this.Class.classLeftVolumeStateOn):c.removeClass(this.Class.classLeftVolumeStateOff).addClass(this.Class.classLeftVolumeStateOn),b<10?d.addClass(this.Class.classRightVolumeStateOff).removeClass(this.Class.classRightVolumeStateOn):d.removeClass(this.Class.classRightVolumeStateOff).addClass(this.Class.classRightVolumeStateOn);var e=Math.max(a,b),f=this.component.find(".volume-control-btn");f.attr("class","volume-control-btn"),e<10?f.addClass(this.Class.classCssVolumeOff):e<75?f.addClass(this.Class.classCssVolumeDown):f.addClass(this.Class.classCssVolumeOn),!0===this.unifyVolumeState?(this.component.find(".channel-volume-info-mid .unify").addClass("on").addClass(this.Class.classUnifyVolumeStateOn).removeClass(this.Class.classUnifyVolumeStateOff),this.component.find(".channel-volume-control-mid").addClass("on")):(this.component.find(".channel-volume-info-mid .unify").removeClass("on").addClass(this.Class.classUnifyVolumeStateOff).removeClass(this.Class.classUnifyVolumeStateOn),this.component.find(".channel-volume-control-mid").removeClass("on"))},onClick:function(a){a.data.component.trigger(a.data.self.Class.eventTypes.CLICK),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onClick/triggerevent:"+a.data.self.Class.eventTypes.CLICK)},onPlayerVolumeChange:function(a,b){null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onPlayerVolumeChange"+parseInt(b.volume)),a.data.self.component.find(".left-volume-slider").slider("value",b.volume),a.data.self.component.find(".right-volume-slider").slider("value",b.volume),a.data.self.updateVolume()},onClickUnifyVolumeState:function(a){if(!1===a.data.self.unifyVolumeState){a.data.self.unifyVolumeState=!0;var b=a.data.self.component.find(".left-volume-slider").slider("value"),c=a.data.self.component.find(".right-volume-slider").slider("value");a.data.self.component.find(".left-volume-slider").slider("value",Math.max(b,c)),a.data.self.component.find(".right-volume-slider").slider("value",Math.max(b,c))}else a.data.self.unifyVolumeState=!1,a.data.self.updateVolume();null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onClickUnifyVolumeState/unifyVolumeState:"+a.data.self.unifyVolumeState)},onClickToVolume:function(a){a.data.self.component.find(".channel-volume-sliders").addClass("on")},onChannelVolumeMouseout:function(a){a.data.self.component.find(".channel-volume-sliders").removeClass("on")},onClickLeftVolume:function(a){a.data.self.component.find(".left-volume-slider").slider("value")<10?a.data.self.component.find(".left-volume-slider").slider("value",100):a.data.self.component.find(".left-volume-slider").slider("value",0)},onClickRightVolume:function(a){a.data.self.component.find(".right-volume-slider").slider("value")<10?a.data.self.component.find(".right-volume-slider").slider("value",100):a.data.self.component.find(".right-volume-slider").slider("value",0)}}),$.Class("fr.ina.amalia.player.plugins.PluginBase",{classCss:"plugin-default",style:""},{namespace:null,uuid:null,pluginContainer:null,mediaPlayer:null,logger:null,loaderContainer:null,settings:{},eventTag:"",listOfpluginTypes:[],bindingManager:null,init:function(a,b,c,d){if(this.mediaPlayer=b,this.pluginContainer=$(c),this.namespace=this.Class.fullName,this.bindingManager=d,this.settings=$.extend({debug:!1,internalPlugin:!1,shortcuts:{enabled:!1,listOfShortcuts:[]}},a||{}),this.eventTag=this.Class.fullName+"_"+this.pluginContainer.attr("id"),!1===this.settings.internalPlugin&&(this.pluginContainer.addClass(this.Class.classCss),this.createLoader(),this.loaderContainer.show()),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),null===this.mediaPlayer)throw new Error("Can't initialize plugin name"+this.Class.fullName);try{!1===this.settings.internalPlugin?(null!==this.loaderContainer&&this.loaderContainer.hide(),this.initialize()):this.initialize()}catch(a){null!==this.logger&&this.logger.error(a.stack)}this.initializeShortcuts()},initialize:function(){},setUuid:function(a){this.uuid=a.toString(),this.pluginContainer.attr("data-plugin-id",this.uuid)},getUuid:function(){return this.uuid.toString()},initializeError:function(a){var b=fr.ina.amalia.player.PlayerErrorCode.getMessage(a),c=$("<div>",{class:"ajs-error",style:"",text:b});this.pluginContainer.append(c)},createLoader:function(){this.loaderContainer=$("<div>",{class:"ajs-loader ajs-icon ajs-icon-cog",style:""}),this.loaderContainer.hide(),this.pluginContainer.append(this.loaderContainer)},registerPluginType:function(a){"string"==typeof a&&""!==a&&this.listOfpluginTypes.push(a)},getPluginTypes:function(){return this.listOfpluginTypes},onPluginReady:function(a){null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onPluginReady"),null!==a.data.self&&(a.data.self.initialize(),null!==a.data.self.loaderContainer&&a.data.self.loaderContainer.hide())},onPluginError:function(a,b){if(null!==a.data.self.logger&&a.data.self.logger.warn("PluginBase/onPluginError"),null!==a.data.self){var c=void 0===b.errorCode?"":b.errorCode;a.data.self.initializeError(c),null!==a.data.self.loaderContainer&&a.data.self.loaderContainer.hide()}},initializeShortcuts:function(){if(null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize shortcuts"),"object"==typeof this.settings.shortcuts&&!0===this.settings.shortcuts.enabled)for(var i=0;i<this.settings.shortcuts.listOfShortcuts.length;i++)try{var conf=this.settings.shortcuts.listOfShortcuts[i];if(null!==conf&&conf.hasOwnProperty("s")&&conf.hasOwnProperty("c")){var f=conf.c,callback=eval("this."+f);"function"==typeof callback?$(document).bind("keydown",{keys:conf.s,callback:conf.c,self:this},this.callback):null!==this.logger&&(this.logger.warn(this.Class.fullName+" : error to bind shortcut "+conf.c),this.logger.warn(conf))}}catch(a){null!==this.logger&&this.logger.warn(this.Class.fullName+" : error to bind shortcut "+conf.c)}},callback:function(event){try{event.preventDefault(),eval("event.data.self."+event.data.callback+"()")}catch(a){null!==event.data.self.logger&&event.data.self.logger.warn(event.data.self.Class.fullName+" : Error to send callback to bind shortcut :"+event.data.callback)}}}),fr.ina.amalia.player.plugins.PluginBase.extend("fr.ina.amalia.player.plugins.PluginBaseMultiBlocks",{METADATA_DISPLAY_TYPE:{STATIC:1,STATIC_DYNAMIC:2,DYNAMIC:3}},{loadDataStarted:!1,dataToDeal:null,managedMetadataIds:[],notManagedMetadataIds:null,listOfMetadataTypes:null,selectedMetadataId:"",addManagedMetadataType:function(a){"string"==typeof a&&""!==a&&this.listOfMetadataTypes.push(a)},isManagedMetadataType:function(a){return $.inArray(a,this.listOfMetadataTypes)>-1},getManagedMetadataTypes:function(){return this.listOfMetadataTypes},isManagedMetadataId:function(a){return $.inArray(a,this.managedMetadataIds)>-1||$.inArray(a,this.notManagedMetadataIds)>-1},isBoundMetadataId:function(a){return $.inArray(a,this.managedMetadataIds)>-1},getBindIds:function(){return this.managedMetadataIds},bindMetadataId:function(a){this.addManagedMetadataId(a)},unbindMetadataId:function(a){this.removeManagedMetadataId(a)},addManagedMetadataId:function(a){if("string"==typeof(a="number"==typeof a?a.toString():a)&&""!==a&&-1===this.managedMetadataIds.indexOf(a)){this.managedMetadataIds.push(a);var b=this.notManagedMetadataIds.indexOf(a);b>-1&&this.notManagedMetadataIds.splice(b,1)}},removeManagedMetadataId:function(a){if("string"==typeof(a="number"==typeof a?a.toString():a)&&""!==a&&-1===this.notManagedMetadataIds.indexOf(a)){this.notManagedMetadataIds.push(a);var b=this.managedMetadataIds.indexOf(a);b>-1&&this.managedMetadataIds.splice(b,1)}},getSelectedMetadata:function(){return this.selectedMetadataId.toString()},onSelectedMetadataChange:function(a,b){null!==b.metadataId&&(this.selectedMetadataId=b.metadataId.toString())}}),fr.ina.amalia.player.plugins.PluginBase.extend("fr.ina.amalia.player.plugins.PluginBaseSimpleBlock",{},{managedDataType:"",selectedMetadataId:"",addManagedDataType:function(a){"string"==typeof a&&""!==a&&(this.managedDataType=a)},isManagedType:function(a){return this.managedDataType===a},getManagedType:function(){return this.managedDataType},getSelectedMetadata:function(){return this.selectedMetadataId.toString()},onSelectedMetadataChange:function(a,b){null!==b.metadataId&&(this.selectedMetadataId=b.metadataId.toString())}}),$.Class("fr.ina.amalia.player.PluginBindingManager",{dataTypes:{DEFAULT:"default",DETECTION:"detection",VISUAL_DETECTION:"visual_detection",VISUAL_TRACKING:"visual_tracking",SEGMENTATION:"segmentation",AUDIO_SEGMENTATION:"audio_segmentation",TRANSCRIPTION:"transcription",SYNCHRONIZED_TEXT:"synchronized_text",KEYFRAMES:"keyframes",HISTOGRAM:"histogram"},pluginTypes:{TIMELINE_CUEPOINT:"timeline_cuepoint",TIMELINE_SEGMENT:"timeline_segment",TIMELINE_IMAGE:"timeline_image",TIMELINE_HISTOGRAM:"timeline_histogram",TIMELINE_VISUAL:"timeline_visual",TEXT_SYNC:"text-sync",CAPTION:"caption",OVERLAY:"overlay"}},{mediaPlayer:null,logger:null,settings:{},listOfDataTypes:null,listOfPluginTypes:null,pluginAndDataTypeMap:null,listOfPlugins:null,init:function(a,b){if(this.listOfPlugins=[],this.mediaPlayer=b,this.settings=$.extend({debug:!1,internalPlugin:!1},a||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),null===this.mediaPlayer)throw new Error("Can't initialize plugin name"+this.Class.fullName);this.setDefaultDataTypes(),this.setDefaultPluginAndDataTypeMap(),this.setDefaultPluginsTypes()},setDefaultDataTypes:function(){this.listOfDataTypes=[],this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.DETECTION),this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_DETECTION),this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_TRACKING),this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.SEGMENTATION),this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.AUDIO_SEGMENTATION),this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.TRANSCRIPTION),this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.SYNCHRONIZED_TEXT),this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.KEYFRAMES),this.listOfDataTypes.push(fr.ina.amalia.player.PluginBindingManager.dataTypes.HISTOGRAM)},setDefaultPluginsTypes:function(){this.listOfPluginTypes=[],this.listOfPluginTypes.push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_CUEPOINT),this.listOfPluginTypes.push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_SEGMENT),this.listOfPluginTypes.push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_IMAGE),this.listOfPluginTypes.push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_HISTOGRAM),this.listOfPluginTypes.push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.CAPTION),this.listOfPluginTypes.push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TEXT_SYNC),this.listOfPluginTypes.push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.OVERLAY)},setDefaultPluginAndDataTypeMap:function(){this.pluginAndDataTypeMap=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.DEFAULT]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.DETECTION]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.DETECTION].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_CUEPOINT),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_DETECTION]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_DETECTION].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_VISUAL),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_DETECTION].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.OVERLAY),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_TRACKING]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_TRACKING].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_VISUAL),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_TRACKING].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.OVERLAY),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.SEGMENTATION]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.SEGMENTATION].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_SEGMENT),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.AUDIO_SEGMENTATION]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.AUDIO_SEGMENTATION].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_SEGMENT),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.TRANSCRIPTION]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.TRANSCRIPTION].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.CAPTION),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.TRANSCRIPTION].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TEXT_SYNC),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.SYNCHRONIZED_TEXT]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.SYNCHRONIZED_TEXT].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.CAPTION),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.SYNCHRONIZED_TEXT].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TEXT_SYNC),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.SYNCHRONIZED_TEXT].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_SEGMENT),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.KEYFRAMES]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.KEYFRAMES].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_IMAGE),this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.HISTOGRAM]=[],this.pluginAndDataTypeMap[fr.ina.amalia.player.PluginBindingManager.dataTypes.HISTOGRAM].push(fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_HISTOGRAM)},getLinetypeWithDataType:function(a){return a===fr.ina.amalia.player.PluginBindingManager.dataTypes.DETECTION?fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_CUEPOINT:a===fr.ina.amalia.player.PluginBindingManager.dataTypes.AUDIO_SEGMENTATION?fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_SEGMENT:a===fr.ina.amalia.player.PluginBindingManager.dataTypes.SEGMENTATION?fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_SEGMENT:a===fr.ina.amalia.player.PluginBindingManager.dataTypes.KEYFRAMES?fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_IMAGE:a===fr.ina.amalia.player.PluginBindingManager.dataTypes.HISTOGRAM?fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_HISTOGRAM:a===fr.ina.amalia.player.PluginBindingManager.dataTypes.SYNCHRONIZED_TEXT?fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_SEGMENT:a===fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_DETECTION||a===fr.ina.amalia.player.PluginBindingManager.dataTypes.VISUAL_TRACKING?fr.ina.amalia.player.PluginBindingManager.pluginTypes.TIMELINE_VISUAL:null},registerPlugin:function(a,b){if(void 0===this.listOfPlugins[a]&&(this.listOfPlugins[a]=[]),"object"==typeof b&&b.length>0)for(var c=0;c<b.length;c++)$.inArray(b[c],this.listOfPlugins[a])<0&&this.listOfPlugins[a].push(b[c])},isManagedDataType:function(a,b){var c=this.listOfPlugins[a];if("object"==typeof c&&c.length)for(var d=0;d<c.length;d++)if($.inArray(c[d],this.pluginAndDataTypeMap[b])>-1)return!0;return!1}}),$.Class("fr.ina.amalia.player.plugins.PluginManager",{},{settings:{},logger:null,pluginsSettings:{},plugins:null,mediaContainer:null,mediaPlayer:null,contextMenuPlugin:null,loadedCount:0,failCount:0,dataLoaded:0,httpDataServicesCount:0,listOfPluginIds:[],listOfPluginTypes:[],bindingManager:null,init:function(a,b,c){this.mediaPlayer=b,this.mediaContainer=c,this.httpDataServicesCount=0,this.settings=$.extend({debug:!1},a||{}),this.pluginsSettings=$.extend({debug:this.settings.debug,dataServices:[],list:[]},a.plugins||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),this.plugins=[],this.initialize()},initialize:function(){null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize"),this.bindingManager=new fr.ina.amalia.player.PluginBindingManager(this.settings,this.mediaPlayer),this.mediaContainer.one(fr.ina.amalia.player.PlayerEventType.STARTED,{self:this},this.onStarted),this.mediaContainer.on(fr.ina.amalia.player.PlayerEventType.ERROR,{self:this},this.onError)},loadPlugins:function(){var a={internalPlugin:!0};this.contextMenuPlugin=this.loadPlugin("fr.ina.amalia.player.plugins.ContextMenuPlugin",a,this.mediaPlayer,this.mediaContainer);var b=$.extend({internalPlugin:!0,framerate:this.settings.framerate,debug:this.settings.debug,hide:!1},this.settings.controlBar||{});!0!==b.hide&&this.loadPlugin(this.settings.controlBarClassName,b,this.mediaPlayer,this.mediaContainer),this.loadDynamicPlugins(this.pluginsSettings.list)},getContextMenuPlugin:function(){return this.contextMenuPlugin},onStarted:function(a){a.data.self.loadPlugins(),a.data.self.loadData(a.data.self.pluginsSettings.dataServices)},onError:function(a){a.data.self.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.PLUGIN_ERROR,{
errorCode:fr.ina.amalia.player.PlayerErrorCode.ERROR_LOAD_PLUGIN})},loadData:function(hosts){if(this.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.BEGIN_DATA_CHANGE),$.isArray(hosts)){var i=0,loader=null,host=null,settings={debug:this.settings.debug};for(i=0;i<hosts.length;++i){if(loader=null,host=hosts[i],settings={debug:this.pluginsSettings.debug,format:host.hasOwnProperty("format")?host.format:"json",url:host.hasOwnProperty("url")?host.url:host,parameters:host.hasOwnProperty("parameters")?host.parameters:null,sublocalisations:!!host.hasOwnProperty("sublocalisations")&&host.sublocalisations},"string"==typeof host[i])loader=new fr.ina.amalia.player.HttpLoader(settings,this.mediaPlayer,this.dataLoadedHandler,{self:this});else if(host.hasOwnProperty("protocol"))if("http"===host.protocol)loader=new fr.ina.amalia.player.HttpLoader(settings,this.mediaPlayer,this.dataLoadedHandler,{self:this});else if("ws"===host.protocol)loader=new fr.ina.amalia.player.WsLoader(settings,this.mediaPlayer,this.dataLoadedHandler,{self:this});else try{loader=eval("new "+host.protocol+"(settings, this.mediaPlayer, this.dataLoadedHandler,{self:this});")}catch(a){null!==this.logger&&(this.logger.warn("Unknown host configuration type."),this.logger.error(a.stack))}else this.logger.warn("Unknown host configuration."),this.logger.warn(host);null!==loader&&loader.getWaitLoadEvent()&&this.httpDataServicesCount++}}else null!==this.logger&&this.logger.warn("Error dataServices is not array.")},dataLoadedHandler:function(a,b){"success"!==b&&(null!==this.logger&&(this.logger.warn("Failed to load data. status: "+b),this.logger.warn(a)),a.self.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.PLUGIN_ERROR,{errorCode:fr.ina.amalia.player.PlayerErrorCode.ERROR_LOAD_PLUGIN})),++a.self.dataLoaded===a.self.httpDataServicesCount&&(a.self.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.END_DATA_CHANGE),a.self.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.PLUGIN_READY))},loadDynamicPlugins:function(a){null!==this.logger&&(this.logger.info(this.Class.fullName,"loadPlugins List : "),this.logger.info(a));for(var b in a)if(a.hasOwnProperty(b)){var c=a[b];if("object"==typeof(c=$.extend({debug:this.pluginsSettings.debug,className:null,container:null,data:this.data,framerate:this.settings.framerate,thumbRootDirectory:this.settings.thumbRootDirectory,parameters:{}},c||{}))&&null!==c.className){var d=null===c.container?this.mediaContainer:$(c.container);c.internalPlugin=null===c.container,this.loadPlugin(c.className,c,this.mediaPlayer,d)}else null!==this.logger&&this.logger.warn(this.Class.fullName,"Error to load plugin className:"+c.className)}},loadPlugin:function(className,settings,mediaPlayer,pluginContainer){null!==this.logger&&this.logger.info(this.Class.fullName,"loadPlugin className:"+className);try{var obj=eval("new "+className+"(settings,mediaPlayer,pluginContainer,this.bindingManager)");return obj.setUuid(fr.ina.amalia.player.helpers.UtilitiesHelper.generateUUID("p_")),this.bindingManager.registerPlugin(obj.getUuid(),obj.getPluginTypes()),this.listOfPluginIds.push(obj.getUuid()),this.listOfPluginTypes[obj.getUuid()]=obj.getPluginTypes(),this.plugins.push(obj),this.loadedCount++,null!==this.logger&&this.logger.info(className+"Plugin loaded :  "+className+" ID: "+obj.getUuid()),obj}catch(a){return this.failCount++,null!==this.logger&&(this.logger.warn("Error to load plugin : "+className),this.logger.warn(a.stack)),!1}}}),fr.ina.amalia.player.plugins.PluginBase.extend("fr.ina.amalia.player.plugins.captions.CaptionsBase",{},{container:null,listOfData:[],definePlayerListeners:function(){this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.TIME_CHANGE,{self:this},this.onTimeupdate),null!==this.logger&&this.logger.trace(this.Class.fullName,"definePlayerListeners")},updateMetadata:function(a,b,c,d,e){this.listOfData=[];var f=null,g=null;e=!0===e,g=this.mediaPlayer.getMetadataWithRange(a,c,d);for(var h=0;h<g.length;h++)f=g[h],!0===f.hasOwnProperty("sublocalisations")&&null!==f.sublocalisations?this._parseSubLocalisations(f.sublocalisations,b,e):null!==f?this._parseLocalisation(f,b,e):null!==this.logger&&this.logger.trace(this.Class.fullName,"Error to set data, index: "+h)},_parseLocalisation:function(a,b,c){var d=null;if(a.tclevel<=b){if(a.tclevel===b&&!1===c||a.tclevel<=b&&!0===c){var e=this._getText(a.data);""!==e&&(d={tcin:"number"==typeof a.tcin?a.tcin:fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(a.tcin),tcout:"number"==typeof a.tcout?a.tcout:fr.ina.amalia.player.helpers.UtilitiesHelper.convertHourToSeconde(a.tcout),text:e,label:a.label,thumb:a.thumb,level:a.tclevel},this.listOfData.push(d))}!0===a.hasOwnProperty("sublocalisations")&&null!==a.sublocalisations&&!0===a.sublocalisations.hasOwnProperty("localisation")&&$.isArray(a.sublocalisations.localisation)&&this._parseSubLocalisations(a.sublocalisations,b,c)}},_parseSubLocalisations:function(a,b,c){var d=null;if(null!==a&&void 0!==a&&!0===a.hasOwnProperty("localisation")&&$.isArray(a.localisation))for(var e=0;e<a.localisation.length;e++)d=a.localisation[e],this._parseLocalisation(d,b,c);return d},_getText:function(a){var b="";if(null!==a&&void 0!==a&&!0===a.hasOwnProperty("text")&&null!==a.text&&$.isArray(a.text))for(var c=0;c<a.text.length;c++)null!==a.text[c]&&(b+=a.text[c].toString());return b},updatePos:function(a){null!==this.logger&&this.logger.trace(this.Class.fullName,"updatePos : "+a)},onTimeupdate:function(a,b){a.data.self.updatePos(parseFloat(b.currentTime))}}),fr.ina.amalia.player.plugins.PluginBase.extend("fr.ina.amalia.player.plugins.ContextMenuPlugin",{classCss:"plugin-context-menu dropdown-menu lg",style:"",copyrightText:" V1.3.3, Â© INA 2023",copyrightHomepage:"http://ina-foss.github.io/amalia.js"},{container:null,menuConfiguration:{position:{my:"left top",at:"right top"}},initialize:function(){this.initContextMenu()},initContextMenu:function(){this.container=$("<ul/>",{class:this.Class.classCss,style:this.Class.style,role:"menu","aria-labelledby":"dLabel"}).menu({disabled:!1}).css({position:"fixed",left:0,top:0}).hide(),this.addItemWithLink(this.Class.copyrightText,null,null,"ajs-icon  ajs-icon-amalia-js"),this.addItemWithLink(fr.ina.amalia.player.PlayerMessage.PLAYER_OPENSOURCE_LINK,this.Class.copyrightHomepage,"homepage","ajs-icon ajs-icon-github"),this.pluginContainer.append(this.container),this.container.on("mouseleave",{self:this},this.onMouseleave),this.pluginContainer.parent().on("contextmenu",{self:this},this.onContextmenu)},addItemWithLink:function(a,b,c,d){b=b||"#",d="string"==typeof d?d:null,c=c||"disabled";var e=$("<li>",{class:c}),f=$("<a>",{text:a,target:"_blank",href:b});return null!==d&&f.append($("<span>",{class:d})),"#"===b&&f.on("click",function(a){a.preventDefault()}),e.append(f),this.container.append(e),e},onContextmenu:function(a){var b=10;a.data.self.container.show().css({left:a.clientX-b,top:a.clientY-b}),a.preventDefault()},onMouseleave:function(a){a.preventDefault(),a.data.self.container.hide()}}),fr.ina.amalia.player.plugins.PluginBase.extend("fr.ina.amalia.player.plugins.CustomControlBarPlugin",{classCss:"plugin-custom-controlbar"},{container:null,leftContainer:null,midContainer:null,rightContainer:null,widgets:null,height:130,progressBar:null,autoHide:!0,displayState:!0,hideDuration:500,autoHideStarted:!1,timeIndicatorContainer:null,initialize:function(){this.settings=$.extend({height:"80",autohide:!0,hideDuration:500,timeFormat:"ms",framerate:25,framepreview:!1,framepreviewTimeBound:500,sticky:!1,widgets:{left:{timelabelWidget:"fr.ina.amalia.player.plugins.controlBar.widgets.TimeLabel"},mid:{playWidget:"fr.ina.amalia.player.plugins.controlBar.widgets.PlayButton",pauseWidget:"fr.ina.amalia.player.plugins.controlBar.widgets.PauseButton"},right:{full:"fr.ina.amalia.player.plugins.controlBar.widgets.FullscreenButton",volume:"fr.ina.amalia.player.plugins.controlBar.widgets.VolumeControlBar"},settings:{}}},this.settings||{}),this.timeIndicatorContainer=null,this.leftContainer=null,this.midContainer=null,this.rightContainer=null,this.widgets=[],this.autoHide=!0!==this.settings.sticky&&this.settings.autohide,this.displayState=!0,this.hideDuration=this.settings.hideDuration,this.height=this.settings.height,this.autoHideStarted=!1,this.createControlBar(),this.initializeWidgets(),this.definePlayerListeners(),this.updatePlayerSize(!1),null!==this.logger&&(this.logger.trace(this.Class.fullName,"initialize"),this.logger.info(this.settings))},createControlBar:function(){var a=!0===this.settings.sticky?this.Class.classCss+" sticky":this.Class.classCss;this.container=$("<div>",{class:a}),this.timeIndicatorContainer=$("<div>",{class:"ajs-time-indicator"});var b=$("<span>",{class:"ajs-tooltip-text"});this.timeIndicatorContainer.append(b),this.container.append(this.timeIndicatorContainer);var c=$("<div>",{class:"ajs-row"});this.leftContainer=$("<div>",{class:"ajs-container left-container"}),this.midContainer=$("<div>",{class:"ajs-container middle-container"}),this.rightContainer=$("<div>",{class:"ajs-container right-container"}),c.append(this.leftContainer),c.append(this.midContainer),c.append(this.rightContainer),this.container.append(c),this.container.height(this.height),this.pluginContainer.append(this.container)},initializeWidgets:function(){var a=this.settings.widgets;if(null!==this.logger&&(this.logger.trace(this.Class.fullName,"initialize"),this.logger.info(a)),a.hasOwnProperty("left"))for(var b in a.left)a.left.hasOwnProperty(b)&&this.initWidget(b,a.left[b],this.leftContainer);if(a.hasOwnProperty("mid"))for(var c in a.mid)a.mid.hasOwnProperty(c)&&this.initWidget(c,a.mid[c],this.midContainer);if(a.hasOwnProperty("right"))for(var d in a.right)a.right.hasOwnProperty(d)&&this.initWidget(d,a.right[d],this.rightContainer);!1!==this.settings.enableProgressBar&&(this.progressBar=new fr.ina.amalia.player.plugins.controlBar.widgets.ProgressBar({debug:this.settings.debug,framepreview:this.settings.framepreview,framepreviewTimeBound:this.settings.framepreviewTimeBound},this.mediaPlayer,this.container)),this.container.find(".player-progress-bar").on("mouseover",$.proxy(this.onProgressBarMouseover,this)),this.container.find(".player-progress-bar").on("mouseout",$.proxy(this.onProgressBarMouseoout,this)),this.container.find(".player-progress-bar").on("mousemove",$.proxy(this.onProgressBarMousemove,this))},initWidget:function(widgetName,widgetClassName,container){try{var settings=this.settings.widgets.hasOwnProperty("settings")&&"object"==typeof this.settings.widgets.settings[widgetName]?this.settings.widgets.settings[widgetName]:this.settings,obj=eval("new "+widgetClassName+"(settings,this.mediaPlayer,container)");this.widgets.push(obj)}catch(a){null!==this.logger&&(this.logger.warn("Error to load widget : "+widgetClassName),this.logger.warn(a.stack))}},definePlayerListeners:function(){this.mediaPlayer.getContainer().on(fr.ina.amalia.player.PlayerEventType.FULLSCREEN_CHANGE,{self:this},this.onFullscreenModeChange),!0===this.autoHide&&(this.mediaPlayer.getContainer().one(fr.ina.amalia.player.PlayerEventType.PLAYING,{self:this},this.onPlaying),this.mediaPlayer.getContainer().one(fr.ina.amalia.player.PlayerEventType.SEEK,{self:this},this.onSeeking)),$(window).on("debouncedresize",{self:this},this.onWindowResize)},updatePlayerSize:function(a){!0===this.settings.sticky?(!0===a?this.mediaPlayer.getContainer().find("video").first().css("height",$(window).height()-this.height):this.mediaPlayer.getContainer().find("video").first().css("height",parseInt(this.mediaPlayer.mediaContainer.parent().height()-this.height)),null!==this.logger&&this.logger.trace(this.Class.fullName,"size : "+this.mediaPlayer.getContainer().find("video").first().css("height"))):!1===this.autoHideStarted?this.container.css("bottom",this.height+"px"):this.container.css("bottom",!0===this.displayState?this.height:"10px")},show:function(){var a=this;!1===a.displayState&&(a.container.find(".ajs-row").show(),a.container.animate({bottom:a.height+"px"},250,function(){a.displayState=!0}))},hide:function(){var a=this;!0===a.displayState&&a.container.animate({bottom:"10px"},250,function(){a.container.find(".ajs-row").hide(),a.displayState=!1})},onFullscreenModeChange:function(a,b){a.data.self.updatePlayerSize(b.inFullScreen)},onPlayerMouseEnter:function(a){!1===a.data.self.displayState&&a.data.self.show(),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onPlayerMouseEnter")},onPlayerMouseLeave:function(a){!0===a.data.self.displayState&&setTimeout(function(){a.data.self.hide()},a.data.self.hideDuration),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onPlayerMouseLeave")},onPlaying:function(a){!1===a.data.self.autoHideStarted&&(a.data.self.autoHideStarted=!0,a.data.self.mediaPlayer.getContainer().on("mouseenter touchstart",{self:a.data.self},a.data.self.onPlayerMouseEnter),a.data.self.mediaPlayer.getContainer().on("mouseleave touchleave",{self:a.data.self},a.data.self.onPlayerMouseLeave))},onSeeking:function(a){!1===a.data.self.autoHideStarted&&(a.data.self.autoHideStarted=!0,a.data.self.hide(),a.data.self.mediaPlayer.mediaContainer.on("mouseenter touchstart",{self:a.data.self},a.data.self.onPlayerMouseEnter),a.data.self.mediaPlayer.mediaContainer.on("mouseleave touchleave",{self:a.data.self},a.data.self.onPlayerMouseLeave))},onProgressBarMouseover:function(){this.timeIndicatorContainer.show()},onProgressBarMouseoout:function(){this.timeIndicatorContainer.hide()},onProgressBarMousemove:function(a){var b=$(a.currentTarget),c=this.timeIndicatorContainer.width()/2,d=a.clientX-b.offset().left,e=Math.max(c,Math.min(d,b.width()-c)),f=d*this.mediaPlayer.getDuration()/b.width()+this.mediaPlayer.getTcOffset();this.timeIndicatorContainer.css("left",e),this.timeIndicatorContainer.find(".ajs-tooltip-text").html(fr.ina.amalia.player.helpers.UtilitiesHelper.formatTime(f,this.settings.framerate,this.settings.timeFormat))},onWindowResize:function(a){a.data.self.updatePlayerSize(a.data.self.mediaPlayer.getFullscreenState()),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onWindowResize")}}),$.Class("fr.ina.amalia.player.LocalStorageManager",{storageNamespace:"ina.media.player"},{settings:{},logger:null,data:null,init:function(){this.initializeStorage()},initializeStorage:function(){if("undefined"!=typeof localStorage)try{!1===localStorage.hasOwnProperty(this.Class.storageNamespace)&&localStorage.setItem(this.Class.storageNamespace,JSON.stringify({})),this.data=JSON.parse(localStorage.getItem(this.Class.storageNamespace))}catch(a){this.data=null}else this.data=null},updateDataStorage:function(){try{"undefined"!=typeof localStorage&&localStorage.setItem(this.Class.storageNamespace,JSON.stringify(this.data))}catch(a){this.data=null}},hasItem:function(a){return null!==this.data&&!0===this.data.hasOwnProperty(a)},getItem:function(a){return null!==this.data&&!0===this.data.hasOwnProperty(a)?this.data[a]:null},setItem:function(a,b){try{null!==this.data&&void 0!==a&&void 0!==b&&(this.data[a]=b,this.updateDataStorage())}catch(a){return null}return!0},removeItem:function(a){null!==this.data&&void 0!==a&&(this.data.splice(a,1),this.updateDataStorage())},clear:function(){"undefined"!=typeof localStorage&&localStorage.removeItem(this.Class.storageNamespace)}}),$.Class("fr.ina.amalia.player.mediaTypeManager",{},{mediaPlayer:null,mainObj:null,logger:null,settings:{},init:function(a,b){if(this.mediaPlayer=b.mediaPlayer,this.mainObj=b,this.namespace=this.Class.fullName,this.settings=$.extend({debug:!1,internalPlugin:!1},a||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),null===this.mediaPlayer)throw new Error("Can't initialize plugin name"+this.Class.fullName);this.initialize()},initialize:function(){}}),fr.ina.amalia.player.mediaTypeManager.extend("fr.ina.amalia.player.media.type.DashMpeg",{},{context:null,dashPlayer:null,initialize:function(){this.context=new Dash.di.DashContext,this.dashPlayer=new MediaPlayer(this.context)},setSrc:function(a){this.dashPlayer.setAutoPlay(this.settings.autoplay),this.dashPlayer.startup(),this.dashPlayer.attachView(this.mediaPlayer.get(0)),this.dashPlayer.retrieveManifest(a,$.proxy(this.initializeDashJS,this)),this.dashPlayer.videoElementExt=this.mediaPlayer.get(0),null!==this.logger&&this.logger.trace(this.Class.fullName,"set dash src :"+this.url)},initializeDashJS:function(a,b){"object"==typeof b?this.mainObj.setErrorCode(fr.ina.amalia.player.PlayerErrorCode.ERROR_MANIFEST_DASH):this.dashPlayer.attachSource(a)}}),$.Class("fr.ina.amalia.player.ShortcutsManager",{},{mediaPlayer:null,settings:{},logger:null,listOfShortcuts:null,init:function(a,b){this.mediaPlayer=b,this.settings=$.extend({enabled:!1,debug:!1,listOfShortcuts:[{s:"f1",c:"togglePlayPause"},{s:"f11",c:"toggleFullScreen"},{s:"f2",c:"muteUnmute"},{s:"f3",c:"seekToBegin"},{s:"f4",c:"seekToEnd"}]},a||{}),this.listOfShortcuts=this.settings.listOfShortcuts,void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),this.initialize()},initialize:function(){if(null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize"),!0===this.settings.enabled)for(var i=0;i<this.listOfShortcuts.length;i++)try{var conf=this.listOfShortcuts[i];if(null!==conf&&conf.hasOwnProperty("s")&&conf.hasOwnProperty("c")){var f=conf.c,callback=eval("this.mediaPlayer."+f);"function"==typeof callback?$(document).bind("keydown",{keys:conf.s,callback:conf.c,self:this},this.callback):null!==this.logger&&(this.logger.warn(this.Class.fullName+" : error to bind shortcut "+conf.c),this.logger.warn(conf))}}catch(a){null!==this.logger&&this.logger.warn(this.Class.fullName+" : error to bind shortcut "+conf.c)}},callback:function(event){try{event.preventDefault(),eval("event.data.self.mediaPlayer."+event.data.callback+"()")}catch(a){null!==event.data.self.logger&&event.data.self.logger.warn(event.data.self.Class.fullName+" : Error to send callback to bind shortcut :"+event.data.callback)}}}),$.Class("fr.ina.amalia.player.BasePlayer",{mediaPlayerClassCss:"player",mediaPlayerStyleCss:"position: relative; width: inherit; height: inherit; background-color: black; ",playButtonStyleCss:"ajs-icon ajs-icon-controlbar-play",pauseButtonStyleCss:"ajs-icon ajs-icon-controlbar-pause",loaderStyleCss:"ajs-icon ajs-icon-cog"},{logger:null,settings:{},title:"",poster:"",mediaContainer:null,mediaPlayer:null,pluginManager:null,localStorageManager:null,loaderContainer:null,controlLayerElement:null,errorContainer:null,isRangePlayer:!1,rangePlayerTcout:null,captureId:null,captureTc:null,captureScale:1,zTcin:null,zTcout:null,tcOffset:0,mediaTypeManager:null,metadataManager:null,intervalRewind:null,shortcutManager:null,playbackRateIdx:7,playbackRateList:[-2,-1.5,-1,-.75,-.5,-.25,-.1,1,.5,.75,1.5,2,4,6,8],isIOSDevices:!1,mediaSourceUrl:"",inCastMode:!1,init:function(a,b){this.controlLayerElement=null,this.mediaSourceUrl="",this.inCastMode=!1,this.settings=$.extend({autoplay:!1,poster:"",src:"",title:"",defaultVolume:75,crossorigin:"",shortcuts:{},defaultPlaybackRateIdx:7,duration:null},a||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),this.mediaContainer=b,this.setStyleBreakpoint(),this.tcOffset=parseInt(this.settings.tcOffset),this.createLoaderContainer(),!0===this.settings.togglePlayPause&&this.createControlLayerElement(),this.createErrorContainer(),this.localStorageManager=new fr.ina.amalia.player.LocalStorageManager({}),this.shortcutManager=new fr.ina.amalia.player.ShortcutsManager(this.settings.shortcuts,this),this.playbackRateIdx=this.settings.defaultPlaybackRateIdx;var c=-1!==navigator.userAgent.indexOf("iPhone"),d=-1!==navigator.userAgent.indexOf("iPod"),e=-1!==navigator.userAgent.indexOf("iPad");this.isIOSDevices=c||e||d,this.setTitle(this.settings.title),this.setPoster(this.settings.poster),this.initialize()},initializePlugins:function(){null!==this.logger&&this.logger.trace(this.Class.fullName,"initializePlugins"),this.pluginManager=new fr.ina.amalia.player.plugins.PluginManager(this.settings,this,this.mediaContainer)},initializeMetadataManager:function(){null!==this.logger&&this.logger.trace(this.Class.fullName,"initializeMetadataManager"),this.metadataManager=new fr.ina.amalia.player.MetadataManager(this.settings,this,this.mediaContainer)},createLoaderContainer:function(){this.loaderContainer=$("<div>",{class:"ajs-loader"});var a=$("<i>",{class:this.Class.loaderStyleCss});this.loaderContainer.append(a),this.mediaContainer.append(this.loaderContainer),this.showLoader()},createControlLayerElement:function(){this.controlLayerElement=$("<div>",{class:"ajs-control-layer"}),this.controlLayerElement.append($("<i>")),this.mediaContainer.append(this.controlLayerElement)},createErrorContainer:function(){this.errorContainer=$("<div>",{class:"ajs-error"}),this.errorContainer.hide(),this.mediaContainer.append(this.errorContainer)},getContainer:function(){return this.mediaContainer},initialize:function(){null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize"),this.initializePlugins(),this.initializeMetadataManager(),this.getContainer().trigger(fr.ina.amalia.player.PlayerEventType.INIT,[this]),this.getContainer().on(fr.ina.amalia.player.PlayerEventType.ERROR,{self:this},this.onError)},load:function(){this.mediaPlayer.get(0).load()},showControlLayerElement:function(a){if(null!==this.controlLayerElement){var b="play"===a?this.Class.playButtonStyleCss:this.Class.pauseButtonStyleCss;this.controlLayerElement.find("i").attr("class",b);var c=this;this.controlLayerElement.fadeIn("speed").addClass("scale-up").delay(200).queue(function(){c.controlLayerElement.removeClass("scale-up").fadeOut("speed").dequeue()})}},showLoader:function(){this.loaderContainer.show()},hideLoader:function(){this.loaderContainer.hide()},getTitle:function(){return this.title},setTitle:function(a){this.title=a},getCastMode:function(){return this.inCastMode},setCastMode:function(a){this.inCastMode=a},getPoster:function(){return this.poster},setPoster:function(a){this.poster=a},setSrc:function(a,b){this.mediaSourceUrl=a,!0===b&&this.play()},getSrc:function(){return this.mediaSourceUrl},getContentType:function(){return""},initEvents:function(){$(window).on("debouncedresize",{self:this},this.onWindowResize),null!==this.logger&&this.logger.info("initEvents")},setStyleBreakpoint:function(){var a="lg",b=this.mediaContainer.width();return b<=320?a="xxs":b>320&&b<=480?a="xs":b>480&&b<=768?a="sm":b>768&&b<=992&&(a="md"),!1===this.mediaContainer.hasClass(a)&&this.mediaContainer.removeClass("xxs").removeClass("xs").removeClass("sm").removeClass("md").removeClass("lg").addClass(a),a},play:function(){if(this.mediaContainer.addClass("playing-mode").removeClass("paused-mode"),void 0!==this.settings.callbacks.onPlay)try{eval(this.settings.callbacks.onPlay+"()")}catch(a){null!==this.logger&&this.logger.warn("Send callback failed.")}},pause:function(){if(this.mediaContainer.removeClass("playing-mode").addClass("paused-mode"),this.isRangePlayer=!1,this.rangePlayerTcout=null,void 0!==this.settings.callbacks.onPause)try{eval(this.settings.callbacks.onPause+"()")}catch(a){null!==this.logger&&this.logger.warn("Send callback failed.")}},stop:function(){if(this.settings.callbacks.hasOwnProperty("onStop")&&void 0!==this.settings.callbacks.onStop)try{eval(this.settings.callbacks.onStop+"()")}catch(a){null!==this.logger&&this.logger.warn("Send callback failed.")}},togglePlayPause:function(){this.isPaused()?(this.play(),this.showControlLayerElement("play")):(this.pause(),this.showControlLayerElement("pause"))},seek:function(a){return this.setCurrentTime(a)},seekToBegin:function(){return this.setCurrentTime(0)},seekToEnd:function(){return this.setCurrentTime(this.getDuration())},mute:function(){this.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.MUTE),this.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.VOLUME_CHANGE,{volume:0})},unmute:function(){this.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.UN_MUTE),this.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.VOLUME_CHANGE,{volume:100})},isMute:function(){return 0===this.getVolume()},muteUnmute:function(){this.isMute()?this.unmute():this.mute()},getTcOffset:function(){return this.tcOffset},getMediaPlayer:function(){return this.mediaPlayer},getDuration:function(a){return"number"==typeof a&&isFinite(a)?a:0},getVolume:function(){throw new Error("Get volume is abstract method.")},rangePlay:function(a,b,c){c=void 0!==c&&c,this.isRangePlayer=!0,this.rangePlayerTcout=b+this.tcOffset,this.setCurrentTime(a),!0===c&&this.play()},setVolume:function(a){return a>=0&&a<=100&&(this.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.VOLUME_CHANGE,{volume:a}),this.localStorageManager.setItem("volume",a),null!==this.logger&&this.logger.trace(this.Class.fullName,"setVolume"+a),!0)},getCurrentTime:function(a){return null===this.settings.duration?a+this.tcOffset:this.lastSeekTime+a+this.tcOffset},setCurrentTime:function(a){var b=isNaN(a)?0:a;this.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.SEEK,{currentTime:b})},getPlaybackrate:function(){throw new Error("Get volume is abstract method.")},setPlaybackrate:function(a){throw new Error("Get volume is abstract method. Speed: "+a)},upPlaybackrate:function(){this.playbackRateIdx=Math.min(this.playbackRateList.length,this.playbackRateIdx+1),this.setPlaybackrate(parseInt(this.playbackRateList[this.playbackRateIdx]))},downPlaybackrate:function(){this.playbackRateIdx=Math.max(0,this.playbackRateIdx-1),this.setPlaybackrate(parseInt(this.playbackRateList[this.playbackRateIdx]))},setErrorCode:function(a){if(void 0!==this.errorContainer){var b=$("<p>",{text:fr.ina.amalia.player.PlayerErrorCode.getMessage(a)});this.errorContainer.html(b),this.errorContainer.show()}},getFullscreenState:function(){throw new Error("Get fullscreen is abstract method.")},isPaused:function(){throw new Error("Is paused is abstract method.")},toggleFullScreen:function(inFullScreen){var container=this.isIOSDevices?this.mediaPlayer.get(0):this.mediaContainer.get(0),iFS=fr.ina.amalia.player.helpers.HTML5Helper.toggleFullScreen(container,this.isIOSDevices);if(void 0!==this.settings.callbacks.onFullscreen)try{eval(this.settings.callbacks.onFullscreen+"(inFullScreen)")}catch(a){null!==this.logger&&this.logger.warn("Send callback failed.")}return null!==this.logger&&this.logger.trace(this.Class.fullName,"onClickFullscreenButton :"+inFullScreen),iFS},getContentTupe:function(){throw new Error("Get media content type is abstract method.")},getCurrentImage:function(a){throw new Error("Get currentTime is abstract method. Scale: "+a)},getTcImage:function(a,b,c){this.setCurrentTime(b),this.play(),this.captureId=a,this.captureTc=b+this.tcOffset,this.captureScale=void 0!==c?Math.min(1,parseFloat(c)):1},moveNextFrame:function(){this.pause(),this.setCurrentTime(Math.min(this.getDuration()+this.tcOffset,this.getCurrentTime()+1/this.settings.framerate))},movePrevFrame:function(){this.pause(),this.setCurrentTime(Math.max(0,this.getCurrentTime()-1/this.settings.framerate))},addMenuItemWithLink:function(a,b,c){if("object"==typeof this.pluginManager&&"function"==typeof this.pluginManager.getContextMenuPlugin){var d=this.pluginManager.getContextMenuPlugin();if("object"==typeof d&&"function"==typeof d.addItemWithLink)return d.addItemWithLink(a,b,c)}return!1},getMetadataManager:function(){return this.metadataManager},getBlocksMetadata:function(){return this.metadataManager.getBlocksMetadata()},getBlockMetadata:function(a){return this.metadataManager.getBlockMetadata(a)},updateBlockMetadata:function(a,b,c){this.metadataManager.updateBlockMetadata(a,b,c)},removeBlockMetadata:function(a){return this.metadataManager.removeBlockMetadata(a)},addAllMetadata:function(a){this.metadataManager.addAllMetadata(a)},addMetadataById:function(a,b){this.metadataManager.addMetadataById(a,b)},replaceAllMetadataById:function(a,b){this.metadataManager.replaceAllMetadataById(a,b)},deleteAllMetadataById:function(a){this.metadataManager.deleteAllMetadataById(a)},getMetadataById:function(a){return this.metadataManager.getMetadataById(a)},setMetadataById:function(a,b){return this.metadataManager.setMetadataById(a,b)},removeMetadataById:function(a){return this.metadataManager.removeMetadataById(a)},getMetadataWithRange:function(a,b,c){return this.metadataManager.getMetadataWithRange(a,b,c)},getSelectedMetadataId:function(){return this.metadataManager.getSelectedMetadataId()},setSelectedMetadataId:function(a){this.metadataManager.setSelectedMetadataId(a)},addMetadataItem:function(a,b){return this.metadataManager.addMetadataItem(a,b)},getSelectedItems:function(){return this.metadataManager.getSelectedItems()},addSelectedItem:function(a){this.metadataManager.addSelectedItem(a)},removeAllSelectedItems:function(){this.metadataManager.removeAllSelectedItems()},getTcin:function(){return this.getTcOffset()},getTcout:function(){return this.getTcOffset()+this.getDuration()},setZoomTc:function(a,b,c){c=void 0!==c?c:"",Math.ceil(this.zTcin)===Math.ceil(a)&&Math.ceil(this.zTcout)===Math.ceil(b)||(this.zTcin=Math.max(0,parseFloat(a)),this.zTcout=parseFloat(b),null!==this.logger&&this.logger.info("SetZoomTc: // Tcin: "+this.zTcin+" // Tcout:"+this.zTcout+" // Event Tag Name:"+c),this.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.ZOOM_RANGE_CHANGE,{zTcin:parseFloat(a),zTcout:parseFloat(b),eventTag:c}))},destroy:function(){this.setSrc("",!1),void 0!==this.mediaContainer.data("fr.ina.amalia.player")&&this.mediaContainer.data("fr.ina.amalia.player",null),this.mediaContainer.get(0).innerHTML="",this.mediaContainer.remove()},onError:function(event,data){null!==event.data.self.logger&&event.data.self.logger.trace(event.data.self.Class.fullName,"onError");var errorCode=void 0===data.errorCode?"":data.errorCode;if(event.data.self.setErrorCode(errorCode),void 0!==event.data.self.settings.callbacks.onError)try{eval(event.data.self.settings.callbacks.onError+"(errorCode)")}catch(a){null!==event.data.self.logger&&event.data.self.logger.warn("Send callback failed.")}},onWindowResize:function(a){a.data.self.setStyleBreakpoint(),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onWindowResize")}}),fr.ina.amalia.player.BasePlayer.extend("fr.ina.amalia.player.PlayerHtml5",{},{initialize:function(){this.lastSeekTime=0,this.createPlayer(),this.setSrc(this.settings.src,this.settings.autoplay),this.setVolume(!1===this.localStorageManager.hasItem("volume")?this.settings.defaultVolume:this.localStorageManager.getItem("volume")),this._super()},setSrc:function(a,b){null!==this.logger&&this.logger.trace(this.Class.fullName,"setSrc:"+a),"mpd"===this.settings.mediaType?(this.mediaTypeManager=new fr.ina.amalia.player.media.type.DashMpeg(this.settings,this),this.mediaTypeManager.setSrc(a)):(this.mediaPlayer.find("source:first").attr({src:a}),""!==this.settings.mediaType&&this.mediaPlayer.find("source:first").attr("type",this.settings.mediaType),this.load()),this._super(a,b)},createPlayer:function(){if(null!==this.logger&&this.logger.trace(this.Class.fullName,"createPlayer"),this.mediaPlayer=$("<video/>",{class:this.Class.mediaPlayerClassCss,style:this.Class.mediaPlayerStyleCss,"x-webkit-airplay":"allow"}),""!==this.settings.crossorigin&&this.mediaPlayer.attr("crossorigin",this.settings.crossorigin),this.settings.hasOwnProperty("preload")&&""!==this.settings.preload&&this.mediaPlayer.attr("preload",this.settings.preload),""!==this.getPoster()&&this.mediaPlayer.attr("poster",this.getPoster()),"mpd"!==this.settings.mediaType){var a=$("<source />");this.mediaPlayer.append(a)}
this.mediaContainer.append(this.mediaPlayer),this.initEvents()},initEvents:function(){this._super(),null!==this.logger&&this.logger.trace(this.Class.fullName,"adEvents"),this.mediaPlayer.on("loadstart",{self:this},this.onLoadstart),this.mediaPlayer.on("playing",{self:this},this.onPlay),this.mediaPlayer.on("pause",{self:this},this.onPause),this.mediaPlayer.on("ended",{self:this},this.onEnded),this.mediaPlayer.one("durationchange",{self:this},this.onDurationchange),this.mediaPlayer.on("timeupdate",{self:this},this.onTimeupdate),this.mediaPlayer.find("source").on("error",{self:this},this.onSourceError),this.mediaPlayer.on("seeked",{self:this},this.onSeeked),!0===this.settings.togglePlayPause&&this.mediaPlayer.on("click",$.proxy(this.togglePlayPause,this)),$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenChange MSFullscreenChange",{self:this},this.onFullscreenHandler)},load:function(){this.mediaPlayer.get(0).load()},play:function(){this.mediaPlayer.get(0).play(),this._super()},pause:function(){this._super(),this.mediaPlayer.get(0).pause()},stop:function(){this.mediaPlayer.get(0).pause(),this.mediaPlayer.get(0).currentTime=0,this._super()},mute:function(){this.mediaPlayer.get(0).volume=0,this._super()},unmute:function(){this.mediaPlayer.get(0).volume=1,this._super()},getDuration:function(){return this._super(null===this.settings.duration?this.mediaPlayer.get(0).duration:parseFloat(this.settings.duration))},getVolume:function(){return 100*this.mediaPlayer.get(0).volume},setVolume:function(a){return this.mediaPlayer.get(0).volume=a/100,this._super(a)},getCurrentTime:function(){return this._super(this.mediaPlayer.get(0).currentTime)},setCurrentTime:function(a){var b=isNaN(a)?0:a;if(null===this.settings.duration)this.mediaPlayer.get(0).currentTime=Math.max(0,b-this.tcOffset);else{this.lastSeekTime=Math.max(0,b-this.tcOffset);var c=Math.max(0,b-this.tcOffset),d=-1===this.settings.src.search(/\?/)?this.settings.src+"?start="+c:this.settings.src+"&start="+c;this.setSrc(d,!0)}this._super(b)},getPlaybackrate:function(){return this.mediaPlayer.get(0).playbackRate},setPlaybackrate:function(a){var b=this;a<=0?(clearInterval(b.intervalRewind),b.intervalRewind=setInterval(function(){b.mediaPlayer.get(0).playbackRate=1;var c=b.getCurrentTime();0===c?(b.mediaPlayer.get(0).playbackRate=1,clearInterval(b.intervalRewind),b.pause()):(c+=a,b.setCurrentTime(c))},30)):(clearInterval(b.intervalRewind),this.isPaused()&&this.play(),b.mediaPlayer.get(0).playbackRate=parseFloat(a)),this.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.PLAYBACK_RATE_CHANGE,{rate:a}),null!==this.logger&&this.logger.trace(this.Class.fullName,"setPlaybackrate :"+a)},getContentType:function(){return null!==this.logger&&this.logger.trace(this.Class.fullName,"getContentType"),this.mediaPlayer.find("source").get(0)},getFullscreenState:function(){return fr.ina.amalia.player.helpers.HTML5Helper.inFullScreen()},isPaused:function(){return this.mediaPlayer.get(0).paused},onFullscreenHandler:function(a){var b=fr.ina.amalia.player.helpers.HTML5Helper.inFullScreen();("object"==typeof a.originalEvent.originalTarget&&"object"==typeof a.originalEvent.originalTarget.mozFullScreenElement?$(a.originalEvent.originalTarget.mozFullScreenElement):$(a.originalEvent.target)).attr("id")===a.data.self.mediaContainer.attr("id")||!1===b?a.data.self.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.FULLSCREEN_CHANGE,{inFullScreen:b}):"MSFullscreenChange"===a.type&&($(document.msFullscreenElement).attr("id")!==a.data.self.mediaContainer.attr("id")&&!1!==b||a.data.self.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.FULLSCREEN_CHANGE,{inFullScreen:b})),a.data.self.mediaContainer.toggleClass("ajs-fullscreen",b),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onFullscreenHandler :"+b)},setZoomTc:function(a,b,c){c=void 0!==c?c:"",Math.ceil(this.zTcin)===Math.ceil(a)&&Math.ceil(this.zTcout)===Math.ceil(b)||(this.zTcin=Math.max(0,parseFloat(a)),this.zTcout=parseFloat(b),null!==this.logger&&this.logger.info("SetZoomTc: // Tcin: "+this.zTcin+" // Tcout:"+this.zTcout+" // Event Tag Name:"+c),this.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.ZOOM_RANGE_CHANGE,{zTcin:parseFloat(a),zTcout:parseFloat(b),eventTag:c}))},getCurrentImage:function(a){var b="";try{var c=this.mediaPlayer.get(0),d=document.createElement("canvas");return a=void 0!==a?Math.min(1,parseFloat(a)):1,d.width=c.videoWidth*a,d.height=c.videoHeight*a,d.getContext("2d").drawImage(c,0,0,d.width,d.height),b=d.toDataURL("image/png"),this.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.IMAGE_CAPTURE,{currentTime:this.getCurrentTime(),captureTc:this.getCurrentTime(),captureId:this.getCurrentTime(),captureImage:b.toString()}),b}catch(a){null!==this.logger&&(this.logger.warn("Error lors de la capture d'imagette"),this.logger.warn(a.stack))}return b},getTcImage:function(a,b,c){this.setCurrentTime(b),this.play(),this.captureId=a,this.captureTc=b+this.tcOffset,this.captureScale=void 0!==c?Math.min(1,parseFloat(c)):1},moveNextFrame:function(){this.pause(),this.setCurrentTime(Math.min(this.getDuration()+this.tcOffset,this.getCurrentTime()+1/this.settings.framerate))},movePrevFrame:function(){this.pause(),this.setCurrentTime(Math.max(0,this.getCurrentTime()-1/this.settings.framerate))},onLoadstart:function(event){if(null!==event.data.self.logger&&event.data.self.logger.trace(event.data.self.Class.fullName,"onLoadstart"),void 0!==event.data.self.settings.callbacks.onReady)try{eval(event.data.self.settings.callbacks.onReady+"()")}catch(a){null!==event.data.self.logger&&event.data.self.logger.warn("Send callback failed.")}},onPlay:function(a){null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onPlay"),a.data.self.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.PLAYING,[a.data.self])},onPause:function(a){null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onPause"),a.data.self.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.PAUSED,[a.data.self])},onSeeked:function(a){if(a.data.self.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.SEEK,{currentTime:a.data.self.getCurrentTime()}),"number"==typeof a.data.self.captureTc)try{a.data.self.getCurrentImage(a.data.self.captureScale),a.data.self.captureTc=null}catch(b){null!==a.data.self.logger&&(a.data.self.logger.warn("Error to capture Tc"),a.data.self.logger.warn(b.stack))}},onEnded:function(event){if(null!==event.data.self.settings.duration&&(event.data.self.setCurrentTime(event.data.self.tcOffset),event.data.self.stop()),null!==event.data.self.logger&&event.data.self.logger.trace(event.data.self.Class.fullName,"onEnded"),event.data.self.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.ENDED,[event.data.self]),void 0!==event.data.self.settings.callbacks.onComplete)try{eval(event.data.self.settings.callbacks.onComplete+"()")}catch(a){null!==event.data.self.logger&&event.data.self.logger.warn("Send callback failed.")}},onDurationchange:function(a){a.data.self.hideLoader(),isNaN(a.data.self.getDuration())||0===a.data.self.getDuration()?a.data.self.mediaPlayer.one("durationchange",{self:a.data.self},a.data.self.onDurationchange):(a.data.self.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.STARTED,[a.data.self]),!0===a.data.self.settings.autoplay&&a.data.self.play())},onTimeupdate:function(event){var tcOffset=event.data.self.getTcOffset(),currentTime=event.data.self.getCurrentTime(),duration=event.data.self.getDuration()+tcOffset,percentage=100*(currentTime-tcOffset)/(duration-tcOffset);if(event.data.self.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.TIME_CHANGE,{self:event.data.self,currentTime:currentTime,duration:duration,percentage:percentage,tcOffset:event.data.self.getTcOffset()}),!0===event.data.self.isRangePlayer&&"number"==typeof event.data.self.rangePlayerTcout&&event.data.self.rangePlayerTcout<=currentTime&&event.data.self.pause(),void 0!==event.data.self.settings.callbacks.onTimeupdate)try{eval(event.data.self.settings.callbacks.onTimeupdate+"(currentTime)")}catch(a){null!==event.data.self.logger&&event.data.self.logger.warn("Send callback failed.")}},onSourceError:function(a){null!==a.data.self.logger&&(a.data.self.logger.warn(a.data.self.Class.fullName+" :: onSourceError"),a.data.self.logger.warn(a)),a.data.self.mediaContainer.trigger(fr.ina.amalia.player.PlayerEventType.ERROR,{self:a.data.self,errorCode:fr.ina.amalia.player.PlayerErrorCode.MEDIA_FILE_NOT_FOUND})}}),$.Class("fr.ina.amalia.player.MediaFactory",{},{settings:{},logger:null,mediaContainer:null,player:null,errorContainer:null,lastSeekTime:null,init:function(a,b){this.mediaContainer=$(a),this.lastSeekTime=0,this.settings=$.extend({player:"default",src:null,poster:"",autoplay:!1,plugins:{},callbacks:{},duration:null,debug:!1},b||{}),void 0!==fr.ina.amalia.player.log&&void 0!==fr.ina.amalia.player.log.LogHandler&&(this.logger=new fr.ina.amalia.player.log.LogHandler({enabled:this.settings.debug})),this.initialize()},initialize:function(){try{null!==this.settings.src?(this.loadPlayer(),null!==this.logger&&this.logger.trace(this.Class.fullName,"initialize")):(this.createErrorContainer(),this.setErrorCode(fr.ina.amalia.player.PlayerErrorCode.MEDIA_FILE_NOT_FOUND))}catch(a){this.createErrorContainer(),this.setErrorCode(fr.ina.amalia.player.PlayerErrorCode.ERROR_HTML5_SUPPORT),null!==this.logger&&this.logger.error(a.stack)}},createErrorContainer:function(){this.errorContainer=$("<div>",{class:"ajs-error"}),this.errorContainer.hide(),this.mediaContainer.append(this.errorContainer)},setErrorCode:function(a){if(void 0!==this.errorContainer){var b=$("<p>",{text:fr.ina.amalia.player.PlayerErrorCode.getMessage(a)});this.errorContainer.html(b),this.errorContainer.show()}},loadPlayer:function(){"default"===this.settings.player?this.loadHtml5MediaPlayer():this.player=eval("new "+this.settings.player+"(this.settings, this.mediaContainer);")},loadHtml5MediaPlayer:function(){if(null!==this.logger&&this.logger.info("Load html 5 media player"),!(new fr.ina.amalia.player.helpers.BrowserFeatureDetection).isSupportsVideos())throw null!==this.logger&&this.logger.error("Your browser does not support the video tag."),new Error("Your browser does not support the video tag.");this.player=new fr.ina.amalia.player.PlayerHtml5(this.settings,this.mediaContainer)},getPlayer:function(){return this.player}}),function(a){a.fn.mediaPlayer=function(b){return this.each(function(){var c=a(this),d="fr.ina.amalia.player";if(c.data(d))return null;b=a.extend({player:"default",plugins:{},src:null,framerate:25,autoplay:!0,controlBarClassName:"fr.ina.amalia.player.plugins.CustomControlBarPlugin",controlBar:{},tcOffset:0,mediaType:"",thumbRootDirectory:"",duration:null,togglePlayPause:!1,debug:!1},b||{});var e=new fr.ina.amalia.player.MediaFactory(this,b);c.data(d,e),c.addClass("ajs"),c.attr("style","width: 100%; height:100%;"),c.parent().css("position","relative")})}}(jQuery);