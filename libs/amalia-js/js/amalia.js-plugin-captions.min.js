/*! V1.3.3, Â© INA 2023 */
/**
 * Copyright (c) 2015-2023 Institut National de l'Audiovisuel, INA
 *
 * This file is part of amalia.js
 *
 * Amalia.js is free software: you can redistribute it and/or modify it under
 * the terms of the MIT License
 *
 * Redistributions of source code, javascript and css minified versions must
 * retain the above copyright notice, this list of conditions and the following
 * disclaimer
 *
 * Neither the name of the copyright holder nor the names of its contributors
 * may be used to endorse or promote products derived from this software without
 * specific prior written permission
 *
 * You should have received a copy of the MIT License along with
 * amalia.js. If not, see <https://opensource.org/license/mit/>
 *
 * Amalia.js is distributed in the hope that it will be useful, but WITHOUT ANY
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
 * A PARTICULAR PURPOSE.
 */
fr.ina.amalia.player.plugins.captions.CaptionsBase.extend("fr.ina.amalia.player.plugins.CaptionsPlugin",{classCss:"ajs-plugin plugin-caption",classCssFullscreenOn:"fullScreenOn",classCssFullscreenOff:"fullScreenOff"},{loadDataStarted:!1,selectedMetadataId:"",initialize:function(){this.container=$("<div>",{class:this.Class.classCss}),this.container.addClass(this.Class.classCssFullscreenOff),this.listOfData=[],this.settings=$.extend({debug:this.settings.debug,framerate:"25",internalPlugin:!1,metadataId:"",level:2},this.settings.parameters||{}),this.pluginContainer.append(this.container),this.definePlayerListeners()},definePlayerListeners:function(){var a=this.mediaPlayer.getContainer();""===this.settings.metadataId&&a.on(fr.ina.amalia.player.PlayerEventType.SELECTED_METADATA_CHANGE,{self:this},this.onSelectedMetadataChange),a.on(fr.ina.amalia.player.PlayerEventType.BEGIN_DATA_CHANGE,{self:this},this.onBeginDataChange),a.on(fr.ina.amalia.player.PlayerEventType.DATA_CHANGE,{self:this},this.onDataChange),a.on(fr.ina.amalia.player.PlayerEventType.END_DATA_CHANGE,{self:this},this.onEndDataChange),a.on(fr.ina.amalia.player.PlayerEventType.TIME_CHANGE,{self:this},this.onTimeupdate),a.on(fr.ina.amalia.player.PlayerEventType.FULLSCREEN_CHANGE,{self:this},this.onFullscreenModeChange),null!==this.logger&&this.logger.trace(this.Class.fullName,"definePlayerListeners")},updataBlockData:function(){""!==this.settings.metadataId?this.updateMetadata(this.settings.metadataId,this.settings.level,0,this.mediaPlayer.getDuration()):""!==this.selectedMetadataId&&this.updateMetadata(this.selectedMetadataId,this.settings.level,0,this.mediaPlayer.getDuration())},updatePos:function(a){a=parseFloat(a);for(var b=$.grep(this.listOfData,function(b){return a>=parseFloat(b.tcin)&&a<parseFloat(b.tcout)}),c="",d=null,e=0;e<b.length;e++)null!==(d=b[e])&&void 0!==d&&!0===d.hasOwnProperty("text")&&(c+=d.text.toString());""!==c?(this.container.html(c),this.container.show()):(this.container.html(""),this.container.hide())},setFullscreenMode:function(a){!0===a?this.container.removeClass(this.Class.classCssFullscreenOff).addClass(this.Class.classCssFullscreenOn):this.container.removeClass(this.Class.classCssFullscreenOn).addClass(this.Class.classCssFullscreenOff)},onFullscreenModeChange:function(a,b){a.data.self.setFullscreenMode(b.inFullScreen)},onSelectedMetadataChange:function(a,b){null!==b.metadataId&&(a.data.self.selectedMetadataId=b.metadataId.toString(),a.data.self.updataBlockData())},onBeginDataChange:function(a){a.data.self.loadDataStarted=!0,null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"onBeginDataChange")},onDataChange:function(a,b){!1===a.data.self.loadDataStarted&&a.data.self.selectedMetadataId===b.id&&a.data.self.updataBlockData()},onEndDataChange:function(a){a.data.self.loadDataStarted=!1,a.data.self.updataBlockData(),null!==a.data.self.logger&&a.data.self.logger.trace(a.data.self.Class.fullName,"EndDataChange")}});